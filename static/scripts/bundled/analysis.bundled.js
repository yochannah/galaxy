!function(t){function e(e){for(var n,s,r=e[0],l=e[1],c=e[2],u=0,h=[];u<r.length;u++)s=r[u],a[s]&&h.push(a[s][0]),a[s]=0;for(n in l)Object.prototype.hasOwnProperty.call(l,n)&&(t[n]=l[n]);for(d&&d(e);h.length;)h.shift()();return o.push.apply(o,c||[]),i()}function i(){for(var t,e=0;e<o.length;e++){for(var i=o[e],n=!0,r=1;r<i.length;r++){var l=i[r];0!==a[l]&&(n=!1)}n&&(o.splice(e--,1),t=s(s.s=i[0]))}return t}var n={},a={3:0},o=[];function s(e){if(n[e])return n[e].exports;var i=n[e]={i:e,l:!1,exports:{}};return t[e].call(i.exports,i,i.exports,s),i.l=!0,i.exports}s.e=function(t){var e=[],i=a[t];if(0!==i)if(i)e.push(i[2]);else{var n=new Promise(function(e,n){i=a[t]=[e,n]});e.push(i[2]=n);var o,r=document.createElement("script");r.charset="utf-8",r.timeout=120,s.nc&&r.setAttribute("nonce",s.nc),r.src=function(t){return s.p+""+({6:"ruleCollectionBuilder",7:"vendors~ruleCollectionBuilder"}[t]||t)+".chunk.js"}(t),o=function(e){r.onerror=r.onload=null,clearTimeout(l);var i=a[t];if(0!==i){if(i){var n=e&&("load"===e.type?"missing":e.type),o=e&&e.target&&e.target.src,s=new Error("Loading chunk "+t+" failed.\n("+n+": "+o+")");s.type=n,s.request=o,i[1](s)}a[t]=void 0}};var l=setTimeout(function(){o({type:"timeout",target:r})},12e4);r.onerror=r.onload=o,document.head.appendChild(r)}return Promise.all(e)},s.m=t,s.c=n,s.d=function(t,e,i){s.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},s.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},s.t=function(t,e){if(1&e&&(t=s(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(s.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)s.d(i,n,function(e){return t[e]}.bind(null,n));return i},s.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return s.d(e,"a",e),e},s.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},s.p="/static/scripts/bundled/",s.oe=function(t){throw console.error(t),t};var r=window.webpackJsonp=window.webpackJsonp||[],l=r.push.bind(r);r.push=e,r=r.slice();for(var c=0;c<r.length;c++)e(r[c]);var d=l;o.push([805,0,1]),i()}({10:function(t,e,i){"use strict";var n=i(0),a=i.n(n),o=i(1),s=i.n(o),r=i(3),l=i.n(r),c=i(80),d=i(8),u={View:l.a.View.extend({initialize:function(t){var e=this;this.model=t&&t.model||new l.a.Model({id:d.a.uid(),min:null,max:null,step:null,precise:!1,split:1e4,value:null,onchange:function(){}}).set(t),this.setElement(this._template()),this.$el.attr("id",this.model.id),this.$text=this.$(".ui-form-slider-text"),this.$slider=this.$(".ui-form-slider-element");var i=[];this.$text.on("change",function(){e.value(a()(this).val())}).on("keyup",function(t){i[t.which]=!1}).on("keydown",function(t){var n=t.which;i[n]=!0,e.model.get("is_workflow")&&i[16]&&52==n?(e.value("$"),event.preventDefault()):8==n||9==n||13==n||37==n||39==n||69==n||n>=48&&n<=57||n>=96&&n<=105||(190==n||110==n)&&-1==a()(this).val().indexOf(".")&&e.model.get("precise")||(189==n||109==n)&&-1==a()(this).val().indexOf("-")||e._isParameter(a()(this).val())||i[91]||i[17]||event.preventDefault()});var n=this.model.attributes;this.has_slider=null!==n.max&&null!==n.min&&n.max>n.min;var o=n.step;o||(o=n.precise&&this.has_slider?(n.max-n.min)/n.split:1),this.has_slider&&this.$slider.slider({min:n.min,max:n.max,step:o}).on("slide",function(t,i){e.value(i.value)}),this.listenTo(this.model,"change",this.render,this),this.render()},render:function(){var t=this.model.get("value");this.has_slider?(this.$slider.slider("value",t),this.$slider.show(),this.$text.addClass("col-3 mr-3")):(this.$slider.hide(),this.$text.removeClass("col-3 mr-3")),t!==this.$text.val()&&this.$text.val(t)},value:function(t){if(void 0!==t){var e=this.model.attributes,i=t,n=null!==t&&""!==t&&!this._isParameter(t);n&&(isNaN(t)&&(t=0),e.precise||(t=Math.round(t)),null===e.max||isNaN(e.max)||(t=Math.min(t,e.max)),null===e.min||isNaN(e.min)||(t=Math.max(t,e.min))),this.model.set("value",t),this.model.trigger("change"),e.onchange(t);var a=n&&parseInt(i)!==parseInt(t)?"This value was invalid or out-of-range. It has been auto-corrected.":null;this.model.trigger("error",a)}return this.model.get("value")},_isParameter:function(t){return this.model.get("is_workflow")&&"$"===String(t).substring(0,1)},_template:function(){return'<div class="ui-form-slider container-fluid">\n                    <div class="row">\n                        <input class="ui-input ui-form-slider-text" type="text"/>\n                        <div class="ui-form-slider-element col mt-1"/>\n                    </div>\n                </div>'}})},h=i(27),p=l.a.View.extend({initialize:function(t){var e=this;this.model=t&&t.model||new l.a.Model({visible:!0,cls:null,data:[],id:d.a.uid(),error_text:"No options available.",wait_text:"Please wait...",multiple:!1,optional:!1,onchange:function(){}}).set(t),this.listenTo(this.model,"change:value",this._changeValue,this),this.listenTo(this.model,"change:wait",this._changeWait,this),this.listenTo(this.model,"change:data",this._changeData,this),this.listenTo(this.model,"change:visible",this._changeVisible,this),this.on("change",function(){e.model.get("onchange")(e.value())}),this.render()},render:function(){var t=this;this.$el.empty().removeClass().addClass("ui-options").addClass(this.model.get("cls")).append(this.$message=a()("<div/>").addClass("mt-2")).append(this.$menu=a()("<div/>").addClass("ui-options-menu")).append(this.$options=a()(this._template())),this.all_button=null,this.model.get("multiple")&&(this.all_button=new h.a.ButtonCheck({onclick:function(){t.$("input").prop("checked",0!==t.all_button.value()),t.value(t._getValue()),t.trigger("change")}}),this.$menu.append(this.all_button.$el)),this._changeData(),this._changeWait(),this._changeVisible()},update:function(t){t.data&&this.model.set("data",t.data)},_changeData:function(){var t=this;this.$options.empty(),this._templateOptions?this.$options.append(this._templateOptions(this.model.get("data"))):s.a.each(this.model.get("data"),function(e){t.$options.append(a()(t._templateOption(e)).addClass("ui-option").tooltip({title:e.tooltip||"",placement:"bottom"}))}),this.$("input").on("change",function(){t.value(t._getValue()),t.trigger("change")}),this._changeValue(),this._changeWait()},_changeVisible:function(){this.$el[this.model.get("visible")?"show":"hide"]()},_changeWait:function(){this.model.get("wait")?0===this.length()&&(this._messageShow(this.model.get("wait_text"),"info"),this.$options.hide(),this.$menu.hide()):0===this.length()?(this._messageShow(this.model.get("error_text"),"danger"),this.$options.hide(),this.$menu.hide()):(this.$message.hide(),this.$options.css("display","inline-block"),this.$menu.show())},_changeValue:function(){this._setValue(this.model.get("value")),null!==this._getValue()||this.model.get("multiple")||this.model.get("optional")||this._setValue(this.first()),this.all_button&&this.all_button.value(a.a.isArray(this._getValue())?this._getValue().length:0,this.length())},value:function(t){return void 0!==t&&this.model.set("value",t),this._getValue()},first:function(){var t=this.$("input").first();return t.length>0?t.val():null},wait:function(){this.model.set("wait",!0)},unwait:function(){this.model.set("wait",!1)},length:function(){return this.$(".ui-option").length},show:function(){this.model.set("visible",!0)},hide:function(){this.model.set("visible",!1)},_setValue:function(t){var e=this;if(void 0!==t&&(this.$("input").prop("checked",!1),null!==t)){var i=a.a.isArray(t)?t:[t];s.a.each(i,function(t){e.$('input[value="'.concat(t,'"]')).first().prop("checked",!0)})}},_getValue:function(){var t=[];return this.$(":checked").each(function(){t.push(a()(this).val())}),d.a.isEmpty(t)?null:this.model.get("multiple")?t:t[0]},_messageShow:function(t,e){this.$message.show().removeClass().addClass("alert alert-".concat(e)).html(t)},_template:function(){return a()("<div/>").addClass("ui-options-list")}}),f=p.extend({_templateOption:function(t){var e=d.a.uid();return a()("<div/>").addClass("ui-option").append(a()("<input/>").attr({id:e,type:this.model.get("type"),name:this.model.id,value:t.value})).append(a()("<label/>").addClass("ui-options-label").attr("for",e).html(t.label))}}),m={};m.View=f.extend({initialize:function(t){t.type="radio",f.prototype.initialize.call(this,t)}});var g={};g.View=f.extend({initialize:function(t){t.type="checkbox",t.multiple=!0,f.prototype.initialize.call(this,t)}});var _={};_.View=p.extend({initialize:function(t){p.prototype.initialize.call(this,t)},_setValue:function(t){void 0!==t&&(this.$("input").prop("checked",!1),this.$("label").removeClass("active"),this.$('[value="'.concat(t,'"]')).prop("checked",!0).closest("label").addClass("active"))},_templateOption:function(t){var e=a()("<label/>").addClass("btn btn-secondary m-0");return t.icon&&e.append(a()("<i/>").addClass("fa").addClass(t.icon).addClass(!t.label&&"no-padding")),e.append(a()("<input/>").attr({type:"radio",name:this.model.id,value:t.value}).hide()),t.label&&e.append(t.label),e},_template:function(){return a()("<div/>").addClass("btn-group ui-radiobutton")}});var v={Base:p,BaseIcons:f,Radio:m,RadioButton:_,Checkbox:g},b={View:v.BaseIcons.extend({initialize:function(t){t.type=t.display||"checkbox",t.multiple="checkbox"==t.type,v.BaseIcons.prototype.initialize.call(this,t)},update:function(t){this.model.set("data",t.options)},_setValue:function(t){if(v.BaseIcons.prototype._setValue.call(this,t),null!=t&&this.header_index){var e=this,i=a.a.isArray(t)?t:[t];s.a.each(i,function(t){var i=e.header_index[t];s.a.each(i,function(t){e._setState(t,!0)})})}},_setState:function(t,e){var i=this.$(".button-".concat(t)),n=this.$(".subgroup-".concat(t));i.data("is_expanded",e),e?(n.show(),i.removeClass("fa-plus-square").addClass("fa-minus-square")):(n.hide(),i.removeClass("fa-minus-square").addClass("fa-plus-square"))},_templateOptions:function(){var t=this;function e(e,i){var n=e.find(".button-".concat(i));n.on("click",function(){t._setState(i,!n.data("is_expanded"))})}this.header_index={};var i=a()("<div/>");return function i(n,o,s){for(var r in s=s||[],o){var l=o[r],c=l.options&&l.options.length>0,u=s.slice(0);t.header_index[l.value]=u.slice(0);var h=a()("<div/>");if(c){var p=d.a.uid(),f=a()("<span/>").addClass("button-".concat(p)).addClass("ui-drilldown-button fa fa-plus-square"),m=a()("<div/>").addClass("subgroup-".concat(p)).addClass("ui-drilldown-subgroup");h.append(a()("<div/>").append(f).append(t._templateOption({label:l.name,value:l.value}))),u.push(p),i(m,l.options,u),h.append(m),e(h,p)}else h.append(t._templateOption({label:l.name,value:l.value}));n.append(h)}}(i,this.model.get("data")),i},_template:function(){return a()("<div/>").addClass("ui-options-list drilldown-container").attr("id",this.model.id)}})},w=i(19),y=l.a.View.extend({initialize:function(t){this.model=t&&t.model||new l.a.Model({message:null,status:"info",cls:"",persistent:!1,fade:!0}).set(t),this.listenTo(this.model,"change",this.render,this),t&&t.active_tab&&(this.active_tab=t.active_tab),this.render()},update:function(t){this.model.set(t)},render:function(){var t=this.model.get("status");if(this.$el.removeClass().addClass("alert alert-".concat(t," mt-2")).addClass(this.model.get("cls")),this.model.get("message")){if(this.$el.html(this.messageForDisplay()),this.$el[this.model.get("fade")?"fadeIn":"show"](),this.timeout&&window.clearTimeout(this.timeout),!this.model.get("persistent")){var e=this;this.timeout=window.setTimeout(function(){e.model.set("message","")},3e3)}}else this.$el.hide();return this},messageForDisplay:function(){return s.a.escape(this.model.get("message"))}}),x=y.extend({messageForDisplay:function(){return this.model.get("message")}}),k=l.a.View.extend({initialize:function(t){this.model=t&&t.model||new l.a.Model({type:"text",placeholder:"",disabled:!1,readonly:!1,visible:!0,cls:"",area:!1,color:null,style:null}).set(t),this.tagName=this.model.get("area")?"textarea":"input",this.setElement(a()("<".concat(this.tagName,"/>"))),this.listenTo(this.model,"change",this.render,this),this.render()},events:{input:"_onchange"},value:function(t){return void 0!==t&&this.model.set("value","string"==typeof t?t:""),this.model.get("value")},render:function(){var t=this;this.$el.removeClass().addClass("ui-".concat(this.tagName)).addClass(this.model.get("cls")).addClass(this.model.get("style")).attr("id",this.model.id).attr("type",this.model.get("type")).attr("placeholder",this.model.get("placeholder")).css("color",this.model.get("color")||"").css("border-color",this.model.get("color")||"");var e=this.model.get("datalist");return a.a.isArray(e)&&e.length>0&&this.$el.autocomplete({source:function(e,i){i(t.model.get("datalist"))},change:function(){t._onchange()}}),this.model.get("value")!==this.$el.val()&&this.$el.val(this.model.get("value")),s.a.each(["readonly","disabled"],function(e){t.model.get(e)?t.$el.attr(e,!0):t.$el.removeAttr(e)}),this.$el[this.model.get("visible")?"show":"hide"](),this},_onchange:function(){this.value(this.$el.val()),this.model.get("onchange")&&this.model.get("onchange")(this.model.get("value"))}}),C=l.a.View.extend({initialize:function(t){this.model=t&&t.model||new l.a.Model(t),this.setElement(a()("<div/>").append(this.$info=a()("<div/>")).append(this.$hidden=a()("<div/>"))),this.listenTo(this.model,"change",this.render,this),this.render()},value:function(t){return void 0!==t&&this.model.set("value",t),this.model.get("value")},render:function(){return this.$el.attr("id",this.model.id),this.$hidden.val(this.model.get("value")),this.model.get("info")?this.$info.show().text(this.model.get("info")):this.$info.hide(),this}}),S=l.a.View.extend({initialize:function(t){var e=this;this.select=new t.SelectClass.View(t),this.model=this.select.model,this.text=new k({onchange:this.model.get("onchange")}),this.on("change",function(){e.model.get("onchange")&&e.model.get("onchange")(e.value())}),this.setElement(a()("<div/>").append(this.select.$el).append(this.text.$el)),this.update(t)},wait:function(){this.select.wait()},unwait:function(){this.select.unwait()},value:function(t){return(this.textmode?this.text:this.select).value(t)},update:function(t){var e=t.data;e||(e=[],s.a.each(t.options,function(t){e.push({label:t[0],value:t[1]})}));var i=this.value();this.textmode=t.textable&&(!a.a.isArray(e)||0===e.length),this.text.$el[this.textmode?"show":"hide"](),this.select.$el[this.textmode?"hide":"show"](),this.select.update({data:e}),this.value(i)}}),T=l.a.View.extend({initialize:function(t){var e=this;this.model=t&&t.model||new l.a.Model(t),this.setElement(a()("<div/>").append(this.$info=a()("<div/>")).append(this.$file=a()("<input/>").attr("type","file").addClass("mb-1")).append(this.$text=a()("<textarea/>").addClass("ui-textarea").attr("disabled",!0)).append(this.$wait=a()("<i/>").addClass("fa fa-spinner fa-spin"))),this.listenTo(this.model,"change",this.render,this),this.$file.on("change",function(t){e._readFile(t)}),this.render()},value:function(t){return void 0!==t&&this.model.set("value",t),this.model.get("value")},render:function(){return this.$el.attr("id",this.model.id),this.model.get("info")?this.$info.show().text(this.model.get("info")):this.$info.hide(),this.model.get("value")?this.$text.text(this.model.get("value")).show():this.$text.hide(),this.model.get("wait")?this.$wait.show():this.$wait.hide(),this},_readFile:function(t){var e=this,i=t.target.files&&t.target.files[0];if(i){var n=new FileReader;n.onload=function(){e.model.set({wait:!1,value:this.result})},this.model.set({wait:!0,value:null}),n.readAsText(i)}}});h.a.Button,h.a.ButtonCheck,h.a.ButtonMenu,h.a.ButtonLink,v.Checkbox,v.RadioButton,v.Radio,e.a={Button:h.a.Button,ButtonCheck:h.a.ButtonCheck,ButtonMenu:h.a.ButtonMenu,ButtonLink:h.a.ButtonLink,Input:k,Message:y,UnescapedMessage:x,Upload:T,Modal:w.a,RadioButton:v.RadioButton,Checkbox:v.Checkbox,Radio:v.Radio,Select:c.a,TextSelect:S,Hidden:C,Slider:u,Drilldown:b}},100:function(t,e,i){"use strict";var n=i(3),a=i.n(n),o=i(4),s=(i(49),["new","queued","running"]),r=["error","deleted"],l=a.a.Model.extend({url:function(){return"".concat(Object(o.getAppRoot)(),"api/histories/").concat(this.attributes.history_id,"/contents/dataset_collections/").concat(this.attributes.collection_id,"/jobs_summary")},hasDetails:function(){return this.has("populated_state")},new:function(){return!this.hasDetails()||"new"==this.get("populated_state")},errored:function(){return"error"===this.get("populated_state")||this.anyWithStates(r)},states:function(){return this.get("states")||{}},anyWithState:function(t){return(this.states()[t]||0)>0},anyWithStates:function(t){var e=this.states();for(var i in t)if((e[t[i]]||0)>0)return!0;return!1},numWithStates:function(t){var e=this.states(),i=0;for(var n in t)i+=e[t[n]]||0;return i},numInError:function(){return this.numWithStates(r)},running:function(){return this.anyWithState("running")},terminal:function(){return!this.new()&&!this.anyWithStates(s)},jobCount:function(){var t=this.states(),e=0;for(var i in t)e+=t[i];return e},toString:function(){return"JobStatesSummary(id=".concat(this.get("id"),")")}}),c=a.a.Collection.extend({model:l,initialize:function(){var t=this;this.on({add:function(e){t.active||e.fetch()}}),this.updateTimeoutId=null,this.active=!0},url:function(){var t=this.models.filter(function(t){return!t.terminal()}),e=t.map(function(t){return t.get("id")}).join(","),i=t.map(function(t){return t.get("model")}).join(",");return"".concat(Object(o.getAppRoot)(),"api/histories/").concat(this.historyId,"/jobs_summary?ids=").concat(e,"&types=").concat(i)},monitor:function(){var t=this;if(this.clearUpdateTimeout(),this.active){var e=function(){t.updateTimeoutId=setTimeout(function(){t.monitor()},2e3)},i=this.models.filter(function(t){return!t.terminal()});i.length,i.length>0?this.fetch({remove:!1}).done(e):e()}},clearUpdateTimeout:function(){this.updateTimeoutId&&(clearTimeout(this.updateTimeoutId),this.updateTimeoutId=null)},toString:function(){return"JobStatesSummaryCollection()"}});e.a={JobStatesSummary:l,JobStatesSummaryCollection:c,FETCH_STATE_ON_ADD:!1,NON_TERMINAL_STATES:s,ERROR_STATES:r}},101:function(t,e,i){"use strict";var n=i(2),a=i.n(n),o=i(1),s=i.n(o),r=i(0),l=i.n(r),c=i(3),d=i.n(c),u=i(5),h=i(8),p=i(67),f=i(10),m=d.a.View.extend({initialize:function(t){this.list={},this.options=h.a.merge(t,{title:a()("Repeat"),empty_text:"Not available.",max:null,min:null}),this.button_new=new f.a.Button({icon:"fa-plus",title:"Insert ".concat(this.options.title),tooltip:"Add new ".concat(this.options.title," block"),cls:"btn btn-secondary float-none form-repeat-add",onclick:function(){t.onnew&&t.onnew()}}),this.setElement(l()("<div/>").append(this.$list=l()("<div/>")).append(l()("<div/>").append(this.button_new.$el)))},size:function(){return s.a.size(this.list)},add:function(t){var e=Object(u.a)();if(t.id&&!this.list[t.id]){var i=new f.a.Button({icon:"fa-trash-o",tooltip:a()("Delete this repeat block"),cls:"ui-button-icon-plain form-repeat-delete",onclick:function(){t.ondel&&t.ondel()}}),n=new p.a.View({id:t.id,title:a()("placeholder"),cls:t.cls||"ui-portlet-section",operations:{button_delete:i}});n.append(t.$el),n.$el.addClass("section-row").hide(),this.list[t.id]=n,this.$list.append(n.$el.fadeIn("fast")),this.options.max>0&&this.size()>=this.options.max&&this.button_new.disable(),this._refresh()}else e.emit.debug("form-repeat::add()","Duplicate or invalid repeat block id.")},del:function(t){var e=Object(u.a)();this.list[t]?(this.$list.find("#".concat(t)).remove(),delete this.list[t],this.button_new.enable(),this._refresh()):e.emit.debug("form-repeat::del()","Invalid repeat block id.")},delAll:function(){for(var t in this.list)this.del(t)},hideOptions:function(){this.button_new.$el.hide(),s.a.each(this.list,function(t){t.hideOperation("button_delete")}),s.a.isEmpty(this.list)&&this.$el.append(l()("<div/>").addClass("form-text text-muted").html(this.options.empty_text))},_refresh:function(){var t=0;for(var e in this.list){var i=this.list[e];i.title("".concat(++t,": ").concat(this.options.title)),i[this.size()>this.options.min?"showOperation":"hideOperation"]("button_delete")}}});e.a={View:m}},102:function(t,e,i){"use strict";var n=i(0),a=i.n(n),o=i(4),s=1e3;try{s=localStorage.getItem("collectionFuzzyCountDefault")||s}catch(t){console.debug(t)}var r={defaults:{history_id:null,history_content_type:null,hid:null,visible:!0},idAttribute:"type_id",hidden:function(){return!this.get("visible")},isVisible:function(t,e){var i=!0;return t||!this.get("deleted")&&!this.get("purged")||(i=!1),e||this.get("visible")||(i=!1),i},urlRoot:"".concat(Object(o.getAppRoot)(),"api/histories/"),url:function(){var t=this.get("history_content_type"),e=this.get("history_id"),i=this.get("id"),n="".concat(this.urlRoot).concat(e,"/contents/").concat(t,"s/").concat(i);return"dataset_collection"==t&&(n="".concat(n,"?view=element-reference&fuzzy_count=").concat(s)),n},hide:function(t){return this.get("visible")?this.save({visible:!1},t):a.a.when()},unhide:function(t){return this.get("visible")?a.a.when():this.save({visible:!0},t)},toString:function(){return[this.get("type_id"),this.get("hid"),this.get("name")].join(":")}};e.a={HistoryContentMixin:r}},103:function(t,e,i){"use strict";var n=i(0),a=i.n(n),o=i(1),s=i.n(o),r=i(3),l=i.n(r),c=i(28),d=i(46),u=i(7),h=i(2),p=i.n(h),f=l.a.View.extend(u.a.LoggableMixin).extend({_logNamespace:"collections",tagName:"li",className:"collection-element",initialize:function(t){this.element=t.element||{},this.identifier=t.identifier},render:function(){return this.$el.attr("data-element-id",this.element.id).html(this.template({identifier:this.identifier,element:this.element})),this},template:s.a.template(['<span class="identifier"><%- identifier %></span>','<span class="name"><%- element.name %></span>'].join("")),destroy:function(){this.off(),this.$el.remove()},toString:function(){return"DatasetCollectionElementView()"}}),m=c.a.ListCollectionCreator,g=m.extend({elementViewClass:f,collectionClass:d.a.HistoryDatasetCollection,className:"pair-collection-creator collection-creator flex-row-container",_mangleDuplicateNames:function(){},render:function(t,e){return 2===this.workingElements.length?m.prototype.render.call(this,t,e):this._renderInvalid(t,e)},_renderList:function(t,e){var i=this,n=a()("<div/>"),o=i.$list();s.a.each(this.elementViews,function(t){t.destroy(),i.removeElementView(t)}),n.append(i._createForwardElementView().$el),n.append(i._createReverseElementView().$el),o.empty().append(n.children()),s.a.invoke(i.elementViews,"render")},_createForwardElementView:function(){return this._createElementView(this.workingElements[0],{identifier:"forward"})},_createReverseElementView:function(){return this._createElementView(this.workingElements[1],{identifier:"reverse"})},_createElementView:function(t,e){var i=new this.elementViewClass(s.a.extend(e,{element:t}));return this.elementViews.push(i),i},swap:function(){this.workingElements=[this.workingElements[1],this.workingElements[0]],this._renderList()},events:s.a.extend(s.a.clone(m.prototype.events),{"click .swap":"swap"}),templates:s.a.extend(s.a.clone(m.prototype.templates),{middle:s.a.template(['<div class="collection-elements-controls">','<a class="swap" href="javascript:void(0);" title="',p()("Swap forward and reverse datasets"),'">',p()("Swap"),"</a>","</div>",'<div class="collection-elements scroll-container flex-row">',"</div>"].join("")),helpContent:s.a.template(["<p>",p()(["Pair collections are permanent collections containing two datasets: one forward and one reverse. ","Often these are forward and reverse reads. The pair collections can be passed to tools and ","workflows in order to have analyses done on both datasets. This interface allows ","you to create a pair, name it, and swap which is forward and which reverse."].join("")),"</p>","<ul>","<li>",p()(['Click the <i data-target=".swap">"Swap"</i> link to make your forward dataset the reverse ',"and the reverse dataset forward."].join("")),"</li>","<li>",p()(['Click the <i data-target=".cancel-create">"Cancel"</i> button to exit the interface.'].join("")),"</li>","</ul><br />","<p>",p()(['Once your collection is complete, enter a <i data-target=".collection-name">name</i> and ','click <i data-target=".create-collection">"Create list"</i>.'].join("")),"</p>"].join("")),invalidInitial:s.a.template(['<div class="header flex-row no-flex">','<div class="alert alert-warning" style="display: block">','<span class="alert-message">',"<% if( _.size( problems ) ){ %>",p()("The following selections could not be included due to problems"),"<ul><% _.each( problems, function( problem ){ %>","<li><b><%- problem.element.name %></b>: <%- problem.text %></li>","<% }); %></ul>","<% } else if( _.size( elements ) === 0 ){ %>",p()("No datasets were selected"),".","<% } else if( _.size( elements ) === 1 ){ %>",p()("Only one dataset was selected"),": <%- elements[0].name %>","<% } else if( _.size( elements ) > 2 ){ %>",p()("Too many datasets were selected"),': <%- _.pluck( elements, "name" ).join( ", ") %>',"<% } %>","<br />",p()("Two (and only two) elements are needed for the pair"),". ",p()("You may need to "),'<a class="cancel-create" href="javascript:void(0)">',p()("cancel"),"</a> ",p()("and reselect new elements"),".","</span>","</div>","</div>",'<div class="footer flex-row no-flex">','<div class="actions clear vertically-spaced">','<div class="other-options float-left">','<button class="cancel-create btn" tabindex="-1">',p()("Cancel"),"</button>","</div>","</div>","</div>"].join(""))}),toString:function(){return"PairCollectionCreator"}}),_=function(t,e){return(e=e||{}).title=p()("Create a collection from a pair of datasets"),c.a.collectionCreatorModal(t,e,g)};e.a={PairCollectionCreator:g,pairCollectionCreatorModal:_,createPairCollection:function(t,e){var i=t.toJSON(),n=!e;return _(i,{defaultHideSourceItems:e,creationFn:function(e,i,a){return e=[{name:"forward",src:"hda",id:e[0].id},{name:"reverse",src:"hda",id:e[1].id}],t.createHDCA(e,"paired",i,a,n)}})}}},104:function(t,e,i){"use strict";var n=i(0),a=i.n(n),o=i(1),s=i.n(o),r=i(3),l=i.n(r),c=i(5),d=i(7),u=l.a.Collection.extend({initialize:function(t,e){l.a.Collection.prototype.initialize.call(this,t,e),this.setOrder(e.order||this.order,{silent:!0})},_setUpListeners:function(){return this.on({"changed-order":this.sort})},fetch:function(t){return t=this._buildFetchOptions(t),Object(c.a)().debug("fetch options:",t),l.a.Collection.prototype.fetch.call(this,t)},_buildFetchOptions:function(t){var e=Object(c.a)();(t=s.a.clone(t)||{}).traditional=!0,t.data=t.data||this._buildFetchData(t),e.debug("data:",t.data);var i=this._buildFetchFilters(t);return e.debug("filters:",i),s.a.isEmpty(i)||s.a.extend(t.data,this._fetchFiltersToAjaxData(i)),e.debug("data:",t.data),t},_buildFetchData:function(t){var e={};return this.order&&(e.order=this.order),s.a.defaults(s.a.pick(t,this._fetchParams),e)},_fetchParams:["order","limit","offset","view","keys"],_buildFetchFilters:function(t){return s.a.clone(t.filters||{})},_fetchFiltersToAjaxData:function(t){var e={q:[],qv:[]};return s.a.each(t,function(t,i){void 0!==t&&""!==t&&(!0===t&&(t="True"),!1===t&&(t="False"),null===t&&(t="None"),e.q.push(i),e.qv.push(t))}),e},reset:function(t,e){return this.allFetched=!1,l.a.Collection.prototype.reset.call(this,t,e)},order:null,comparators:{update_time:d.a.buildComparator("update_time",{ascending:!1}),"update_time-asc":d.a.buildComparator("update_time",{ascending:!0}),create_time:d.a.buildComparator("create_time",{ascending:!1}),"create_time-asc":d.a.buildComparator("create_time",{ascending:!0})},setOrder:function(t,e){e=e||{};var i=this.comparators[t];if(s.a.isUndefined(i))throw new Error("unknown order: ".concat(t));if(i!==this.comparator)return this.order=t,this.comparator=i,e.silent||this.trigger("changed-order",e),this}}),h=u.extend({limitPerPage:500,initialize:function(t,e){u.prototype.initialize.call(this,t,e),this.currentPage=e.currentPage||0},getTotalItemCount:function(){return this.length},shouldPaginate:function(){return this.getTotalItemCount()>=this.limitPerPage},getLastPage:function(){return Math.floor(this.getTotalItemCount()/this.limitPerPage)},getPageCount:function(){return this.getLastPage()+1},getPageLimitOffset:function(t){return t=this.constrainPageNum(t),{limit:this.limitPerPage,offset:t*this.limitPerPage}},constrainPageNum:function(t){return Math.max(0,Math.min(t,this.getLastPage()))},fetchPage:function(t,e){var i=this;return t=i.constrainPageNum(t),i.currentPage=t,e=s.a.defaults(e||{},i.getPageLimitOffset(t)),i.trigger("fetching-more"),i.fetch(e).always(function(){i.trigger("fetching-more-done")})},fetchCurrentPage:function(t){return this.fetchPage(this.currentPage,t)},fetchPrevPage:function(t){return this.fetchPage(this.currentPage-1,t)},fetchNextPage:function(t){return this.fetchPage(this.currentPage+1,t)}}),p=u.extend({limitOnFirstFetch:null,limitPerFetch:100,initialize:function(t,e){u.prototype.initialize.call(this,t,e),this.limitOnFirstFetch=e.limitOnFirstFetch||this.limitOnFirstFetch,this.limitPerFetch=e.limitPerFetch||this.limitPerFetch,this.allFetched=!1,this.lastFetched=e.lastFetched||0},_buildFetchOptions:function(t){return t.remove=t.remove||!1,u.prototype._buildFetchOptions.call(this,t)},fetchFirst:function(t){return Object(c.a)().debug("ControlledFetchCollection.fetchFirst:",t),t=t?s.a.clone(t):{},this.allFetched=!1,this.lastFetched=0,this.fetchMore(s.a.defaults(t,{reset:!0,limit:this.limitOnFirstFetch}))},fetchMore:function(t){var e=Object(c.a)();e.debug("ControlledFetchCollection.fetchMore:",t),t=s.a.clone(t||{});var i=this;if(e.debug("fetchMore, options.reset:",t.reset),!t.reset&&i.allFetched)return a.a.when();t.reset?t.offset=0:void 0===t.offset&&(t.offset=i.lastFetched);var n=t.limit=t.limit||i.limitPerFetch||null;return e.debug("fetchMore, limit:",n,"offset:",t.offset),i.trigger("fetching-more"),i.fetch(t).always(function(){i.trigger("fetching-more-done")}).done(function(t){var a=s.a.isArray(t)?t.length:0;i.lastFetched+=a,e.debug("fetchMore, lastFetched:",i.lastFetched),(!n||a<n)&&(i.allFetched=!0,i.trigger("all-fetched",this))})},fetchAll:function(t){t=t||{};var e=this;return(t=s.a.pick(t,"silent")).filters={},e.fetch(t).done(function(){e.allFetched=!0,e.trigger("all-fetched",e)})}});e.a={ControlledFetchCollection:u,PaginatedCollection:h,InfinitelyScrollingCollection:p}},105:function(t,e,i){"use strict";var n=i(0),a=i.n(n),o=i(3),s=i.n(o),r=i(1),l=i.n(r),c=i(25),d=i(77),u=i(7),h=i(2),p=i.n(h),f=(i(120),s.a.View.extend(u.a.LoggableMixin).extend({_logNamespace:"list",viewClass:c.c.ListItemView,collectionClass:s.a.Collection,tagName:"div",className:"list-panel",fxSpeed:"fast",emptyMsg:p()("This list is empty"),noneFoundMsg:p()("No matching items found"),searchPlaceholder:p()("search"),initialize:function(t,e){(t=t||{}).logger&&(this.logger=t.logger),this.log("".concat(this,".initialize:"),t),this.fxSpeed=l.a.has(t,"fxSpeed")?t.fxSpeed:this.fxSpeed,this.filters=[],this.searchFor=t.searchFor||"",this.selecting=void 0===t.selecting||t.selecting,this.selected=t.selected||[],this.lastSelected=null,this.dragItems=t.dragItems||!1,this.viewClass=t.viewClass||this.viewClass,this.views=[],this.collection=t.collection||this._createDefaultCollection(),this.filters=t.filters||[],this.$scrollContainer=t.$scrollContainer||this.$scrollContainer,this.title=t.title||"",this.subtitle=t.subtitle||"",this._setUpListeners()},_setUpListeners:function(){return this.off(),this.on({error:function(t,e,i,n,a){console.error(t,e,i,n,a)},loading:function(){this._showLoadingIndicator("loading...",40)},"loading-done":function(){this._hideLoadingIndicator(40)}}),this.once("rendered",function(){this.trigger("rendered:initial",this)}),this._setUpCollectionListeners(),this._setUpViewListeners(),this},_createDefaultCollection:function(){return new this.collectionClass([])},_setUpCollectionListeners:function(){return this.log("".concat(this,"._setUpCollectionListeners"),this.collection),this.stopListening(this.collection),this.listenTo(this.collection,{error:function(t,e,i,n,a){this.trigger("error",t,e,i,n,a)},update:function(t,e){var i=e.changes;return e.renderAll||i.added.length+i.removed.length>1?this.renderItems():1===i.added.length?this.addItemView(l.a.first(i.added),t,e):1===i.removed.length?this.removeItemView(l.a.first(i.removed),t,e):void 0}}),this},_setUpViewListeners:function(){this.log("".concat(this,"._setUpViewListeners")),this.on({"view:selected":function(t,e){if(e&&e.shiftKey&&this.lastSelected){var i=this.viewFromModelId(this.lastSelected);i&&this.selectRange(t,i)}else e&&e.altKey&&!this.selecting&&this.showSelectors();this.selected.push(t.model.id),this.lastSelected=t.model.id},"view:de-selected":function(t,e){this.selected=l.a.without(this.selected,t.model.id)}})},render:function(t){this.log("".concat(this,".render"),t);var e=this._buildNewRender();return this._setUpBehaviors(e),this._queueNewRender(e,t),this},_buildNewRender:function(){this.debug("".concat(this,"(ListPanel)._buildNewRender"));var t=a()(this.templates.el({},this));return this._renderControls(t),this._renderTitle(t),this._renderSubtitle(t),this._renderSearch(t),this.renderItems(t),t},_renderControls:function(t){this.debug("".concat(this,"(ListPanel)._renderControls"));var e=a()(this.templates.controls({},this));return t.find(".controls").replaceWith(e),e},_renderTitle:function(t){},_renderSubtitle:function(t){},_queueNewRender:function(t,e){e=void 0===e?this.fxSpeed:e;var i=this;i.log("_queueNewRender:",t,e),a()(i).queue("fx",[function(t){i.$el.fadeOut(e,t)},function(e){i._swapNewRender(t),e()},function(t){i.$el.fadeIn(e,t)},function(t){i.trigger("rendered",i),t()}])},_swapNewRender:function(t){return this.$el.empty().attr("class",this.className).append(t.children()),this.selecting&&this.showSelectors(0),this},_setUpBehaviors:function(t){return t=t||this.$el,this.$controls(t).find("[title]").tooltip(),this._renderMultiselectActionMenu(t),this},_renderMultiselectActionMenu:function(t){var e=(t=t||this.$el).find(".list-action-menu"),i=this.multiselectActions();if(!i.length)return e.empty();var n=a()(['<div class="list-action-menu btn-group">','<button class="list-action-menu-btn btn btn-secondary dropdown-toggle" data-toggle="dropdown">',p()("For all selected"),"...","</button>",'<ul class="dropdown-menu float-right" role="menu">',"</ul>","</div>"].join("")),o=i.map(function(t){var e=['<li><a href="javascript:void(0);">',t.html,"</a></li>"].join("");return a()(e).click(function(e){return e.preventDefault(),t.func(e)})});return n.find("ul").append(o),e.replaceWith(n),n},multiselectActions:function(){return[]},$scrollContainer:function(t){return(t||this.$el).parent().parent()},$controls:function(t){return(t||this.$el).find("> .controls")},$list:function(t){return(t||this.$el).find("> .list-items")},$messages:function(t){return(t||this.$el).find("> .controls .messages")},$emptyMessage:function(t){return(t||this.$el).find("> .empty-message")},renderItems:function(t){t=t||this.$el;var e=this;e.log("".concat(this,".renderItems"),t);var i=e.$list(t);e.freeViews();var n=e._filterCollection();return e.views=n.map(function(t){return e._createItemView(t)}),i.empty(),e.views.length&&e._attachItems(t),e._renderEmptyMessage(t).toggle(!e.views.length),e.trigger("views:ready",e.views),e.views},_filterCollection:function(){return this.collection.filter(l.a.bind(this._filterItem,this))},_filterItem:function(t){return l.a.every(this.filters.map(function(e){return e.call(t)}))&&(!this.searchFor||t.matchesAll(this.searchFor))},_createItemView:function(t){var e=new(this._getItemViewClass(t))(l.a.extend(this._getItemViewOptions(t),{model:t}));return this._setUpItemViewListeners(e),e},_destroyItemView:function(t){this.stopListening(t),this.views=l.a.without(this.views,t)},_destroyItemViews:function(t){var e=this;return e.views.forEach(function(t){e.stopListening(t)}),e.views=[],e},freeViews:function(){return this._destroyItemViews()},_getItemViewClass:function(t){return this.viewClass},_getItemViewOptions:function(t){return{fxSpeed:this.fxSpeed,expanded:!1,selectable:this.selecting,selected:l.a.contains(this.selected,t.id),draggable:this.dragItems}},_setUpItemViewListeners:function(t){var e=this;return this.listenTo(t,"all",function(){var t=Array.prototype.slice.call(arguments,0);t[0]="view:".concat(t[0]),e.trigger.apply(e,t)}),this.listenTo(t,"draggable:dragstart",function(t,e){var i={},n=this.getSelectedModels();i=n.length?n.toJSON():[e.model.toJSON()],t.dataTransfer.setData("text",JSON.stringify(i))},this),e},_attachItems:function(t){var e=this;return this.$list(t).append(this.views.map(function(t){return e._renderItemView$el(t)})),this},_renderItemView$el:function(t){return t.render(0).$el},_renderEmptyMessage:function(t){this.debug("_renderEmptyMessage",t,this.searchFor);var e=this.searchFor?this.noneFoundMsg:this.emptyMsg;return this.$emptyMessage(t).text(e)},expandAll:function(){l.a.each(this.views,function(t){t.expand()})},collapseAll:function(){l.a.each(this.views,function(t){t.collapse()})},addItemView:function(t,e,i){var n=this,o=n._filterCollection().indexOf(t);if(-1!==o){var s=n._createItemView(t);return a()(s).queue("fx",[function(t){n.$emptyMessage().is(":visible")?n.$emptyMessage().fadeOut(n.fxSpeed,t):t()},function(t){n._attachView(s,o),t()}]),s}},_attachView:function(t,e,i){i=!!l.a.isUndefined(i)||i,e=e||0;var n=this;return n.views.splice(e,0,t),n._insertIntoListAt(e,n._renderItemView$el(t).hide()),n.trigger("view:attached",t),i?t.$el.slideDown(n.fxSpeed,function(){n.trigger("view:attached:rendered")}):(t.$el.show(),n.trigger("view:attached:rendered")),t},_insertIntoListAt:function(t,e){var i=this.$list();return 0===t?i.prepend(e):i.children().eq(t-1).after(e),e},removeItemView:function(t,e,i){var n=this,o=l.a.find(n.views,function(e){return e.model===t});if(o)return n.views=l.a.without(n.views,o),n.trigger("view:removed",o),a()({}).queue("fx",[function(t){o.$el.fadeOut(n.fxSpeed,t)},function(t){o.remove(),n.trigger("view:removed:rendered"),n.views.length?t():n._renderEmptyMessage().fadeIn(n.fxSpeed,t)}]),o},viewFromModelId:function(t){return l.a.find(this.views,function(e){return e.model.id===t})},viewFromModel:function(t){return t?this.viewFromModelId(t.id):void 0},viewsWhereModel:function(t){return this.views.filter(function(e){return l.a.isMatch(e.model.attributes,t)})},viewRange:function(t,e){if(t===e)return t?[t]:[];var i=this.views.indexOf(t),n=this.views.indexOf(e);return-1===i||-1===n?i===n?[]:-1===i?[e]:[t]:i<n?this.views.slice(i,n+1):this.views.slice(n,i+1)},_renderSearch:function(t){return t.find(".controls .search-input").searchInput({placeholder:this.searchPlaceholder,initialVal:this.searchFor,onfirstsearch:l.a.bind(this._firstSearch,this),onsearch:l.a.bind(this.searchItems,this),onclear:l.a.bind(this.clearSearch,this)}),t},_firstSearch:function(t){return this.log("onFirstSearch",t),this.searchItems(t)},searchItems:function(t,e){if(this.log("searchItems",t,this.searchFor,e),!e&&this.searchFor===t)return this;this.searchFor=t,this.renderItems(),this.trigger("search:searching",t,this);var i=this.$("> .controls .search-query");return i.val()!==t&&i.val(t),this},clearSearch:function(t){return this.searchFor="",this.trigger("search:clear",this),this.$("> .controls .search-query").val(""),this.renderItems(),this},THROTTLE_SELECTOR_FX_AT:20,showSelectors:function(t){t=void 0!==t?t:this.fxSpeed,this.selecting=!0,this.$(".list-actions").slideDown(t),t=this.views.length>=this.THROTTLE_SELECTOR_FX_AT?0:t,l.a.each(this.views,function(e){e.showSelector(t)})},hideSelectors:function(t){t=void 0!==t?t:this.fxSpeed,this.selecting=!1,this.$(".list-actions").slideUp(t),t=this.views.length>=this.THROTTLE_SELECTOR_FX_AT?0:t,l.a.each(this.views,function(e){e.hideSelector(t)}),this.selected=[],this.lastSelected=null},toggleSelectors:function(){this.selecting?this.hideSelectors():this.showSelectors()},selectAll:function(t){l.a.each(this.views,function(e){e.select(t)})},deselectAll:function(t){this.lastSelected=null,l.a.each(this.views,function(e){e.deselect(t)})},selectRange:function(t,e){var i=this.viewRange(t,e);return l.a.each(i,function(t){t.select()}),i},getSelectedViews:function(){return l.a.filter(this.views,function(t){return t.selected})},getSelectedModels:function(){return new this.collection.constructor(l.a.map(this.getSelectedViews(),function(t){return t.model}))},_showLoadingIndicator:function(t,e,i){this.debug("_showLoadingIndicator",this.indicator,t,e,i),e=void 0!==e?e:this.fxSpeed,this.indicator||(this.indicator=new d.a.LoadingIndicator(this.$el),this.debug("\t created",this.indicator)),this.$el.is(":visible")?(this.$el.fadeOut(e),this.indicator.show(t,e,i)):this.indicator.show(0,i)},_hideLoadingIndicator:function(t,e){this.debug("_hideLoadingIndicator",this.indicator,t,e),t=void 0!==t?t:this.fxSpeed,this.indicator&&this.indicator.hide(t,e)},scrollPosition:function(){return this.$scrollContainer().scrollTop()},scrollTo:function(t,e){return e=e||0,this.$scrollContainer().animate({scrollTop:t},e),this},scrollToTop:function(t){return this.scrollTo(0,t)},scrollToItem:function(t,e){return this},scrollToId:function(t,e){return this.scrollToItem(this.viewFromModelId(t),e)},events:{"click .select-all":"selectAll","click .deselect-all":"deselectAll"},toString:function(){return"ListPanel(".concat(this.collection,")")}}));f.prototype.templates={el:u.a.wrapTemplate(["<div>",'<div class="controls"></div>','<div class="list-items"></div>','<div class="empty-message infomessagesmall"></div>',"</div>"]),controls:u.a.wrapTemplate(['<div class="controls">','<div class="title">','<div class="name"><%- view.title %></div>',"</div>",'<div class="subtitle"><%- view.subtitle %></div>','<div class="actions"></div>','<div class="messages"></div>','<div class="search">','<div class="search-input"></div>',"</div>",'<div class="list-actions">','<div class="btn-group">','<button class="select-all btn btn-secondary"','data-mode="select">',p()("All"),"</button>",'<button class="deselect-all btn btn-secondary"','data-mode="select">',p()("None"),"</button>","</div>",'<div class="list-action-menu btn-group">',"</div>","</div>","</div>"])};var m,g=f.extend({modelCollectionKey:"contents",initialize:function(t){f.prototype.initialize.call(this,t),this.selecting=void 0!==t.selecting&&t.selecting,this.setModel(this.model,t)},setModel:function(t,e){if(e=e||{},this.debug("".concat(this,".setModel:"),t,e),this.freeModel(),this.freeViews(),t){var i=this.model?this.model.get("id"):null;this.model=t,this.logger&&(this.model.logger=this.logger),this._setUpModelListeners(),this.stopListening(this.collection),this.collection=this.model[this.modelCollectionKey]||e.collection||this._createDefaultCollection(),this._setUpCollectionListeners(),i&&t.get("id")!==i&&this.trigger("new-model",this)}return this},freeModel:function(){return this.model&&this.stopListening(this.model),this},_setUpModelListeners:function(){return this.log("".concat(this,"._setUpModelListeners"),this.model),this.listenTo(this.model,"error",function(){var t=Array.prototype.slice.call(arguments,0);t.unshift("error"),this.trigger.apply(this,t)},this),this.logger&&this.listenTo(this.model,"all",function(t){this.info("".concat(this,"(model)"),t,arguments)}),this},_renderControls:function(t){this.debug("".concat(this,"(ModelListPanel)._renderControls"));var e=this.model?this.model.toJSON():{},i=a()(this.templates.controls(e,this));return t.find(".controls").replaceWith(i),i},toString:function(){return"ModelListPanel(".concat(this.model,")")}});g.prototype.templates=(m=u.a.wrapTemplate(['<div class="controls">','<div class="title">','<div class="name"><%- model.name %></div>',"</div>",'<div class="subtitle"><%- view.subtitle %></div>','<div class="actions"></div>','<div class="messages"></div>','<div class="search">','<div class="search-input"></div>',"</div>",'<div class="list-actions">','<div class="btn-group">','<button class="select-all btn btn-secondary"','data-mode="select">',p()("All"),"</button>",'<button class="deselect-all btn btn-secondary"','data-mode="select">',p()("None"),"</button>","</div>",'<div class="list-action-menu btn-group">',"</div>","</div>","</div>"]),l.a.extend(l.a.clone(f.prototype.templates),{controls:m})),e.a={ListPanel:f,ModelListPanel:g}},106:function(t,e,i){"use strict";var n,a=i(1),o=i.n(a),s=i(42),r=i(7),l=i(2),c=i.n(l),d=s.b.DatasetListItemView,u=d.extend({className:"".concat(d.prototype.className," history-content"),initialize:function(t,e){d.prototype.initialize.call(this,t,e)},toString:function(){var t=this.model?"".concat(this.model):"(no model)";return"HDAListItemView(".concat(t,")")}});u.prototype.templates=(n=o.a.extend({},d.prototype.templates.warnings,{hidden:r.a.wrapTemplate(["<% if( !dataset.visible ){ %>",'<div class="hidden-msg warningmessagesmall">',c()("This dataset has been hidden"),"</div>","<% } %>"],"dataset")}),o.a.extend({},d.prototype.templates,{titleBar:function(t){return'\n        <div class="title-bar clear" tabindex="0">\n            <span class="state-icon"></span>\n            <div class="title">\n                <span class="hid">'.concat(t.hid,'</span>\n                <span class="name">').concat(o.a.escape(t.name),'</span>\n            </div>\n            </br>\n            <div class="nametags"></div>\n        </div>\n    ')},warnings:n})),e.a={HDAListItemView:u}},107:function(t,e,i){"use strict";var n,a=i(1),o=i.n(a),s=i(11),r=i(37),l=i(71),c=i(2),d=i.n(c),u=i(109),h=r.a.DCListItemView,p=h.extend({className:"".concat(h.prototype.className," history-content"),render:function(){var t=h.prototype.render.apply(this,arguments);return this._mountNametags("initialize"),t},_setUpListeners:function(){var t=this;h.prototype._setUpListeners.call(this);var e=function(e,i){t.render(0),t._mountNametags("listener")};this.model.jobStatesSummary&&this.listenTo(this.model.jobStatesSummary,"change",e),this.listenTo(this.model,{"change:tags change:visible change:state":e})},_mountNametags:function(t){var e=this.$el.find(".nametags")[0];if(e){var i=this.model.attributes,n=i.id,a=i.model_class,o=i.tags,s="".concat(a,"-").concat(n);Object(u.a)({storeKey:s,tags:o},e)}},_getFoldoutPanelClass:function(){return l.a.CollectionView},_swapNewRender:function(t){var e;h.prototype._swapNewRender.call(this,t);var i=this.model.jobStatesSummary;e=i?i.new()?"loading":i.errored()?"error":i.terminal()?"ok":i.running()?"running":"queued":this.model.get("job_source_id")?"loading":this.model.get("populated_state")?s.a.OK:s.a.RUNNING,this.$el.addClass("state-".concat(e));var n=this.stateDescription();return this.$(".state-description").html(n),this.$el},stateDescription:function(){var t=this.model,e=t.get("job_source_type"),i=l.a.collectionTypeDescription(t),n=l.a.collectionDescription(t),a=t.jobStatesSummary;if(e&&"Job"!=e){if(a&&a.hasDetails()){var o=a.new(),s=o?null:a.jobCount();if(o)return'\n                        <div class="progress state-progress">\n                            <span class="note">Creating jobs.<span class="blinking">..</span></span>\n                            <div class="progress-bar info" style="width:100%">\n                        </div>';if(a.errored()){var r=a.numInError();return"a ".concat(i," with ").concat(r," / ").concat(s," jobs in error")}if(a.terminal())return n;var c=a.states().running||0,d=(a.states().ok||0)/(1*s),u=c/(1*s),h=1-d-u,p=s&&s>1?"".concat(s," jobs"):"a job";return'\n                        <div class="progress state-progress">\n                            <span class="note">'.concat(p," generating a ").concat(i,'</span>\n                            <div class="progress-bar ok" style="width:').concat(100*d,'%"></div>\n                            <div class="progress-bar running" style="width:').concat(100*u,'%"></div>\n                            <div class="progress-bar new" style="width:').concat(100*h,'%">\n                        </div>')}return'\n                    <div class="progress state-progress">\n                        <span class="note">Loading job data for '.concat(i,'.<span class="blinking">..</span></span>\n                        <div class="progress-bar info" style="width:100%">\n                    </div>')}return n},toString:function(){var t=this.model?"".concat(this.model):"(no model)";return"HDCAListItemView(".concat(t,")")}});p.prototype.templates=(n=o.a.extend({},h.prototype.templates.warnings,{hidden:function(t){!t.visible&&'<div class="hidden-msg warningmessagesmall">'.concat(d()("This collection has been hidden"),"</div>")}}),o.a.extend({},h.prototype.templates,{warnings:n,titleBar:function(t){return'\n        <div class="title-bar clear" tabindex="0">\n            <span class="state-icon"></span>\n            <div class="title">\n                <span class="hid">'.concat(t.hid,'</span>\n                <span class="name">').concat(o.a.escape(t.name),'</span>\n            </div>\n            <div class="state-description">\n            </div>\n            <div class="nametags">\x3c!-- Nametags mount here (hdca-li) --\x3e</div>\n        </div>\n    ')}})),e.a={HDCAListItemView:p}},108:function(t,e,i){"use strict";var n=i(1),a=i.n(n),o=i(3),s=i.n(o),r=i(7),l=i(2),c=i.n(l),d=(i(62),s.a.View.extend(r.a.LoggableMixin).extend(r.a.HiddenUntilActivatedViewMixin).extend({tagName:"div",className:"annotation-display",initialize:function(t){t=t||{},this.tooltipConfig=t.tooltipConfig||{placement:"bottom"},this.listenTo(this.model,"change:annotation",function(){this.render()}),this.hiddenUntilActivated(t.$activator,t)},render:function(){var t=this;return this.$el.html(this._template()),this.$annotation().make_text_editable({use_textarea:!0,on_finish:function(e){t.$annotation().text(e),t.model.save({annotation:e},{silent:!0}).fail(function(){t.$annotation().text(t.model.previous("annotation"))})}}),this},_template:function(){var t=this.model.get("annotation");return['<label class="prompt">',c()("Annotation"),"</label>",'<div class="annotation">',a.a.escape(t),"</div>"].join("")},$annotation:function(){return this.$el.find(".annotation")},remove:function(){this.$annotation.off(),this.stopListening(this.model),s.a.View.prototype.remove.call(this)},toString:function(){return["AnnotationEditor(","".concat(this.model),")"].join("")}}));e.a={AnnotationEditor:d}},109:function(t,e,i){"use strict";var n=i(68),a={props:{tag:{type:String,required:!0}},computed:{tagLabel:function(){return this.tag.startsWith("name:")?this.tag.replace("name:",""):this.tag},tagStyles:function(){var t=Object(n.a)(this.tag);return{"background-color":t.primary,color:t.contrasting,"border-color":t.darker}}}},o=(i(193),i(13)),s=Object(o.a)(a,function(){var t=this,e=t.$createElement;return(t._self._c||e)("span",{staticClass:"badge badge-tags",style:t.tagStyles,on:{click:function(e){return e.preventDefault(),t.$emit("tag-click",t.tag)}}},[t._v(" "+t._s(t.tagLabel)+" ")])},[],!1,null,null,null).exports,r=i(60);function l(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}var c={components:{Nametag:s},props:{storeKey:{type:String,required:!0},tags:{type:Array,required:!1,default:function(){return[]}}},computed:{nameTags:function(){return this.$store.getters.getTagsById(this.storeKey).filter(function(t){return t.startsWith("name:")})},title:function(){return"".concat(this.nameTags.length," nametags")}},methods:function(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{},n=Object.keys(i);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(i).filter(function(t){return Object.getOwnPropertyDescriptor(i,t).enumerable}))),n.forEach(function(e){l(t,e,i[e])})}return t}({},Object(r.b)(["updateTags","initializeTags"])),mounted:function(){this.initializeTags({key:this.storeKey,tags:this.tags})}},d=(i(194),Object(o.a)(c,function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"nametags",attrs:{title:this.title}},this._l(this.nameTags,function(t){return e("nametag",{key:t,attrs:{tag:t}})}),1)},[],!1,null,null,null).exports),u=i(83);i.d(e,"a",function(){return h});var h=Object(u.a)(d)},11:function(t,e,i){"use strict";var n={UPLOAD:"upload",QUEUED:"queued",RUNNING:"running",SETTING_METADATA:"setting_metadata",NEW:"new",EMPTY:"empty",OK:"ok",PAUSED:"paused",FAILED_METADATA:"failed_metadata",NOT_VIEWABLE:"noPermission",DISCARDED:"discarded",ERROR:"error"};n.READY_STATES=[n.OK,n.EMPTY,n.PAUSED,n.FAILED_METADATA,n.NOT_VIEWABLE,n.DISCARDED,n.ERROR],n.NOT_READY_STATES=[n.UPLOAD,n.QUEUED,n.RUNNING,n.SETTING_METADATA,n.NEW],e.a=n},110:function(t,e,i){"use strict";var n=i(1),a=i.n(n),o=i(0),s=i.n(o),r=i(3),l=i.n(r),c=i(4),d=i(5);var u=function(t,e){if(0===t.length)return e.length;if(0===e.length)return t.length;var i,n,a=[];for(i=0;i<=e.length;i++)a[i]=[i];for(n=0;n<=t.length;n++)a[0][n]=n;for(i=1;i<=e.length;i++)for(n=1;n<=t.length;n++)e.charAt(i-1)===t.charAt(n-1)?a[i][n]=a[i-1][n-1]:a[i][n]=Math.min(a[i-1][n-1]+1,Math.min(a[i][n-1]+1,a[i-1][n]+1));return a[e.length][t.length]};var h=function(t,e){var i,n,a=/(-?[0-9.]+)/g,o=t.toString().toLowerCase()||"",s=e.toString().toLowerCase()||"",r=String.fromCharCode(0),l=o.replace(a,"".concat(r,"$1").concat(r)).split(r),c=s.replace(a,"".concat(r,"$1").concat(r)).split(r),d=new Date(o).getTime(),u=d?new Date(s).getTime():null;if(u){if(d<u)return-1;if(d>u)return 1}for(var h=0,p=Math.max(l.length,c.length);h<p;h++){if((i=parseFloat(l[h])||l[h])<(n=parseFloat(c[h])||c[h]))return-1;if(i>n)return 1}return 0},p=i(70),f=i(7),m=i(2),g=i.n(m),_=(i(138),l.a.View.extend(f.a.LoggableMixin).extend({_logNamespace:"collections",tagName:"li",className:"dataset paired",initialize:function(t){this.pair=t.pair||{}},template:a.a.template(['<span class="forward-dataset-name flex-column"><%- pair.forward.name %></span>','<span class="pair-name-column flex-column">','<span class="pair-name"><%- pair.name %></span>',"</span>",'<span class="reverse-dataset-name flex-column"><%- pair.reverse.name %></span>'].join("")),render:function(){this.dragStartHandler=a.a.bind(this._dragstart,this),this.dragEndHandler=a.a.bind(this._dragend,this);var t=this.$el.attr("draggable",!0).data("pair",this.pair).html(this.template({pair:this.pair})).addClass("flex-column-container").get(0);return t.addEventListener("dragstart",this.dragStartHandler,!1),t.addEventListener("dragend",this.dragEndHandler,!1),this},events:{dragover:"_sendToParent",drop:"_sendToParent"},_dragstart:function(t){t.currentTarget.style.opacity="0.4",t.originalEvent&&(t=t.originalEvent),t.dataTransfer.effectAllowed="move",t.dataTransfer.setData("text/plain",JSON.stringify(this.pair)),this.$el.parent().trigger("pair.dragstart",[this])},_dragend:function(t){t.currentTarget.style.opacity="1.0",this.$el.parent().trigger("pair.dragend",[this])},_sendToParent:function(t){this.$el.parent().trigger(t)},toString:function(){return"PairView(".concat(this.pair.name,")")}}));function v(t){(t=t||{}).createPair=t.createPair||function(t){var e=(t=t||{}).listA.splice(t.indexA,1)[0],i=t.listB.splice(t.indexB,1)[0],n=t.listB.indexOf(e),a=t.listA.indexOf(i);return-1!==n&&t.listB.splice(n,1),-1!==a&&t.listA.splice(a,1),this._pair(e,i,{silent:!0})};var e=[];return t.preprocessMatch=t.preprocessMatch||function(t){var i=function(){return e.length||(e=[new RegExp(this.filters[0]),new RegExp(this.filters[1])]),e}.call(this);return a.a.extend(t,{matchTo:t.matchTo.name.replace(i[0],""),possible:t.possible.name.replace(i[1],"")})},function(e){this.debug("autopair _strategy ---------------------------");var i,n=(e=e||{}).listA,a=e.listB,o=0,s={score:0,index:null},r=[];for(this.debug("starting list lens:",n.length,a.length),this.debug("bestMatch (starting):",JSON.stringify(s,null,"  "));o<n.length;){var l=n[o];for(s.score=0,i=0;i<a.length;i++){var c=a[i];if(this.debug("".concat(o,":").concat(l.name)),this.debug("".concat(i,":").concat(c.name)),n[o]!==a[i]&&(s=t.match.call(this,t.preprocessMatch.call(this,{matchTo:l,possible:c,index:i,bestMatch:s})),this.debug("bestMatch:",JSON.stringify(s,null,"  ")),1===s.score)){this.debug("breaking early due to perfect match");break}}var d=t.scoreThreshold.call(this);if(this.debug("scoreThreshold:",d),this.debug("bestMatch.score:",s.score),s.score>=d?r.push(t.createPair.call(this,{listA:n,indexA:o,listB:a,indexB:s.index})):o+=1,!n.length||!a.length)return r}return this.debug("paired:",JSON.stringify(r,null,"  ")),this.debug("autopair _strategy ---------------------------"),r}}var b=l.a.View.extend(f.a.LoggableMixin).extend(p.a.CollectionCreatorMixin).extend({_logNamespace:"collections",className:"list-of-pairs-collection-creator collection-creator flex-row-container",initialize:function(t){this.metric("PairedCollectionCreator.initialize",t),t=a.a.defaults(t,{datasets:[],filters:this.DEFAULT_FILTERS,automaticallyPair:!0,strategy:"lcs",matchPercentage:.9,twoPassAutopairing:!0}),this.initialList=t.datasets,this.historyId=t.historyId,this.filters=this.commonFilters[t.filters]||this.commonFilters[this.DEFAULT_FILTERS],a.a.isArray(t.filters)&&(this.filters=t.filters),this.automaticallyPair=t.automaticallyPair,this.strategy=this.strategies[t.strategy]||this.strategies[this.DEFAULT_STRATEGY],a.a.isFunction(t.strategy)&&(this.strategy=t.strategy),this.matchPercentage=t.matchPercentage,this.twoPassAutopairing=t.twoPassAutopairing,this.removeExtensions=!0,this.oncancel=t.oncancel,this.oncreate=t.oncreate,this.autoscrollDist=t.autoscrollDist||24,this.unpairedPanelHidden=!1,this.pairedPanelHidden=!1,this.$dragging=null,this.blocking=!1,this._setUpCommonSettings(t),this._setUpBehaviors(),this._dataSetUp()},commonFilters:{illumina:["_1","_2"],Rs:["_R1","_R2"]},DEFAULT_FILTERS:"illumina",strategies:{simple:"autopairSimple",lcs:"autopairLCS",levenshtein:"autopairLevenshtein"},DEFAULT_STRATEGY:"lcs",_dataSetUp:function(){this.paired=[],this.unpaired=[],this.selectedIds=[],this._sortInitialList(),this._ensureIds(),this.unpaired=this.initialList.slice(0),this.automaticallyPair&&(this.autoPair(),this.once("rendered:initial",function(){this.trigger("autopair")}))},_sortInitialList:function(){this._sortDatasetList(this.initialList)},_sortDatasetList:function(t){return t.sort(function(t,e){return h(t.name,e.name)}),t},_ensureIds:function(){return this.initialList.forEach(function(t){t.hasOwnProperty("id")||(t.id=a.a.uniqueId())}),this.initialList},_splitByFilters:function(){var t=this.filters.map(function(t){return new RegExp(t)}),e=[[],[]];return this.unpaired.forEach(function(i){t.forEach(function(t,n){(function(t,e){return e.test(t.name)})(i,t)&&e[n].push(i)})}),e},_addToUnpaired:function(t){var e=this;this.unpaired.splice(function i(n,a){if(n===a)return n;var o=Math.floor((a-n)/2)+n,s=h(t.name,e.unpaired[o].name);if(s<0)return i(n,o);if(s>0)return i(o+1,a);for(;e.unpaired[o]&&e.unpaired[o].name===t.name;)o++;return o}(0,this.unpaired.length),0,t)},autoPair:function(t){var e=this._splitByFilters(),i=[];return this.twoPassAutopairing&&(i=this.autopairSimple({listA:e[0],listB:e[1]}),e=this._splitByFilters()),t=t||this.strategy,e=this._splitByFilters(),i=i.concat(this[t].call(this,{listA:e[0],listB:e[1]}))},autopairSimple:v({scoreThreshold:function(){return.6},match:function(t){return(t=t||{}).matchTo===t.possible?{index:t.index,score:1}:t.bestMatch}}),autopairLevenshtein:v({scoreThreshold:function(){return this.matchPercentage},match:function(t){var e=1-u((t=t||{}).matchTo,t.possible)/Math.max(t.matchTo.length,t.possible.length);return e>t.bestMatch.score?{index:t.index,score:e}:t.bestMatch}}),autopairLCS:v({scoreThreshold:function(){return this.matchPercentage},match:function(t){t=t||{};var e=this._naiveStartingAndEndingLCS(t.matchTo,t.possible).length/Math.max(t.matchTo.length,t.possible.length);return e>t.bestMatch.score?{index:t.index,score:e}:t.bestMatch}}),_naiveStartingAndEndingLCS:function(t,e){for(var i="",n="",a=0,o=0;a<t.length&&a<e.length&&t[a]===e[a];)i+=t[a],a+=1;if(a===t.length)return t;if(a===e.length)return e;for(a=t.length-1,o=e.length-1;a>=0&&o>=0&&t[a]===e[o];)n=[t[a],n].join(""),a-=1,o-=1;return i+n},_pair:function(t,e,i){i=i||{},this.debug("_pair:",t,e);var n=this._createPair(t,e,i.name);return this.paired.push(n),this.unpaired=a.a.without(this.unpaired,t,e),i.silent||this.trigger("pair:new",n),n},_createPair:function(t,e,i){if(!t||!e||t===e)throw new Error("Bad pairing: ".concat([JSON.stringify(t),JSON.stringify(e)]));return{forward:t,name:i=i||this._guessNameForPair(t,e),reverse:e}},_guessNameForPair:function(t,e,i){i=void 0!==i?i:this.removeExtensions;var n=t.name,a=e.name,o=this._naiveStartingAndEndingLCS(n.replace(new RegExp(this.filters[0]),""),a.replace(new RegExp(this.filters[1]),"")),s=o.lastIndexOf("/");if(s>0){var r=o.slice(0,s+1);o=o.replace(r,""),n=n.replace(c,""),a=a.replace(c,"")}if(i){var l=o.lastIndexOf(".");if(l>0){var c=o.slice(l,o.length);o=o.replace(c,""),n=n.replace(c,""),a=a.replace(c,"")}}return o||"".concat(n," & ").concat(a)},_unpair:function(t,e){if(e=e||{},!t)throw new Error("Bad pair: ".concat(JSON.stringify(t)));return this.paired=a.a.without(this.paired,t),this._addToUnpaired(t.forward),this._addToUnpaired(t.reverse),e.silent||this.trigger("pair:unpair",[t]),t},unpairAll:function(){for(var t=[];this.paired.length;)t.push(this._unpair(this.paired[0],{silent:!0}));this.trigger("pair:unpair",t)},_pairToJSON:function(t){return{collection_type:"paired",src:"new_collection",name:t.name,element_identifiers:[{name:"forward",id:t.forward.id,src:t.forward.src||"hda"},{name:"reverse",id:t.reverse.id,src:t.reverse.src||"hda"}]}},createList:function(t){var e=this,i="".concat(Object(c.getAppRoot)(),"api/histories/").concat(this.historyId,"/contents/dataset_collections"),n={type:"dataset_collection",collection_type:"list:paired",hide_source_items:e.hideOriginals||!1,copy_elements:e.copyElements,name:a.a.escape(t||e.$(".collection-name").val()),element_identifiers:e.paired.map(function(t){return e._pairToJSON(t)})};return e.blocking=!0,s.a.ajax(i,{type:"POST",contentType:"application/json",dataType:"json",data:JSON.stringify(n)}).always(function(){e.blocking=!1}).fail(function(t,i,n){e._ajaxErrHandler(t,i,n)}).done(function(t,i,n){e.trigger("collection:created",t,i,n),e.metric("collection:created",t),"function"==typeof e.oncreate&&e.oncreate.call(this,t,i,n)})},_ajaxErrHandler:function(t,e,i){this.error(t,e,i);var n=g()("An error occurred while creating this collection");t&&(0===t.readyState&&0===t.status?n+=": ".concat(g()("Galaxy could not be reached and may be updating.")).concat(g()(" Try again in a few minutes.")):t.responseJSON?n+="<br /><pre>".concat(JSON.stringify(t.responseJSON),"</pre>"):n+=": ".concat(i)),this._showAlert(n,"alert-danger")},render:function(t,e){return this.$el.empty().html(this.templates.main()),this._renderHeader(t),this._renderMiddle(t),this._renderFooter(t),this._addPluginComponents(),this.trigger("rendered",this),this},_renderHeader:function(t,e){var i=this.$(".header").empty().html(this.templates.header()).find(".help-content").prepend(s()(this.templates.helpContent()));return this._renderFilters(),i},_renderFilters:function(){return this.$(".forward-column .column-header input").val(this.filters[0]).add(this.$(".reverse-column .column-header input").val(this.filters[1]))},_renderMiddle:function(t,e){var i=this.$(".middle").empty().html(this.templates.middle());return this.unpairedPanelHidden?this.$(".unpaired-columns").hide():this.pairedPanelHidden&&this.$(".paired-columns").hide(),this._renderUnpaired(),this._renderPaired(),i},_renderUnpaired:function(t,e){var i,n,a=this,o=[],s=this._splitByFilters();this.$(".forward-column .title").text([s[0].length,g()("unpaired forward")].join(" ")),this.$(".forward-column .unpaired-info").text(this._renderUnpairedDisplayStr(this.unpaired.length-s[0].length)),this.$(".reverse-column .title").text([s[1].length,g()("unpaired reverse")].join(" ")),this.$(".reverse-column .unpaired-info").text(this._renderUnpairedDisplayStr(this.unpaired.length-s[1].length)),this.$(".unpaired-columns .column-datasets").empty(),this.$(".autopair-link").toggle(0!==this.unpaired.length),0!==this.unpaired.length?(n=s[1].map(function(t,e){return void 0!==s[0][e]&&s[0][e]!==t&&o.push(a._renderPairButton()),a._renderUnpairedDataset(t)}),(i=s[0].map(function(t){return a._renderUnpairedDataset(t)})).length||n.length?(this.$(".unpaired-columns .forward-column .column-datasets").append(i).add(this.$(".unpaired-columns .paired-column .column-datasets").append(o)).add(this.$(".unpaired-columns .reverse-column .column-datasets").append(n)),this._adjUnpairedOnScrollbar()):this._renderUnpairedNotShown()):this._renderUnpairedEmpty()},_renderUnpairedDisplayStr:function(t){return["(",t," ",g()("filtered out"),")"].join("")},_renderUnpairedDataset:function(t){return s()("<li/>").attr("id","dataset-".concat(t.id)).addClass("dataset unpaired").attr("draggable",!0).addClass(t.selected?"selected":"").append(s()("<span/>").addClass("dataset-name").text(t.name)).data("dataset",t)},_renderPairButton:function(){return s()("<li/>").addClass("dataset unpaired").append(s()("<span/>").addClass("dataset-name").text(g()("Pair these datasets")))},_renderUnpairedEmpty:function(){var t=s()('<div class="empty-message"></div>').text("(".concat(g()("no remaining unpaired datasets"),")"));return this.$(".unpaired-columns .paired-column .column-datasets").empty().prepend(t),t},_renderUnpairedNotShown:function(){var t=s()('<div class="empty-message"></div>').text("(".concat(g()("no datasets were found matching the current filters"),")"));return this.$(".unpaired-columns .paired-column .column-datasets").empty().prepend(t),t},_adjUnpairedOnScrollbar:function(){var t=this.$(".unpaired-columns").last(),e=this.$(".unpaired-columns .reverse-column .dataset").first();if(e.length){var i=t.offset().left+t.outerWidth(),n=e.offset().left+e.outerWidth(),a=Math.floor(i)-Math.floor(n);this.$(".unpaired-columns .forward-column").css("margin-left",a>0?a:0)}},_renderPaired:function(t,e){if(this.$(".paired-column-title .title").text([this.paired.length,g()("paired")].join(" ")),this.$(".unpair-all-link").toggle(0!==this.paired.length),0!==this.paired.length){this.$(".remove-extensions-link").show(),this.$(".paired-columns .column-datasets").empty();var i=this;this.paired.forEach(function(t,e){var n=new _({pair:t});i.$(".paired-columns .column-datasets").append(n.render().$el).append(['<button class="unpair-btn">','<span class="fa fa-unlink" title="',g()("Unpair"),'"></span>',"</button>"].join(""))})}else this._renderPairedEmpty()},_renderPairedEmpty:function(){var t=s()('<div class="empty-message"></div>').text("(".concat(g()("no paired datasets yet"),")"));return this.$(".paired-columns .column-datasets").empty().prepend(t),t},footerSettings:{".hide-originals":"hideOriginals",".remove-extensions":"removeExtensions"},_addPluginComponents:function(){this._chooseFiltersPopover(".choose-filters-link"),this.$(".help-content i").hoverhighlight(".collection-creator","rgba( 64, 255, 255, 1.0 )")},_chooseFiltersPopover:function(t){var e=s()(a.a.template(['<div class="choose-filters">','<div class="help">',g()("Choose from the following filters to change which unpaired reads are shown in the display"),":</div>",a.a.values(this.commonFilters).map(function(t){return e=t[0],i=t[1],['<button class="filter-choice btn" ','data-forward="',e,'" data-reverse="',i,'">',g()("Forward"),": ",e,", ",g()("Reverse"),": ",i,"</button>"].join("");var e,i}).join(""),"</div>"].join(""))({}));return this.$(t).popover({container:".collection-creator",placement:"bottom",html:!0,content:e})},_validationWarning:function(t,e){"name"===t&&(t=this.$(".collection-name").add(this.$(".collection-name-prompt")),this.$(".collection-name").focus().select()),e?(t=t||this.$(".".concat("validation-warning"))).removeClass("validation-warning"):t.addClass("validation-warning")},_setUpBehaviors:function(){return this.once("rendered",function(){this.trigger("rendered:initial",this)}),this.on("pair:new",function(){this._renderUnpaired(),this._renderPaired(),this.$(".paired-columns").scrollTop(8e6)}),this.on("pair:unpair",function(t){this._renderUnpaired(),this._renderPaired(),this.splitView()}),this.on("filter-change",function(){this.filters=[this.$(".forward-unpaired-filter input").val(),this.$(".reverse-unpaired-filter input").val()],this.metric("filter-change",this.filters),this._renderFilters(),this._renderUnpaired()}),this.on("autopair",function(){var t;this._renderUnpaired(),this._renderPaired();var e=null;this.paired.length?(e="alert-success",t="".concat(this.paired.length," ").concat(g()("pairs created")),this.unpaired.length||(t+=": ".concat(g()("all datasets have been successfully paired")),this.hideUnpaired(),this.$(".collection-name").focus())):t=g()(["Could not automatically create any pairs from the given dataset names.","You may want to choose or enter different filters and try auto-pairing again.","Close this message using the X on the right to view more help."].join(" ")),this._showAlert(t,e)}),this},events:{"click .more-help":"_clickMoreHelp","click .less-help":"_clickLessHelp","click .main-help":"_toggleHelp","click .header .alert button":"_hideAlert","click .forward-column .column-title":"_clickShowOnlyUnpaired","click .reverse-column .column-title":"_clickShowOnlyUnpaired","click .unpair-all-link":"_clickUnpairAll","change .forward-unpaired-filter input":function(t){this.trigger("filter-change")},"focus .forward-unpaired-filter input":function(t){s()(t.currentTarget).select()},"click .autopair-link":"_clickAutopair","click .choose-filters .filter-choice":"_clickFilterChoice","click .clear-filters-link":"_clearFilters","change .reverse-unpaired-filter input":function(t){this.trigger("filter-change")},"focus .reverse-unpaired-filter input":function(t){s()(t.currentTarget).select()},"click .forward-column .dataset.unpaired":"_clickUnpairedDataset","click .reverse-column .dataset.unpaired":"_clickUnpairedDataset","click .paired-column .dataset.unpaired":"_clickPairRow","click .unpaired-columns":"clearSelectedUnpaired","mousedown .unpaired-columns .dataset":"_mousedownUnpaired","click .paired-column-title":"_clickShowOnlyPaired","mousedown .flexible-partition-drag":"_startPartitionDrag","click .paired-columns .dataset.paired":"selectPair","click .paired-columns":"clearSelectedPaired","click .paired-columns .pair-name":"_clickPairName","click .unpair-btn":"_clickUnpair","dragover .paired-columns .column-datasets":"_dragoverPairedColumns","drop .paired-columns .column-datasets":"_dropPairedColumns","pair.dragstart .paired-columns .column-datasets":"_pairDragstart","pair.dragend   .paired-columns .column-datasets":"_pairDragend","change .remove-extensions":function(t){this.toggleExtensions()},"change .collection-name":"_changeName","keydown .collection-name":"_nameCheckForEnter","change .hide-originals":"_changeHideOriginals","click .cancel-create":"_cancelCreate","click .create-collection":"_clickCreate"},_clickShowOnlyUnpaired:function(t){this.$(".paired-columns").is(":visible")?this.hidePaired():this.splitView()},_clickShowOnlyPaired:function(t){this.$(".unpaired-columns").is(":visible")?this.hideUnpaired():this.splitView()},hideUnpaired:function(t,e){this.unpairedPanelHidden=!0,this.pairedPanelHidden=!1,this._renderMiddle(t,e)},hidePaired:function(t,e){this.unpairedPanelHidden=!1,this.pairedPanelHidden=!0,this._renderMiddle(t,e)},splitView:function(t,e){return this.unpairedPanelHidden=this.pairedPanelHidden=!1,this._renderMiddle(t,e),this},_clickUnpairAll:function(t){this.metric("unpairAll"),this.unpairAll()},_clickAutopair:function(t){var e=this.autoPair();this.metric("autopair",e.length,this.unpaired.length),this.trigger("autopair")},_clickFilterChoice:function(t){var e=s()(t.currentTarget);this.$(".forward-unpaired-filter input").val(e.data("forward")),this.$(".reverse-unpaired-filter input").val(e.data("reverse")),this._hideChooseFilters(),this.trigger("filter-change")},_hideChooseFilters:function(){this.$(".choose-filters-link").popover("hide"),this.$(".popover").css("display","none")},_clearFilters:function(t){this.$(".forward-unpaired-filter input").val(""),this.$(".reverse-unpaired-filter input").val(""),this.trigger("filter-change")},_clickUnpairedDataset:function(t){return t.stopPropagation(),this.toggleSelectUnpaired(s()(t.currentTarget))},toggleSelectUnpaired:function(t,e){e=e||{};var i=t.data("dataset"),n=void 0!==e.force?e.force:!t.hasClass("selected");return t.length&&void 0!==i?(n?(t.addClass("selected"),e.waitToPair||this.pairAllSelected()):t.removeClass("selected"),t):t},pairAllSelected:function(t){t=t||{};var e=this,i=[],n=[],a=[];return e.$(".unpaired-columns .forward-column .dataset.selected").each(function(){i.push(s()(this).data("dataset"))}),e.$(".unpaired-columns .reverse-column .dataset.selected").each(function(){n.push(s()(this).data("dataset"))}),i.length=n.length=Math.min(i.length,n.length),i.forEach(function(t,i){try{a.push(e._pair(t,n[i],{silent:!0}))}catch(t){e.error(t)}}),a.length&&!t.silent&&this.trigger("pair:new",a),a},clearSelectedUnpaired:function(){this.$(".unpaired-columns .dataset.selected").removeClass("selected")},_mousedownUnpaired:function(t){if(t.shiftKey){var e=this,i=s()(t.target).addClass("selected"),n=function(t){e.$(t.target).filter(".dataset").addClass("selected")};i.parent().on("mousemove",n),s()(document).one("mouseup",function(t){i.parent().off("mousemove",n),e.pairAllSelected()})}},_clickPairRow:function(t){var e=s()(t.currentTarget).index(),i=s()(".unpaired-columns .forward-column .dataset").eq(e).data("dataset"),n=s()(".unpaired-columns .reverse-column .dataset").eq(e).data("dataset");this._pair(i,n)},_startPartitionDrag:function(t){var e=this,i=t.pageY;function n(t){var n=t.pageY-i;e.adjPartition(n)||s()("body").trigger("mouseup"),e._adjUnpairedOnScrollbar(),i+=n}s()("body").css("cursor","ns-resize"),e.$(".flexible-partition-drag").css("color","black"),s()("body").mousemove(n),s()("body").one("mouseup",function(t){e.$(".flexible-partition-drag").css("color",""),s()("body").css("cursor","").unbind("mousemove",n)})},adjPartition:function(t){var e=this.$(".unpaired-columns"),i=this.$(".paired-columns"),n=parseInt(e.css("height"),10),a=parseInt(i.css("height"),10);n=Math.max(10,n+t),a-=t;var o=t<0;if(o){if(this.unpairedPanelHidden)return!1;if(n<=10)return this.hideUnpaired(),!1}else this.unpairedPanelHidden&&(e.show(),this.unpairedPanelHidden=!1);if(o)this.pairedPanelHidden&&(i.show(),this.pairedPanelHidden=!1);else{if(this.pairedPanelHidden)return!1;if(a<=15)return this.hidePaired(),!1}return e.css({height:"".concat(n,"px"),flex:"0 0 auto"}),!0},selectPair:function(t){t.stopPropagation(),s()(t.currentTarget).toggleClass("selected")},clearSelectedPaired:function(t){this.$(".paired-columns .dataset.selected").removeClass("selected")},_clickPairName:function(t){t.stopPropagation();var e=s()(t.currentTarget),i=e.parent().parent().index(".dataset.paired"),n=this.paired[i],a=prompt("Enter a new name for the pair:",n.name);a&&(n.name=a,n.customizedName=!0,e.text(n.name))},_clickUnpair:function(t){var e=Math.floor(s()(t.currentTarget).index(".unpair-btn"));this._unpair(this.paired[e])},_dragoverPairedColumns:function(t){t.preventDefault();var e=this.$(".paired-columns .column-datasets");this._checkForAutoscroll(e,t.originalEvent.clientY);var i=this._getNearestPairedDatasetLi(t.originalEvent.clientY);s()(".element-drop-placeholder").remove();var n=s()('<div class="element-drop-placeholder"></div>');i.length?i.before(n):e.append(n)},_checkForAutoscroll:function(t,e){var i=t.offset(),n=t.scrollTop(),a=e-i.top,o=i.top+t.outerHeight()-e;a>=0&&a<this.autoscrollDist?t.scrollTop(n-2):o>=0&&o<this.autoscrollDist&&t.scrollTop(n+2)},_getNearestPairedDatasetLi:function(t){for(var e=this.$(".paired-columns .column-datasets li").toArray(),i=0;i<e.length;i++){var n=s()(e[i]),a=n.offset().top,o=Math.floor(n.outerHeight()/2)+4;if(a+o>t&&a-o<t)return n}return s()()},_dropPairedColumns:function(t){t.preventDefault(),t.dataTransfer.dropEffect="move";var e=this._getNearestPairedDatasetLi(t.originalEvent.clientY);return e.length?this.$dragging.insertBefore(e):this.$dragging.insertAfter(this.$(".paired-columns .unpair-btn").last()),this._syncPairsToDom(),!1},_syncPairsToDom:function(){var t=[];this.$(".paired-columns .dataset.paired").each(function(){t.push(s()(this).data("pair"))}),this.paired=t,this._renderPaired()},_pairDragstart:function(t,e){e.$el.addClass("selected");var i=this.$(".paired-columns .dataset.selected");this.$dragging=i},_pairDragend:function(t,e){s()(".element-drop-placeholder").remove(),this.$dragging=null},toggleExtensions:function(t){var e=this;e.removeExtensions=void 0!==t?t:!e.removeExtensions,a.a.each(e.paired,function(t){t.customizedName||(t.name=e._guessNameForPair(t.forward,t.reverse))}),e._renderPaired(),e._renderFooter()},_printList:function(t){var e=this;a.a.each(t,function(i){t===e.paired?e._printPair(i):e.debug(i)})},_printPair:function(t){this.debug(t.forward.name,t.reverse.name,": ->",t.name)},toString:function(){return"PairedCollectionCreator"},templates:a.a.extend({},p.a.CollectionCreatorMixin._creatorTemplates,{header:a.a.template(['<div class="main-help well clear">','<a class="more-help" href="javascript:void(0);">',g()("More help"),"</a>",'<div class="help-content">','<a class="less-help" href="javascript:void(0);">',g()("Less"),"</a>","</div>","</div>",'<div class="alert alert-dismissable">','<button type="button" class="close" data-dismiss="alert" aria-hidden="true">&times;</button>','<span class="alert-message"></span>',"</div>",'<div class="column-headers vertically-spaced flex-column-container">','<div class="forward-column flex-column column">','<div class="column-header">','<div class="column-title">','<span class="title">',g()("Unpaired forward"),"</span>",'<span class="title-info unpaired-info"></span>',"</div>",'<div class="unpaired-filter forward-unpaired-filter float-left">','<input class="search-query" placeholder="',g()("Filter this list"),'" />',"</div>","</div>","</div>",'<div class="paired-column flex-column no-flex column">','<div class="column-header">','<a class="choose-filters-link" href="javascript:void(0)">',g()("Choose filters"),"</a>",'<a class="clear-filters-link" href="javascript:void(0);">',g()("Clear filters"),"</a><br />",'<a class="autopair-link" href="javascript:void(0);">',g()("Auto-pair"),"</a>","</div>","</div>",'<div class="reverse-column flex-column column">','<div class="column-header">','<div class="column-title">','<span class="title">',g()("Unpaired reverse"),"</span>",'<span class="title-info unpaired-info"></span>',"</div>",'<div class="unpaired-filter reverse-unpaired-filter float-left">','<input class="search-query" placeholder="',g()("Filter this list"),'" />',"</div>","</div>","</div>","</div>"].join("")),middle:a.a.template(['<div class="unpaired-columns flex-column-container scroll-container flex-row">','<div class="forward-column flex-column column">','<ol class="column-datasets"></ol>',"</div>",'<div class="paired-column flex-column no-flex column">','<ol class="column-datasets"></ol>',"</div>",'<div class="reverse-column flex-column column">','<ol class="column-datasets"></ol>',"</div>","</div>",'<div class="flexible-partition">','<div class="flexible-partition-drag" title="',g()("Drag to change"),'"></div>','<div class="column-header">','<div class="column-title paired-column-title">','<span class="title"></span>',"</div>",'<a class="unpair-all-link" href="javascript:void(0);">',g()("Unpair all"),"</a>","</div>","</div>",'<div class="paired-columns flex-column-container scroll-container flex-row">','<ol class="column-datasets"></ol>',"</div>"].join("")),footer:a.a.template(['<div class="attributes clear">','<div class="clear">','<label class="setting-prompt float-right">',g()("Hide original elements"),"?",'<input class="hide-originals float-right" type="checkbox" />',"</label>",'<label class="setting-prompt float-right">',g()("Remove file extensions from pair names"),"?",'<input class="remove-extensions float-right" type="checkbox" />',"</label>","</div>",'<div class="clear">','<input class="collection-name form-control float-right" ','placeholder="',g()("Enter a name for your new list"),'" />','<div class="collection-name-prompt float-right">',g()("Name"),":</div>","</div>","</div>",'<div class="actions clear vertically-spaced">','<div class="other-options float-left">','<button class="cancel-create btn" tabindex="-1">',g()("Cancel"),"</button>",'<div class="create-other btn-group dropup">','<button class="btn btn-secondary dropdown-toggle" data-toggle="dropdown">',g()("Create a different kind of collection"),' <span class="caret"></span>',"</button>",'<ul class="dropdown-menu" role="menu">','<li><a href="#">',g()("Create a <i>single</i> pair"),"</a></li>",'<li><a href="#">',g()("Create a list of <i>unpaired</i> datasets"),"</a></li>","</ul>","</div>","</div>",'<div class="main-options float-right">','<button class="create-collection btn btn-primary">',g()("Create list"),"</button>","</div>","</div>"].join("")),helpContent:a.a.template(["<p>",g()(["Collections of paired datasets are ordered lists of dataset pairs (often forward and reverse reads). ","These collections can be passed to tools and workflows in order to have analyses done on each member of ","the entire group. This interface allows you to create a collection, choose which datasets are paired, ","and re-order the final collection."].join("")),"</p>","<p>",g()(['Unpaired datasets are shown in the <i data-target=".unpaired-columns">unpaired section</i> ',"(hover over the underlined words to highlight below). ",'Paired datasets are shown in the <i data-target=".paired-columns">paired section</i>.',"<ul>To pair datasets, you can:","<li>Click a dataset in the ",'<i data-target=".unpaired-columns .forward-column .column-datasets,','.unpaired-columns .forward-column">forward column</i> ',"to select it then click a dataset in the ",'<i data-target=".unpaired-columns .reverse-column .column-datasets,','.unpaired-columns .reverse-column">reverse column</i>.',"</li>",'<li>Click one of the "Pair these datasets" buttons in the ','<i data-target=".unpaired-columns .paired-column .column-datasets,','.unpaired-columns .paired-column">middle column</i> ',"to pair the datasets in a particular row.","</li>",'<li>Click <i data-target=".autopair-link">"Auto-pair"</i> ',"to have your datasets automatically paired based on name.","</li>","</ul>"].join("")),"</p>","<p>",g()(["<ul>You can filter what is shown in the unpaired sections by:","<li>Entering partial dataset names in either the ",'<i data-target=".forward-unpaired-filter input">forward filter</i> or ','<i data-target=".reverse-unpaired-filter input">reverse filter</i>.',"</li>","<li>Choosing from a list of preset filters by clicking the ",'<i data-target=".choose-filters-link">"Choose filters" link</i>.',"</li>","<li>Entering regular expressions to match dataset names. See: ",'<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Guide/Regular_Expressions"',' target="_blank">MDN\'s JavaScript Regular Expression Tutorial</a>. ',"Note: forward slashes (\\) are not needed.","</li>","<li>Clearing the filters by clicking the ",'<i data-target=".clear-filters-link">"Clear filters" link</i>.',"</li>","</ul>"].join("")),"</p>","<p>",g()(["To unpair individual dataset pairs, click the ",'<i data-target=".unpair-btn">unpair buttons ( <span class="fa fa-unlink"></span> )</i>. ','Click the <i data-target=".unpair-all-link">"Unpair all" link</i> to unpair all pairs.'].join("")),"</p>","<p>",g()(['You can include or remove the file extensions (e.g. ".fastq") from your pair names by toggling the ','<i data-target=".remove-extensions-prompt">"Remove file extensions from pair names?"</i> control.'].join("")),"</p>","<p>",g()(['Once your collection is complete, enter a <i data-target=".collection-name">name</i> and ','click <i data-target=".create-collection">"Create list"</i>. ',"(Note: you do not have to pair all unpaired datasets to finish.)"].join("")),"</p>"].join(""))})}),w=function(t,e){var i,n=Object(d.a)(),o=s.a.Deferred();if(e=a.a.defaults(e||{},{datasets:t,oncancel:function(){n.modal.hide(),o.reject("cancelled")},oncreate:function(t,e){n.modal.hide(),o.resolve(e)},title:g()("Create a collection of paired datasets")}),!n||!n.modal)throw new Error("Galaxy or Galaxy.modal not found");return i=new b(e),n.modal.show({title:e.title,body:i.$el,width:"80%",height:"800px",closing_events:!0}),i.render(),window.creator=i,o};e.a={PairedCollectionCreator:b,pairedCollectionCreatorModal:w,createListOfPairsCollection:function(t,e){var i=t.toJSON();return w(i,{historyId:t.historyId,defaultHideSourceItems:e,copyElements:!e})}}},111:function(t,e,i){"use strict";var n=i(2),a=i.n(n),o=i(1),s=i.n(o),r=i(0),l=i.n(r),c=i(3),d=i.n(c),u=i(4),h=(i(248),window.Tour);l.a.fn.tooltip.Constructor.Default.whiteList.button=["data-role"];var p=Object(u.getAppRoot)(),f={storage:window.sessionStorage,onEnd:function(){window.sessionStorage.removeItem("activeGalaxyTour")},delay:150,orphan:!0},m=function(t){return s.a.each(t.steps,function(t){t.preclick&&(t.onShow=function(){s.a.each(t.preclick,function(t){l()(t).click()})}),t.postclick&&(t.onHide=function(){s.a.each(t.postclick,function(t){l()(t).click()})}),t.textinsert&&(t.onShown=function(){l()(t.element).val(t.textinsert).trigger("change")}),t.path&&(console.warn("This Galaxy Tour is attempting to use path navigation.  This is known to be unstable and can possibly get the Galaxy client 'stuck' in a tour, and at this time is not allowed."),delete t.path)}),t},g=d.a.Model.extend({urlRoot:"".concat(p,"api/tours")}),_=d.a.Collection.extend({url:"".concat(p,"api/tours"),model:g}),v=d.a.View.extend({title:a()("Tours"),initialize:function(){var t=this;this.setElement("<div/>"),this.model=new _,this.model.fetch({success:function(){t.render()},error:function(){console.error("Failed to fetch tours.")}})},render:function(){var t=s.a.template('\n    <h2>Galaxy Tours</h2>\n    <p>This page presents a list of interactive tours available on this Galaxy server.\n    Select any tour to get started (and remember, you can click \'End Tour\' at any time).</p>\n\n<div class="row mb-3">\n    <div class="col-12 btn-group" role="group" aria-label="Tag selector">\n        <% _.each(tourtagorder, function(tag) { %>\n        <button class="btn btn-primary tag-selector-button" tag-selector-button="<%- tag.key %>">\n            <%- tag.name %>\n        </button>\n        <% }); %>\n    </div>\n</div>\n\n<div class="row mb-3">\n    <div class="col-12">\n    <h4>Tours</h4>\n    <ul class="list-group">\n    <% _.each(tours, function(tour) { %>\n        <li class="list-group-item" tags="<%- tour.attributes.tags_lc %>">\n            <a href="/tours/<%- tour.id %>" class="tourItem" data-tour.id=<%- tour.id %>>\n                <%- tour.attributes.name || tour.id %>\n            </a>\n             - <%- tour.attributes.description || "No description given." %>\n             <% _.each(tour.attributes.tags, function(tag) { %>\n                <span class="badge badge-primary">\n                    <%- tag.charAt(0).toUpperCase() + tag.slice(1) %>\n                </span>\n             <% }); %>\n        </li>\n    <% }); %>\n    </ul>\n    </div>\n</div>'),e={};s.a.each(this.model.models,function(t){t.attributes.tags_lc=[],null===t.attributes.tags?(void 0===e.Untagged&&(e.Untagged={name:"Untagged",tours:[]}),e.Untagged.tours.push(t)):s.a.each(t.attributes.tags,function(i){var n=i.charAt(0).toUpperCase()+i.slice(1);void 0===e[n]&&(e[n]={name:n,tours:[]}),t.attributes.tags_lc.push(i.toLowerCase()),e[n].tours.push(t)})});var i=[];Object.keys(e).forEach(function(t,e){i.push({name:t,key:t.toLowerCase()})}),this.$el.html(t({tours:this.model.models,tourtags:e,tourtagorder:i})).on("click",".tourItem",function(t){t.preventDefault(),w(l()(this).data("tour.id"))}).on("click",".tag-selector-button",function(t){var e=l()(t.target),i=[];e.toggleClass("btn-primary"),e.toggleClass("btn-secondary"),l()(".tag-selector-button.btn-primary").each(function(){i.push(l()(this).attr("tag-selector-button"))}),l()("li.list-group-item").each(function(){if(l()(this).attr("tags")){var t=l()(this).attr("tags").split(",").filter(function(t){return i.indexOf(t.toLowerCase())>-1});l()(this).css("display",t.length>0?"block":"none")}})})}});function b(t){var e=m(t);window.sessionStorage.setItem("activeGalaxyTour",JSON.stringify(t));var i=new h(s.a.extend({steps:e.steps},f));return i.init(),i.goTo(0),i.restart(),i}function w(t){var e="".concat(p,"api/tours/").concat(t);l.a.getJSON(e,function(t){b(t)})}e.a={ToursView:v,giveTourWithData:b,giveTourById:w,activeGalaxyTourRunner:function(){var t=JSON.parse(window.sessionStorage.getItem("activeGalaxyTour"));if(t&&(t=m(t))&&t.steps&&window&&window.self===window.top){var e=new h(s.a.extend({steps:t.steps},f));e.init(),e.restart()}}}},116:function(t,e,i){"use strict";var n=i(0),a=i.n(n),o=i(3),s=i.n(o),r=i(1),l=i.n(r),c=i(15),d=i.n(c),u=i(4),h=i(5),p=i(2),f=i.n(p),m=i(19),g=s.a.View.extend({initialize:function(){this.modal=null},makeModalIframe:function(t){var e=Object(h.a)(),i=e.config.communication_server_host,n=e.config.communication_server_port,o=l.a.escape(e.user.attributes.username),s=l.a.escape(e.config.persistent_communication_rooms),r="?username=".concat(o,"&persistent_communication_rooms=").concat(s),c="".concat(i,":").concat(n).concat(r),d=null,u=null,p='<iframe class="h-100 w-100" src="'.concat(c,'"> </iframe>');return a()(".chat-modal").length>0&&a()(".chat-modal").remove(),g.modal=new m.a.View({body:p,height:350,width:600,closing_events:!0,title_separator:!1,cls:"ui-modal chat-modal"}),g.modal.show(),d=a()(".chat-modal .modal-header"),u=a()(".chat-modal .modal-body"),d.addClass("modal-header-body"),u.addClass("modal-header-body"),d.find("h4").remove(),d.removeAttr("min-height padding border"),d.append('<i class="fa fa-comment" aria-hidden="true" title="Communicate with other users"></i><i class="fa fa-expand expand-compress-modal" aria-hidden="true" title="Maximize"></i><i class="fa fa-times close-modal" aria-hidden="true" title="Close"></i>'),a()(".close-modal").click(function(t){a()(".chat-modal").css("display","none")}),a()(".expand-compress-modal").click(function(t){a()(".expand-compress-modal").hasClass("fa-expand")?(a()(".chat-modal .modal-dialog").width("1000px"),a()(".chat-modal .modal-body").height("575px"),a()(".expand-compress-modal").removeClass("fa-expand").addClass("fa-compress"),a()(".expand-compress-modal").attr("title","Minimize"),a()(".expand-compress-modal").css("margin-left","96.2%")):(a()(".chat-modal .modal-dialog").width("".concat(600,"px")),a()(".chat-modal .modal-body").height("".concat(350,"px")),a()(".expand-compress-modal").removeClass("fa-compress").addClass("fa-expand"),a()(".expand-compress-modal").attr("title","Maximize"),a()(".expand-compress-modal").css("margin-left","93.2%"))}),this},render:function(){return{id:"show-chat-online",icon:"fa-comment-o",tooltip:f()("Chat online"),visible:!1,onclick:this.makeModalIframe}}}),_=i(48),v=i(8);function b(){var t=Object(h.a)(),e=t.session_csrf_token,i="".concat(t.root,"user/logout?session_csrf_token=").concat(e);d.a.get(i).then(function(){t.user&&t.user.clearSessionStorage(),window.top.location.href="".concat(t.root,"login")})}var w={Collection:s.a.Collection.extend({model:s.a.Model.extend({defaults:{visible:!0,target:"_parent"}}),fetch:function(t){t=t||{},this.reset();var e=Object(h.a)(),i=new g;this.add(i.render()),this.add({id:"analysis",title:f()("Analyze Data"),url:"",tooltip:f()("Analysis home view")}),this.add({id:"workflow",title:f()("Workflow"),tooltip:f()("Chain tools into workflows"),disabled:!e.user.id,url:"workflows/list",target:"__use_router__"}),this.add({id:"visualization",title:f()("Visualize"),tooltip:f()("Visualize datasets"),disabled:!e.user.id,menu:[{title:f()("Create Visualization"),url:"visualizations",target:"__use_router__"},{title:f()("Interactive Environments"),url:"visualization/gie_list",target:"galaxy_main"}]}),this.add({id:"shared",title:f()("Shared Data"),url:"library/index",tooltip:f()("Access published resources"),menu:[{title:f()("Data Libraries"),url:"library/list"},{title:f()("Histories"),url:"histories/list_published",target:"__use_router__"},{title:f()("Workflows"),url:"workflows/list_published",target:"__use_router__"},{title:f()("Visualizations"),url:"visualizations/list_published",target:"__use_router__"},{title:f()("Pages"),url:"pages/list_published",target:"__use_router__"}]}),_.a.load({type:"masthead",callback:function(t){a()(document).ready(function(){t.each(function(t){var e=t.toJSON();if(e.activate){var i={id:e.id,icon:e.config.icon,url:e.config.url,tooltip:e.config.tooltip,onclick:e.config.function&&new Function(e.config.function)},n=Object(h.a)();n.page?n.page.masthead.collection.add(i):n.masthead&&n.masthead.collection.add(i),v.a.appendScriptStyle(e)}})})}}),e.user.get("is_admin")&&this.add({id:"admin",title:f()("Admin"),url:"admin",tooltip:f()("Administer this Galaxy"),cls:"admin-only"});var n={id:"help",title:f()("Help"),tooltip:f()("Support, contact, and community"),menu:[{title:f()("Support"),url:t.support_url,target:"_blank"},{title:f()("Search"),url:t.search_url,target:"_blank"},{title:f()("Mailing Lists"),url:t.mailing_lists,target:"_blank"},{title:f()("Videos"),url:t.screencasts_url,target:"_blank"},{title:f()("Wiki"),url:t.wiki_url,target:"_blank"},{title:f()("How to Cite Galaxy"),url:t.citation_url,target:"_blank"},{title:f()("Interactive Tours"),url:"tours"}]};t.terms_url&&n.menu.push({title:f()("Terms and Conditions"),url:t.terms_url,target:"_blank"}),t.helpsite_url&&n.menu.unshift({title:f()("Galaxy Help"),url:t.helpsite_url,target:"_blank"}),this.add(n);var o={};return o=e.user.id?{id:"user",title:f()("User"),cls:"loggedin-only",tooltip:f()("Account and saved data"),menu:[{title:"".concat(f()("Logged in as")," ").concat(e.user.get("email"))},{title:f()("Preferences"),url:"user",target:"__use_router__"},{title:f()("Custom Builds"),url:"custom_builds",target:"__use_router__"},{title:f()("Logout"),divider:!0,onclick:b},{title:f()("Saved Datasets"),url:"datasets/list",target:"__use_router__"},{title:f()("Saved Histories"),url:"histories/list",target:"__use_router__"},{title:f()("Saved Pages"),url:"pages/list",target:"__use_router__"},{title:f()("Saved Visualizations"),url:"visualizations/list",target:"__use_router__"}]}:t.allow_user_creation?{id:"user",title:f()("Login or Register"),cls:"loggedout-only",url:"login",tooltip:f()("Log in or register a new account")}:{id:"user",title:f()("Login"),cls:"loggedout-only",tooltip:f()("Login"),url:"login",target:"galaxy_main",noscratchbook:!0},this.add(o),(new a.a.Deferred).resolve().promise()}}),Tab:s.a.View.extend({initialize:function(t){this.model=t.model,this.setElement(this._template()),this.$link=this.$(".nav-link"),this.$note=this.$(".nav-note"),this.$menu=this.$(".dropdown-menu"),this.listenTo(this.model,"change",this.render,this)},events:{"click .nav-link":"_toggleClick"},render:function(){var t=this;return a()(".tooltip").remove(),this.$el.removeClass().addClass(this.model.get("disabled")&&"disabled").addClass(this.model.get("active")&&"active").addClass(this.model.get("menu")&&"dropdown").attr("id",this.model.id).css({visibility:this.model.get("visible")?"visible":"hidden"}),this.model.set("url",this._formatUrl(this.model.get("url"))),this.$note.html(this.model.get("note")||"").removeClass().addClass("nav-note").addClass(this.model.get("note_cls")).css({display:this.model.get("show_note")?"block":"none"}),this.$link.html(this.model.get("title")||"").removeClass().addClass("nav-link").addClass(this.model.get("cls")).addClass(this.model.get("icon")&&"nav-icon fa ".concat(this.model.get("icon"))).addClass(this.model.get("menu")&&"dropdown-toggle").addClass(this.model.get("toggle")&&"toggle").attr("target",this.model.get("target")).attr("href",this.model.get("url")).attr("title",this.model.get("tooltip")).tooltip("dispose"),this.model.get("tooltip")&&this.$link.tooltip({placement:"bottom"}),this.model.get("menu")&&this.model.get("show_menu")?(this.$menu.show(),a()("#dd-helper").show().off().on("click",function(){a()("#dd-helper").hide(),t.model.set("show_menu",!1)})):(this.$menu.hide(),a()("#dd-helper").hide()),this.$menu.empty().removeClass(),this.model.get("menu")&&(l.a.each(this.model.get("menu"),function(e){t.$menu.append(t._buildMenuItem(e)),e.divider&&t.$menu.append(a()("<div/>").addClass("dropdown-divider"))}),this.$menu.addClass("dropdown-menu"),this.$link.append(a()("<b/>").addClass("caret"))),this},_buildMenuItem:function(t){var e=this;return(t=l.a.defaults(t||{},{title:"",url:"",target:"_parent",noscratchbook:!1})).url=this._formatUrl(t.url),a()("<a/>").addClass("dropdown-item").attr("href",t.url).attr("target",t.target).html(t.title).on("click",function(i){if(i.preventDefault(),e.model.set("show_menu",!1),t.onclick)t.onclick();else{var n=Object(h.a)();if("__use_router__"==t.target&&void 0!==n.page)n.page.router.executeUseRouter(t.url);else try{n.frame.add(t)}catch(t){console.warn("Missing frame element on galaxy instance",t)}}})},buildLink:function(t,e){return a()("<div/>").append(a()("<a/>").attr("href",Object(u.getAppRoot)()+e).html(t)).html()},_toggleClick:function(t){var e=this,i=this.model;if(t.preventDefault(),a()(".tooltip").hide(),i.trigger("dispatch",function(t){i.id!==t.id&&t.get("menu")&&t.set("show_menu",!1)}),i.get("disabled"))this.$link.popover&&this.$link.popover("dispose"),this.$link.popover({html:!0,placement:"bottom",content:"Please ".concat(this.buildLink("login or register","login")," to use this feature.")}).popover("show"),window.setTimeout(function(){e.$link.popover("dispose")},3e3);else if(i.get("menu"))i.set("show_menu",!0);else if(i.get("onclick"))i.get("onclick")();else{var n=Object(h.a)();"__use_router__"==i.attributes.target&&void 0!==n.page?n.page.router.executeUseRouter(i.attributes.url):n.frame.add(i.attributes)}},_formatUrl:function(t){return"string"==typeof t&&-1===t.indexOf("//")&&"/"!=t.charAt(0)?Object(u.getAppRoot)()+t:t},_template:function(){return'\n            <li class="nav-item">\n                <a class="nav-link"/>\n                <div class="nav-note"/>\n                <div class="dropdown-menu"/>\n            </li>'}})},y=s.a.View.extend({initialize:function(t){this.model=t&&t.model||new s.a.Model(t),this.setElement(a()("<div/>").addClass("corner frame")),this.$el.append(a()("<div/>").addClass("f-header corner").append(a()("<div/>").addClass("f-title")).append(a()("<div/>").addClass("f-icon f-close fa fa-close").tooltip({title:f()("Close"),placement:"bottom"}))).append(a()("<div/>").addClass("f-content")).append(a()("<div/>").addClass("f-resize f-icon corner fa fa-expand").tooltip({title:"Resize"})).append(a()("<div/>").addClass("f-cover")),this.$header=this.$(".f-header"),this.$title=this.$(".f-title"),this.$content=this.$(".f-content"),this.render(),this.listenTo(this.model,"change",this.render,this)},render:function(){var t=this,e=this.model.attributes;this.$title.html(l.a.escape(e.title)||""),this.$header.find(".f-icon-left").remove(),l.a.each(e.menu,function(e){var i=a()("<div/>").addClass("f-icon-left").addClass(e.icon);l.a.isFunction(e.disabled)&&e.disabled()?i.attr("disabled",!0):i.on("click",function(){e.onclick(t)}).tooltip({title:e.tooltip||"",placement:"bottom"}),t.$header.append(i)}),e.url?this.$content.html(a()("<iframe/>").addClass("f-iframe").attr("scrolling","auto").attr("src","".concat(e.url+(-1===e.url.indexOf("?")?"?":"&"),"widget=True"))):e.content&&(l.a.isFunction(e.content)?e.content(t.$content):t.$content.html(e.content))}}),x={View:s.a.View.extend({defaultOptions:{frame:{cols:6,rows:3},rows:1e3,cell:130,margin:5,scroll:5,top_min:40,frame_max:9,visible:!0},cols:0,top:0,top_max:0,frame_z:0,frame_counter:0,frame_uid:0,frame_list:{},frame_shadow:null,visible:!1,event:{},initialize:function(t){var e=this;this.options=l.a.defaults(t||{},this.defaultOptions),this.visible=this.options.visible,this.top=this.top_max=this.options.top_min,this.setElement(a()("<div/>").addClass("galaxy-frame").append(a()("<div/>").addClass("frame-background")).append(a()("<div/>").addClass("frame-menu frame-scroll-up fa fa-chevron-up fa-2x")).append(a()("<div/>").addClass("frame-menu frame-scroll-down fa fa-chevron-down fa-2x"))),this.frame_shadow=new s.a.View({el:a()("<div/>").addClass("corner frame-shadow")}),this.$el.append(this.frame_shadow.$el),this._frameInit(this.frame_shadow,"#frame-shadow"),this._frameResize(this.frame_shadow,{width:0,height:0}),this.frame_list["#frame-shadow"]=this.frame_shadow,this.visible?this.show():this.hide(),this._panelRefresh(),a()(window).resize(function(){e.visible&&e._panelRefresh()})},render:function(){this.$(".frame-scroll-up")[this.top!=this.options.top_min?"show":"hide"](),this.$(".frame-scroll-down")[this.top!=this.top_max?"show":"hide"]()},add:function(t){var e=Object(h.a)();if(this.frame_counter>=this.options.frame_max)e.modal.show({title:f()("Warning"),body:"You have reached the maximum number of allowed frames (".concat(this.options.frame_max,")."),buttons:{Close:function(){e.modal.hide()}}});else{var i="#frame-".concat(this.frame_uid++);if(0!==a()(i).length)e.modal.show({title:f()("Error"),body:"This frame already exists. This page might contain multiple frame managers.",buttons:{Close:function(){e.modal.hide()}}});else{this.top=this.options.top_min;var n=new y(t);this.$el.append(n.$el),t.width=this._toPixelCoord("width",this.options.frame.cols),t.height=this._toPixelCoord("height",this.options.frame.rows),this.frame_z=parseInt(n.$el.css("z-index")),this.frame_list[i]=n,this.frame_counter++,this._frameInit(n,i),this._frameResize(n,{width:t.width,height:t.height}),this._frameInsert(n,{top:0,left:0},!0),this.visible||this.show(),this.trigger("add")}}},del:function(t){var e=this,i=t.$el;i.fadeOut("fast",function(){i.remove(),delete e.frame_list[t.id],e.frame_counter--,e._panelRefresh(!0),e._panelAnimationComplete(),e.trigger("remove")})},show:function(){this.visible=!0,this.$el.fadeIn("fast"),this.trigger("show")},hide:function(){this.event.type||(this.visible=!1,this.$el.fadeOut("fast",function(){a()(this).hide()}),this.trigger("hide"))},length:function(){return this.frame_counter},events:{mousemove:"_eventFrameMouseMove",mouseup:"_eventFrameMouseUp",mouseleave:"_eventFrameMouseUp",mousewheel:"_eventPanelScroll",DOMMouseScroll:"_eventPanelScroll","mousedown .frame":"_eventFrameMouseDown","mousedown .frame-background":"_eventHide","mousedown .frame-scroll-up":"_eventPanelScroll_up","mousedown .frame-scroll-down":"_eventPanelScroll_down","mousedown .f-close":"_eventFrameClose"},_eventFrameMouseDown:function(t){a()(".tooltip").hide(),this.event.type||((a()(t.target).hasClass("f-header")||a()(t.target).hasClass("f-title"))&&(this.event.type="drag"),a()(t.target).hasClass("f-resize")&&(this.event.type="resize"),this.event.type&&(t.preventDefault(),this.event.target=this._frameIdentify(t.target),this.event.xy={x:t.originalEvent.pageX,y:t.originalEvent.pageY},this._frameDragStart(this.event.target)))},_eventFrameMouseMove:function(t){if(this.event.type){var e={x:t.originalEvent.pageX,y:t.originalEvent.pageY},i={x:e.x-this.event.xy.x,y:e.y-this.event.xy.y};this.event.xy=e;var n=this._frameScreen(this.event.target);if("resize"==this.event.type){n.width+=i.x,n.height+=i.y;var a=this.options.cell-this.options.margin-1;n.width=Math.max(n.width,a),n.height=Math.max(n.height,a),this._frameResize(this.event.target,n),n.width=this._toGridCoord("width",n.width)+1,n.height=this._toGridCoord("height",n.height)+1,n.width=this._toPixelCoord("width",n.width),n.height=this._toPixelCoord("height",n.height),this._frameResize(this.frame_shadow,n),this._frameInsert(this.frame_shadow,{top:this._toGridCoord("top",n.top),left:this._toGridCoord("left",n.left)})}else if("drag"==this.event.type){n.left+=i.x,n.top+=i.y,this._frameOffset(this.event.target,n);var o={top:this._toGridCoord("top",n.top),left:this._toGridCoord("left",n.left)};0!==o.left&&o.left++,this._frameInsert(this.frame_shadow,o)}}},_eventFrameMouseUp:function(t){this.event.type&&(this._frameDragStop(this.event.target),this.event.type=null)},_eventFrameClose:function(t){this.event.type||(t.preventDefault(),this.del(this._frameIdentify(t.target)))},_eventHide:function(t){this.event.type||this.hide()},_eventPanelScroll:function(t){!this.event.type&&this.visible&&(0!==a()(t.srcElement).parents(".frame").length?t.stopPropagation():(t.preventDefault(),this._panelScroll(t.originalEvent.detail?t.originalEvent.detail:t.originalEvent.wheelDelta/-3)))},_eventPanelScroll_up:function(t){this.event.type||(t.preventDefault(),this._panelScroll(-this.options.scroll))},_eventPanelScroll_down:function(t){this.event.type||(t.preventDefault(),this._panelScroll(this.options.scroll))},_frameIdentify:function(t){return this.frame_list["#".concat(a()(t).closest(".frame").attr("id"))]},_frameDragStart:function(t){this._frameFocus(t,!0);var e=this._frameScreen(t);this._frameResize(this.frame_shadow,e),this._frameGrid(this.frame_shadow,t.grid_location),t.grid_location=null,this.frame_shadow.$el.show(),a()(".f-cover").show()},_frameDragStop:function(t){this._frameFocus(t,!1);var e=this._frameScreen(this.frame_shadow);this._frameResize(t,e),this._frameGrid(t,this.frame_shadow.grid_location,!0),this.frame_shadow.grid_location=null,this.frame_shadow.$el.hide(),a()(".f-cover").hide(),this._panelAnimationComplete()},_toGridCoord:function(t,e){var i="width"==t||"height"==t?1:-1;return"top"==t&&(e-=this.top),parseInt((e+i*this.options.margin)/this.options.cell,10)},_toPixelCoord:function(t,e){var i="width"==t||"height"==t?1:-1,n=e*this.options.cell-i*this.options.margin;return"top"==t&&(n+=this.top),n},_toGrid:function(t){return{top:this._toGridCoord("top",t.top),left:this._toGridCoord("left",t.left),width:this._toGridCoord("width",t.width),height:this._toGridCoord("height",t.height)}},_toPixel:function(t){return{top:this._toPixelCoord("top",t.top),left:this._toPixelCoord("left",t.left),width:this._toPixelCoord("width",t.width),height:this._toPixelCoord("height",t.height)}},_isCollision:function(t){for(var e in this.frame_list){var i=this.frame_list[e];if(null!==i.grid_location&&(n=t,a=i.grid_location,!(n.left>a.left+a.width-1||n.left+n.width-1<a.left||n.top>a.top+a.height-1||n.top+n.height-1<a.top)))return!0}var n,a;return!1},_locationRank:function(t){return t.top*this.cols+t.left},_panelRefresh:function(t){this.cols=parseInt(a()(window).width()/this.options.cell,10)+1,this._frameInsert(null,null,t)},_panelAnimationComplete:function(){var t=this;a()(".frame").promise().done(function(){t._panelScroll(0,!0)})},_panelScroll:function(t,e){var i=this.top-this.options.scroll*t;if(i=Math.max(i,this.top_max),i=Math.min(i,this.options.top_min),this.top!=i){for(var n in this.frame_list){var a=this.frame_list[n];if(null!==a.grid_location){var o={top:a.screen_location.top-(this.top-i),left:a.screen_location.left};this._frameOffset(a,o,e)}}this.top=i}this.render()},_frameInit:function(t,e){t.id=e,t.screen_location={},t.grid_location={},t.grid_rank=null,t.$el.attr("id",e.substring(1))},_frameInsert:function(t,e,i){var n=this,o=[];t&&(t.grid_location=null,o.push([t,this._locationRank(e)])),l.a.each(this.frame_list,function(t){null!==t.grid_location&&(t.grid_location=null,o.push([t,t.grid_rank]))}),o.sort(function(t,e){return t[1]<e[1]?-1:t[1]>e[1]?1:0}),l.a.each(o,function(t){n._framePlace(t[0],i)}),this.top_max=0,l.a.each(this.frame_list,function(t){null!==t.grid_location&&(n.top_max=Math.max(n.top_max,t.grid_location.top+t.grid_location.height))}),this.top_max=a()(window).height()-this.top_max*this.options.cell-2*this.options.margin,this.top_max=Math.min(this.top_max,this.options.top_min),this.render()},_framePlace:function(t,e){t.grid_location=null;for(var i=this._toGrid(this._frameScreen(t)),n=!1,a=0;a<this.options.rows;a++){for(var o=0;o<Math.max(1,this.cols-i.width);o++)if(i.top=a,i.left=o,!this._isCollision(i)){n=!0;break}if(n)break}n?this._frameGrid(t,i,e):console.log("Grid dimensions exceeded.")},_frameFocus:function(t,e){t.$el.css("z-index",this.frame_z+(e?1:0))},_frameOffset:function(t,e,i){if(t.screen_location.left=e.left,t.screen_location.top=e.top,i){this._frameFocus(t,!0);var n=this;t.$el.animate({top:e.top,left:e.left},"fast",function(){n._frameFocus(t,!1)})}else t.$el.css({top:e.top,left:e.left})},_frameResize:function(t,e){t.$el.css({width:e.width,height:e.height}),t.screen_location.width=e.width,t.screen_location.height=e.height},_frameGrid:function(t,e,i){t.grid_location=e,this._frameOffset(t,this._toPixel(e),i),t.grid_rank=this._locationRank(e)},_frameScreen:function(t){var e=t.screen_location;return{top:e.top,left:e.left,width:e.width,height:e.height}}})},k=i(22),C=i(14),S=i(64),T=s.a.View.extend({initialize:function(t){var e=this;t=t||{},this.frames=new x.View({visible:!1}),this.setElement(this.frames.$el),this.active=!1,this.buttonActive=t.collection.add({id:"enable-scratchbook",icon:"fa-th",tooltip:f()("Enable/Disable Scratchbook"),onclick:function(){e.active=!e.active,e.buttonActive.set({toggle:e.active,show_note:e.active,note_cls:e.active&&"fa fa-check"}),e.active||e.frames.hide()},onbeforeunload:function(){if(e.frames.length()>0)return"You opened ".concat(e.frames.length()," frame(s) which will be lost.")}}),this.buttonLoad=t.collection.add({id:"show-scratchbook",icon:"fa-eye",tooltip:f()("Show/Hide Scratchbook"),show_note:!0,visible:!1,onclick:function(t){e.frames.visible?e.frames.hide():e.frames.show()}}),this.frames.on("add remove",function(){e.frames.visible&&0===e.frames.length()&&e.frames.hide(),e.buttonLoad.set({note:e.frames.length(),visible:e.frames.length()>0})}).on("show hide ",function(){e.buttonLoad.set({toggle:e.frames.visible,icon:e.frames.visible?"fa-eye":"fa-eye-slash"})}),this.history_cache={}},addDataset:function(t){var e=this,i=null,n=Object(h.a)();if(n&&n.currHistoryPanel){var a=n.currHistoryPanel.collection.historyId;this.history_cache[a]={name:n.currHistoryPanel.model.get("name"),dataset_ids:[]},n.currHistoryPanel.collection.each(function(t){!t.get("deleted")&&t.get("visible")&&e.history_cache[a].dataset_ids.push(t.get("id"))})}var o=function(t,i){if(t){var n=e.history_cache[t.get("history_id")];if(n&&n.dataset_ids){var a=n.dataset_ids,o=a.indexOf(t.get("id"));if(-1!==o&&o+i>=0&&o+i<a.length)return a[o+i]}}},s=function(t,n,a){var s=o(t,n);s?e._loadDataset(s,function(t,e){i=t,a.model.set(e)}):a.model.trigger("change")};this._loadDataset(t,function(t,n){i=t,e.add(l.a.extend({menu:[{icon:"fa fa-chevron-circle-left",tooltip:f()("Previous in History"),onclick:function(t){s(i,-1,t)},disabled:function(){return!o(i,-1)}},{icon:"fa fa-chevron-circle-right",tooltip:f()("Next in History"),onclick:function(t){s(i,1,t)},disabled:function(){return!o(i,1)}}]},n))})},_loadDataset:function(t,e){var i=this,n=new k.a({id:t});a.a.when(n.fetch()).then(function(){var a=l.a.find(["tabular","interval"],function(t){return-1!==n.get("data_type").indexOf(t)}),o=n.get("name"),s=i.history_cache[n.get("history_id")];s&&(o="".concat(s.name,": ").concat(o)),e(n,a?{title:o,url:null,content:Object(k.d)({model:new k.c(n.toJSON()),embedded:!0,height:"100%"}).$el}:{title:o,url:"".concat(Object(u.getAppRoot)(),"datasets/").concat(t,"/display/?preview=True"),content:null})})},addTrackster:function(t){var e=this,i=new C.a.Visualization({id:t});a.a.when(i.fetch()).then(function(){var t=new S.a(Object(u.getAppRoot)()),n={title:i.get("name"),type:"other",content:function(e){var n={container:e,name:i.get("title"),id:i.id,dbkey:i.get("dbkey"),stand_alone:!1},a=i.get("latest_revision"),o=a.config.view.drawables;l.a.each(o,function(t){t.dataset={hda_ldda:t.hda_ldda,id:t.dataset_id}}),t.create_visualization(n,a.config.viewport,a.config.view.drawables,a.config.bookmarks,!1)}};e.add(n)})},add:function(t){if("_blank"==t.target)window.open(t.url);else if("_top"==t.target||"_parent"==t.target||"_self"==t.target)window.location=t.url;else if(!this.active||t.noscratchbook){var e=a()(window.parent.document).find("#galaxy_main");"galaxy_main"==t.target||"center"==t.target?0===e.length?window.location=this._build_url(t.url,{use_panels:!0}):e.attr("src",t.url):window.location=t.url}else t.url=this._build_url(t.url,{hide_panels:!0,hide_masthead:!0}),this.frames.add(t)},_build_url:function(t,e){if(t)return t+=-1==t.indexOf("?")?"?":"&",t+=a.a.param(e,!0)}}),$=i(7),O={UserQuotaMeter:s.a.View.extend($.a.LoggableMixin).extend({_logNamespace:"user",options:{warnAtPercent:85,errorAtPercent:100},initialize:function(t){this.log("".concat(this,".initialize:"),t),l.a.extend(this.options,t),this.listenTo(this.model,"change:quota_percent change:total_disk_usage",this.render)},update:function(t){return this.log("".concat(this," updating user data..."),t),this.model.loadFromApi(this.model.get("id"),t),this},isOverQuota:function(){return null!==this.model.get("quota_percent")&&this.model.get("quota_percent")>=this.options.errorAtPercent},_render_quota:function(){var t=this.model.toJSON(),e=t.quota_percent,i=a()(this._templateQuotaMeter(t)),n=i.find(".progress-bar");return this.isOverQuota()?(n.attr("class","progress-bar bg-danger"),i.find(".quota-meter-text").css("color","white"),this.trigger("quota:over",t)):e>=this.options.warnAtPercent?(n.attr("class","progress-bar bg-warning"),this.trigger("quota:under quota:under:approaching",t)):(n.attr("class","progress-bar bg-success"),this.trigger("quota:under quota:under:ok",t)),i},_render_usage:function(){var t=a()(this._templateUsage(this.model.toJSON()));return this.log("".concat(this,".rendering usage:"),t),t},render:function(){var t=null;return this.log("".concat(this,".model.quota_percent:"),this.model.get("quota_percent")),t=null===this.model.get("quota_percent")||void 0===this.model.get("quota_percent")?this._render_usage():this._render_quota(),this.$el.html(t),this.$el.find(".quota-meter-text").tooltip(),this},_templateQuotaMeter:function(t){return['<div id="quota-meter" class="quota-meter progress">','<div class="progress-bar" style="width: ',t.quota_percent,'%"></div>','<div class="quota-meter-text" data-placement="left" style="top: 6px"',t.nice_total_disk_usage?' title="Using '.concat(t.nice_total_disk_usage,'. Click for details.">'):">",'<a href="https://galaxyproject.org/support/account-quotas/" target="_blank">',f()("Using")," ",t.quota_percent,"%","</a>","</div>","</div>"].join("")},_templateUsage:function(t){return['<div id="quota-meter" class="quota-meter" style="background-color: transparent">','<div class="quota-meter-text" data-placement="left" data-original-title="This value is recalculated when you log out." style="top: 6px; color: white">',t.nice_total_disk_usage?f()("Using ")+t.nice_total_disk_usage:"","</div>","</div>"].join("")},toString:function(){return"UserQuotaMeter(".concat(this.model,")")}})},A=s.a.View.extend({initialize:function(t){var e=Object(h.a)(),i=this;this.options=t,this.setElement(this._template()),this.$navbarBrandLink=this.$(".navbar-brand"),this.$navbarBrandImage=this.$(".navbar-brand-image"),this.$navbarBrandTitle=this.$(".navbar-brand-title"),this.$navbarTabs=this.$(".navbar-nav"),this.$quoteMeter=this.$(".quota-meter-container"),this.collection=new w.Collection,this.collection.on("add",function(t){i.$navbarTabs.append(new w.Tab({model:t}).render().$el)}).on("reset",function(){i.$navbarTabs.empty()}).on("dispatch",function(t){i.collection.each(function(e){t(e)})}).fetch(this.options),this.highlight(t.active_view),e.frame=this.frame=new T({collection:this.collection}),e.quotaMeter=this.quotaMeter=new O.UserQuotaMeter({model:e.user,el:this.$quoteMeter}),a()(window).on("click",function(t){var e=a()(t.target).closest("a[download]");1==e.length&&(0===a()("iframe[id=download]").length&&a()("body").append(a()("<iframe/>").attr("id","download").hide()),a()("iframe[id=download]").attr("src",e.attr("href")),t.preventDefault())}).on("beforeunload",function(){var t="";if(i.collection.each(function(e){var i=e.get("onbeforeunload")&&e.get("onbeforeunload")();i&&(t+="".concat(i," "))}),""!==t)return t})},render:function(){return this.$navbarBrandTitle.html("Galaxy ".concat(this.options.brand&&"/ ".concat(this.options.brand)||"")),this.$navbarBrandLink.attr("href",this.options.logo_url),this.$navbarBrandImage.attr("src",this.options.logo_src),this.quotaMeter.render(),this},highlight:function(t){this.collection.forEach(function(e){e.set("active",e.id==t)})},_template:function(){return'\n            <nav id="masthead" class="navbar navbar-expand justify-content-center navbar-dark">\n                <a class="navbar-brand">\n                    <img class="navbar-brand-image"/>\n                    <span class="navbar-brand-title"/>\n                </a>\n                <ul class="navbar-nav"/>\n                <div class="quota-meter-container"/>\n            </nav>'}});e.a={View:A}},117:function(t,e,i){"use strict";e.a={tool:"fa-wrench",data_input:"fa-file-o",data_collection_input:"fa-folder-o",subworkflow:"fa-sitemap fa-rotate-270",parameter_input:"fa-pencil",pause:"fa-pause"}},120:function(t,e,i){"use strict";var n=i(0),a=i.n(n),o=a.a,s=window._l||function(t){return t};function r(t,e){var i=27,n=13,r=o(t),l=!0;function c(t){o(this).parent().children("input").val("").trigger("searchInput.clear").blur(),e.onclear()}return"string"===a.a.type(e)?("toggle-loading"===e&&(r.find(".search-loading").toggle(),r.find(".search-clear").toggle()),r):("object"===a.a.type(e)&&(e=a.a.extend(!0,{},{initialVal:"",name:"search",placeholder:"search",classes:"",onclear:function(){},onfirstsearch:null,onsearch:function(t){},minSearchLen:0,escWillClear:!0,oninit:function(){}},e)),r.addClass("search-input").prepend([o(['<input type="text" name="',e.name,'" placeholder="',e.placeholder,'" ','class="search-query ',e.classes,'" ',"/>"].join("")).focus(function(t){o(this).select()}).keyup(function(t){if(t.preventDefault(),t.stopPropagation(),t.which===i&&e.escWillClear)c.call(this,t);else{var a=o(this).val();(t.which===n||e.minSearchLen&&a.length>=e.minSearchLen)&&function(t,i){if(!i)return c();o(this).trigger("search.search",i),"function"==typeof e.onfirstsearch&&l?(l=!1,e.onfirstsearch(i)):e.onsearch(i)}.call(this,t,a)}}).val(e.initialVal),o(['<span class="search-clear fa fa-times-circle" ','title="',s("clear search (esc)"),'"></span>'].join("")).tooltip({placement:"bottom"}).click(function(t){c.call(this,t)}),o(['<span class="search-loading fa fa-spinner fa-spin" ','title="',s("loading..."),'"></span>'].join("")).hide().tooltip({placement:"bottom"})]))}a.a.fn.extend({searchInput:function(t){return this.each(function(){return r(this,t)})}})},121:function(t,e,i){"use strict";var n=i(1),a=i.n(n),o=i(0),s=i.n(o),r=i(4),l=i(5),c=i(2),d=i.n(c),u=i(88),h=i(10),p=i(24),f=i(48),m=i(130),g=i(12),_=i(15),v=i.n(_);e.a=p.a.extend({initialize:function(t){var e=Object(l.a)(),i=this;this.deferred=new u.a,p.a.prototype.initialize.call(this,t),this._update(this.model.get("initialmodel")),this.model.get("listen_to_history")&&e.currHistoryPanel&&this.listenTo(e.currHistoryPanel.collection,"change",function(){i.model.get("onchange")()}),this.$el.on("remove",function(){i._destroy()})},_update:function(t){var e=this;(t=t||this.model.get("buildmodel"))?(this.deferred.reset(),this.deferred.execute(function(i){t(i,e),i.then(function(){e._render()})})):this._render()},_destroy:function(){var t=this;this.$el.off().hide(),this.deferred.execute(function(){p.a.prototype.remove.call(t),Object(l.a)().emit.debug("tool-form-base::_destroy()","Destroy view.")})},_render:function(){var t=this,e=this.model.attributes;this.model.set({title:e.fixed_title||"<b>".concat(e.name,"</b> ").concat(e.description," (Galaxy Version ").concat(e.version,")"),operations:!e.hide_operations&&this._operations(),onchange:function(){t.deferred.reset(),t.deferred.execute(function(e){t.model.get("postchange")(e,t)})}}),this.render(),this.model.get("collapsible")||this.$el.append(s()("<div/>").addClass("mt-2").append(this._footer())),e.tool_errors&&this.message.update({status:"danger",message:e.tool_errors,persistent:!0}),this.show_message&&this.message.update({status:"success",message:"Now you are using '".concat(e.name,"' version ").concat(e.version,", id '").concat(e.id,"'."),persistent:!1}),this.show_message=!0},_operations:function(){var t=this,e=this.model.attributes,i=Object(l.a)(),n=i.user.getFavorites().tools.indexOf(e.id)>=0,a=new h.a.Button({icon:"fa-star-o",title:e.narrow?null:"Favorite",tooltip:"Add to favorites",visible:!i.user.isAnonymous()&&!n,onclick:function(){v.a.put("".concat(i.root,"api/users/").concat(i.user.id,"/favorites/tools"),{object_id:e.id}).then(function(t){a.hide(),o.show(),i.user.updateFavorites("tools",t.data)})}}),o=new h.a.Button({icon:"fa-star",title:e.narrow?null:"Added",tooltip:"Remove from favorites",visible:!i.user.isAnonymous()&&n,onclick:function(){v.a.delete("".concat(i.root,"api/users/").concat(i.user.id,"/favorites/tools/").concat(encodeURIComponent(e.id))).then(function(t){o.hide(),a.show(),i.user.updateFavorites("tools",t.data)})}}),s=new h.a.ButtonMenu({icon:"fa-cubes",title:e.narrow?null:"Versions",tooltip:"Select another tool version"});if(!e.sustain_version&&e.versions&&e.versions.length>1)for(var c in e.versions){var u=e.versions[c];u!=e.version&&s.addMenu({title:"Switch to ".concat(u),version:u,icon:"fa-cube",onclick:function(){t.model.set("id",e.id.replace(e.version,this.version)),t.model.set("version",this.version),t._update()}})}else s.$el.hide();var p=new h.a.ButtonMenu({id:"options",icon:"fa-caret-down",title:e.narrow?null:"Options",tooltip:"View available options"});return p.addMenu({icon:"fa-share",title:d()("Share"),onclick:function(){prompt("Copy to clipboard: Ctrl+C, Enter","".concat(window.location.origin+Object(r.getAppRoot)(),"root?tool_id=").concat(e.id))}}),i.user&&i.user.get("is_admin")&&p.addMenu({icon:"fa-download",title:d()("Download"),onclick:function(){window.location.href="".concat(Object(r.getAppRoot)(),"api/tools/").concat(e.id,"/download")}}),e.requirements&&e.requirements.length>0&&p.addMenu({icon:"fa-info-circle",title:d()("Requirements"),onclick:function(){!this.requirements_visible||t.portlet.collapsed?(this.requirements_visible=!0,t.portlet.expand(),t.message.update({persistent:!0,message:t._templateRequirements(e),status:"info"})):(this.requirements_visible=!1,t.message.update({message:""}))}}),e.sharable_url&&p.addMenu({icon:"fa-external-link",title:d()("See in Tool Shed"),onclick:function(){window.open(e.sharable_url)}}),f.a.load({type:"tool-menu",callback:function(t){t.each(function(t){var i=t.toJSON();i.activate&&i.config.function&&p.addMenu({icon:i.config.icon,title:i.config.title,onclick:function(){new Function("options",i.config.function)(e)}})})}}),{menu:p,versions:s,favorite:a,remove_favorite:o}},_footer:function(){var t=this.model.attributes,e=s()("<div/>").append(this._templateHelp(t));if(t.citations){var i=g.a.extend(m.a),n=document.createElement("div");e.append(n),new i({propsData:{id:t.id,source:"tools"}}).$mount(n)}return e},_templateHelp:function(t){var e=s()("<div/>").addClass("form-help form-text mt-4").append(t.help);return e.find("a").attr("target","_blank"),e.find("img").each(function(){var t=s()(this).attr("src");-1!==t.indexOf("admin_toolshed")&&s()(this).attr("src",Object(r.getAppRoot)()+t)}),e},_templateRequirements:function(t){var e=t.requirements.length;if(e>0){var i="This tool requires ";a.a.each(t.requirements,function(t,n){i+=t.name+(t.version?" (Version ".concat(t.version,")"):"")+(n<e-2?", ":n==e-2?" and ":"")});var n=s()("<a/>").attr("target","_blank").attr("href","https://galaxyproject.org/tools/requirements/").text("here");return s()("<span/>").append("".concat(i,". Click ")).append(n).append(" for more information.")}return"No requirements found."}})},122:function(t,e,i){"use strict";(function(t){function i(t){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function n(t){t=t||{};return this.userId=window.bootstrapped&&window.bootstrapped.user?window.bootstrapped.user.id:null,this.userId=this.userId||t.userId||null,this.consoleLogger=t.consoleLogger||null,this._init(t),this}function a(t){var e=String(t);return"[object Object]"==e&&(e=JSON.stringify(t)),e}function o(t){return this._init(t||{})}n.ALL=0,n.LOG=0,n.DEBUG=10,n.INFO=20,n.WARN=30,n.ERROR=40,n.METRIC=50,n.NONE=100,n.defaultOptions={logLevel:n.NONE,consoleLevel:n.NONE,defaultNamespace:"Galaxy",consoleNamespaceWhitelist:null,consoleFlattenMessages:!1,clientPrefix:"client.",maxCacheSize:3e3,postSize:1e3,addTime:!0,cacheKeyPrefix:"logs-",postUrl:"/api/metrics",delayPostInMs:6e5,getPingData:void 0,onServerResponse:void 0},n.prototype._init=function(t){for(var e in this.options={},n.defaultOptions)n.defaultOptions.hasOwnProperty(e)&&(this.options[e]=t.hasOwnProperty(e)?t[e]:n.defaultOptions[e]);return this.options.logLevel=this._parseLevel(this.options.logLevel),this.options.consoleLevel=this._parseLevel(this.options.consoleLevel),this._sending=!1,this._waiting=null,this._postSize=this.options.postSize,this._initCache(),this},n.prototype._initCache=function(){try{this.cache=new o({maxSize:this.options.maxCacheSize,key:this.options.cacheKeyPrefix+this.userId})}catch(t){this._emitToConsole("warn","MetricsLogger",["Could not intitialize logging cache:",t]),this.options.logLevel=n.NONE}},n.prototype._parseLevel=function(t){var e=i(t);if("number"===e)return t;if("string"===e){var a=t.toUpperCase();if(n.hasOwnProperty(a))return n[a]}throw new Error("Unknown log level: ".concat(t))},n.prototype.emit=function(t,e,i){return e=e||this.options.defaultNamespace,t&&i?((t=this._parseLevel(t))>=this.options.logLevel&&this._addToCache(t,e,i),this.consoleLogger&&t>=this.options.consoleLevel&&this._emitToConsole(t,e,i),this):this},n.prototype._addToCache=function(t,e,i){this._emitToConsole("debug","MetricsLogger",["_addToCache:",arguments,this.options.addTime,this.cache.length()]);try{this.cache.add(this._buildEntry(t,e,i))>=this._postSize&&this._postCache()}catch(t){this._emitToConsole("warn","MetricsLogger",["Metrics logger could not stringify logArguments:",e,i]),this._emitToConsole("error","MetricsLogger",[t])}return this},n.prototype._buildEntry=function(t,e,i){this._emitToConsole("debug","MetricsLogger",["_buildEntry:",arguments]);var n={level:t,namespace:this.options.clientPrefix+e,args:i};return this.options.addTime&&(n.time=(new Date).toISOString()),n},n.prototype._postCache=function(e){if(e=e||{},this._emitToConsole("info","MetricsLogger",["_postCache",e,this._postSize]),!this.options.postUrl||this._sending)return t.when({});var i=this,n=e.count||i._postSize,a=i.cache.get(n),o=a.length,s="function"==typeof i.options.getPingData?i.options.getPingData():{};return s.metrics=JSON.stringify(a),i._sending=!0,t.post(i.options.postUrl,s).always(function(){i._sending=!1}).fail(function(t,e,n){i._postSize=i.options.maxCacheSize,i.emit("error","MetricsLogger",["_postCache error:",t.readyState,t.status,t.responseJSON||t.responseText])}).done(function(t){"function"==typeof i.options.onServerResponse&&i.options.onServerResponse(t),i.cache.remove(o),i._postSize=i.options.postSize})},n.prototype._delayPost=function(){var t=this;t._waiting=setTimeout(function(){t._waiting=null},t.options.delayPostInMs)},n.prototype._emitToConsole=function(t,e,i){var o=this.options.consoleNamespaceWhitelist;if(!this.consoleLogger)return this;if(o&&-1===o.indexOf(e))return this;var s=Array.prototype.slice.call(i,0);return s.unshift(e),this.options.consoleFlattenMessages&&(s=[s.map(a).join(" ")]),t>=n.METRIC&&"function"==typeof this.consoleLogger.info?this.consoleLogger.info.apply(this.consoleLogger,s):t>=n.ERROR&&"function"==typeof this.consoleLogger.error?this.consoleLogger.error.apply(this.consoleLogger,s):(t>=n.WARN&&"function"==typeof this.consoleLogger.warn?this.consoleLogger.warn.apply(this.consoleLogger,s):t>=n.INFO&&"function"==typeof this.consoleLogger.info?this.consoleLogger.info.apply(this.consoleLogger,s):t>=n.DEBUG&&"function"==typeof this.consoleLogger.debug?this.consoleLogger.debug.apply(this.consoleLogger,s):"function"==typeof this.consoleLogger.log&&this.consoleLogger.log.apply(this.consoleLogger,s),this)},n.prototype.log=function(){this.emit(1,this.options.defaultNamespace,Array.prototype.slice.call(arguments,0))},n.prototype.debug=function(){this.emit(n.DEBUG,this.options.defaultNamespace,Array.prototype.slice.call(arguments,0))},n.prototype.info=function(){this.emit(n.INFO,this.options.defaultNamespace,Array.prototype.slice.call(arguments,0))},n.prototype.warn=function(){this.emit(n.WARN,this.options.defaultNamespace,Array.prototype.slice.call(arguments,0))},n.prototype.error=function(){this.emit(n.ERROR,this.options.defaultNamespace,Array.prototype.slice.call(arguments,0))},n.prototype.metric=function(){this.emit(n.METRIC,this.options.defaultNamespace,Array.prototype.slice.call(arguments,0))},o.defaultOptions={maxSize:5e3},o.prototype._init=function(t){if(!this._hasStorage())throw new Error("LoggingCache needs localStorage");if(!t.key)throw new Error("LoggingCache needs key for localStorage");return this.key=t.key,this._initStorage(),this.maxSize=t.maxSize||o.defaultOptions.maxSize,this},o.prototype._hasStorage=function(){try{return localStorage.setItem("test","test"),localStorage.removeItem("test"),!0}catch(t){return!1}},o.prototype._initStorage=function(){return null===localStorage.getItem(this.key)?this.empty():this},o.prototype.add=function(t){var e=this._fetchAndParse(),i=e.length+1-this.maxSize;return i>0&&e.splice(0,i),e.push(t),this._unparseAndStore(e),e.length},o.prototype._fetchAndParse=function(){return JSON.parse(localStorage.getItem(this.key))},o.prototype._unparseAndStore=function(t){return localStorage.setItem(this.key,JSON.stringify(t))},o.prototype.length=function(){return this._fetchAndParse().length},o.prototype.get=function(t){return this._fetchAndParse().slice(0,t)},o.prototype.remove=function(t){var e=this._fetchAndParse(),i=e.splice(0,t);return this._unparseAndStore(e),i},o.prototype.empty=function(){return localStorage.setItem(this.key,"[]"),this},o.prototype.stringify=function(t){return JSON.stringify(this.get(t))},o.prototype.print=function(){console.log(JSON.stringify(this._fetchAndParse(),null,"  "))},e.a={MetricsLogger:n,LoggingCache:o}}).call(this,i(0))},125:function(t,e,i){},130:function(t,e,i){"use strict";var n=i(1),a=i.n(n),o=i(15),s=i.n(o),r=i(12),l=i(38),c=i.n(l),d=i(4),u=i(169),h=i(170),p=i(150);r.a.use(c.a);var f={props:{source:{type:String,required:!0},id:{type:String,required:!0},viewRender:{type:Boolean,requried:!1,default:!0}},data:function(){return{citations:[],content:"",errors:[]}},computed:{formattedReferences:function(){var t=this;return this.citations.reduce(function(e,i){return e.concat('<p class="formatted-reference">'.concat(t.formattedReference(i),"</p>"))},"")}},created:function(){var t=this;s.a.get("".concat(Object(d.getAppRoot)(),"api/").concat(this.source,"/").concat(this.id,"/citations")).then(function(e){t.content="";var i=!0,n=!1,o=void 0;try{for(var s,r=e.data[Symbol.iterator]();!(i=(s=r.next()).done);i=!0){var l=s.value;try{var c={fields:{},entryType:void 0},d=u.toJSON(l.content);if(d)for(var h in d=a.a.first(d),c.entryType=d.entryType||void 0,d.entryTags)c.fields[h.toLowerCase()]=d.entryTags[h];t.citations.push(c),t.content+=l.content}catch(t){console.warn("Error parsing bibtex: "+t)}}}catch(t){n=!0,o=t}finally{try{i||null==r.return||r.return()}finally{if(n)throw o}}}).catch(function(t){console.error(t)})},methods:{formattedReference:function(t){var e=t.entryType,i=t.fields,n="",a="".concat(this._asSentence((i.author?i.author:"")+(i.year?" (".concat(i.year,")"):""))," "),o=i.title||"",s=i.pages?"pp. ".concat(i.pages):"",r=i.address;if("article"==e){var l=(i.volume?i.volume:"")+(i.number?" (".concat(i.number,")"):"")+(s?", ".concat(s):"");n="".concat(a+this._asSentence(o)+(i.journal?"In <em>".concat(i.journal,", "):"")+this._asSentence(l)+this._asSentence(i.address),"</em>")}else n="inproceedings"==e||"proceedings"==e?"".concat(a+this._asSentence(o)+(i.booktitle?"In <em>".concat(i.booktitle,", "):"")+(s||"")+(r?", ".concat(r):""),".</em>"):"mastersthesis"==e||"phdthesis"==e?a+this._asSentence(o)+(i.howpublished?"".concat(i.howpublished,". "):"")+(i.note?"".concat(i.note,"."):""):"techreport"==e?a+this._asSentence(o)+this._asSentence(i.institution)+this._asSentence(i.number)+this._asSentence(i.type):"book"==e||"inbook"==e||"incollection"==e?"".concat(a," ").concat(this._formatBookInfo(i)):"".concat(a," ").concat(this._asSentence(o)).concat(this._asSentence(i.howpublished)).concat(this._asSentence(i.note));var c="";i.doi&&(c="https://doi.org/".concat(i.doi),n+='[<a href="'.concat(c,'" target="_blank">doi:').concat(i.doi,"</a>]"));var d=i.url||c;return d&&(n+='[<a href="'.concat(d,'" target="_blank">Link</a>]')),Object(h.convertLaTeX)({onError:function(t,e){return"{".concat(Object(p.stringifyLaTeX)(e),"}")}},n)},_formatBookInfo:function(t){var e="";return t.chapter&&(e+="".concat(t.chapter," in ")),t.title&&(e+="<em>".concat(t.title,"</em>")),t.editor&&(e+=", Edited by ".concat(t.editor,", ")),t.publisher&&(e+=", ".concat(t.publisher)),t.pages&&(e+=", pp. ".concat(t.pages)),t.series&&(e+=", <em>".concat(t.series,"</em>")),t.volume&&(e+=", Vol.".concat(t.volume)),t.issn&&(e+=", ISBN: ".concat(t.issn)),"".concat(e,".")},_asSentence:function(t){return t&&t.trim()?"".concat(t,". "):""},toggleViewRender:function(){this.viewRender=!this.viewRender}}},m=(i(192),i(13)),g=Object(m.a)(f,function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("b-card",[i("h4",{staticClass:"mb-0",attrs:{slot:"header"},slot:"header"},[t._v("\n        Citations\n        "),t.viewRender?i("b-button",{staticClass:"citations-to-bibtex",attrs:{title:"Show all in BibTeX format."},on:{click:t.toggleViewRender}},[i("i",{staticClass:"fa fa-pencil-square-o"}),t._v(" Show BibTeX\n        ")]):i("b-button",{attrs:{title:"Return to formatted citation list."},on:{click:t.toggleViewRender}},[i("i",{staticClass:"fa fa-times"}),t._v(" Hide BibTeX\n        ")])],1),t._v(" "),"histories"===t.source?i("div",{staticClass:"infomessage"},[t._v("\n        When writing up your analysis, remember to include all references that should be cited in order to\n        completely describe your work. Also, please remember to\n        "),i("a",{attrs:{href:"https://galaxyproject.org/citing-galaxy"}},[t._v("cite Galaxy")]),t._v(".\n    ")]):t._e(),t._v(" "),t.viewRender?i("span",{staticClass:"citations-formatted"},[i("p",{domProps:{innerHTML:t._s(t.formattedReferences)}})]):i("pre",[t._v("        "),i("code",{staticClass:"citations-bibtex"},[t._v("\n            "+t._s(t.content)+"\n        ")]),t._v("\n    ")])])},[],!1,null,null,null);e.a=g.exports},138:function(t,e,i){"use strict";var n=i(0),a=i.n(n),o=a.a;a.a.fn.extend({hoverhighlight:function(t,e){return t=t||"body",this.length?(o(this).each(function(){var i=o(this),n=i.data("target");n&&i.mouseover(function(i){o(n,t).css({background:e})}).mouseout(function(t){o(n).css({background:""})})}),this):this}})},14:function(t,e,i){"use strict";var n=i(1),a=i.n(n),o=i(0),s=i.n(o),r=i(3),l=i.n(r),c=i(4),d=i(2),u=i.n(d),h=i(22),p=i(21),f=i(32),m=i(33),g=i(81),_=i(5),v={toJSON:function(){var t=this,e={};return a.a.each(t.constructor.to_json_keys,function(i){var n=t.get(i);i in t.constructor.to_json_mappers&&(n=t.constructor.to_json_mappers[i](n,t)),e[i]=n}),e}},b=function(t){this.default_font=void 0!==t?t:"9px Monaco, Lucida Console, monospace",this.dummy_canvas=this.new_canvas(),this.dummy_context=this.dummy_canvas.getContext("2d"),this.dummy_context.font=this.default_font,this.char_width_px=this.dummy_context.measureText("A").width,this.patterns={},this.load_pattern("right_strand","/visualization/strand_right.png"),this.load_pattern("left_strand","/visualization/strand_left.png"),this.load_pattern("right_strand_inv","/visualization/strand_right_inv.png"),this.load_pattern("left_strand_inv","/visualization/strand_left_inv.png")};a.a.extend(b.prototype,{load_pattern:function(t,e){var i=this.patterns,n=this.dummy_context,a=new Image;a.src="".concat(Object(c.getAppRoot)(),"static/images").concat(e),a.onload=function(){i[t]=n.createPattern(a,"repeat")}},get_pattern:function(t){return this.patterns[t]},new_canvas:function(){var t=s()("<canvas/>")[0];return t.manager=this,t}});var w=l.a.Model.extend({defaults:{num_elements:20,obj_cache:null,key_ary:null},initialize:function(t){this.clear()},get_elt:function(t){var e=this.attributes.obj_cache,i=this.attributes.key_ary,n=t.toString(),o=a.a.indexOf(i,function(t){return t.toString()===n});return-1!==o&&(e[n].stale?(i.splice(o,1),delete e[n]):this.move_key_to_end(t,o)),e[n]},set_elt:function(t,e){var i=this.attributes.obj_cache,n=this.attributes.key_ary,a=t.toString(),o=this.attributes.num_elements;if(!i[a]){if(n.length>=o)delete i[n.shift().toString()];n.push(t)}return i[a]=e,e},move_key_to_end:function(t,e){this.attributes.key_ary.splice(e,1),this.attributes.key_ary.push(t)},clear:function(){this.attributes.obj_cache={},this.attributes.key_ary=[]},size:function(){return this.attributes.key_ary.length},most_recently_added:function(){return 0===this.size()?null:this.attributes.key_ary[this.attributes.key_ary.length-1]}}),y=w.extend({defaults:a.a.extend({},w.prototype.defaults,{dataset:null,genome:null,init_data:null,min_region_size:200,filters_manager:null,data_type:"data",data_mode_compatible:function(t,e){return!0},can_subset:function(t){return!1}}),initialize:function(t){w.prototype.initialize.call(this);var e=this.get("init_data");e&&this.add_data(e)},add_data:function(t){this.get("num_elements")<t.length&&this.set("num_elements",t.length);var e=this;a.a.each(t,function(t){e.set_data(t.region,t)})},data_is_ready:function(){var t=this.get("dataset"),e=s.a.Deferred(),i="raw_data"===this.get("data_type")?"state":"data"===this.get("data_type")?"converted_datasets_state":"error",n=new p.a.ServerStateDeferred({ajax_settings:{url:this.get("dataset").url(),data:{hda_ldda:t.get("hda_ldda"),data_type:i},dataType:"json"},interval:5e3,success_fn:function(t){return"pending"!==t}});return s.a.when(n.go()).then(function(t){e.resolve("ok"===t||"data"===t)}),e},search_features:function(t){var e=this.get("dataset"),i={query:t,hda_ldda:e.get("hda_ldda"),data_type:"features"};return s.a.getJSON(e.url(),i)},load_data:function(t,e,i,n){var a=this.get("dataset"),o={data_type:this.get("data_type"),chrom:t.get("chrom"),low:t.get("start"),high:t.get("end"),mode:e,resolution:i,hda_ldda:a.get("hda_ldda")};s.a.extend(o,n);var r=this.get("filters_manager");if(r){for(var l=[],c=r.filters,d=0;d<c.length;d++)l.push(c[d].name);o.filter_cols=JSON.stringify(l)}var u=this,h=s.a.getJSON(a.url(),o,function(e){e.region=t,u.set_data(t,e)});return this.set_data(t,h),h},get_data:function(t,e,i,n){var a=this.get_elt(t);if(a&&(p.a.is_deferred(a)||this.get("data_mode_compatible")(a,e)))return a;for(var o,s,r=this.get("key_ary"),l=this.get("obj_cache"),c=0;c<r.length;c++)if((o=r[c]).contains(t)&&(s=!0,a=l[o.toString()],p.a.is_deferred(a)||this.get("data_mode_compatible")(a,e)&&this.get("can_subset")(a))){if(this.move_key_to_end(o,c),!p.a.is_deferred(a)){var d=this.subset_entry(a,t);this.set_data(t,d),a=d}return a}if(!s&&t.length()<this.attributes.min_region_size){t=t.copy();var u=this.most_recently_added();!u||t.get("start")>u.get("start")?t.set("end",t.get("start")+this.attributes.min_region_size):t.set("start",t.get("end")-this.attributes.min_region_size),t.set("genome",this.attributes.genome),t.trim()}return this.load_data(t,e,i,n)},set_data:function(t,e){this.set_elt(t,e)},DEEP_DATA_REQ:"deep",BROAD_DATA_REQ:"breadth",get_more_data:function(t,e,i,n,a){var o=this._mark_stale(t);if(o&&this.get("data_mode_compatible")(o,e)){var r=t.get("start");a===this.DEEP_DATA_REQ?s.a.extend(n,{start_val:o.data.length+1}):a===this.BROAD_DATA_REQ&&(r=(o.max_high?o.max_high:o.data[o.data.length-1][2])+1);var l=t.copy().set("start",r),c=this,d=this.load_data(l,e,i,n),u=s.a.Deferred();return this.set_data(t,u),s.a.when(d).then(function(e){e.data&&(e.data=o.data.concat(e.data),e.max_low&&(e.max_low=o.max_low),e.message&&(e.message=e.message.replace(/[0-9]+/,e.data.length))),c.set_data(t,e),u.resolve(e)}),u}console.log("ERROR: problem with getting more data: current data is not compatible")},can_get_more_detailed_data:function(t){var e=this.get_elt(t);return"bigwig"===e.dataset_type&&e.data.length<8e3},get_more_detailed_data:function(t,e,i,n,a){var o=this._mark_stale(t);if(o)return a||(a={}),"bigwig"===o.dataset_type&&(a.num_samples=1e3*n),this.load_data(t,e,i,a);console.log("ERROR getting more detailed data: no current data")},_mark_stale:function(t){var e=this.get_elt(t);return e||console.log("ERROR: no data to mark as stale: ",this.get("dataset"),t.toString()),e.stale=!0,e},get_genome_wide_data:function(t){var e=this,i=!0,n=a.a.map(t.get("chroms_info").chrom_info,function(t){var n=e.get_elt(new C({chrom:t.chrom,start:0,end:t.len}));return n||(i=!1),n});if(i)return n;var o=s.a.Deferred();return s.a.getJSON(this.get("dataset").url(),{data_type:"genome_data"},function(t){e.add_data(t.data),o.resolve(t.data)}),o},subset_entry:function(t,e){var i={bigwig:function(t,e){return a.a.filter(t,function(t){return t[0]>=e.get("start")&&t[0]<=e.get("end")})},refseq:function(e,i){var n=i.get("start")-t.region.get("start");return t.data.slice(n,n+i.length())}},n=t.data;return!t.region.same(e)&&t.dataset_type in i&&(n=i[t.dataset_type](t.data,e)),{region:e,data:n,dataset_type:t.dataset_type}}}),x=y.extend({initialize:function(t){var e=new l.a.Model;e.urlRoot=t.data_url,this.set("dataset",e)},load_data:function(t,e,i,n){return t.length()<=1e5?y.prototype.load_data.call(this,t,e,i,n):{data:null,region:t}}}),k=l.a.Model.extend({defaults:{name:null,key:null,chroms_info:null},initialize:function(t){this.id=t.dbkey},get_chroms_info:function(){return this.attributes.chroms_info.chrom_info},get_chrom_region:function(t){var e=a.a.find(this.get_chroms_info(),function(e){return e.chrom===t});return new C({chrom:e.chrom,end:e.len})},get_chrom_len:function(t){return a.a.find(this.get_chroms_info(),function(e){return e.chrom===t}).len}}),C=l.a.Model.extend({defaults:{chrom:null,start:0,end:0,str_val:null,genome:null},same:function(t){return this.attributes.chrom===t.get("chrom")&&this.attributes.start===t.get("start")&&this.attributes.end===t.get("end")},initialize:function(t){if(t.from_str){var e=t.from_str.split(":"),i=e[0],n=e[1].split("-");this.set({chrom:i,start:parseInt(n[0],10),end:parseInt(n[1],10)})}this.attributes.str_val="".concat(this.get("chrom"),":").concat(this.get("start"),"-").concat(this.get("end")),this.on("change",function(){this.attributes.str_val="".concat(this.get("chrom"),":").concat(this.get("start"),"-").concat(this.get("end"))},this)},copy:function(){return new C({chrom:this.get("chrom"),start:this.get("start"),end:this.get("end")})},length:function(){return this.get("end")-this.get("start")},toString:function(){return this.attributes.str_val},toJSON:function(){return{chrom:this.get("chrom"),start:this.get("start"),end:this.get("end")}},compute_overlap:function(t){var e=this.get("chrom"),i=t.get("chrom"),n=this.get("start"),a=t.get("start"),o=this.get("end"),s=t.get("end");return e&&i&&e!==i?C.overlap_results.DIF_CHROMS:n<a?o<a?C.overlap_results.BEFORE:o<s?C.overlap_results.OVERLAP_START:C.overlap_results.CONTAINS:n>a?n>s?C.overlap_results.AFTER:o<=s?C.overlap_results.CONTAINED_BY:C.overlap_results.OVERLAP_END:o>=s?C.overlap_results.CONTAINS:C.overlap_results.CONTAINED_BY},trim:function(t){if(this.attributes.start<0&&(this.attributes.start=0),this.attributes.genome){var e=this.attributes.genome.get_chrom_len(this.attributes.chrom);this.attributes.end>e&&(this.attributes.end=e-1)}return this},contains:function(t){return this.compute_overlap(t)===C.overlap_results.CONTAINS},overlaps:function(t){return 0===a.a.intersection([this.compute_overlap(t)],[C.overlap_results.DIF_CHROMS,C.overlap_results.BEFORE,C.overlap_results.AFTER]).length}},{overlap_results:{DIF_CHROMS:1e3,BEFORE:1001,CONTAINS:1002,OVERLAP_START:1003,OVERLAP_END:1004,CONTAINED_BY:1005,AFTER:1006}}),S=l.a.Collection.extend({model:C}),T=l.a.Model.extend({defaults:{region:null,note:""},initialize:function(t){this.set("region",new C(t.region))}}),$=l.a.Collection.extend({model:T}),O=l.a.Model.extend(v).extend({defaults:{mode:"Auto"},initialize:function(t){this.set("dataset",new h.a(t.dataset));var e=[{key:"name",default_value:this.get("dataset").get("name")},{key:"color"},{key:"min_value",label:"Min Value",type:"float",default_value:0},{key:"max_value",label:"Max Value",type:"float",default_value:1}];this.set("config",f.a.ConfigSettingCollection.from_models_and_saved_values(e,t.prefs));var i=this.get("preloaded_data");i=i?i.data:[],this.set("data_manager",new y({dataset:this.get("dataset"),init_data:i}))}},{to_json_keys:["track_type","dataset","prefs","mode","filters","tool_state"],to_json_mappers:{prefs:function(t,e){return 0===a.a.size(t)&&(t={name:e.get("config").get("name").get("value"),color:e.get("config").get("color").get("value")}),t},dataset:function(t){return{id:t.id,hda_ldda:t.get("hda_ldda")}}}}),A=l.a.Collection.extend({model:O}),j=l.a.Model.extend({defaults:{title:"",type:""},urlRoot:"".concat(Object(c.getAppRoot)(),"api/visualizations"),save:function(){return s.a.ajax({url:this.url(),type:"POST",dataType:"json",data:{vis_json:JSON.stringify(this)}})}}),D=j.extend(v).extend({defaults:a.a.extend({},j.prototype.defaults,{dbkey:"",drawables:null,bookmarks:null,viewport:null}),initialize:function(t){this.set("drawables",new A(t.tracks));this.set("config",f.a.ConfigSettingCollection.from_models_and_saved_values([],t.prefs)),this.unset("tracks"),this.get("drawables").each(function(t){t.unset("preloaded_data")})},add_tracks:function(t){this.get("drawables").add(t)}},{to_json_keys:["view","viewport","bookmarks"],to_json_mappers:{view:function(t,e){return{obj_type:"View",prefs:{name:e.get("title"),content_visible:!0},drawables:e.get("drawables")}}}}),I=l.a.Router.extend({initialize:function(t){var e=this;this.view=t.view,this.route(/([\w]+)$/,"change_location"),this.route(/([\w+]+:[\d,]+-[\d,]+)$/,"change_location"),this.view.on("navigate",function(t){e.navigate(t)})},change_location:function(t){this.view.go_to(t)}});e.a={BackboneTrack:O,BrowserBookmark:T,BrowserBookmarkCollection:$,Cache:w,CanvasManager:b,Genome:k,GenomeDataManager:y,GenomeRegion:C,GenomeRegionCollection:S,GenomeVisualization:D,GenomeReferenceDataManager:x,TrackBrowserRouter:I,Visualization:j,select_datasets:function(t,e){var i=new m.a({url_base:"".concat(Object(c.getAppRoot)(),"visualization/list_history_datasets"),filters:t,embedded:!0}),n=new m.a({url_base:"".concat(Object(c.getAppRoot)(),"visualization/list_library_datasets"),embedded:!0}),a=new g.a.View;a.add({id:"histories",title:u()("Histories"),$el:s()("<div/>").append(i.$el)}),a.add({id:"libraries",title:u()("Libraries"),$el:s()("<div/>").append(n.$el)});var o=Object(_.a)();o.modal.show({title:u()("Select datasets for new tracks"),body:a.$el,closing_events:!0,buttons:{Cancel:function(){o.modal.hide()},Add:function(){var t=[];a.$("input.grid-row-select-checkbox[name=id]:checked").each(function(){window.console.log(s()(this).val()),t[t.length]=s.a.ajax({url:"".concat(Object(c.getAppRoot)(),"api/datasets/").concat(s()(this).val()),dataType:"json",data:{data_type:"track_config",hda_ldda:"histories"==a.current()?"hda":"ldda"}})}),s.a.when.apply(s.a,t).then(function(){var t=arguments[0]instanceof Array?s.a.map(arguments,function(t){return t[0]}):[arguments[0]];e(t)}),o.modal.hide()}}})}}},140:function(t,e,i){"use strict";(function(t,i,n){e.a=t.Model.extend({defaults:{url_base:"",async:!1,async_ops:[],categorical_filters:[],filters:{},sort_key:null,show_item_checkboxes:!1,advanced_search:!1,cur_page:1,num_pages:1,operation:void 0,item_ids:void 0},can_async_op:function(t){return-1!==i.indexOf(this.attributes.async_ops,t)},add_filter:function(t,e,i){if(i){var n,a=this.attributes.filters[t];if(null==a)n=e;else if("string"==typeof a)if("All"==a||a==e)n=e;else{var o=[];o[0]=a,o[1]=e,n=o}else-1===(n=a).indexOf(e)&&n.push(e);this.attributes.filters[t]=n}else this.attributes.filters[t]=e},remove_filter:function(t,e){var n=this.attributes.filters[t];if(null==n)return!1;if("string"==typeof n)this.attributes.filters[t]="";else{var a=i.indexOf(n,e);-1!==a&&(n[a]="")}},get_url_data:function(){var t={async:this.attributes.async,sort:this.attributes.sort_key,page:this.attributes.cur_page,show_item_checkboxes:this.attributes.show_item_checkboxes,advanced_search:this.attributes.advanced_search};this.attributes.operation&&(t.operation=this.attributes.operation),this.attributes.item_ids&&(t.id=this.attributes.item_ids);return i.each(i.pairs(this.attributes.filters),function(e){t["f-".concat(e[0])]=e[1]}),t},get_url:function(t){return"".concat(this.get("url_base"),"?").concat(n.param(this.get_url_data()),"&").concat(n.param(t))}})}).call(this,i(3),i(1),i(0))},141:function(t,e,i){"use strict";var n=i(0),a=i.n(n),o=i(3),s=i.n(o),r=i(4),l=i(24),c=i(10),d=s.a.View.extend({initialize:function(t){this.model=new s.a.Model(t),this.url=this.model.get("url"),this.redirect=this.model.get("redirect"),t&&t.active_tab&&(this.active_tab=t.active_tab),this.setElement("<div/>"),this.render()},render:function(){var t=this;a.a.ajax({url:Object(r.getAppRoot)()+this.url,type:"GET"}).done(function(e){var i=a.a.extend({},t.model.attributes,e),n=new l.a({title:i.title,title_id:i.title_id,message:i.message,status:i.status||"warning",icon:i.icon,initial_errors:!0,errors:i.errors,inputs:i.inputs,buttons:{submit:new c.a.Button({tooltip:i.submit_tooltip,title:i.submit_title||"Save",icon:i.submit_icon||"fa-save",cls:"btn btn-primary",onclick:function(){t._submit(n)}})}});t.$el.empty().append(n.$el)}).fail(function(e){t.$el.empty().append(new c.a.Message({message:"Failed to load resource ".concat(t.url,"."),status:"danger",persistent:!0}).$el)})},_submit:function(t){var e=this;a.a.ajax({url:Object(r.getAppRoot)()+e.url,data:JSON.stringify(t.data.create()),type:"PUT",contentType:"application/json"}).done(function(i){var n={};i.id?n.id=i.id:n={message:i.message,status:"success",persistent:!1},e.redirect?window.location="".concat(Object(r.getAppRoot)()+e.redirect,"?").concat(a.a.param(n)):(t.data.matchModel(i,function(e,i){t.field_list[i].value(e.value)}),e._showMessage(t,i.message))}).fail(function(i){e._showMessage(t,{message:i.responseJSON.err_msg,status:"danger",persistent:!1})})},_showMessage:function(t,e){t.$el.parents().filter(function(){return-1!=["auto","scroll"].indexOf(a()(this).css("overflow"))}).first().animate({scrollTop:0},500),t.message.update(e)}});e.a={View:d}},152:function(t,e,i){"use strict";var n=i(0),a=i.n(n),o=i(4),s=i(8);e.a={AUTO_EXTENSION:{id:"auto",text:"Auto-detect",description:"This system will try to detect the file type automatically. If your file is not detected properly as one of the known formats, it most likely means that it has some format problems (e.g., different number of columns on different rows). You can still coerce the system to set your data to the format you think it should be.  You can also upload compressed files, which will automatically be decompressed."},DEFAULT_GENOME:"?",DEFAULT_EXTENSION:"auto",getRemoteFiles:function(t,e){return a.a.ajax({url:"".concat(Object(o.getAppRoot)(),"api/remote_files"),method:"GET",success:t,error:e})},getUploadDatatypes:function(t,e,i){s.a.get({url:"".concat(Object(o.getAppRoot)(),"api/datatypes?extension_only=False"),success:function(n){var a=[];for(var o in n)a.push({id:n[o].extension,text:n[o].extension,description:n[o].description,description_url:n[o].description_url,composite_files:n[o].composite_files});a.sort(function(t,e){var i=t.text&&t.text.toLowerCase(),n=e.text&&e.text.toLowerCase();return i>n?1:i<n?-1:0}),e||a.unshift(i),t(a)}})},getUploadGenomes:function(t,e){s.a.get({url:"".concat(Object(o.getAppRoot)(),"api/genomes"),success:function(i){var n=[];for(var a in i)n.push({id:i[a][1],text:i[a][0]});n.sort(function(t,i){return t.id==e?-1:i.id==e?1:t.text>i.text?1:t.text<i.text?-1:0}),t(n)}})}}},167:function(t,e,i){"use strict";var n=i(1),a=i.n(n),o=i(0),s=i.n(o),r=i(3),l=i.n(r),c=i(4),d=i(5),u=i(12),h=i(38),p=i.n(h);u.a.use(p.a);var f={props:["value"],computed:{filter:{get:function(){return this.value},set:function(t){this.$emit("input",t)}}}},m=i(13),g=Object(m.a)(f,function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("b-input-group",[i("b-input",{attrs:{placeholder:"Type to Search"},model:{value:t.filter,callback:function(e){t.filter=e},expression:"filter"}}),t._v(" "),i("b-input-group-append",[i("b-btn",{attrs:{disabled:!t.filter},on:{click:function(e){t.filter=""}}},[i("i",{staticClass:"fa fa-times"})])],1)],1)},[],!1,null,null,null).exports;u.a.use(p.a);var _={props:{items:{type:Array,required:!0},filter:{type:String,default:null},multiple:{type:Boolean,default:!1}},data:function(){return{currentPage:1,fields:{label:{sortable:!0},details:{sortable:!0},time:{sortable:!0}},nItems:0,perPage:100}},watch:{items:{immediate:!0,handler:function(t){this.filtered(t)}}},methods:{filtered:function(t){this.nItems=t.length,this.currentPage=1},clicked:function(t){this.$emit("clicked",t)}}},v=Object(m.a)(_,function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",[i("b-table",{attrs:{small:"",hover:"",items:t.items,fields:t.fields,filter:t.filter,"per-page":t.perPage,"current-page":t.currentPage},on:{"row-clicked":t.clicked,filtered:t.filtered},scopedSlots:t._u([{key:"label",fn:function(e){return[e.item.isDataset?i("i",{staticClass:"fa fa-file-o"}):i("i",{staticClass:"fa fa-folder"}),t._v("\n            "+t._s(e.value?e.value:"-")+"\n        ")]}},{key:"details",fn:function(e){return[t._v("\n            "+t._s(e.value?e.value:"-")+"\n        ")]}},{key:"time",fn:function(e){return[t._v("\n            "+t._s(e.value?e.value:"-")+"\n        ")]}}])}),t._v(" "),0===t.nItems?i("div",[t.filter?i("div",[t._v("\n            No search results found for: "),i("b",[t._v(t._s(this.filter))]),t._v(".\n        ")]):i("div",[t._v("No entries.")])]):t._e(),t._v(" "),t.nItems>t.perPage?i("b-pagination",{attrs:{"per-page":t.perPage,"total-rows":t.nItems},model:{value:t.currentPage,callback:function(e){t.currentPage=e},expression:"currentPage"}}):t._e()],1)},[],!1,null,null,null).exports;function b(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var w=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.root=e,this.navigation=[]}var e,i,n;return e=t,(i=[{key:"getUrl",value:function(t){if(t)this.navigation.push(t);else{this.navigation.pop();var e=this.navigation.length;t=e>0?this.navigation[e-1]:this.root}return t}},{key:"atRoot",value:function(){return 0==this.navigation.length}}])&&b(e.prototype,i),n&&b(e,n),t}();function y(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var x=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.values={},this.multiple=e.multiple||!1,this.format=e.format||null}var e,i,n;return e=t,(i=[{key:"add",value:function(t){this.multiple||(this.values={});var e=t&&t.id;if(!e)throw"Invalid record with no <id>.";this.values[e]?delete this.values[e]:this.values[e]=t}},{key:"count",value:function(){return Object.keys(this.values).length}},{key:"exists",value:function(t){return!!this.values[t]}},{key:"finalize",value:function(){var t=this,e=[];return Object.values(this.values).forEach(function(i){var n=null;n=t.format?i[t.format]:i,e.push(n)}),e.length>0&&!this.multiple&&(e=e[0]),e}}])&&y(e.prototype,i),n&&y(e,n),t}(),k=i(15),C=i.n(k);function S(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var T=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.root=e.root,this.host=e.host}var e,i,n;return e=t,(i=[{key:"get",value:function(t){var e=this;return new Promise(function(i,n){C.a.get(t).then(function(t){var n=e.getItems(t.data);i(n)}).catch(function(t){var e="Request failed.";t.response&&(e=t.response.data.err_msg||"".concat(t.response.statusText," (").concat(t.response.status,")")),n(e)})})}},{key:"getItems",value:function(t){for(var e=[],i=[t];i.length>0;){var n=i.pop();if(Array.isArray(n))n.forEach(function(t){i.push(t)});else if(n.elements)i.push(n.elements);else if(n.object)i.push(n.object);else{var a=this.getRecord(n);a&&e.push(a)}}return e}},{key:"getRecord",value:function(t){return t.details=t.extension||t.description,t.time=t.update_time||t.create_time,t.isDataset=this.isDataset(t),t.time&&(t.time=t.time.substring(0,16).replace("T"," ")),"Library"==t.model_class?(t.label=t.name,t.url="".concat(this.root,"api/libraries/").concat(t.id,"/contents"),t):t.hid?(t.label="".concat(t.hid,": ").concat(t.name),t.download="".concat(this.host,"/api/histories/").concat(t.history_id,"/contents/").concat(t.id,"/display"),t):"file"==t.type?(t.src="ldda",t.label=t.name,t.download="".concat(this.host).concat(this.root,"api/libraries/datasets/download/uncompressed?ld_ids=").concat(t.id),t):void 0}},{key:"isDataset",value:function(t){return"dataset"==t.history_content_type||"file"==t.type}}])&&S(e.prototype,i),n&&S(e,n),t}();u.a.use(p.a);var $={components:{"data-dialog-search":g,"data-dialog-table":v},props:{callback:{type:Function,required:!0},multiple:{type:Boolean,default:!1},format:{type:String,default:"download"},library:{type:Boolean,default:!0},root:{type:String,required:!0},host:{type:String,required:!0},history:{type:String,required:!0}},data:function(){return{errorMessage:null,filter:null,items:[],modalShow:!0,optionsShow:!1,undoShow:!1,hasValue:!1,oldnewItems:!1}},created:function(){this.services=new T({root:this.root,host:this.host}),this.urlTracker=new w(this.getHistoryUrl()),this.model=new x({multiple:this.multiple,format:this.format}),this.load()},methods:{getHistoryUrl:function(){return"".concat(this.root,"api/histories/").concat(this.history,"/contents?deleted=false")},formatRows:function(){var t=!0,e=!1,i=void 0;try{for(var n,a=this.items[Symbol.iterator]();!(t=(n=a.next()).done);t=!0){var o=n.value,s="active";o.isDataset&&(s=this.model.exists(o.id)?"success":"default"),u.a.set(o,"_rowVariant",s)}}catch(t){e=!0,i=t}finally{try{t||null==a.return||a.return()}finally{if(e)throw i}}},clicked:function(t){t.isDataset?(this.model.add(t),this.hasValue=this.model.count()>0,this.multiple?this.formatRows():this.finalize()):this.load(t.url)},finalize:function(){var t=this.model.finalize();this.modalShow=!1,this.callback(t)},load:function(t){var e=this;t=this.urlTracker.getUrl(t),this.filter=null,this.optionsShow=!1,this.undoShow=!this.urlTracker.atRoot(),this.services.get(t).then(function(t){e.library&&e.urlTracker.atRoot()&&t.unshift({label:"Data Libraries",url:"".concat(e.root,"api/libraries")}),e.items=t,e.formatRows(),e.optionsShow=!0}).catch(function(t){e.errorMessage=t})}}},O=(i(219),Object(m.a)($,function(){var t=this,e=t.$createElement,i=t._self._c||e;return t.modalShow?i("b-modal",{staticClass:"data-dialog-modal",attrs:{visible:"","ok-only":"","ok-title":"Close"}},[i("template",{slot:"modal-header"},[i("data-dialog-search",{model:{value:t.filter,callback:function(e){t.filter=e},expression:"filter"}})],1),t._v(" "),t.errorMessage?i("b-alert",{attrs:{variant:"danger",show:""},domProps:{innerHTML:t._s(t.errorMessage)}}):i("div",[t.optionsShow?i("data-dialog-table",{attrs:{items:t.items,multiple:t.multiple,filter:t.filter},on:{clicked:t.clicked,load:t.load}}):i("div",[i("span",{staticClass:"fa fa-spinner fa-spin"}),t._v(" "),i("span",[t._v("Please wait...")])])],1),t._v(" "),t.errorMessage?t._e():i("div",{staticClass:"w-100",attrs:{slot:"modal-footer"},slot:"modal-footer"},[t.undoShow?i("b-btn",{staticClass:"float-left",attrs:{size:"sm"},on:{click:function(e){return t.load()}}},[i("div",{staticClass:"fa fa-caret-left mr-1"}),t._v("\n            Back\n        ")]):t._e(),t._v(" "),t.multiple?i("b-btn",{staticClass:"float-right ml-1",attrs:{size:"sm",variant:"primary",disabled:!t.hasValue},on:{click:t.finalize}},[t._v("\n            Ok\n        ")]):t._e(),t._v(" "),i("b-btn",{staticClass:"float-right",attrs:{size:"sm"},on:{click:function(e){t.modalShow=!1}}},[t._v(" Cancel ")])],1)],2):t._e()},[],!1,null,null,null).exports);function A(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var j=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)}var e,i,n;return e=t,(i=[{key:"dialog",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=Object(d.a)(),n="".concat(window.location.protocol,"//").concat(window.location.hostname,":").concat(window.location.port);Object.assign(e,{callback:t,history:i.currHistoryPanel&&i.currHistoryPanel.model.id,root:i.root,host:n});var a=u.a.extend(O),o=document.createElement("div");s()("body").append(o),new a({propsData:e}).$mount(o)}},{key:"create",value:function(t){var e=Object(d.a)().currHistoryPanel,i=t.history_id;!i&&e&&(i=e.model.get("id")),s.a.uploadpost({url:"".concat(Object(c.getAppRoot)(),"api/tools"),success:function(i){e&&e.refreshContents(),t.success&&t.success(i)},error:t.error,data:{payload:{tool_id:"upload1",history_id:i,inputs:JSON.stringify({"files_0|type":"upload_dataset","files_0|NAME":t.file_name,"files_0|space_to_tab":t.space_to_tab?"Yes":null,"files_0|to_posix_lines":t.to_posix_lines?"Yes":null,"files_0|dbkey":t.genome||"?","files_0|file_type":t.extension||"auto","files_0|url_paste":t.url_paste})}}})}}])&&A(e.prototype,i),n&&A(e,n),t}(),D=i(116),I=i(93),M=i(19),R=i(8),E=l.a.View.extend({el:"body",className:"full-content",_panelids:["left","right"],initialize:function(t){var e=this,i=this;this.config=a.a.defaults(t.config||{},{message_box_visible:!1,message_box_content:"",message_box_class:"info",show_inactivity_warning:!1,inactivity_box_content:"",hide_panels:!1,hide_masthead:!1});var n=Object(d.a)();n.modal=this.modal=new M.a.View,n.router=this.router=t.Router&&new t.Router(i,t),n.data=this.data=new j(this),this.masthead=new D.a.View(this.config),this.center=new I.a.CenterPanel,n.display=this.display=function(t){t.title?(R.a.setWindowTitle(t.title),t.allow_title_display=!1):(R.a.setWindowTitle(),t.allow_title_display=!0),t.active_tab&&i.masthead.highlight(t.active_tab),i.center.display(t)},this.$el.attr("scroll","no"),this.$el.html(this._template()),this.$masthead=this.$("#masthead"),this.$center=this.$("#center"),this.$messagebox=this.$("#messagebox"),this.$inactivebox=this.$("#inactivebox"),this.config.hide_masthead?(this.$masthead.remove(),this.$center.css("top",0)):this.$masthead.replaceWith(this.masthead.$el),this.$center.append(this.center.$el),this.$el.append(this.masthead.frame.$el),this.$el.append(this.modal.$el),this.panels={},this.config.hide_panels||a.a.each(this._panelids,function(n){var a=n.charAt(0).toUpperCase()+n.slice(1),o=t[a];if(o){var s=new o(i,t),r=i.$("#".concat(n));i[s.toString()]=s,i.panels[n]=new I.a.SidePanel({id:n,el:r,view:s}),e.config.hide_masthead&&r.css("top",0)}}),this.render(),this.router&&l.a.history.start({root:Object(c.getAppRoot)(),pushState:!0})},render:function(){return s()(".select2-hidden-accessible").remove(),this.config.hide_masthead||(this.masthead.render(),this.renderMessageBox(),this.renderInactivityBox()),this.renderPanels(),this._checkCommunicationServerOnline(),this},renderMessageBox:function(){if(this.config.message_box_visible){var t=this.config.message_box_content||"",e=this.config.message_box_class||"info";this.$el.addClass("has-message-box"),this.$messagebox.attr("class","panel-".concat(e,"-message")).html(t).toggle(!!t).show()}else this.$el.removeClass("has-message-box"),this.$messagebox.hide();return this},renderInactivityBox:function(){if(this.config.show_inactivity_warning){var t=this.config.inactivity_box_content||"",e=s()("<a/>").attr("href","".concat(Object(c.getAppRoot)(),"user/resend_verification")).text("Resend verification");this.$el.addClass("has-inactivity-box"),this.$inactivebox.html("".concat(t," ")).append(e).toggle(!!t).show()}else this.$el.removeClass("has-inactivity-box"),this.$inactivebox.hide();return this},renderPanels:function(){var t=this;return a.a.each(this._panelids,function(e){var i=t.panels[e];i?i.render():(t.$center.css(e,0),t.$("#".concat(e)).hide())}),this},_template:function(){return['<div id="everything">\n                <div id="background"/>\n                <div id="masthead"/>\n                <div id="messagebox"/>\n                <div id="inactivebox" class="panel-warning-message" />\n                <div id="columns">\n                    <div id="left" class="unified-panel"/>\n                    <div id="center" />\n                    <div id="right" class="unified-panel" />\n                </div>\n            </div>\n            <div id="dd-helper" />'].join("")},toString:function(){return"PageLayoutView"},_checkCommunicationServerOnline:function(){var t=Object(d.a)(),e=t.config.communication_server_host,i=t.config.communication_server_port,n=t.user.attributes.preferences,a=s()("#show-chat-online");n&&-1!=["1","true"].indexOf(n.communication_server)?s.a.ajax({url:"".concat(e,":").concat(i)}).success(function(e){null!==t.user.id&&"hidden"===a.css("visibility")&&a.css("visibility","visible")}).error(function(t){a.css("visibility","hidden")}):a.css("visibility","hidden")}});e.a={View:E}},17:function(t,e,i){"use strict";var n=i(3),a=i.n(n),o=i(1),s=i.n(o),r=i(8),l=a.a.View.extend({optionsDefault:{css:"",placeholder:"No data available",data:[],value:null,multiple:!1,minimumInputLength:0,maximumTextLength:100,initialData:""},initialize:function(t){if(this.options=r.a.merge(t,this.optionsDefault),this.setElement(this._template(this.options)),this.options.container){if(this.options.container.append(this.$el),this.select_data=this.options.data,this._refresh(),!this.options.multiple){this.options.value&&this._setValue(this.options.value);var e=this;this.options.onchange&&this.$el.on("change",function(){e.options.onchange(e.value())})}}else console.log("ui-select::initialize() : container not specified.")},value:function(t){var e=this._getValue();void 0!==t&&this._setValue(t);var i=this._getValue();return i!=e&&this.options.onchange&&this.options.onchange(i),i},text:function(){return this.$el.select2("data").text},disabled:function(){return!this.$el.select2("enable")},enable:function(){this.$el.select2("enable",!0)},disable:function(){this.$el.select2("enable",!1)},add:function(t){this.select_data.push({id:t.id,text:t.text}),this._refresh()},del:function(t){var e=this._getIndex(t);-1!=e&&(this.select_data.splice(e,1),this._refresh())},remove:function(){this.$el.select2("destroy")},update:function(t){for(var e in this.select_data=[],t.data)this.select_data.push(t.data[e]);this._refresh()},_refresh:function(){var t,e=this;if(this.options.multiple)t={multiple:this.options.multiple,containerCssClass:this.options.css,placeholder:this.options.placeholder,minimumInputLength:this.options.minimumInputLength,ajax:this.options.ajax,dropdownCssClass:this.options.dropdownCssClass,escapeMarkup:this.options.escapeMarkup,formatResult:this.options.formatResult,formatSelection:this.options.formatSelection,initSelection:this.options.initSelection,initialData:this.options.initialData},this.$el.select2(t);else{this.select_data&&this.select_data.map(function(t){var i=e.options.maximumTextLength+3;if(t.text&&t.text.length>i){var n=t.text.indexOf("(".concat(t.id,")"));n=-1!=n&&n<i?n:i;var a=t.text.substring(0,n).replace(/[ .]*$/,"");t.text="".concat(a,"...(").concat(t.id,")")}});var i=this._getValue();t={data:this.select_data,containerCssClass:this.options.css,placeholder:this.options.placeholder,dropdownAutoWidth:!0},this.$el.select2(t),this._setValue(i)}},_getIndex:function(t){s.a.findIndex(this.select_data,{id:t})},_getValue:function(){return this.$el.select2("val")},_setValue:function(t){-1==this._getIndex(t)&&this.select_data.length>0&&(t=this.select_data[0].id),this.$el.select2("val",t)},_template:function(t){return'<input type="hidden" value="'.concat(this.options.initialData,'"/>')}});e.a={View:l}},177:function(t,e,i){"use strict";i.r(e);i(222);var n=i(1),a=i.n(n);!function(){window.console=window.console||{log:function(){},debug:function(){},info:function(){},warn:function(){},error:function(){},assert:function(){}},console.debug("Polyfills are running"),Object.assign=Object.assign||a.a.extend;for(var t=0,e=["ms","moz","webkit","o"],i=0;i<e.length&&!window.requestAnimationFrame;++i)window.requestAnimationFrame=window["".concat(e[i],"RequestAnimationFrame")],window.cancelRequestAnimationFrame=window["".concat(e[i],"CancelRequestAnimationFrame")];window.requestAnimationFrame||(window.requestAnimationFrame=function(e,i){var n=(new Date).getTime(),a=Math.max(0,16-(n-t)),o=window.setTimeout(function(){e(n+a)},a);return t=n+a,o}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(t){clearTimeout(t)});var n=[{name:"canvas",compatible:function(){return window.CanvasRenderingContext2D}},{name:"sessionStorage",compatible:function(){try{return window.sessionStorage.length>=0}catch(t){console.debug(t)}return!1}}].filter(function(t){return!t.compatible()}).map(function(t){return t.name});if(n.length){var o=document.querySelectorAll('link[rel="index"]').item(0);o&&(window.location="".concat(o.href,"static/incompatible-browser.html")),console.log("incompatible browser:\n".concat(n.join("\n")))}}()},188:function(t,e,i){(function(e){t.exports=e.bundleEntries=i(198)}).call(this,i(86))},189:function(t,e){var i={__root:{"Analyze Data":!1,Workflow:!1,"Shared Data":!1,"Data Libraries":!1,Histories:!1,Workflows:!1,Visualizations:!1,Pages:!1,Visualization:!1,"New Track Browser":!1,"Saved Visualizations":!1,"Interactive Environments":!1,Admin:!1,Help:!1,Support:!1,Search:!1,"Mailing Lists":!1,Videos:!1,Wiki:!1,"How to Cite Galaxy":!1,"Interactive Tours":!1,User:!1,Login:!1,Register:!1,"Login or Register":!1,"Logged in as":!1,Preferences:!1,"Custom Builds":!1,Logout:!1,"Saved Histories":!1,"Saved Datasets":!1,"Saved Pages":!1,"Account and saved data":!1,"Account registration or login":!1,"Support, contact, and community":!1,"Administer this Galaxy":!1,"Visualize datasets":!1,"Access published resources":!1,"Chain tools into workflows":!1,"Analysis home view":!1,"History Lists":!1,"Histories Shared with Me":!1,"Current History":!1,"Create New":!1,"Copy History":!1,"Share or Publish":!1,"Show Structure":!1,"Extract Workflow":!1,"Delete Permanently":!1,"Dataset Actions":!1,"Copy Datasets":!1,"Dataset Security":!1,"Resume Paused Jobs":!1,"Collapse Expanded Datasets":!1,"Unhide Hidden Datasets":!1,"Delete Hidden Datasets":!1,"Purge Deleted Datasets":!1,Downloads:!1,"Export Tool Citations":!1,"Export History to File":!1,"Other Actions":!1,"Import from File":!1,Webhooks:!1,"This history is empty":!1,"No matching datasets found":!1,"An error occurred while getting updates from the server":!1,"Please contact a Galaxy administrator if the problem persists":!1,"search datasets":!1,"You are currently viewing a deleted history!":!1,"You are over your disk quota":!1,"Tool execution is on hold until your disk usage drops below your allocated quota":!1,All:!1,None:!1,"For all selected":!1,"Edit history tags":!1,"Edit history Annotation":!1,"Click to rename history":!1,"Operations on multiple datasets":!1,"Hide datasets":!1,"Unhide datasets":!1,"Delete datasets":!1,"Undelete datasets":!1,"Permanently delete datasets":!1,"This will permanently remove the data in your datasets. Are you sure?":!1,Dataset:!1,Annotation:!1,"This history is empty. Click 'Get Data' on the left tool menu to start":!1,"You must be logged in to create histories":!1,"Unable to purge dataset":!1,"Cannot display datasets removed from disk":!1,"This dataset must finish uploading before it can be viewed":!1,"This dataset is not yet viewable":!1,"View data":!1,Download:!1,"Download dataset":!1,"Additional files":!1,"View details":!1,"This is a new dataset and not all of its data are available yet":!1,"You do not have permission to view this dataset":!1,"The job creating this dataset was cancelled before completion":!1,"This job is waiting to run":!1,"This dataset is currently uploading":!1,"Metadata is being auto-detected":!1,"This job is currently running":!1,'This job is paused. Use the "Resume Paused Jobs" in the history menu to resume':!1,"An error occurred with this dataset":!1,"No data":!1,"An error occurred setting the metadata for this dataset":!1,"There was an error getting the data for this dataset":!1,"This dataset has been deleted and removed from disk":!1,"This dataset has been deleted":!1,"This dataset has been hidden":!1,format:!1,database:!1,"Edit attributes":!1,"Cannot edit attributes of datasets removed from disk":!1,"Undelete dataset to edit attributes":!1,"This dataset must finish uploading before it can be edited":!1,"This dataset is not yet editable":!1,Delete:!1,"Dataset is already deleted":!1,"View or report this error":!1,"Run this job again":!1,Visualize:!1,"Visualize in":!1,"Undelete it":!1,"Permanently remove it from disk":!1,"Unhide it":!1,"You may be able to":!1,"set it manually or retry auto-detection":!1,"Edit dataset tags":!1,"Edit dataset annotation":!1,"Tool Help":!1,"Reset passwords":!1,"Search Tool Shed":!1,"Monitor installing repositories":!1,"Manage installed tools":!1,"Reset metadata":!1,"Download local tool":!1,"Tool lineage":!1,"Reload a tool's configuration":!1,"Review tool migration stages":!1,"View Tool Error Logs":!1,"Manage Display Whitelist":!1,"Manage Tool Dependencies":!1,Users:!1,Groups:!1,"API keys":!1,"Impersonate a user":!1,Data:!1,Quotas:!1,Roles:!1,"Local data":!1,"Form Definitions":!1,"Enable/Disable Scratchbook":!1,"Show/Hide Scratchbook":!1,Tags:!1,"Edit annotation":!1,Subscript:!1,Superscript:!1,Trackster:!1,"Any additional comments you can provide regarding what you were doing at the time of the bug.":!1,"Your email address":!1,Report:!1,"Error Report":!1,"Dataset details":!1,"Save permissions.":!1,"Change the datatype to a new type.":!1,"Convert the datatype to a new format.":!1,"Save attributes of the dataset.":!1,"Change data type":!1,"Edit dataset attributes":!1,"Save permissions":!1,"Manage dataset permissions":!1,"Change datatype":!1,"Convert datatype":!1,"Convert to new format":!1,Save:!1,Permissions:!1,Datatypes:!1,Convert:!1,Attributes:!1,"Import into History":!1,"Location Details":!1,"Deleting selected items":!1,"Please select folders or files":!1,"Please enter paths to import":!1,"Adding datasets from your history":!1,"Create New Folder":!1,"Create New Library":!1,Tours:!1,"Click here to sign out of all sessions.":!1,"Add or remove custom builds using history datasets.":!1,"Associate OpenIDs with your account.":!1,"Customize your Toolbox by displaying or omitting sets of Tools.":!1,"Access your current API key or create a new one.":!1,"Enable or disable the communication feature to chat with other users.":!1,"Allows you to change your login credentials.":!1,"User Preferences":!1,"Sign out":!1,"Manage custom builds":!1,"Manage OpenIDs":!1,"Manage Toolbox filters":!1,"Manage API key":!1,"Set dataset permissions for new histories":!1,"Change communication settings":!1,"Change password":!1,"Manage information":!1,"Configured Galaxy Tool Sheds":!1,"Repository Installation Queue":!1,"Repository Status":!1,"Workflows Missing Tools":!1,"See in Tool Shed":!1,Requirements:!1,Share:!1,"Workflow submission failed":!1,"Run workflow":!1,"Job submission failed":!1,Execute:!1,"Tool request failed":!1,"Copy and insert individual steps":!1,Warning:!1,"An email notification will be sent when the job has completed.":!1,"Add a step label.":!1,"Assign columns":!1,"Delete this repeat block":!1,placeholder:!1,Repeat:!1,"Browse GenomeSpace":!1,Browse:!1,Error:!1,Close:!1,"Download from web or upload from disk":!1,Collection:!1,Composite:!1,Regular:!1,"Upload configuration":!1,"FTP files":!1,Reset:!1,Pause:!1,Start:!1,"Choose FTP file":!1,"Choose local file":!1,Build:!1,"Choose FTP files":!1,"Choose local files":!1,Select:!1,"Create a collection of paired datasets":!1,"View all histories":!1,"History options":!1,"Refresh history":!1,"View error logs":!1,"View migration stages":!1,"View lineage":!1,"Manage dependencies":!1,"Manage whitelist":!1,"Manage metadata":!1,"Manage tools":!1,"Monitor installation":!1,"Install new tools":!1,"Tool Management":!1,Forms:!1,"User Management":!1,"Manage jobs":!1,"Display applications":!1,"Data tables":!1,"Data types":!1,Server:!1,"Could Not Save":!1,"Saving...":!1,Settings:!1,"Add tracks":!1,"New Visualization":!1,"Add Data to Saved Visualization":!1,"Close visualization":!1,Circster:!1,Bookmarks:!1,"Add group":!1,"Remove parameter from tree":!1,"Add parameter to tree":!1,Remove:!1,"Select datasets for new tracks":!1,Libraries:!1,"Zoom out":!1,"Zoom in":!1,"Phyloviz Help":!1,"Save visualization":!1,"PhyloViz Settings":!1,Title:!1,"Filtering Dataset":!1,"Filter Dataset":!1,"Show individual tracks":!1,"Trackster Error":!1,"Tool parameter space visualization":!1,Tool:!1,"Set as overview":!1,"Set display mode":!1,Filters:!1,"Show composite track":!1,"Edit settings":!1,"Test title":!1,"Test Title":!1,"Test button":!1,title:!1,"Create new Build":!1,"Delete custom build.":!1,"Provide the data source.":!1,"Next in History":!1,"Previous in History":!1,"Chat online":!1,"Multiple collections":!1,"Dataset collections":!1,"Dataset collection":!1,"Multiple datasets":!1,"Single dataset":!1,"Download from URL or upload files from disk":!1,"tool tooltip":!1},__ja:{"Analyze Data":"",Workflow:"","Shared Data":"","Data Libraries":"",Histories:"",Workflows:"",Visualizations:"",Pages:"",Visualization:"","New Track Browser":" Track Browser","Saved Visualizations":"","Interactive Environments":"",Admin:"",Help:"",Support:"",Search:"","Mailing Lists":"",Videos:"","How to Cite Galaxy":"Galaxy ","Interactive Tours":"",User:"",Login:"",Register:"","Login or Register":"/",Preferences:"","Custom Builds":"",Logout:"","Saved Histories":"","Saved Datasets":"","Saved Pages":"","Account and saved data":"","Account registration or login":"","Support, contact, and community":"","Administer this Galaxy":" Galaxy ","Visualize datasets":"","Access published resources":"","Chain tools into workflows":"","Analysis home view":"","History Lists":"","Histories Shared with Me":"","Current History":"","Create New":"","Copy History":"","Share or Publish":"","Show Structure":"","Extract Workflow":"","Delete Permanently":"","Dataset Actions":"","Copy Datasets":"","Dataset Security":"","Resume Paused Jobs":"","Collapse Expanded Datasets":"","Unhide Hidden Datasets":"","Delete Hidden Datasets":"","Purge Deleted Datasets":"",Downloads:"","Export Tool Citations":"","Export History to File":"","Other Actions":"","Import from File":"",Webhooks:"Webhooks","This history is empty":"","No matching datasets found":"","Search datasets":"","You are currently viewing a deleted history!":"","You are over your disk quota":"",All:"",None:"","For all selected":"","Edit history tags":"","Edit history annotation":"","Click to rename history":"","Operations on multiple datasets":"","Permanently delete datasets":"","This will permanently remove the data in your datasets. Are you sure?":"",Dataset:"","This history is empty. Click 'Get Data' on the left tool menu to start":" '' ","You must be logged in to create histories":"","View data":"",Download:"","Download dataset":"","View details":"","This job is waiting to run":"","This job is currently running":"","An error occurred with this dataset":"","No data":"","This dataset has been deleted and removed from disk":"","This dataset has been deleted":"","This dataset has been hidden":"",format:"",database:"","Edit attributes":"",Delete:"","View or report this error":"","Run this job again":"",Visualize:"","Undelete it":"","Permanently remove it from disk":"","Unhide it":"","Search Tool Shed":"Tool Shed ","Search Tool Shed (Beta)":"Tool Shed (Beta) ","Monitor installing repositories":"","Manage installed tools":"","Reset metadata":"","Download local tool":"","Tool lineage":"","Reload a tool's configuration":"","Review tool migration stages":"","View Tool Error Logs":"","Manage Display Whitelist":"","Manage Tool Dependencies":"",Users:"",Groups:"","API keys":"API ","Impersonate a user":"",Data:"",Quotas:"",Roles:"","Local data":"","Form definitions":"",Administration:"",Server:"","Tools and Tool Shed":" Tool Shed","User Management":"","Form Definitions":"","Your workflows":""},__fr:{"Analyze Data":"Analyse de donnes",Workflow:"Workflow","Shared Data":"Donnes partages","Data Libraries":"Bibliothque de donnes",Histories:!1,Workflows:!1,Visualizations:"Visualisations",Pages:"Pages",Visualization:!1,"New Track Browser":"Nouveau Navigateur de Tracks/Pistes","Saved Visualizations":"Visualisations sauvegardes","Interactive Environments":"Environnements interactifs",Admin:"Admin",Help:"Aide",Support:"Assistance",Search:!1,"Mailing Lists":"Liste de diffusion",Videos:"Vidos",Wiki:"Documentations","How to Cite Galaxy":"Comment citer Galaxy","Interactive Tours":"Guides interactifs",User:"Utilisateur",Login:"Authentification",Register:"Enregistrement","Login or Register":"Authentification et Enregistrement","Logged in as":"Authentifi en tant que",Preferences:"Prfrences","Custom Builds":"Mes gnomes Builds de rfrence",Logout:"Dconnexion","Saved Histories":"Historiques sauvegards","Saved Datasets":"Jeux de donnes sauvegards","Saved Pages":"Pages sauvegardes","Account and saved data":"Compte et donnes sauvegardes","Account registration or login":"Enregistrement ou authentification","Support, contact, and community":"Support,contact et communaut","Administer this Galaxy":"Outils Admin","Visualize datasets":"Visualiser les jeux de donnes","Access published resources":"Accder aux donnes partages","Chain tools into workflows":"Relier outils dans un workflow","Analysis home view":"Accueil analyse de donnes","History Lists":"Tableaux des historiques","Histories Shared with Me":"Historiques partags avec moi","Current History":"Cet Historique","Create New":"Crer un nouveau","Copy History":"Copier l'Historique","Share or Publish":"Partager et publier","Show Structure":"Montrer la structure","Extract Workflow":"Extraire un Workflow","Delete Permanently":"Supprimer dfinitivement","Dataset Actions":"Actions sur les jeux de donnes","Copy Datasets":"Copier des jeux de donnes","Dataset Security":"Permissions/Scurit","Resume Paused Jobs":"Reprendre les processus en pause","Collapse Expanded Datasets":"Rduire les donnes tendues","Unhide Hidden Datasets":"Afficher les donnes caches","Delete Hidden Datasets":"Supprimer les donnes caches","Purge Deleted Datasets":"Purger les donnes supprimes",Downloads:"Tlcharger","Export Tool Citations":"Exporter les citations des outils","Export History to File":"Exporter l'Historique dans un fichier","Other Actions":"Autres actions","Import from File":"Importer depuis un fichier",Webhooks:"Webhooks","This history is empty":"Cet historique est vide","No matching datasets found":"Aucunes donnes correspondantes n'ont t trouves","An error occurred while getting updates from the server":"Une erreur s'est produite lors de la rception des donnes depuis le serveur","Please contact a Galaxy administrator if the problem persists":"Veuillez contacter un administrateur de l'instance Galaxy si ce problme persiste","search datasets":"Rechercher des donnes","You are currently viewing a deleted history!":"Vous consultez actuellement un historique supprim!","You are over your disk quota":"Vous avez dpass votre quota d'espace disque","Tool execution is on hold until your disk usage drops below your allocated quota":"L'excution de l'outil est en attente tant que votre utilisation d'espace disque dpasse le quota attribu",All:"Tout",None:"Aucun","For all selected":"Pour toute la slection","Edit history tags":"Editer les mots-cls de l'historique","Edit history Annotation":"Editer l'annotation de l'historique","Click to rename history":"Cliquer pour renommer l'historique","Operations on multiple datasets":"Oprer sur plusieurs jeux de donnes en mme temps","Hide datasets":"Cacher les jeux de donnes","Unhide datasets":"Afficher les jeux de donnes cachs","Delete datasets":"Supprimer les jeux de donnes","Undelete datasets":"Restaurer les jeux de donnes supprims","Permanently delete datasets":"Supprimer dfinitivement les jeux de donnes","This will permanently remove the data in your datasets. Are you sure?":"Cela supprimera de manire permanente les donnes de votre historique. tes-vous certain?",Dataset:"Jeu de donnes",Annotation:"Annotation","This history is empty. Click 'Get Data' on the left tool menu to start":"Cet historique est vide. Cliquer sur 'Get Data' au niveau du menu d'outils  gauche pour dmarrer","You must be logged in to create histories":"Vous devez tre connect pour crer un historique","load your own data":"Charger vos propres donnes","get data from an external source":"Charger des donnes depuis une source externe","Include Deleted Datasets":"Inclure les jeux de donnes supprims","Include Hidden Datasets":"Inclure les jeux de donnes cachs","Unable to purge dataset":"Impossible de purger le jeu de donnes","Cannot display datasets removed from disk":"Impossible de visualiser les jeux de donnes supprims du disque","This dataset must finish uploading before it can be viewed":"Le jeu de donnes doit tre totalement tlvers avant de pouvoir tre visualiser","This dataset is not yet viewable":"Ce jeu de donnes n'est pas visualisable","View data":"Voir les donnes",Download:!1,"Download dataset":"Tlcharger le jeu de donnes","Additional files":"Fichiers additionnels","View details":"Voir les dtails","This is a new dataset and not all of its data are available yet":"Il s'agit d'un nouveau jeu de donnes et seule une partie des donnes est accessible pour le moment","You do not have permission to view this dataset":"Vous n'avez pas la permission de voir ce jeu de donnes","The job creating this dataset was cancelled before completion":"Le processus  l'origine de ce jeu de donnes a t annul prmaturment","This job is waiting to run":"Ce calcul est en attente de traitement","This dataset is currently uploading":"Ce jeu de donnes est en cours de tlversement","Metadata is being auto-detected":"Les mtadonnes sont auto-dtectes","This job is currently running":"Le traitement est en cours",'This job is paused. Use the "Resume Paused Jobs" in the history menu to resume':'Ce traitement est en pause. Utilisez le "Relancer les traitements en pause" dans le menu d\'historique pour le relancer',"An error occurred with this dataset":"Une erreur est survenue avec ce jeu de donnes","No data":"Aucune donne","An error occurred setting the metadata for this dataset":"Une erreur est survenue pendant la rcupration des mtadonnes de ce jeu de donnes","There was an error getting the data for this dataset":"Il est survenu une erreur durant la rcupration du contenu de ce jeu de donnes","This dataset has been deleted and removed from disk":"Ce jeu de donnes a t supprim et effac du disque","This dataset has been deleted":"Ce jeu de donnes a t supprim","This dataset has been hidden":"Ce jeu de donnes a t cach",format:"format",database:"gnome de rfrence","Edit attributes":"Editer les attributs","Cannot edit attributes of datasets removed from disk":"Impossible d'diter les attributs de jeux de donnes effacs du disque","Undelete dataset to edit attributes":"Restaurer le jeu de donnes pour en diter les attributs","This dataset must finish uploading before it can be edited":"Ce jeu de donnes doit tre entirement tlvers avant toute modification","This dataset is not yet editable":"Ce jeu de donnes n'est pas encore ditable",Delete:"Supprimer","Dataset is already deleted":"Le jeu de donnes est dj supprim","View or report this error":"Voir ou remonter cette erreur","Run this job again":"Excuter ce traitement  nouveau",Visualize:!1,"Visualize in":"Visualiser via","Undelete it":"Restaurer","Permanently remove it from disk":"Supprimer dfinitivement du disque","Unhide it":"Rendre visible","You may be able to":"Vous devriez tre en mesure de","set it manually or retry auto-detection":"Traitez le manuellement ou retenter la dtection automatique","Edit dataset tags":"Editer les mots-cls du jeu de donnes","Edit dataset annotation":"Editer les annotations du jeu de donnes","Tool Help":"Aide outil","Reset passwords":"Rinitialiser les mots de passe","Search Tool Shed":"Chercher via un Tool Shed","Monitor installing repositories":"Contrler les dpts installs","Manage installed tools":"Grer les outils installs","Reset metadata":"Rinitialiser les mtadonnes","Download local tool":"Tlcharger un outil en local","Tool lineage":"Affiliation des outils","Reload a tool's configuration":"Recharger une configuration d'outils","Review tool migration stages":"Vrifier les tapes de migration d'outils","View Tool Error Logs":"Voir les logs d'erreur d'outils","Manage Display Whitelist":"Grer la liste blanche d'outils graphiques","Manage Tool Dependencies":"Grer les dpendances d'outils",Users:!1,Groups:!1,"API keys":"Cl d'API","Impersonate a user":"Prendre la place d'un utilisateur",Data:!1,Quotas:!1,Roles:!1,"Local data":"Donnes locales","Form Definitions":"Dfinitions de formulaires","Enable/Disable Scratchbook":"Activer/Dsactiver la visu Scratchbook","Show/Hide Scratchbook":"Montrer/cacher la visu Scratchbook",Tags:"Mots-cls","Edit annotation":"Editer les annotations",Subscript:!1,Superscript:!1,Trackster:!1,"Any additional comments you can provide regarding what you were doing at the time of the bug.":"N'importe quel commentaire que vous pouvez fournir concernant ce que vous faisiez lorsque le bug est apparu","Your email address":"Votre adresse e-mail",Report:!1,"Error Report":"Rapport d'erreur","Dataset details":"Dtails du jeu de donnes","Save permissions.":"Sauvegarder les permissions","Change the datatype to a new type.":"Changer en un nouveau format de donnes","Convert the datatype to a new format.":"Convertir le format de donnes","Save attributes of the dataset.":"Sauvegarder les attributs du jeu de donnes","Change data type":"Changer le format de donnes","Edit dataset attributes":"Modifier les attributs du jeu de donnes","Save permissions":"Sauvegarder les permissions","Manage dataset permissions":"Grer les permissions sur les jeux de donnes","Change datatype":"Changer le format de donnes","Convert datatype":"Convertir le format de donnes","Convert to new format":"Convertir en un nouveau format de donnes",Save:!1,Permissions:!1,Datatypes:!1,Convert:!1,Attributes:!1,"Import into History":"Importer dans l'historique","Location Details":"Dtails de localisation","Deleting selected items":"Suppression des objets slectionns","Please select folders or files":"S'il vous plat slectionnez des dossiers ou fichiers","Please enter paths to import":"S'il vous plat entrer des chemins/URLs  importer","Adding datasets from your history":"Ajouts de jeux de donnes  partir de votre historique","Create New Folder":"Crer un nouveau dossier","Create New Library":"Crer une nouvelle bibliothque",Tours:!1,"Click here to sign out of all sessions.":!1,"Add or remove custom builds using history datasets.":!1,"Associate OpenIDs with your account.":!1,"Customize your Toolbox by displaying or omitting sets of Tools.":!1,"Access your current API key or create a new one.":!1,"Enable or disable the communication feature to chat with other users.":!1,"Allows you to change your login credentials.":!1,"User Preferences":!1,"Sign out":!1,"Manage custom builds":!1,"Manage OpenIDs":!1,"Manage Toolbox filters":!1,"Manage API key":!1,"Set dataset permissions for new histories":!1,"Change communication settings":!1,"Change password":!1,"Manage information":!1,"Configured Galaxy Tool Sheds":!1,"Repository Installation Queue":!1,"Repository Status":!1,"Workflows Missing Tools":!1,"See in Tool Shed":!1,Requirements:!1,Share:!1,"Workflow submission failed":!1,"Run workflow":!1,"Job submission failed":!1,Execute:!1,"Tool request failed":!1,"Copy and insert individual steps":!1,Warning:!1,"An email notification will be sent when the job has completed.":!1,"Add a step label.":!1,"Assign columns":!1,"Delete this repeat block":!1,placeholder:!1,Repeat:!1,"Browse GenomeSpace":!1,Browse:!1,Error:!1,Close:!1,"Download from web or upload from disk":!1,Collection:!1,Composite:!1,Regular:!1,"Upload configuration":!1,"FTP files":!1,Reset:!1,Pause:!1,Start:!1,"Choose FTP file":!1,"Choose local file":!1,Build:!1,"Choose FTP files":!1,"Choose local files":!1,Select:!1,"Create a collection of paired datasets":!1,"View all histories":!1,"History options":!1,"Refresh history":!1,"View error logs":!1,"View migration stages":!1,"View lineage":!1,"Manage dependencies":!1,"Manage whitelist":!1,"Manage metadata":!1,"Manage tools":!1,"Monitor installation":!1,"Install new tools":!1,"Tool Management":!1,Forms:!1,"User Management":!1,"Manage jobs":!1,"Display applications":!1,"Data tables":!1,"Data types":!1,Server:!1,"Could Not Save":!1,"Saving...":!1,Settings:!1,"Add tracks":!1,"New Visualization":!1,"Add Data to Saved Visualization":!1,"Close visualization":!1,Circster:!1,Bookmarks:!1,"Add group":!1,"Remove parameter from tree":!1,"Add parameter to tree":!1,Remove:!1,"Select datasets for new tracks":!1,Libraries:!1,"Zoom out":!1,"Zoom in":!1,"Phyloviz Help":!1,"Save visualization":!1,"PhyloViz Settings":!1,Title:!1,"Filtering Dataset":!1,"Filter Dataset":!1,"Show individual tracks":!1,"Trackster Error":!1,"Tool parameter space visualization":!1,Tool:!1,"Set as overview":!1,"Set display mode":!1,Filters:!1,"Show composite track":!1,"Edit settings":!1,"Test title":!1,"Test Title":!1,"Test button":!1,title:!1,"Create new Build":!1,"Delete custom build.":!1,"Provide the data source.":!1,"Next in History":!1,"Previous in History":!1,"Chat online":!1,"Multiple collections":!1,"Dataset collections":!1,"Dataset collection":!1,"Multiple datasets":!1,"Single dataset":!1,"Download from URL or upload files from disk":!1,"tool tooltip":!1},__zh:{"Analyze Data":"",Workflow:"","Shared Data":"","Data Libraries":"",Histories:"",Workflows:"",Visualizations:"",Pages:"",Visualization:"","New Track Browser":" Track Browser","Saved Visualizations":"","Interactive Environments":"",Admin:"",Help:"",Support:"",Search:"","Mailing Lists":"",Videos:"",Wiki:!1,"How to Cite Galaxy":"","Interactive Tours":"",User:"",Login:"",Register:"","Login or Register":"","Logged in as":"",Preferences:"","Custom Builds":"",Logout:"","Saved Histories":"","Saved Datasets":"","Saved Pages":"",Tools:"","Account and saved data":"","Account registration or login":"","Support, contact, and community":"","Administer this Galaxy":"Galaxy","Visualize datasets":"","Access published resources":"","Chain tools into workflows":"","Analysis home view":"",History:"","History Lists":"","Histories Shared with Me":"","Current History":"","Create New":"","Copy History":"","Share or Publish":"","Show Structure":"","Extract Workflow":"",Delete:"","Delete Permanently":"","Dataset Actions":"","Copy Datasets":"","Dataset Security":"","Resume Paused Jobs":"","Collapse Expanded Datasets":!1,"Unhide Hidden Datasets":"","Delete Hidden Datasets":"","Purge Deleted Datasets":"",Downloads:"","Export Tool Citations":"","Export History to File":"","Other Actions":"","Import from File":"",Webhooks:!1,"This history is empty":"","No matching datasets found":"","An error occurred while getting updates from the server":"","Please contact a Galaxy administrator if the problem persists":"Galaxy","An error was encountered while <% where %>":": <% where %>","search datasets":"","You are currently viewing a deleted history!":"","You are over your disk quota":"","Tool execution is on hold until your disk usage drops below your allocated quota":"",All:"",None:"","For all selected":"","Edit history tags":"","Edit history Annotation":"","Click to rename history":"","Operations on multiple datasets":"","Hide datasets":"","Unhide datasets":"","Delete datasets":"","Undelete datasets":"","Permanently delete datasets":"","This will permanently remove the data in your datasets. Are you sure?":"",Dataset:"",Annotation:"","This history is empty. Click 'Get Data' on the left tool menu to start":"","You must be logged in to create histories":"","You can ":" "," or ":"  ","load your own data":"","get data from an external source":"","Unable to purge dataset":"","Cannot display datasets removed from disk":"","This dataset must finish uploading before it can be viewed":", ","This dataset is not yet viewable":"","View data":"",Download:"","Download dataset":"","Additional files":"","View details":"","This is a new dataset and not all of its data are available yet":"","You do not have permission to view this dataset":"","The job creating this dataset was cancelled before completion":"","This job is waiting to run":"","This dataset is currently uploading":"","Metadata is being auto-detected":"","This job is currently running":"",'This job is paused. Use the "Resume Paused Jobs" in the history menu to resume':' "" ',"An error occurred with this dataset":"","No data":"","An error occurred setting the metadata for this dataset":"","There was an error getting the data for this dataset":"","This dataset has been deleted and removed from disk":"","This dataset has been deleted":"","This dataset has been hidden":"",format:"",database:"","Edit attributes":"","Cannot edit attributes of datasets removed from disk":"","Undelete dataset to edit attributes":"","This dataset must finish uploading before it can be edited":", ","This dataset is not yet editable":"","Dataset is already deleted":"","View or report this error":"","Run this job again":"",Visualize:"","Visualize in":"","Undelete it":"","Permanently remove it from disk":"","Unhide it":"","You may be able to":"","set it manually or retry auto-detection":"","Edit dataset tags":"","Edit dataset annotation":"","Tool Help":"","Search Tool Shed":" Tool Shed","Monitor installing repositories":"","Manage installed tools":"","Reset metadata":"","Download local tool":"","Tool lineage":!1,"Reload a tool's configuration":"","Review tool migration stages":"","View Tool Error Logs":"","Manage Display Whitelist":"","Manage Tool Dependencies":"",Users:"",Groups:"","API keys":!1,"Impersonate a user":"",Data:"",Quotas:"",Roles:"","Local data":"","Form Definitions":"","Enable/Disable Scratchbook":"/ Scratchbook","Show/Hide Scratchbook":"/ Scratchbook",Tags:"","Edit annotation":"",ja:!0,fr:!0,zh:!0},init:function(t){t||(t="undefined"!=typeof window&&window._i18n&&window._i18n.locale?window._i18n.locale:"undefined"!=typeof document&&document.documentElement.lang?document.documentElement.lang:"undefined"!=typeof navigator&&(navigator.languages||navigator.language||navigator.userLanguage)?((t=navigator.languages&&navigator.languages[0]||navigator.language||navigator.userLanguage)||"root").toLowerCase():"root");var e=this["__"+t]||this.__root;if(e)for(var i in e)this[i]=e[i];for(var i in this.__root)void 0===this[i]&&(this[i]=this.__root[i])}};i.init(),t.exports=i},19:function(t,e,i){"use strict";var n=i(0),a=i.n(n),o=i(1),s=i.n(o),r=i(3),l=i.n(r).a.View.extend({className:"ui-modal",optionsDefault:{container:"body",title:"ui-modal",cls:"ui-modal",body:"",backdrop:!0,height:null,width:null,xlarge:!1,closing_events:!1,closing_callback:null,title_separator:!0},buttonList:{},initialize:function(t){this.options=s.a.defaults(t||{},this.optionsDefault),a()(this.options.container).prepend(this.el),t&&this.render()},show:function(t){var e=this;t&&(this.options=s.a.defaults(t,this.optionsDefault),this.render()),this.visible||(this.visible=!0,this.$el.fadeIn("fast")),this.options.closing_events&&(a()(document).on("keyup.ui-modal",function(t){27==t.keyCode&&e.hide(!0)}),this.$backdrop.on("click",function(){e.hide(!0)})),this.$el.find(".title").focus()},hide:function(t){this.visible=!1,this.$el.fadeOut("fast"),this.options.closing_callback&&this.options.closing_callback(t),a()(document).off("keyup.ui-modal"),this.$backdrop.off("click")},render:function(){var t=this;if(this.$el.html(this._template()),this.$header=this.$(".modal-header"),this.$dialog=this.$(".modal-dialog"),this.$body=this.$(".modal-body"),this.$footer=this.$(".modal-footer"),this.$backdrop=this.$(".modal-backdrop"),this.$buttons=this.$(".buttons"),"progress"==this.options.body&&(this.options.body=a()('<div class="progress progress-striped active"><div class="progress-bar progress-bar-info" style="width:100%"/></div>')),this.$el.removeClass().addClass("modal").addClass(this.options.cls),this.$header.find(".title").html(this.options.title),this.$body.html(this.options.body),this.$buttons.empty(),this.buttonList={},this.options.buttons){var e=0;a.a.each(this.options.buttons,function(i,n){var o=a()("<button/>").attr("id","button-".concat(e++)).text(i).click(n);t.$buttons.append(o).append("&nbsp;"),t.buttonList[i]=o})}else this.$footer.hide();this.$backdrop[this.options.backdrop?"addClass":"removeClass"]("in"),this.$header[this.options.title_separator?"removeClass":"addClass"]("no-separator"),this.$body.removeAttr("style"),this.options.height?(this.$body.css("height",this.options.height),this.$body.css("overflow","hidden")):this.$body.css("max-height",a()(window).height()/2),this.options.width&&this.$dialog.css("width",this.options.width),this.options.xlarge&&this.$dialog.css("max-width","3000px")},getButton:function(t){return this.buttonList[t]},enableButton:function(t){this.getButton(t).prop("disabled",!1)},disableButton:function(t){this.getButton(t).prop("disabled",!0)},showButton:function(t){this.getButton(t).show()},hideButton:function(t){this.getButton(t).hide()},scrollTop:function(){return this.$body.scrollTop()},_template:function(){return'<div class="modal-backdrop fade"/><div class="modal-dialog"><div class="modal-content"><div class="modal-header"><h4 class="title" tabindex="0"/></div><div class="modal-body"/><div class="modal-footer"><div class="buttons"/></div></div></div>'}});e.a={View:l}},192:function(t,e,i){"use strict";var n=i(95);i.n(n).a},193:function(t,e,i){"use strict";var n=i(96);i.n(n).a},194:function(t,e,i){"use strict";var n=i(97);i.n(n).a},195:function(t,e,i){"use strict";var n=i(98);i.n(n).a},196:function(t,e,i){"use strict";var n=i(99);i.n(n).a},197:function(t,e,i){},198:function(t,e,i){"use strict";i.r(e);var n=i(0),a=i.n(n),o=(i(160),i(5)),s=i(1),r=i.n(s),l=i(3),c=i.n(l),d=i(4),u=i(2),h=i.n(u),p=i(8),f=i(6);function m(t,e){this.canvas=null,this.dragging=!1,this.inner_color="#FFFFFF",this.outer_color="#25537b",t&&e&&this.connect(t,e)}a.a.extend(m.prototype,{connect:function(t,e){this.handle1=t,this.handle1&&this.handle1.connect(this),this.handle2=e,this.handle2&&this.handle2.connect(this)},destroy:function(){this.handle1&&this.handle1.disconnect(this),this.handle2&&this.handle2.disconnect(this),a()(this.canvas).remove()},destroyIfInvalid:function(t){this.handle1&&this.handle2&&!this.handle2.attachable(this.handle1).canAccept&&(t&&f.a.warning("Destroying a connection because collection type has changed."),this.destroy())},redraw:function(){var t=this.handle1,e=this.handle2,i=t&&t.isMappedOver(),n=e&&e.isMappedOver(),o="".concat(i?"start-ribbon":""," ").concat(n?"end-ribbon":""),s=a()("#canvas-container"),r=window.workflow_globals.canvas_manager.canvasZoom;this.canvas||(this.canvas=document.createElement("canvas"),s.append(a()(this.canvas)),this.dragging&&(this.canvas.style.zIndex="300")),this.canvas.setAttribute("handle1-id",t&&t.element.getAttribute?t.element.getAttribute("id"):""),this.canvas.setAttribute("handle2-id",e&&e.element.getAttribute?e.element.getAttribute("id"):"");var l=function(t){return(a()(t).offset().left-s.offset().left)/r},c=function(t){return(a()(t).offset().top-s.offset().top)/r};if(t&&e){var d=l(t.element)+5,u=c(t.element)+5,h=l(e.element)+5,p=c(e.element)+5,f=Math.min(d,h),m=Math.max(d,h),g=Math.min(u,p),_=Math.max(u,p),v=Math.min(Math.max(Math.abs(_-g)/2,100),300),b=f-100,w=g-100,y=m-f+200,x=_-g+200;this.canvas.style.left="".concat(b,"px"),this.canvas.style.top="".concat(w,"px"),this.canvas.setAttribute("width",y),this.canvas.setAttribute("height",x),this.canvas.setAttribute("class",o),d-=b,u-=w,h-=b,p-=w;var k=null,C=null,S=1;i?(k=[-6,-3,0,3,6],S=5):k=[0],n?(C=[-6,-3,0,3,6],S=5):C=[0];for(var T=0;T<S;T++){var $=5,O=7;(k.length>1||C.length>1)&&($=1,O=3),this.draw_outlined_curve(d,u,h,p,v,$,O,k[T%k.length],C[T%C.length])}}},draw_outlined_curve:function(t,e,i,n,a,o,s,r,l){var c=this.canvas.getContext("2d");r=r||0,l=l||0,c.lineCap="round",c.strokeStyle=this.outer_color,c.lineWidth=s,c.beginPath(),c.moveTo(t,e+r),c.bezierCurveTo(t+a,e+r,i-a,n+l,i,n+l),c.stroke(),c.strokeStyle=this.inner_color,c.lineWidth=o,c.beginPath(),c.moveTo(t,e+r),c.bezierCurveTo(t+a,e+r,i-a,n+l,i,n+l),c.stroke()}});var g=m;function _(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var v=function(){function t(e,i){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.app=e,this.canvas_container=i,this.id_counter=0,this.nodes={},this.name=null,this.has_changes=!1,this.active_form_has_changes=!1,this.workflowOutputLabels={},this.workflow_version=0}var e,i,n;return e=t,(i=[{key:"canLabelOutputWith",value:function(t){return!t||!(t in this.workflowOutputLabels)}},{key:"registerOutputLabel",value:function(t){t&&(this.workflowOutputLabels[t]=!0)}},{key:"unregisterOutputLabel",value:function(t){t&&delete this.workflowOutputLabels[t]}},{key:"updateOutputLabel",value:function(t,e){t&&this.unregisterOutputLabel(t),this.canLabelOutputWith(e)||f.a.warning("Workflow contains duplicate workflow output labels ".concat(e,". This must be fixed before it can be saved.")),e&&this.registerOutputLabel(e)}},{key:"attemptUpdateOutputLabel",value:function(t,e,i){return!!this.canLabelOutputWith(i)&&(t.labelWorkflowOutput(e,i),t.nodeView.redrawWorkflowOutputs(),!0)}},{key:"updateDatatype",value:function(t,e,i){return t.changeOutputDatatype(e,i),!0}},{key:"create_node",value:function(t,e,i){var n=this.app.prebuildNode(t,e,i);return this.add_node(n),this.fit_canvas_to_nodes(),this.app.canvas_manager.draw_overview(),this.activate_node(n),n}},{key:"add_node",value:function(t){t.id=this.id_counter,t.element.attr("id","wf-node-step-".concat(t.id)),t.element.attr("node-label",t.label),this.id_counter++,this.nodes[t.id]=t,this.has_changes=!0,t.workflow=this}},{key:"remove_node",value:function(t){this.active_node==t&&this.clear_active_node(),delete this.nodes[t.id],this.has_changes=!0}},{key:"remove_all",value:function(){var t=this;a.a.each(this.nodes,function(e,i){i.destroy(),t.remove_node(i)})}},{key:"rectify_workflow_outputs",value:function(){var t=this,e=!1,i=!1;a.a.each(this.nodes,function(t,n){"tool"===n.type&&n.workflow_outputs&&n.workflow_outputs.length>0&&(e=!0),a.a.each(n.post_job_actions,function(t,e){"HideDatasetAction"===e.action_type&&(i=!0)})}),!1===e&&!1===i||a.a.each(this.nodes,function(i,n){var o=!1;null===n.post_job_actions&&(n.post_job_actions={},o=!0);var s=[];a.a.each(n.post_job_actions,function(t,e){"HideDatasetAction"==e.action_type&&s.push(t)}),s.length>0&&a.a.each(s,function(t,e){o=!0,delete n.post_job_actions[e]}),e&&a.a.each(n.output_terminals,function(t,e){if(!0===!n.isWorkflowOutput(e.name)){o=!0;var i={action_type:"HideDatasetAction",output_name:e.name,action_arguments:{}};n.post_job_actions["HideDatasetAction".concat(e.name)]=null,n.post_job_actions["HideDatasetAction".concat(e.name)]=i}}),t.active_node==n&&!0===o&&t.reload_active_node()})}},{key:"to_simple",value:function(){var t={};return a.a.each(this.nodes,function(e,i){var n={};a.a.each(i.input_terminals,function(t,e){n[e.name]=null;var i=[];a.a.each(e.connectors,function(t,a){if(a.handle1){var o={id:a.handle1.node.id,output_name:a.handle1.name},s=e.attributes.input.input_subworkflow_step_id;void 0!==s&&(o.input_subworkflow_step_id=s),i[t]=o,n[e.name]=i}})});var o={};i.post_job_actions&&a.a.each(i.post_job_actions,function(t,e){var i={action_type:e.action_type,output_name:e.output_name,action_arguments:e.action_arguments};o[e.action_type+e.output_name]=null,o[e.action_type+e.output_name]=i}),i.workflow_outputs||(i.workflow_outputs=[]);var s={id:i.id,type:i.type,content_id:i.content_id,tool_version:i.config_form?i.config_form.version:null,tool_state:i.tool_state,errors:i.errors,input_connections:n,position:a()(i.element).position(),annotation:i.annotation,post_job_actions:i.post_job_actions,uuid:i.uuid,label:i.label,workflow_outputs:i.workflow_outputs};t[i.id]=s}),{steps:t}}},{key:"from_simple",value:function(t,e){var i=void 0===e||e,n=this,o=0;i?n.name=t.name:o=Object.keys(n.nodes).length;var s=o,r=!1;n.workflow_version=t.version,a.a.each(t.steps,function(t,e){var l=n.app.prebuildNode(e.type,e.name,e.content_id);i||(e.uuid=null,a.a.each(e.workflow_outputs,function(t,e){e.uuid=null})),l.init_field_data(e),e.position&&l.element.css({top:e.position.top,left:e.position.left}),l.id=parseInt(e.id)+o,l.element.attr("id","wf-node-step-".concat(l.id)),l.element.attr("node-label",e.label),n.nodes[l.id]=l,s=Math.max(s,parseInt(t)+o),r||(l.workflow_outputs.length>0?r=!0:a.a.each(l.post_job_actions||[],function(t,e){"HideDatasetAction"===e.action_type&&(r=!0)}))}),n.id_counter=s+1,a.a.each(t.steps,function(t,e){var i=n.nodes[parseInt(t)+o];a.a.each(e.input_connections,function(t,e){e&&(a.a.isArray(e)||(e=[e]),a.a.each(e,function(e,a){var s=n.nodes[parseInt(a.id)+o],r=new g;r.connect(s.output_terminals[a.output_name],i.input_terminals[t]),r.redraw()}))}),r&&a.a.each(i.output_terminals,function(t,e){void 0===i.post_job_actions["HideDatasetAction".concat(e.name)]&&(i.addWorkflowOutput(e.name),a()(i.element).find(".callout-terminal.".concat(e.name.replace(/(?=[()])/g,"\\"))).find("icon").addClass("mark-terminal-active"),n.has_changes=!0)})})}},{key:"check_changes_in_active_form",value:function(){this.active_form_has_changes&&(this.has_changes=!0,a()("#right-content").find("form").submit(),this.active_form_has_changes=!1)}},{key:"reload_active_node",value:function(){if(this.active_node){var t=this.active_node;this.clear_active_node(),this.activate_node(t)}}},{key:"clear_active_node",value:function(){this.active_node&&(this.active_node.make_inactive(),this.active_node=null),document.activeElement.blur(),this.app.showAttributes()}},{key:"activate_node",value:function(t){this.active_node!=t&&(this.check_changes_in_active_form(),this.clear_active_node(),this.app.showForm(t.config_form,t),t.make_active(),this.active_node=t)}},{key:"node_changed",value:function(t,e){this.has_changes=!0,this.active_node==t&&e&&(this.check_changes_in_active_form(),this.app.showForm(t.config_form,t)),this.app.showWorkflowParameters()}},{key:"layout",value:function(){this.check_changes_in_active_form(),this.has_changes=!0;var t={},e={};a.a.each(this.nodes,function(i,n){void 0===t[i]&&(t[i]=0),void 0===e[i]&&(e[i]=[])}),a.a.each(this.nodes,function(i,n){a.a.each(n.input_terminals,function(i,o){a.a.each(o.connectors,function(i,a){var o=a.handle1.node;t[n.id]+=1,e[o.id].push(n.id)})})});for(var i=[];;){var n=[];for(var o in t)0===t[o]&&n.push(o);if(0===n.length)break;for(var s in i.push(n),n){var r=n[s];for(var l in delete t[r],e[r])t[e[r][l]]-=1}}if(!t.length){var c=this.nodes,d=80;a.a.each(i,function(t,e){e.sort(function(t,e){return a()(c[t].element).position().top-a()(c[e].element).position().top});var i=0,n=30;a.a.each(e,function(t,e){var o=c[e],s=a()(o.element);a()(s).css({top:n,left:d}),i=Math.max(i,a()(s).width()),n+=a()(s).height()+30}),d+=i+80}),a.a.each(c,function(t,e){e.redraw()})}}},{key:"bounds_for_all_nodes",value:function(){var t,e=1/0,i=-1/0,n=1/0,o=-1/0;return a.a.each(this.nodes,function(s,r){var l=a()(r.element);t=l.position(),e=Math.min(e,t.left),i=Math.max(i,t.left+l.width()),n=Math.min(n,t.top),o=Math.max(o,t.top+l.width())}),{xmin:e,xmax:i,ymin:n,ymax:o}}},{key:"fit_canvas_to_nodes",value:function(){function t(t,e){return Math.ceil(t/e)*e}function e(t,e){return t<e||t>3*e?-(t-(Math.ceil(t%e/e)+1)*e):0}var i=this.app.canvas_manager.canvasZoom,n=this.bounds_for_all_nodes(),o=this.canvas_container.position(),s=this.canvas_container.parent(),r=e(n.xmin,100),l=e(n.ymin,100);r=Math.max(r,o.left),l=Math.max(l,o.top);var c=o.left-r,d=o.top-l,u=t(n.xmax+100,100)+r,h=t(n.ymax+100,100)+l;u=Math.max(u,-c+s.width()),h=Math.max(h,-d+s.height()),this.canvas_container.css({left:c/i,top:d/i,width:u,height:h}),this.canvas_container.children().each(function(){var t=a()(this).position();a()(this).css("left",(t.left+r)/i),a()(this).css("top",(t.top+l)/i)})}}])&&_(e.prototype,i),n&&_(e,n),t}();function b(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function w(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function y(t,e,i){return e&&w(t.prototype,e),i&&w(t,i),t}var x=function(){function t(e){b(this,t),this.panel=e}return y(t,[{key:"test",value:function(t,e){var i=this;window.clearTimeout(this.timeout);var n=t.pageX,o=t.pageY,s=a()(this.panel),r=s.position(),l=s.width(),c=s.height(),d=s.parent(),u=d.width(),h=d.height(),p=d.offset(),f=p.left,m=p.top,g=f+d.width(),_=m+d.height(),v=-(l-u/2),b=-(c-h/2),w=u/2,y=h/2,x=!1,k=0;n-5<f?r.left<w&&(k=Math.min(23,w-r.left),s.css("left",r.left+k),x=!0):n+5>g?r.left>v&&(k=Math.min(23,r.left-v),s.css("left",r.left-k),x=!0):o-5<m?r.top<y&&(k=Math.min(23,y-r.top),s.css("top",r.top+k),x=!0):o+5>_&&r.top>b&&(k=Math.min(23,r.top-v),s.css("top","".concat(r.top-k,"px")),x=!0),x&&(e(),this.timeout=window.setTimeout(function(){i.test(t,e)},50))}},{key:"stop",value:function(){window.clearTimeout(this.timeout)}}]),t}(),k=[.25,.33,.5,.67,.75,.8,.9,1,1.1,1.25,1.5,1.75,2,2.5,3,4],C=7,S=function(){function t(e,i,n){b(this,t),this.app=e,this.cv=i,this.cc=this.cv.find("#canvas-container"),this.overview=n,this.oc=n.find("#overview-canvas"),this.ov=n.find("#overview-viewport"),this.zoomLevel=C,this.canvasZoom=k[C],this.initZoomControls(),this.init_drag(),this.init_copy_paste()}return y(t,[{key:"setZoom",value:function(t){this.zoomLevel=Math.min(Math.max(0,t),k.length),this.canvasZoom=k[this.zoomLevel],this.cv.css("transform-origin","top left"),this.cv.css("transform","scale("+this.canvasZoom+")"),this.cv.css("width","".concat(100/this.canvasZoom,"%")),this.cv.css("height","".concat(100/this.canvasZoom,"%")),this.app.workflow.fit_canvas_to_nodes()}},{key:"initZoomControls",value:function(){var t=this,e=a()('<div class="btn-group-vertical"/>').css({position:"absolute",left:"1rem",bottom:"1rem"});e.append(a()('<div class="btn btn-secondary fa fa-plus"/>').click(function(){return t.setZoom(t.zoomLevel+1)})),e.append(a()('<div class="btn btn-secondary fa fa-minus"/>').click(function(){return t.setZoom(t.zoomLevel-1)})),this.cv.closest("#workflow-canvas-body").append(e)}},{key:"init_drag",value:function(){var t,e,i=this,n=this,o=function(t,e){t=Math.min(t,n.cv.width()/2),t=Math.max(t,-n.cc.width()+n.cv.width()/2),e=Math.min(e,n.cv.height()/2),e=Math.max(e,-n.cc.height()+n.cv.height()/2),n.cc.css({left:t,top:e}),n.cv.css({"background-position-x":t,"background-position-y":e}),n.update_viewport_overlay()};this.cc.each(function(){this.scroll_panel=new x(this)}),this.cv.bind("click",function(){document.activeElement.blur()}).bind("dragstart",function(){var i=a()(this).offset(),o=n.cc.position();e=o.top-i.top,t=o.left-i.left}).bind("drag",function(n,a){o((a.offsetX+t)/i.canvasZoom,(a.offsetY+e)/i.canvasZoom)}).bind("dragend",function(){n.app.workflow.fit_canvas_to_nodes(),n.draw_overview()}),this.overview.click(function(t){if(n.overview.hasClass("blockaclick"))n.overview.removeClass("blockaclick");else{var e=n.cc.width(),i=n.cc.height(),a=n.oc.width(),s=n.oc.height(),r=t.pageX-n.oc.offset().left-n.ov.width()/2,l=t.pageY-n.oc.offset().top-n.ov.height()/2;o(-r/a*e,-l/s*i),n.app.workflow.fit_canvas_to_nodes(),n.draw_overview()}}),this.ov.bind("drag",function(t,e){var i=n.cc.width(),a=n.cc.height(),s=n.oc.width(),r=n.oc.height(),l=e.offsetX-n.overview.offset().left,c=e.offsetY-n.overview.offset().top;o(-l/s*i,-c/r*a)}).bind("dragend",function(){n.overview.addClass("blockaclick"),n.app.workflow.fit_canvas_to_nodes(),n.draw_overview()}),a()(".workflow-overview").bind("drag",function(t,e){var i=a()(this).offsetParent(),o=i.offset(),s=Math.max(i.width()-(e.offsetX-o.left),i.height()-(e.offsetY-o.top));a()(this).css({width:s,height:s}),n.draw_overview()}),a()(".workflow-overview div").bind("drag",function(){})}},{key:"init_copy_paste",value:function(){var t=this;document.addEventListener("copy",function(e){""===window.getSelection().toString()&&(t.app.workflow.active_node&&"subworkflow"!==t.app.workflow.active_node.type&&e.clipboardData.setData("application/json",JSON.stringify({nodeId:t.app.workflow.active_node.id})),e.preventDefault())}),document.addEventListener("paste",function(e){if(document.activeElement&&"textarea"!==document.activeElement.type&&"text"!==document.activeElement.type){var i;try{i=JSON.parse(e.clipboardData.getData("application/json")).nodeId}catch(t){console.debug(t)}i&&t.app.workflow.nodes.hasOwnProperty(i)&&t.app.workflow.nodes[i].clone(),e.preventDefault()}})}},{key:"update_viewport_overlay",value:function(){var t=this.cc,e=this.cv,i=this.oc,n=this.ov,a=t.width(),o=t.height(),s=i.width(),r=i.height(),l=t.position();n.css({left:-l.left/a*s,top:-l.top/o*r,width:e.width()/a*s-2,height:e.height()/o*r-2})}},{key:"draw_overview",value:function(){var t,e,i,n,o=a()("#overview-canvas"),s=o.parent().parent().width(),r=o.get(0).getContext("2d"),l=a()("#canvas-container").width(),c=a()("#canvas-container").height(),d=this.cv.width(),u=this.cv.height();l<d&&c<u?(n=(s-(i=l/d*s))/2,e=(s-(t=c/u*s))/2):l<c?(e=0,t=s,n=(s-(i=Math.ceil(t*l/c)))/2):(i=s,n=0,e=(s-(t=Math.ceil(i*c/l)))/2),o.parent().css({left:n,top:e,width:i,height:t}),o.attr("width",i),o.attr("height",t),a.a.each(this.app.workflow.nodes,function(e,n){r.fillStyle="gray";var o=a()(n.element),s=o.position(),d=s.left/l*i,u=s.top/c*t,h=o.width()/l*i,p=o.height()/c*t;n.errors&&(r.fillStyle="#e31a1e"),r.fillRect(d,u,h,p)}),this.update_viewport_overlay()}}]),t}(),T=i(18),$=i.n(T);function O(t){this.collectionType=t,this.isCollection=!0,this.rank=t.split(":").length}function A(t,e){this.canAccept=t,this.reason=e}window.workflow_globals=window.workflow_globals||{};var j={isCollection:!1,canMatch:function(){return!1},canMapOver:function(){return!1},toString:function(){return"NullCollectionType[]"},append:function(t){return t},equal:function(t){return t===this}},D={isCollection:!0,canMatch:function(t){return j!==t},canMapOver:function(){return!1},toString:function(){return"AnyCollectionType[]"},append:function(){return D},equal:function(t){return t===this}};a.a.extend(O.prototype,{append:function(t){return t===j?this:t===D?t:new O("".concat(this.collectionType,":").concat(t.collectionType))},canMatch:function(t){return t!==j&&(t===D||t.collectionType==this.collectionType)},canMapOver:function(t){if(t===j)return!1;if(t===D)return!1;if(this.rank<=t.rank)return!1;var e=t.collectionType;return this._endsWith(this.collectionType,e)},effectiveMapOver:function(t){var e=t.collectionType;return new O(this.collectionType.substring(0,this.collectionType.length-e.length-1))},equal:function(t){return t.collectionType==this.collectionType},toString:function(){return"CollectionType[".concat(this.collectionType,"]")},_endsWith:function(t,e){return-1!==t.indexOf(e,t.length-e.length)}});var I=c.a.Model.extend({initialize:function(t){this.mapOver=t.mapOver||j,this.terminal=t.terminal,this.terminal.terminalMapping=this},disableMapOver:function(){this.setMapOver(j)},setMapOver:function(t){this.mapOver=t,this.trigger("change")}}),M=c.a.Model.extend({initialize:function(t){this.element=t.element,this.connectors=[]},connect:function(t){this.connectors.push(t),this.node&&this.node.markChanged()},disconnect:function(t){this.connectors.splice(a.a.inArray(t,this.connectors),1),this.node&&(this.node.markChanged(),this.resetMappingIfNeeded(),t.dragging||t.handle2.resetCollectionTypeSource())},redraw:function(){a.a.each(this.connectors,function(t,e){e.redraw()})},destroy:function(){a.a.each(this.connectors.slice(),function(t,e){e.destroy()})},destroyInvalidConnections:function(){r.a.each(this.connectors,function(t){t&&t.destroyIfInvalid()})},setMapOver:function(t){var e=t;if(this.multiple){var i=new O("list");if(t.collectionType===i.collectionType)return;e=t.effectiveMapOver?t.effectiveMapOver(i):t}this.mapOver().equal(t)||(this.terminalMapping.setMapOver(t),r.a.each(this.node.output_terminals,function(t){t.setMapOver(e)}))},mapOver:function(){return this.terminalMapping?this.terminalMapping.mapOver:j},isMappedOver:function(){return this.terminalMapping&&this.terminalMapping.mapOver.isCollection},resetMapping:function(){this.terminalMapping.disableMapOver()},resetCollectionTypeSource:function(){var t=this.node;r.a.each(t.output_terminals,function(t){t.attributes.collection_type_source&&t.attributes.collection_type&&(t.attributes.collection_type=null,t.update(t.attributes))})},resetMappingIfNeeded:function(){}}),R=M.extend({initialize:function(t){M.prototype.initialize.call(this,t),this.datatypes=t.datatypes,this.force_datatype=t.force_datatype},resetMappingIfNeeded:function(){this.node.hasConnectedOutputTerminals()||this.node.hasConnectedMappedInputTerminals()||r.a.each(this.node.mappedInputTerminals(),function(t){t.resetMappingIfNeeded()}),!this.node.hasMappedOverInputTerminals()&&this.resetMapping()},resetMapping:function(){this.terminalMapping.disableMapOver(),r.a.each(this.connectors,function(t){var e=t.handle2;e&&(e.resetMappingIfNeeded(),t.destroyIfInvalid())})}}),E=M.extend({initialize:function(t){M.prototype.initialize.call(this,t),this.update(t.input)},canAccept:function(t){return this._inputFilled()?new A(!1,"Input already filled with another connection, delete it before connecting another output."):this.attachable(t)},resetMappingIfNeeded:function(){this.mapOver().isCollection&&((this.node.hasConnectedMappedInputTerminals()||!this.node.hasConnectedOutputTerminals())&&this.resetMapping())},resetMapping:function(){this.terminalMapping.disableMapOver(),this.node.hasMappedOverInputTerminals()||r.a.each(this.node.output_terminals,function(t){t.resetMapping()})},connected:function(){return 0!==this.connectors.length},_inputFilled:function(){return!!this.connected()&&(!this.multiple||!!this._collectionAttached())},_collectionAttached:function(){if(this.connected()){var t=this.connectors[0].handle1;return!!t&&!!(t.isCollection||t.isMappedOver()||t.datatypes.indexOf("input_collection")>0)}return!1},_mappingConstraints:function(){if(!this.node)return[];var t=this.mapOver();if(t.isCollection)return[t];var e=[];return this.node.hasConnectedOutputTerminals()?e.push(r.a.first(r.a.values(this.node.output_terminals)).mapOver()):r.a.each(this.node.connectedMappedInputTerminals(),function(t){e.push(t.mapOver())}),e},_producesAcceptableDatatype:function(t){for(var e in this.datatypes){var i=this.datatypes[e];if("input"==i)return new A(!0,null);var n=[],a=t.force_datatype?[t.force_datatype]:t.datatypes;for(var o in n=n.concat(a)){var s=n[o];if("input"==s||"_sniff_"==s||"input_collection"==s||window.workflow_globals.app.isSubType(n[o],i))return new A(!0,null)}}return new A(!1,"Effective output data type(s) [".concat(n,"] do not appear to match input type(s) [").concat(this.datatypes,"]."))},_otherCollectionType:function(t){var e=j;t.isCollection&&(e=t.collectionType);var i=t.mapOver();return i.isCollection&&(e=i.append(e)),e}}),P=E.extend({update:function(t){this.datatypes=t.extensions,this.multiple=t.multiple,this.collection=!1},connect:function(t){E.prototype.connect.call(this,t);var e=t.handle1;if(e){var i=this._otherCollectionType(e);i.isCollection&&this.setMapOver(i)}},attachable:function(t){var e=this._otherCollectionType(t),i=this.mapOver();if(e.isCollection){if(this.multiple){if(this.connected()&&!this._collectionAttached())return new A(!1,"Cannot attach collections to data parameters with individual data inputs already attached.");if(e.collectionType&&e.collectionType.endsWith("paired"))return new A(!1,"Cannot attach paired inputs to multiple data parameters, only lists may be treated this way.")}return i.isCollection&&i.canMatch(e)?this._producesAcceptableDatatype(t):this.multiple&&new O("list").canMatch(e)?this._producesAcceptableDatatype(t):this._mappingConstraints().every(r.a.bind(e.canMatch,e))?this._producesAcceptableDatatype(t):i.isCollection?this.node.hasConnectedMappedInputTerminals()?new A(!1,"Can't map over this input with output collection type - other inputs have an incompatible map over collection type. Disconnect inputs (and potentially outputs) and retry."):new A(!1,"Can't map over this input with output collection type - this step has outputs defined constraining the mapping of this tool. Disconnect outputs and retry."):new A(!1,"Can't map over this input with output collection type - an output of this tool is not mapped over constraining this input. Disconnect output(s) and retry.")}return i.isCollection?new A(!1,"Cannot attach non-collection outputs to mapped over inputs, consider disconnecting inputs and outputs to reset this input's mapping."):this._producesAcceptableDatatype(t)}}),V=E.extend({update:function(t){this.type=t.type},connect:function(t){E.prototype.connect.call(this,t)},attachable:function(t){return new A(this.type==t.attributes.type,"")}}),L=E.extend({update:function(t){this.multiple=!1,this.collection=!0,this.collection_type=t.collection_type,this.datatypes=t.extensions;var e=[];t.collection_types?r.a.each(t.collection_types,function(t){e.push(new O(t))}):e.push(D),this.collectionTypes=e},connect:function(t){E.prototype.connect.call(this,t);var e=t.handle1;if(e){var i=this.node;r.a.each(i.output_terminals,function(i){i.attributes.collection_type_source&&!t.dragging&&(e.isMappedOver()?e.isCollection?i.attributes.collection_type=e.terminalMapping.mapOver.append(e.collectionType).collectionType:i.attributes.collection_type=e.terminalMapping.mapOver.collectionType:i.attributes.collection_type=e.attributes.collection_type,i.update(i.attributes))});var n=this._effectiveMapOver(e);this.setMapOver(n)}},_effectiveMapOver:function(t){var e=this.collectionTypes,i=this._otherCollectionType(t);if(!r.a.some(e,function(t){return t.canMatch(i)}))for(var n in e){var a=e[n];if(i.canMapOver(a)){var o=i.effectiveMapOver(a);if(o!=j)return o}}return j},_effectiveCollectionTypes:function(){var t=this.mapOver();return r.a.map(this.collectionTypes,function(e){return t.append(e)})},attachable:function(t){var e=this._otherCollectionType(t);if(e.isCollection){var i=this._effectiveCollectionTypes(),n=this.mapOver();if(r.a.some(i,function(t){return t.canMatch(e)}))return this._producesAcceptableDatatype(t);if(n.isCollection)return this.node.hasConnectedMappedInputTerminals()?new A(!1,"Can't map over this input with output collection type - other inputs have an incompatible map over collection type. Disconnect inputs (and potentially outputs) and retry."):new A(!1,"Can't map over this input with output collection type - this step has outputs defined constraining the mapping of this tool. Disconnect outputs and retry.");if(r.a.some(this.collectionTypes,function(t){return e.canMapOver(t)})){var a=this._effectiveMapOver(t);return a.isCollection?this._mappingConstraints().every(function(t){return a.canMatch(t)})?this._producesAcceptableDatatype(t):this.node.hasConnectedMappedInputTerminals()?new A(!1,"Can't map over this input with output collection type - other inputs have an incompatible map over collection type. Disconnect inputs (and potentially outputs) and retry."):new A(!1,"Can't map over this input with output collection type - this step has outputs defined constraining the mapping of this tool. Disconnect outputs and retry."):new A(!1,"Incompatible collection type(s) for attachment.")}return new A(!1,"Incompatible collection type(s) for attachment.")}return new A(!1,"Cannot attach a data output to a collection input.")}}),z=M.extend({initialize:function(t){(M.prototype.initialize.call(this,t),this.datatypes=t.datatypes,this.force_datatype=t.force_datatype,t.collection_type)?this.collectionType=new O(t.collection_type):(t.collection_type_source||console.log("Warning: No collection type or collection type source defined."),this.collectionType=D);this.isCollection=!0},update:function(t){var e;t.collection_type?e=new O(t.collection_type):(t.collection_type_source||console.log("Warning: No collection type or collection type source defined."),e=D);var i=this.collectionType;this.collectionType=e;var n=this.connectors.slice(0);e.collectionType!=i.collectionType&&r.a.each(n,function(t){t.destroyIfInvalid(!0)})}}),N={InputTerminal:P,InputParameterTerminal:V,OutputTerminal:R,OutputParameterTerminal:M.extend({}),InputCollectionTerminal:L,OutputCollectionTerminal:z,TerminalMapping:I,CollectionTypeDescription:O,NULL_COLLECTION_TYPE_DESCRIPTION:j,ANY_COLLECTION_TYPE_DESCRIPTION:D};window.workflow_globals=window.workflow_globals||{};var F=c.a.View.extend({tagName:"div",className:"fa-icon-button fa fa-folder-o",initialize:function(t){this.$el.tooltip({delay:500,title:"Run tool in parallel over collection"}),this.model.bind("change",r.a.bind(this.render,this))},render:function(){this.model.mapOver.isCollection?this.$el.show():this.$el.hide()}}),H=F.extend({events:{click:"onClick",mouseenter:"onMouseEnter",mouseleave:"onMouseLeave"},onMouseEnter:function(t){var e=this.model;!e.terminal.connected()&&e.mapOver.isCollection&&this.$el.css("color","red")},onMouseLeave:function(t){this.$el.css("color","black")},onClick:function(t){var e=this.model;!e.terminal.connected()&&e.mapOver.isCollection&&e.terminal.resetMapping()}}),U=c.a.View.extend({setupMappingView:function(t){var e=new this.terminalMappingClass({terminal:t}),i=new this.terminalMappingViewClass({model:e});i.render(),t.terminalMappingView=i,this.terminalMappingView=i},terminalElements:function(){return this.terminalMappingView?[this.terminalMappingView.el,this.el]:[this.el]}}),B=U.extend({className:"terminal input-terminal",initialize:function(t){var e=t.node,i=t.input,n=i.name,o="node-".concat(e.cid,"-input-").concat(n),s=this.terminalForInput(i);this.setupMappingView(s),this.el.terminal=s,this.$el.attr("input-name",n),this.$el.attr("id",o),this.$el.append(a()("<icon/>")),this.id=o,s.node=e,s.name=n,s.label=i.label,e.input_terminals[n]=s},events:{dropinit:"onDropInit",dropstart:"onDropStart",dropend:"onDropEnd",drop:"onDrop",hover:"onHover"},onDropInit:function(t,e){var i=this.el.terminal,n=a()(e.drag).hasClass("output-terminal")&&i.canAccept(e.drag.terminal);return n.canAccept?(this.$el.addClass("can-accept"),this.$el.removeClass("cannot-accept"),this.reason=null):(this.$el.addClass("cannot-accept"),this.$el.removeClass("can-accept"),this.reason=n.reason),!0},onDropStart:function(t,e){e.proxy.terminal&&(this.$el.hasClass("can-accept")?(e.proxy.terminal.connectors[0].inner_color="#BBFFBB",e.proxy.dropTooltip=""):(e.proxy.terminal.connectors[0].inner_color="#fe7f02",this.reason?(e.proxy.dropTooltip=this.reason,a()(e.proxy).tooltip("show")):e.proxy.dropTooltip=""))},onDropEnd:function(t,e){e.proxy.dropTooltip="",e.proxy.terminal&&(e.proxy.terminal.connectors[0].inner_color="#FFFFFF")},onDrop:function(t,e){if(e.proxy.dropTooltip="",this.$el.hasClass("can-accept")){var i=this.el.terminal;new g(e.drag.terminal,i).redraw()}},onHover:function(){var t=this.el,e=t.terminal;if(e.connectors.length>0){var i=a()("<div/>").addClass("delete-terminal").click(function(){a.a.each(e.connectors,function(t,e){e&&e.destroy()}),i.remove()}).on("mouseleave",function(){i.remove()});a()(t).parent().append(i)}}}),q=B.extend({terminalMappingClass:N.TerminalMapping,terminalMappingViewClass:H,terminalForInput:function(t){return new N.InputTerminal({element:this.el,input:t})}}),G=B.extend({terminalMappingClass:N.TerminalMapping,terminalMappingViewClass:H,terminalForInput:function(t){return new N.InputParameterTerminal({element:this.el,input:t})}}),W=B.extend({terminalMappingClass:N.TerminalMapping,terminalMappingViewClass:H,terminalForInput:function(t){return new N.InputCollectionTerminal({element:this.el,input:t})}}),J=U.extend({className:"terminal output-terminal",initialize:function(t){var e=t.node,i=t.output,n=i.name,o="node-".concat(e.cid,"-output-").concat(n),s=this.terminalForOutput(i);this.setupMappingView(s),this.el.terminal=s,this.$el.attr("output-name",n),this.$el.attr("id",o),this.$el.append(a()("<icon/>")),s.node=e,s.name=n,s.label=i.label,e.output_terminals[n]=s},events:{drag:"onDrag",dragstart:"onDragStart",dragend:"onDragEnd"},onDrag:function(t,e){var i=function(){var t=window.workflow_globals.canvas_manager.canvasZoom,i=a()(e.proxy).offsetParent().offset(),n=e.offsetX-i.left,o=e.offsetY-i.top;a()(e.proxy).css({left:n/t,top:o/t}),e.proxy.terminal.redraw(),window.workflow_globals.canvas_manager.update_viewport_overlay()};i(),a()("#canvas-container").get(0).scroll_panel.test(t,i)},onDragStart:function(t,e){a()(e.available).addClass("input-terminal-active"),window.workflow_globals.workflow.check_changes_in_active_form();var i=a()("<div class='drag-terminal'/>").appendTo("#canvas-container").get(0);i.dropTooltip="",a()(i).tooltip({title:function(){return i.dropTooltip||""}}),i.terminal=new N.OutputTerminal({element:i});var n=new g;return n.dragging=!0,n.connect(this.el.terminal,i.terminal),i},onDragEnd:function(t,e){var i=e.proxy.terminal.connectors[0];i&&i.destroy(),a()(e.proxy).tooltip("dispose"),a()(e.proxy).remove(),a()(e.available).removeClass("input-terminal-active"),a()("#canvas-container").get(0).scroll_panel.stop()}}),Y=J.extend({terminalMappingClass:N.TerminalMapping,terminalMappingViewClass:F,terminalForOutput:function(t){var e=t.extensions;return new N.OutputTerminal({element:this.el,datatypes:e,force_datatype:t.force_datatype})}}),K=J.extend({terminalMappingClass:N.TerminalMapping,terminalMappingViewClass:F,terminalForOutput:function(t){var e=t.collection_type,i=t.collection_type_source;return new N.OutputCollectionTerminal({element:this.el,collection_type:e,collection_type_source:i,datatypes:t.extensions,force_datatype:t.force_datatype})}}),Q={InputTerminalView:q,InputParameterTerminalView:G,OutputTerminalView:Y,OutputParameterTerminalView:J.extend({terminalMappingClass:N.TerminalMapping,terminalMappingViewClass:F,terminalForOutput:function(t){return new N.OutputCollectionTerminal({element:this.el,type:t.type})}}),InputCollectionTerminalView:W,OutputCollectionTerminalView:K};window.workflow_globals=window.workflow_globals||{};var X=c.a.View.extend({className:"form-row dataRow input-data-row",initialize:function(t){this.input=t.input,this.nodeView=t.nodeView,this.terminalElement=t.terminalElement,this.$el.attr("name",this.input.name).html(this.input.label||this.input.name),t.skipResize||(this.$el.css({position:"absolute",left:-1e3,top:-1e3,display:"none"}),a()("body").append(this.el),this.nodeView.updateMaxWidth(this.$el.outerWidth()),this.$el.css({position:"",left:"",top:"",display:""}),this.$el.remove())}}),Z=c.a.View.extend({className:"form-row dataRow",initialize:function(t){this.output=t.output,this.terminalElement=t.terminalElement,this.nodeView=t.nodeView;var e=this.output,i=e.label||e.name,n=this.nodeView.node;if(e.extensions.indexOf("input")>=0||e.extensions.indexOf("input_collection")>=0||(i="".concat(i," (").concat(e.force_datatype||e.extensions.join(", "),")")),this.$el.html(i),this.calloutView=null,["tool","subworkflow"].indexOf(n.type)>=0){var o=new et({label:i,output:e,node:n});this.calloutView=o,this.$el.append(o.el)}this.$el.css({position:"absolute",left:-1e3,top:-1e3,display:"none"}),a()("body").append(this.el),this.nodeView.updateMaxWidth(this.$el.outerWidth()+17),this.$el.css({position:"",left:"",top:"",display:""}).detach()},redrawWorkflowOutput:function(){this.calloutView&&this.calloutView.resetImage()}}),tt=c.a.View.extend({className:"form-row dataRow",initialize:function(t){this.output=t.output,this.terminalElement=t.terminalElement,this.nodeView=t.nodeView;var e=this.output,i=e.label||e.name,n=this.nodeView.node;if(this.$el.html(i),this.calloutView=null,["tool","subworkflow"].indexOf(n.type)>=0){var o=new et({label:i,output:e,node:n});this.calloutView=o,this.$el.append(o.el),this.$el.hover(function(){o.hoverImage()},function(){o.resetImage()})}this.$el.css({position:"absolute",left:-1e3,top:-1e3,display:"none"}),a()("body").append(this.el),this.nodeView.updateMaxWidth(this.$el.outerWidth()+17),this.$el.css({position:"",left:"",top:"",display:""}).detach()},redrawWorkflowOutput:function(){this.calloutView&&this.calloutView.resetImage()}}),et=c.a.View.extend({tagName:"div",initialize:function(t){this.label=t.label,this.node=t.node,this.output=t.output;var e=this,i=this.node;this.$el.attr("class","callout-terminal ".concat(this.label)).css({display:"none"}).append(a()("<icon class='mark-terminal fa fa-asterisk'/>").click(function(){var t=e.output.name;i.isWorkflowOutput(t)?(i.removeWorkflowOutput(t),e.$("icon").removeClass("mark-terminal-active")):(i.addWorkflowOutput(t),e.$("icon").addClass("mark-terminal-active")),window.workflow_globals.workflow.has_changes=!0,window.workflow_globals.canvas_manager.draw_overview()})).tooltip({delay:500,title:"Mark dataset as a workflow output. All unmarked datasets will be hidden."}),this.$el.css({top:"50%",margin:"-8px 0px 0px 0px",right:8}),this.$el.show(),this.resetImage()},resetImage:function(){this.node.isWorkflowOutput(this.output.name)?this.$("icon").addClass("mark-terminal-active"):this.$("icon").removeClass("mark-terminal-active")}}),it={DataInputView:X,DataOutputView:Z,ParameterOutputView:tt},nt=c.a.View.extend({initialize:function(t){this.node=t.node,this.output_width=Math.max(150,this.$el.width()),this.tool_body=this.$el.find(".toolFormBody"),this.tool_body.find("div").remove(),this.newInputsDiv().appendTo(this.tool_body),this.terminalViews={},this.outputViews={}},render:function(){this.renderToolLabel(),this.renderToolErrors(),this.$el.css("width",Math.min(250,Math.max(this.$el.width(),this.output_width)))},renderToolLabel:function(){this.$(".nodeTitle").text(this.node.label||this.node.name),this.$el.attr("node-label",this.node.label)},renderToolErrors:function(){this.node.errors?this.$el.addClass("tool-node-error"):this.$el.removeClass("tool-node-error")},newInputsDiv:function(){return a()("<div/>").addClass("inputs")},updateMaxWidth:function(t){this.output_width=Math.max(this.output_width,t)},addRule:function(){this.tool_body.append(a()("<div/>").addClass("rule"))},addDataInput:function(t,e){var i=!0;e||(e=this.$(".inputs"),i=!1);var n=this.terminalViews[t.name],a=Q.InputTerminalView;if("dataset_collection"==t.input_type?a=Q.InputCollectionTerminalView:"parameter"==t.input_type&&(a=Q.InputParameterTerminalView),!n||n instanceof a||(n.el.terminal.destroy(),n=null),n){var o=n.el.terminal;o.update(t),o.destroyInvalidConnections()}else n=new a({node:this.node,input:t});this.terminalViews[t.name]=n;var s=n.el,r=new it.DataInputView({terminalElement:s,input:t,nodeView:this,skipResize:i}).$el;return e.append(r.prepend(n.terminalElements())),n},terminalViewForOutput:function(t){var e=Q.OutputTerminalView;return t.collection?e=Q.OutputCollectionTerminalView:t.parameter&&(e=Q.OutputParameterTerminalView),new e({node:this.node,output:t})},outputViewforOutput:function(t,e){return new(t.parameter?it.ParameterOutputView:it.DataOutputView)({output:t,terminalElement:e.el,nodeView:this})},addDataOutput:function(t){var e=this.terminalViewForOutput(t),i=this.outputViewforOutput(t,e);this.outputViews[t.name]=i,this.tool_body.append(i.$el.append(e.terminalElements()))},redrawWorkflowOutputs:function(){$.a.each(this.outputViews,function(t){t.redrawWorkflowOutput()})},updateDataOutput:function(t){this.node.output_terminals[t.name].update(t)}}),at=c.a.Model.extend({initialize:function(t,e){this.app=t,this.element=e.element,this.input_terminals={},this.output_terminals={},this.errors={},this.workflow_outputs=[]},getWorkflowOutput:function(t){return r.a.findWhere(this.workflow_outputs,{output_name:t})},isWorkflowOutput:function(t){return void 0!==this.getWorkflowOutput(t)},removeWorkflowOutput:function(t){for(;this.isWorkflowOutput(t);){var e=this.getWorkflowOutput(t);this.workflow_outputs.splice(r.a.indexOf(this.workflow_outputs,e),1)}},addWorkflowOutput:function(t,e){if(!this.isWorkflowOutput(t)){var i={output_name:t};return e&&(i.label=e),this.workflow_outputs.push(i),!0}return!1},labelWorkflowOutput:function(t,e){var i=!1,n=null;if(this.isWorkflowOutput(t)){var a=this.getWorkflowOutput(t);n=a.label,a.label=e,i=n!=e}else i=this.addWorkflowOutput(t,e);return i&&(this.app.workflow.updateOutputLabel(n,e),this.markChanged(),this.nodeView.redrawWorkflowOutputs()),i},changeOutputDatatype:function(t,e){var i=this.output_terminals[t],n=this.nodeView.outputViews[t].output;i.force_datatype=e,n.force_datatype=e,e?this.post_job_actions["ChangeDatatypeAction"+t]={action_arguments:{newtype:e},action_type:"ChangeDatatypeAction",output_name:t}:delete this.post_job_actions["ChangeDatatypeAction"+t],this.markChanged(),i.destroyInvalidConnections()},connectedOutputTerminals:function(){return this._connectedTerminals(this.output_terminals)},_connectedTerminals:function(t){var e=[];return a.a.each(t,function(t,i){i.connectors.length>0&&e.push(i)}),e},hasConnectedOutputTerminals:function(){var t=this.output_terminals;for(var e in t)if(t[e].connectors.length>0)return!0;return!1},connectedMappedInputTerminals:function(){return this._connectedMappedTerminals(this.input_terminals)},hasConnectedMappedInputTerminals:function(){var t=this.input_terminals;for(var e in t){var i=t[e];if(i.connectors.length>0&&i.isMappedOver())return!0}return!1},_connectedMappedTerminals:function(t){var e=[];return a.a.each(t,function(t,i){i.mapOver().isCollection&&i.connectors.length>0&&e.push(i)}),e},mappedInputTerminals:function(){return this._mappedTerminals(this.input_terminals)},_mappedTerminals:function(t){var e=[];return a.a.each(t,function(t,i){i.mapOver().isCollection&&e.push(i)}),e},hasMappedOverInputTerminals:function(){var t=!1;return r.a.each(this.input_terminals,function(e){e.mapOver().isCollection&&(t=!0)}),t},redraw:function(){a.a.each(this.input_terminals,function(t,e){e.redraw()}),a.a.each(this.output_terminals,function(t,e){e.redraw()})},clone:function(){var t=this,e={name:this.name,label:this.label,annotation:this.annotation,post_job_actions:this.post_job_actions},i=this.app.workflow.create_node(this.type,this.name,this.content_id);p.a.request({type:"POST",url:"".concat(Object(d.getAppRoot)(),"api/workflows/build_module"),data:{type:this.type,tool_id:this.content_id,tool_state:this.tool_state},success:function(n){var a=Object.assign({},n,e);i.init_field_data(a),i.update_field_data(a),t.app.workflow.activate_node(i)}})},destroy:function(){a.a.each(this.input_terminals,function(t,e){e.destroy()}),a.a.each(this.output_terminals,function(t,e){e.destroy()}),this.app.workflow.remove_node(this),a()(this.element).remove()},make_active:function(){a()(this.element).addClass("toolForm-active")},make_inactive:function(){var t,e=this.element.get(0);(t=e.parentNode).removeChild(e),t.appendChild(e),a()(e).removeClass("toolForm-active")},set_tool_version:function(){"tool"===this.type&&this.config_form&&(this.tool_version=this.config_form.version,this.content_id=this.config_form.id)},init_field_data:function(t){t.type&&(this.type=t.type),this.name=t.name,this.config_form=t.config_form,this.set_tool_version(),this.tool_state=t.tool_state,this.errors=t.errors,this.tooltip=t.tooltip?t.tooltip:"",this.annotation=t.annotation,this.post_job_actions=t.post_job_actions?t.post_job_actions:{},this.label=t.label,this.uuid=t.uuid,this.workflow_outputs=t.workflow_outputs?t.workflow_outputs:[];var e=new nt({el:this.element[0],node:this});this.nodeView=e,a.a.each(t.inputs,function(t,i){e.addDataInput(i)}),t.inputs.length>0&&t.outputs.length>0&&e.addRule(),a.a.each(t.outputs,function(t,i){e.addDataOutput(i)}),e.render(),this.app.workflow.node_changed(this,!0)},update_field_data:function(t){var e=this,i=e.nodeView,n=[];if(a.a.each(i.outputViews,function(e,i){var a=i.output.name,o=t.outputs,s=!1;r.a.each(o,function(t){t.name==a&&(s=!0)}),!1===s&&n.push(a)}),r.a.each(n,function(t){r.a.each(i.outputViews[t].terminalElement.terminal.connectors,function(t){t&&t.destroy()}),i.outputViews[t].remove(),delete i.outputViews[t],delete e.output_terminals[t]}),a.a.each(e.workflow_outputs,function(t,i){i&&!e.output_terminals[i.output_name]&&e.workflow_outputs.splice(t,1)}),a.a.each(t.outputs,function(t,n){i.outputViews[n.name]?(e.output_terminals[n.name].datatypes=n.extensions,e.output_terminals[n.name].force_datatype=n.force_datatype,"parameter_input"==e.type&&(e.output_terminals[n.name].attributes.type=n.type),e.output_terminals[n.name].destroyInvalidConnections()):i.addDataOutput(n)}),this.tool_state=t.tool_state,this.config_form=t.config_form,this.set_tool_version(),this.errors=t.errors,this.annotation=t.annotation,this.label=t.label,"post_job_actions"in t){var o=t.post_job_actions;this.post_job_actions=o||{}}e.nodeView.renderToolErrors();var s=i.$("div.inputs"),l=i.newInputsDiv(),c={};r.a.each(t.inputs,function(t){var i=e.nodeView.addDataInput(t,l);c[t.name]=i}),r.a.each(r.a.difference(r.a.values(i.terminalViews),r.a.values(c)),function(t){t.el.terminal.destroy()}),i.terminalViews=c,e.nodeView.render();var d=t.outputs;1==d.length&&"collection_type"in d[0]&&i.updateDataOutput(d[0]),s.replaceWith(l),"workflow_outputs"in t&&(this.workflow_outputs=t.workflow_outputs?t.workflow_outputs:[]),this.markChanged(),this.redraw()},error:function(t){var e=a()(this.element).find(".toolFormBody");e.find("div").remove();var i="<div style='color: red; text-style: italic;'>".concat(t,"</div>");this.config_form=i,e.html(i),this.app.workflow.node_changed(this)},markChanged:function(){this.app.workflow.node_changed(this)}}),ot=i(117),st=i(24),rt=i(121);function lt(t){var e=t.model.attributes,i=e.workflow,n=e.node;e.inputs.unshift({type:"text",name:"__annotation",label:"Annotation",fixed:!0,value:n.annotation,area:!0,help:"Add an annotation or notes to this step. Annotations are available when a workflow is viewed."}),e.inputs.unshift({type:"text",name:"__label",label:"Label",value:n.label,help:h()("Add a step label."),fixed:!0,onchange:function(e){var a=!1;for(var o in i.nodes){var s=i.nodes[o];if(s.label&&s.label==e&&s.id!=n.id){a=!0;break}}var r=t.data.match("__label");t.element_list[r].model.set("error_text",a&&"Duplicate label. Please fix this before saving the workflow."),t.trigger("change")}})}function ct(t,e,i){var n=[],a=[],o=i.datatypes,s=i.node,r=i.workflow;for(var l in o)n.push({0:o[l],1:o[l]});for(var c in s.input_terminals)a.push({name:s.input_terminals[c].name,label:s.input_terminals[c].label});var d,u,p=(d='This action will rename the output dataset. Click <a href="https://galaxyproject.org/learn/advanced-workflow/variables/">here</a> for more information. Valid input variables are:',d+="\n        <ul>\n            ".concat(a.map(function(t){return"<li><strong>".concat(t.name.replace(/\|/g,"."),"</strong>\n                                                         ").concat(t.label?"(".concat(t.label,")"):"","\n                                             </li>")}).join(""),"\n        </ul>\n    "));n.sort(function(t,e){return t.label>e.label?1:t.label<e.label?-1:0}),n.unshift({0:"Sequences",1:"Sequences"}),n.unshift({0:"Roadmaps",1:"Roadmaps"}),n.unshift({0:"Leave unchanged",1:"__empty__"});var f={title:"Configure Output: '".concat(e,"'"),type:"section",flat:!0,inputs:[{label:"Label",type:"text",value:(u=s.getWorkflowOutput(t))&&u.label||"",help:"This will provide a short name to describe the output - this must be unique across workflows.",onchange:function(e){r.attemptUpdateOutputLabel(s,t,e)}},{action:"RenameDatasetAction",pja_arg:"newname",label:"Rename dataset",type:"text",value:"",ignore:"",help:p},{action:"ChangeDatatypeAction",pja_arg:"newtype",label:"Change datatype",type:"select",ignore:"__empty__",value:"__empty__",options:n,help:"This action will change the datatype of the output to the indicated datatype.",onchange:function(e){"__empty__"===e&&(e=null),r.updateDatatype(s,t,e)}},{action:"TagDatasetAction",pja_arg:"tags",label:"Add Tags",type:"text",value:"",ignore:"",help:"This action will set tags for the dataset."},{action:"RemoveTagDatasetAction",pja_arg:"tags",label:"Remove Tags",type:"text",value:"",ignore:"",help:"This action will remove tags for the dataset."},{title:h()("Assign columns"),type:"section",flat:!0,inputs:[{action:"ColumnSetAction",pja_arg:"chromCol",label:"Chrom column",type:"integer",value:"",ignore:""},{action:"ColumnSetAction",pja_arg:"startCol",label:"Start column",type:"integer",value:"",ignore:""},{action:"ColumnSetAction",pja_arg:"endCol",label:"End column",type:"integer",value:"",ignore:""},{action:"ColumnSetAction",pja_arg:"strandCol",label:"Strand column",type:"integer",value:"",ignore:""},{action:"ColumnSetAction",pja_arg:"nameCol",label:"Name column",type:"integer",value:"",ignore:""}],help:"This action will set column assignments in the output dataset. Blank fields are ignored."}]};return function t(e,i,n,a){var o=a.node.post_job_actions;for(var s in(i=i||[]).push(e),e.inputs){var r=e.inputs[s];if(r.action){if(r.name="pja__".concat(n,"__").concat(r.action),r.pja_arg&&(r.name+="__".concat(r.pja_arg)),r.payload)for(var l in r.payload)r.payload["".concat(r.name,"__").concat(l)]=r.payload[l],delete r.payload[l];var c=o[r.action+n];if(c){for(var d in i)i[d].expanded=!0;r.pja_arg?r.value=c.action_arguments&&c.action_arguments[r.pja_arg]||r.value:r.value="true"}}r.inputs&&t(r,i.slice(0),n,a)}}(f,[],t,i),f}var dt,ut={Default:c.a.View.extend({initialize:function(t){var e=this,i=t.node;this.form=new st.a(p.a.merge(t,{onchange:function(){p.a.request({type:"POST",url:"".concat(Object(d.getAppRoot)(),"api/workflows/build_module"),data:{id:i.id,type:i.type,content_id:i.content_id,inputs:e.form.data.create()},success:function(t){i.update_field_data(t)}})}})),lt(this.form),this.form.render()}}),Tool:c.a.View.extend({initialize:function(t){var e=this,i=t.node;this.form=new rt.a(p.a.merge(t,{text_enable:"Set in Advance",text_disable:"Set at Runtime",narrow:!0,initial_errors:!0,cls:"ui-portlet-section",initialmodel:function(t,i){e._customize(i),t.resolve()},buildmodel:function(t,e){e.model.get("postchange")(t,e)},postchange:function(t,n){var s=Object(o.a)(),r=n.model.attributes,l={tool_id:r.id,tool_version:r.version,type:"tool",inputs:a.a.extend(!0,{},n.data.create())};s.emit.debug("tool-form-workflow::postchange()","Sending current state.",l),p.a.request({type:"POST",url:"".concat(Object(d.getAppRoot)(),"api/workflows/build_module"),data:l,success:function(a){n.model.set(a.config_form),e._customize(n),n.update(a.config_form),n.errors(a.config_form),i.update_field_data(a),s.emit.debug("tool-form-workflow::postchange()","Received new model.",a),t.resolve()},error:function(e){s.emit.debug("tool-form-workflow::postchange()","Refresh request failed.",e),t.reject()}})}}))},_customize:function(t){var e=t.model.attributes;p.a.deepeach(e.inputs,function(t){t.type&&(t.connectable=!0,-1!=["data","data_collection"].indexOf(t.type)?(t.type="hidden",t.info="Data input '".concat(t.name,"' (").concat(p.a.textify(t.extensions),")"),t.value={__class__:"RuntimeValue"}):t.fixed||(t.collapsible_value={__class__:"RuntimeValue"},t.is_workflow=t.options&&0===t.options.length||-1!=["integer","float"].indexOf(t.type)))}),p.a.deepeach(e.inputs,function(t){"conditional"===t.type&&(t.connectable=!1,t.test_param.collapsible_value=void 0)}),function(t){var e=t.model.attributes,i=e.inputs,n=e.node,a=n.post_job_actions,o=n.output_terminals&&Object.keys(n.output_terminals)[0];if(o)for(var s in i.push({name:"pja__".concat(o,"__EmailAction"),label:"Email notification",type:"boolean",value:String(Boolean(a["EmailAction".concat(o)])),ignore:"false",help:h()("An email notification will be sent when the job has completed."),payload:{host:window.location.host}}),i.push({name:"pja__".concat(o,"__DeleteIntermediatesAction"),label:"Output cleanup",type:"boolean",value:String(Boolean(a["DeleteIntermediatesAction".concat(o)])),ignore:"false",help:"Upon completion of this step, delete non-starred outputs from completed workflow steps if they are no longer required as inputs."}),n.output_terminals){var r=n.output_terminals[s].label||s;i.push(ct(s,r,e))}}(t),lt(t)}})},ht=i(10),pt=i(19),ft=i(76),mt=(i(62),function(t){this.$overlay=t.overlay,this.$dialog=t.dialog,this.$header=this.$dialog.find(".modal-header"),this.$body=this.$dialog.find(".modal-body"),this.$footer=this.$dialog.find(".modal-footer"),this.$backdrop=t.backdrop,this.$header.find(".close").on("click",a.a.proxy(this.hide,this))});function gt(){dt.hide()}function _t(t,e,i,n,a){dt.setContent({title:t,body:e,buttons:i,extra_buttons:n}),dt.show({backdrop:!0},a)}function vt(t,e,i,n,a){dt.setContent({title:t,body:e,buttons:i,extra_buttons:n}),dt.show({backdrop:!1},a)}function bt(t){var e=t.width||"600",i=t.height||"400",n=t.scroll||"auto";a()("#overlay-background").bind("click.overlay",function(){gt(),a()("#overlay-background").unbind("click.overlay")}),dt.setContent({closeButton:!0,title:"&nbsp;",body:a()("<div style='margin: -5px;'><iframe style='margin: 0; padding: 0;' src='".concat(t.url,"' width='").concat(e,"' height='").concat(i,"' scrolling='").concat(n,"' frameborder='0'></iframe></div>"))}),dt.show({backdrop:!0})}a.a.extend(mt.prototype,{setContent:function(t){this.$header.hide(),t.title&&(this.$header.find(".title").html(t.title),this.$header.show()),t.closeButton?(this.$header.find(".close").show(),this.$header.show()):this.$header.find(".close").hide(),this.$footer.hide();var e=this.$footer.find(".buttons").html("");t.buttons&&(a.a.each(t.buttons,function(t,i){e.append(a()("<button></button> ").text(t).click(i)).append(" ")}),this.$footer.show());var i=this.$footer.find(".extra_buttons").html("");t.extra_buttons&&(a.a.each(t.extra_buttons,function(t,e){i.append(a()("<button></button>").text(t).click(e)).append(" ")}),this.$footer.show());var n=t.body;"progress"==n&&(n=a()("<div class='progress progress-striped active'><div class='progress-bar' style='width: 100%'></div></div>")),this.$body.html(n)},show:function(t,e){t.backdrop?this.$backdrop.addClass("in"):this.$backdrop.removeClass("in"),this.$overlay.show(),this.$dialog.show(),this.$overlay.addClass("in"),this.$body.css("min-width",this.$body.width()),this.$body.css("max-height",a()(window).height()/1.5),e&&e()},hide:function(){var t=this;t.$dialog.fadeOut(function(){t.$overlay.hide(),t.$backdrop.removeClass("in"),t.$body.children().remove(),t.$body.css("min-width",void 0)})}}),a()(function(){dt=new mt({overlay:a()("#top-modal"),dialog:a()("#top-modal-dialog"),backdrop:a()("#top-modal-backdrop")})});var wt=i(20);function yt(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var i=[],n=!0,a=!1,o=void 0;try{for(var s,r=t[Symbol.iterator]();!(n=(s=r.next()).done)&&(i.push(s.value),!e||i.length!==e);n=!0);}catch(t){a=!0,o=t}finally{try{n||null==r.return||r.return()}finally{if(a)throw o}}return i}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function xt(t){var e=a()("#galaxy_tools").contents();0===e.length&&(e=a()(document),a()(this).removeClass("search_active"),e.find(".toolTitle").removeClass("search_match"),e.find(".toolSectionBody").hide(),e.find(".toolTitle").show(),e.find(".toolPanelLabel").show(),e.find(".toolSectionWrapper").each(function(){"recently_used_wrapper"!==a()(this).attr("id")?a()(this).show():a()(this).hasClass("user_pref_visible")&&a()(this).show()}),e.find("#search-no-results").hide(),e.find("#search-spinner").hide(),t&&e.find("#tool-search-query").val("search tools"))}window.workflow_globals=window.workflow_globals||{};var kt=c.a.View.extend({initialize:function(t){var e=window.workflow_globals.app=this;this.options=t,this.urls=t&&t.urls||{};var i=e.urls.workflow_index;a()("#search-clear-btn").click(function(){a()("#tool-search-query").val(""),xt(!1)}),a()("#tool-search-query").click(function(){a()(this).focus(),a()(this).select()}).keyup(function(t){if(27==t.keyCode&&(this.value=""),a()(this).css("font-style","normal"),this.value.length<3)xt(!1);else if(this.value!=this.lastValue){a()(this).addClass("search_active");var i=this.value;this.timer&&window.clearTimeout(this.timer),a()("#search-spinner").show(),this.timer=window.setTimeout(function(){a.a.get(e.urls.tool_search,{q:i},function(t){if(a()("#search-no-results").hide(),a()(".toolSectionWrapper").hide(),a()(".toolSectionWrapper").find(".toolTitle").hide(),0!==t.length){var e=a.a.map(t,function(t,e){return"link-".concat(t)});a()(e).each(function(t,e){a()("[id='".concat(e,"']")).parent().addClass("search_match"),a()("[id='".concat(e,"']")).parent().show().parent().parent().show().parent().show()}),a()(".toolPanelLabel").each(function(){for(var t=a()(this),e=t.next(),i=!0;0!==e.length&&e.hasClass("toolTitle");){if(e.is(":visible")){i=!1;break}e=e.next()}i&&t.hide()})}else a()("#search-no-results").show();a()("#search-spinner").hide()},"json")},400)}this.lastValue=this.value}),this.canvas_manager=window.workflow_globals.canvas_manager=new S(this,a()("#canvas-viewport"),a()("#overview")),this.reset(),this.datatypes=JSON.parse(a.a.ajax({url:"".concat(Object(d.getAppRoot)(),"api/datatypes"),async:!1}).responseText),this.datatypes_mapping=JSON.parse(a.a.ajax({url:"".concat(Object(d.getAppRoot)(),"api/datatypes/mapping"),async:!1}).responseText),this.ext_to_type=this.datatypes_mapping.ext_to_class_name,this.type_to_type=this.datatypes_mapping.class_to_classes,this.get_workflow_versions=function(){for(var t={},i=JSON.parse(a.a.ajax({url:"".concat(Object(d.getAppRoot)(),"api/workflows/").concat(e.options.id,"/versions"),async:!1}).responseText),n=0;n<i.length;n++){var o=i[n],s="Version ".concat(o.version,", ").concat(o.steps," steps"),r=!1;n==e.workflow.workflow_version&&(s="".concat(s," (active)"),r=!0),t[s]={version:n,selected:r}}return t},this.build_version_select=function(){var t=this.get_workflow_versions();a()("#workflow-version-switch").empty(),a.a.each(t,function(t,e){a()("#workflow-version-switch").append(a()("<option></option>").html(t).val(e.version).selected(e.selected))}),a()("#workflow-version-switch").on("change",function(){if(a()("#workflow-version-switch").unbind("change"),this.value!=e.workflow.workflow_version){if(e.workflow&&e.workflow.has_changes)if(0==window.confirm("There are unsaved changes to your workflow which will be lost. Continue ?"))return void e.build_version_select();e.load_workflow(e.options.id,this.value)}})},this.load_workflow=function(t,n){this._workflowLoadAjax(t,n,{success:function(t){e.reset(),e.workflow.from_simple(t,!0),e.workflow.has_changes=!1,e.workflow.fit_canvas_to_nodes(),e.scroll_to_nodes(),e.canvas_manager.draw_overview(),e.build_version_select();var i="";r.a.each(t.steps,function(n,a){var o="";n.errors&&(o+="<li>".concat(n.errors,"</li>")),r.a.each(t.upgrade_messages[a],function(t){o+="<li>".concat(t,"</li>")}),o&&(i+="<li>Step ".concat(parseInt(a,10)+1,": ").concat(e.workflow.nodes[a].name,"<ul>").concat(o,"</ul></li>"))}),i?_t("Issues loading this workflow","Please review the following issues, possibly resulting from tool upgrades or changes.<p><ul>".concat(i,"</ul></p>"),{Continue:gt}):gt(),e.showWorkflowParameters()},error:function(t){_t("Loading workflow failed.",t.err_msg,{Ok:function(t){window.onbeforeunload=void 0,window.document.location=i}})},beforeSubmit:function(t){vt("Loading workflow","progress")}})},this.load_workflow(e.options.id,e.options.version),wt.b&&(a()("#workflow-run-button").click(function(){return window.location="".concat(Object(d.getAppRoot)(),"workflows/run?id=").concat(e.options.id)}),a()("#workflow-save-button").click(function(){return function(t,i){if(vt("Saving workflow","progress"),e.workflow.check_changes_in_active_form(),!e.workflow.has_changes)return gt(),void(i&&i());e.workflow.rectify_workflow_outputs(),p.a.request({url:"".concat(Object(d.getAppRoot)(),"api/workflows/").concat(e.options.id),type:"PUT",data:{workflow:e.workflow.to_simple()},success:function(t){var n=a()("<div/>").text(t.message);if(t.errors){n.addClass("warningmark");var o=a()("<ul/>");a.a.each(t.errors,function(t,e){a()("<li/>").text(e).appendTo(o)}),n.append(o)}else n.addClass("donemark");e.workflow.name=t.name,e.workflow.has_changes=!1,e.workflow.stored=!0,e.workflow.workflow_version=t.version,e.showWorkflowParameters(),e.build_version_select(),t.errors?_t("Saving workflow",n,{Ok:gt}):(i&&i(),gt())},error:function(t){_t("Saving workflow failed.",t.err_msg,{Ok:gt})}})}()}),Object(wt.b)(a()("#workflow-options-button"),{"Save As":function(){_t("Save As a New Workflow",a()('<form><label style="display:inline-block; width: 100%;">Save as name: </label><input type="text" id="workflow_rename" style="width: 80%;" autofocus/><br><label style="display:inline-block; width: 100%;">Annotation: </label><input type="text" id="wf_annotation" style="width: 80%;" /></form>'),{OK:function(){var t=a()("#workflow_rename").val().length>0?a()("#workflow_rename").val():"SavedAs_".concat(e.workflow.name),i=a()("#wf_annotation").val().length>0?a()("#wf_annotation").val():"";a.a.ajax({url:e.urls.workflow_save_as,type:"POST",data:{workflow_name:t,workflow_annotation:i,workflow_data:function(){return JSON.stringify(e.workflow.to_simple())}}}).done(function(t){window.onbeforeunload=void 0,window.location="".concat(Object(d.getAppRoot)(),"workflow/editor?id=").concat(t),gt()}).fail(function(){gt(),alert("Saving this workflow failed. Please contact this site's administrator.")})},Cancel:gt})},"Edit Attributes":function(){e.workflow.clear_active_node()},"Auto Re-layout":function(){e.workflow.layout(),e.workflow.fit_canvas_to_nodes(),e.scroll_to_nodes(),e.canvas_manager.draw_overview()},Download:{url:"".concat(Object(d.getAppRoot)(),"api/workflows/").concat(e.options.id,"/download?format=json-download"),action:function(){}}}));var n=localStorage.getItem("overview-size");void 0!==n&&a()(".workflow-overview").css({width:n,height:n}),a()(".workflow-overview").bind("dragend",function(t,e){var i=a()(this).offsetParent(),n=i.offset(),o=Math.max(i.width()-(e.offsetX-n.left),i.height()-(e.offsetY-n.top));localStorage.setItem("overview-size","".concat(o,"px"))}),window.onbeforeunload=function(){if(e.workflow&&e.workflow.has_changes)return"There are unsaved changes to your workflow which will be lost."},this.options.workflows.length>0&&a()("#left").find(".toolMenu").append(this._buildToolPanelWorkflows()),a()("div.toolSectionBody").hide(),a()("div.toolSectionTitle > span").wrap("<a href='#'></a>");var o=null;a()("div.toolSectionTitle").each(function(){var t=a()(this).next("div.toolSectionBody");a()(this).click(function(){t.is(":hidden")?(o&&o.slideUp("fast"),o=t,t.slideDown("fast")):(t.slideUp("fast"),o=null)})}),Object(ft.a)("workflow-name","workflow-name",e.urls.rename_async,"new_name"),a()("#workflow-tag").click(function(){return a()(".tag-area").click(),!1}),Object(ft.a)("workflow-annotation","workflow-annotation",e.urls.annotate_async,"new_annotation",25,!0,4)},_buildToolPanelWorkflows:function(){var t=this,e=a()('<div class="toolSectionWrapper"><div class="toolSectionTitle"><a href="#"><span>Workflows</span></a></div><div class="toolSectionBody"><div class="toolSectionBg"/></div></div>');return r.a.each(this.options.workflows,function(i){if(i.id!==t.options.id){var n=new ht.a.Button({icon:"fa fa-copy",cls:"ui-button-icon-plain",tooltip:h()("Copy and insert individual steps"),onclick:function(){var e=Object(o.a)();i.step_count<2?t.copy_into_workflow(i.id,i.name):e.modal.show({title:h()("Warning"),body:"This will copy ".concat(i.step_count," new steps into your workflow."),buttons:{Cancel:function(){e.modal.hide()},Copy:function(){e.modal.hide(),t.copy_into_workflow(i.id,i.name)}}})}}),s=a()("<a/>").attr("href","#").html(i.name).on("click",function(){t.add_node_for_subworkflow(i.latest_id,i.name)});e.find(".toolSectionBg").append(a()("<div/>").addClass("toolTitle").append(s).append(n.$el))}}),e},copy_into_workflow:function(t){var e=this;this._workflowLoadAjax(t,null,{success:function(t){e.workflow.from_simple(t,!1);var i="";a.a.each(t.upgrade_messages,function(t,n){i+="<li>Step ".concat(parseInt(t,10)+1,": ").concat(e.workflow.nodes[t].name,"<ul>"),a.a.each(n,function(t,e){i+="<li>".concat(e,"</li>")}),i+="</ul></li>"}),i?_t("Subworkflow embedded with changes","Problems were encountered loading this workflow (possibly a result of tool upgrades). Please review the following parameters and then save.<ul>".concat(i,"</ul>"),{Continue:gt}):gt()},beforeSubmit:function(t){vt("Importing workflow","progress")}})},reset:function(){this.workflow&&this.workflow.remove_all(),this.workflow=window.workflow_globals.workflow=new v(this,a()("#canvas-container"))},scroll_to_nodes:function(){var t,e,i=a()("#canvas-viewport"),n=a()("#canvas-container");e=n.width()<i.width()?(i.width()-n.width())/2:0,t=n.height()<i.height()?(i.height()-n.height())/2:0,n.css({left:e,top:t})},_workflowLoadAjax:function(t,e,i){a.a.ajax(p.a.merge(i,{url:this.urls.load_workflow,data:{id:t,_:"true",version:e},dataType:"json",cache:!1}))},_moduleInitAjax:function(t,e){var i=this;p.a.request({type:"POST",url:"".concat(Object(d.getAppRoot)(),"api/workflows/build_module"),data:e,success:function(e){var n=Object(o.a)();t.init_field_data(e),t.update_field_data(e),a.a.each(t.output_terminals,function(e,i){t.addWorkflowOutput(i.name),a()(t.element).find(".callout.".concat(i.name.replace(/(?=[()])/g,"\\"))).find("img").attr("src","".concat(n.root,"static/images/fugue/asterisk-small.png"))}),i.workflow.activate_node(t)}})},add_node_for_tool:function(t,e){var i=this.workflow.create_node("tool",e,t);this._moduleInitAjax(i,{type:"tool",tool_id:t,_:"true"})},add_node_for_subworkflow:function(t,e){var i=this.workflow.create_node("subworkflow",e,t);this._moduleInitAjax(i,{type:"subworkflow",content_id:t,_:"true"})},add_node_for_module:function(t,e){var i=this.workflow.create_node(t,e);this._moduleInitAjax(i,{type:t,_:"true"})},display_file_list:function(t){var e="<select id='node_data_list' name='node_data_list'>";for(var i in t.output_terminals)e+="<option value='".concat(i,"'>").concat(i,"</option>");return e+="</select>"},showWorkflowParameters:function(){var t=/\$\{.+?\}/g,e=[],i=a()("#workflow-parameters-container"),n=a()("#workflow-parameters-box"),o="",s=[];a.a.each(this.workflow.nodes,function(i,n){n.config_form&&n.config_form.inputs&&p.a.deepeach(n.config_form.inputs,function(e){if("string"==typeof e.value){var i=e.value.match(t);i&&(s=s.concat(i))}}),n.post_job_actions&&a.a.each(n.post_job_actions,function(e,i){i.action_arguments&&a.a.each(i.action_arguments,function(e,i){if("string"==typeof i){var n=i.match(t);n&&(s=s.concat(n))}})}),s&&a.a.each(s,function(t,i){-1===a.a.inArray(i,e)&&e.push(i)})}),e&&0!==e.length?(a.a.each(e,function(t,e){o+="<div>".concat(e.substring(2,e.length-1),"</div>")}),i.html(o),n.show()):(i.html(o),n.hide())},showAttributes:function(){a()(".right-content").hide(),a()("#edit-attributes").show()},showForm:function(t,e){var i="right-content",n="".concat(i,"-").concat(e.id),s=a()("#".concat(i)),r=Object(o.a)();if(t&&0===s.find("#".concat(n)).length){var l=a()('<div id="'.concat(n,'" class="').concat(i,'"/>'));if(t.node=e,t.workflow=this.workflow,t.datatypes=this.datatypes,t.icon=ot.a[e.type],t.cls="ui-portlet-section",e){var c="tool"==e.type?"Tool":"Default";l.append(new ut[c](t).form.$el),s.append(l)}else r.emit.debug("workflow-view::initialize()","Node not found in workflow.")}a()(".".concat(i)).hide(),s.find("#".concat(n)).show(),s.show(),s.scrollTop()},isSubType:function(t,e){return t=this.ext_to_type[t],e=this.ext_to_type[e],this.type_to_type[t]&&e in this.type_to_type[t]},get_workflow_path:function(t,e,i){var n={},a={};for(var o in t.steps){var s=t.steps[o],r=s.input_connections;for(var l in a[s.id]=this.getToolId(s.content_id),r){var c=r[l];if(null!=c){var d=[],u=!0,h=!1,p=void 0;try{for(var f,m=c[Symbol.iterator]();!(u=(f=m.next()).done);u=!0){var g=f.value;d.push(g.id.toString())}}catch(t){h=!0,p=t}finally{try{u||null==m.return||m.return()}finally{if(h)throw p}}n[s.id.toString()]=d}}}var _=[],v=[];_.push(e),_=function t(e,i){for(var a in n)if(parseInt(a)===parseInt(e)){var o=parseInt(n[a][0]);null!=o&&(i.push(o),void 0!==n[o]&&null!==n[o]&&t(o,i))}return i}(e,_);var b=!0,w=!1,y=void 0;try{for(var x,k=_[Symbol.iterator]();!(b=(x=k.next()).done);b=!0){var C=a[x.value.toString()];null!=C&&v.push(C)}}catch(t){w=!0,y=t}finally{try{b||null==k.return||k.return()}finally{if(w)throw y}}return v.join(",")},getToolId:function(t){if(null!=t&&t.indexOf("/")>-1){var e=t.split("/");t=e[e.length-2]}return t},getToolRecommendations:function(t,e){var i=this.get_workflow_path(this.workflow.to_simple(),t.id,e),n=a()(".modal-tool-recommendation");n.length>0&&n.remove();var o=new pt.a.View({title:"Recommended tools",body:"<div> Loading tools ... </div>",height:"230",width:"250",closing_events:!0,title_separator:!0});o.$el.addClass("modal-tool-recommendation"),o.show(),p.a.request({type:"POST",url:"".concat(Object(d.getAppRoot)(),"api/workflows/get_tool_predictions"),data:{tool_sequence:i},success:function(t){var e="<div>",i=t.predicted_data.children;if(i.length>0){e+="<div>";var n=!0,s=!1,r=void 0;try{for(var l,c=i.entries()[Symbol.iterator]();!(n=(l=c.next()).done);n=!0){var d=yt(l.value,2),u=(d[0],d[1]);e+="<i class='fa mr-1 fa-wrench'></i><a href='#'class='pred-tool panel-header-button' id='"+u.tool_id+"'>"+u.name,e+="</a></br>"}}catch(t){s=!0,r=t}finally{try{n||null==c.return||c.return()}finally{if(s)throw r}}e+="</div>"}else e+="No tool recommendations";e+="</div>",o.$body.html(e),a()(".pred-tool").click(function(t){workflow_globals.app.add_node_for_tool(t.target.id,t.target.id),o.hide()})}})},prebuildNode:function(t,e,i){var n=this,o=a()("<div class='toolForm toolFormInCanvas'/>"),s=a()("<div class='toolFormTitle unselectable'><span class='nodeTitle'>".concat(e,"</div></div>"));!function(t,e){var i=ot.a[e];if(i){var n=a()('<i class="icon fa">&nbsp;</i>').addClass(i);t.before(n)}}(s.find(".nodeTitle"),t),o.append(s),o.css("left",a()(window).scrollLeft()+20),o.css("top",a()(window).scrollTop()+20),o.append(a()("<div class='toolFormBody'></div>"));var r=new at(this,{element:o});r.type=t,r.content_id=i;var l="<div><img height='16' align='middle' src='".concat(Object(d.getAppRoot)(),"static/images/loading_small_white_bg.gif'/> loading tool info...</div>");o.find(".toolFormBody").append(l);var c=a()("<div class='buttons' style='float: right;'></div>");c.append(a()('<div class="sr-only"><a href="#right">Node Details</a></div>')),"subworkflow"!==t&&c.append(a()("<div/>").addClass("fa-icon-button fa fa-files-o node-clone").click(function(t){r.clone()}));var u=window.Galaxy.config.enable_tool_recommendation;if(void 0!==r.content_id&&(!0===u||"true"===u)){var h=n.getToolId(r.content_id);c.append(a()("<a/>").addClass("panel-header-button").attr("href","#").attr("title","Show recommended tools").html('<span class="fa-icon-button fa fa-arrow-right"></span>').click(function(t){n.getToolRecommendations(r,h)}))}c.append(a()("<div/>").addClass("fa-icon-button fa fa-times node-destroy").click(function(t){r.destroy()})),o.appendTo("#canvas-container");var p=a()("#canvas-container").position(),f=a()("#canvas-container").parent(),m=o.width(),g=o.height();return o.css({left:-p.left+f.width()/2-m/2,top:-p.top+f.height()/2-g/2}),c.prependTo(o.find(".toolFormTitle")),m+=c.width()+10,o.css("width",m),o.bind("dragstart",function(){n.workflow.activate_node(r)}).bind("dragend",function(){n.workflow.node_changed(this),n.workflow.fit_canvas_to_nodes(),n.canvas_manager.draw_overview()}).bind("dragclickonly",function(){n.workflow.activate_node(r)}).bind("drag",function(t,e){var i=a()(this).offsetParent().offset(),o=(e.offsetX-i.left)/n.canvas_manager.canvasZoom,s=(e.offsetY-i.top)/n.canvas_manager.canvasZoom;a()(this).css({left:o,top:s}),a()(this).find(".terminal").each(function(){this.terminal.redraw()})}),r}}),Ct=i(64),St=i(9),Tt=i(14),$t=i(32),Ot=i(26),At=(i(164),c.a.Model.extend({is_visible:function(t,e){var i=t.getBoundingClientRect(),n=a()("svg")[0].getBoundingClientRect();return!(i.right<0||i.left>n.right||i.bottom<0||i.top>n.bottom)}})),jt={drawTicks:function(t,e,i,n,a){var o=t.append("g").selectAll("g").data(e).enter().append("g").selectAll("g").data(i).enter().append("g").attr("class","tick").attr("transform",function(t){return"rotate(".concat(180*t.angle/Math.PI-90,")translate(").concat(t.radius,",0)")}),s=[],r=[],l=function(t){return t.angle>Math.PI?"end":null};return a?(s=[0,0,0,-4],r=[4,0,"",".35em"],l=null):(s=[1,0,4,0],r=[0,4,".35em",""]),o.append("line").attr("x1",s[0]).attr("y1",s[1]).attr("x2",s[2]).attr("y1",s[3]).style("stroke","#000"),o.append("text").attr("x",r[0]).attr("y",r[1]).attr("dx",r[2]).attr("dy",r[3]).attr("text-anchor",l).attr("transform",n).text(function(t){return t.label})},formatNum:function(t,e){if(void 0===e&&(e=2),null===t)return null;var i=null;if(Math.abs(t)<1)i=t.toPrecision(e);else{var n=Math.round(t.toPrecision(e));(t=Math.abs(t))<1e3?i=n:t<1e6?i="".concat(Math.round((n/1e3).toPrecision(3)).toFixed(0),"K"):t<1e9&&(i="".concat(Math.round((n/1e6).toPrecision(3)).toFixed(0),"M"))}return i}},Dt=c.a.Model.extend({}),It=c.a.View.extend({className:"circster",initialize:function(t){this.genome=t.genome,this.label_arc_height=50,this.scale=1,this.circular_views=null,this.chords_views=null,this.model.get("drawables").on("add",this.add_track,this),this.model.get("drawables").on("remove",this.remove_track,this);var e=this.model.get("config");e.get("arc_dataset_height").on("change:value",this.update_track_bounds,this),e.get("track_gap").on("change:value",this.update_track_bounds,this)},get_circular_tracks:function(){return this.model.get("drawables").filter(function(t){return"DiagonalHeatmapTrack"!==t.get("track_type")})},get_chord_tracks:function(){return this.model.get("drawables").filter(function(t){return"DiagonalHeatmapTrack"===t.get("track_type")})},get_tracks_bounds:function(){var t=this.get_circular_tracks(),e=this.model.get("config").get_value("arc_dataset_height"),i=this.model.get("config").get_value("track_gap"),n=Math.min(this.$el.width(),this.$el.height())-20,a=n/2-t.length*(e+i)+i-this.label_arc_height,o=St.range(a,n/2,e+i);return r.a.map(o,function(t){return[t,t+e]})},render:function(){var t=this,e=t.$el.width(),i=t.$el.height(),n=this.get_circular_tracks(),a=this.get_chord_tracks(),o=t.model.get("config").get_value("total_gap"),s=this.get_tracks_bounds(),r=St.select(t.$el[0]).append("svg").attr("width",e).attr("height",i).attr("pointer-events","all").append("svg:g").call(St.behavior.zoom().on("zoom",function(){var e=St.event.scale;r.attr("transform","translate(".concat(St.event.translate,") scale(").concat(e,")")),t.scale!==e&&(t.zoom_drag_timeout&&clearTimeout(t.zoom_drag_timeout),t.zoom_drag_timeout=setTimeout(function(){},400))})).attr("transform","translate(".concat(e/2,",").concat(i/2,")")).append("svg:g").attr("class","tracks");this.circular_views=n.map(function(e,i){var n=new Pt({el:r.append("g")[0],track:e,radius_bounds:s[i],genome:t.genome,total_gap:o});return n.render(),n}),this.chords_views=a.map(function(e){var i=new Vt({el:r.append("g")[0],track:e,radius_bounds:s[0],genome:t.genome,total_gap:o});return i.render(),i});var l=this.circular_views[this.circular_views.length-1].radius_bounds[1],c=[l,l+this.label_arc_height];this.label_track_view=new Rt({el:r.append("g")[0],track:new Dt,radius_bounds:c,genome:t.genome,total_gap:o}),this.label_track_view.render()},add_track:function(t){var e=this.model.get("config").get_value("total_gap");if("DiagonalHeatmapTrack"===t.get("track_type")){var i=this.circular_views[0].radius_bounds,n=new Vt({el:St.select("g.tracks").append("g")[0],track:t,radius_bounds:i,genome:this.genome,total_gap:e});n.render(),this.chords_views.push(n)}else{var a=this.get_tracks_bounds();r.a.each(this.circular_views,function(t,e){t.update_radius_bounds(a[e])}),r.a.each(this.chords_views,function(t){t.update_radius_bounds(a[0])});var o=this.circular_views.length,s=new Pt({el:St.select("g.tracks").append("g")[0],track:t,radius_bounds:a[o],genome:this.genome,total_gap:e});s.render(),this.circular_views.push(s)}},remove_track:function(t,e,i){var n=this.circular_views[i.index];this.circular_views.splice(i.index,1),n.$el.remove();var a=this.get_tracks_bounds();r.a.each(this.circular_views,function(t,e){t.update_radius_bounds(a[e])})},update_track_bounds:function(){var t=this.get_tracks_bounds();r.a.each(this.circular_views,function(e,i){e.update_radius_bounds(t[i])}),r.a.each(this.chords_views,function(e){e.update_radius_bounds(t[0])})}}),Mt=c.a.View.extend({tagName:"g",initialize:function(t){this.bg_stroke="#ddd",this.loading_bg_fill="#ffc",this.bg_fill="#ddd",this.total_gap=t.total_gap,this.track=t.track,this.radius_bounds=t.radius_bounds,this.genome=t.genome,this.chroms_layout=this._chroms_layout(),this.data_bounds=[],this.scale=1,this.parent_elt=St.select(this.$el[0])},get_fill_color:function(){var t=this.track.get("config").get_value("block_color");return t||(t=this.track.get("config").get_value("color")),t},render:function(){var t=this.parent_elt,e=this.chroms_layout,i=St.svg.arc().innerRadius(this.radius_bounds[0]).outerRadius(this.radius_bounds[1]),n=t.selectAll("g").data(e).enter().append("svg:g").append("path").attr("d",i).attr("class","chrom-background").style("stroke",this.bg_stroke).style("fill",this.loading_bg_fill);n.append("title").text(function(t){return t.data.chrom});var o=this,s=o.track.get("data_manager"),r=!s||s.data_is_ready();a.a.when(r).then(function(){a.a.when(o._render_data(t)).then(function(){n.style("fill",o.bg_fill),o.render_labels()})})},render_labels:function(){},update_radius_bounds:function(t){this.radius_bounds=t;var e=St.svg.arc().innerRadius(this.radius_bounds[0]).outerRadius(this.radius_bounds[1]);this.parent_elt.selectAll("g>path.chrom-background").transition().duration(1e3).attr("d",e),this._transition_chrom_data(),this._transition_labels()},update_scale:function(t){var e=this.scale;if(this.scale=t,!(t<=e)){var i=this,n=new At;return this.parent_elt.selectAll("path.chrom-data").filter(function(t,e){return n.is_visible(this)}).each(function(e,n){var o,s=St.select(this),l=s.attr("chrom"),c=i.genome.get_chrom_region(l);i.track.get("data_manager").can_get_more_detailed_data(c)&&(o=i.track.get("data_manager").get_more_detailed_data(c,"Coverage",0,t),a.a.when(o).then(function(t){s.remove(),i._update_data_bounds();var e=r.a.find(i.chroms_layout,function(t){return t.data.chrom===l}),n=i.get_fill_color();i._render_chrom_data(i.parent_elt,e,t).style("stroke",n).style("fill",n)}))}),i}},_transition_chrom_data:function(){var t=this.track,e=this.chroms_layout,i=this.parent_elt.selectAll("g>path.chrom-data");if(i[0].length>0){var n=this;a.a.when(t.get("data_manager").get_genome_wide_data(this.genome)).then(function(a){var o=r.a.reject(r.a.map(a,function(t,i){var a=null,o=n._get_path_function(e[i],t);return o&&(a=o(t.data)),a}),function(t){return null===t}),s=t.get("config").get_value("color");i.each(function(t,e){St.select(this).transition().duration(1e3).style("stroke",s).style("fill",s).attr("d",o[e])})})}},_transition_labels:function(){},_update_data_bounds:function(t){this.data_bounds=t||this.get_data_bounds(this.track.get("data_manager").get_genome_wide_data(this.genome)),this._transition_chrom_data()},_render_data:function(t){var e=this,i=this.chroms_layout,n=this.track,o=a.a.Deferred();return a.a.when(n.get("data_manager").get_genome_wide_data(this.genome)).then(function(a){e.data_bounds=e.get_data_bounds(a),n.get("config").set_value("min_value",e.data_bounds[0],{silent:!0}),n.get("config").set_value("max_value",e.data_bounds[1],{silent:!0});var s=r.a.zip(i,a);r.a.each(s,function(i){var n=i[0],a=i[1];return e._render_chrom_data(t,n,a)});var l=e.get_fill_color();e.parent_elt.selectAll("path.chrom-data").style("stroke",l).style("fill",l),o.resolve(t)}),o},_render_chrom_data:function(t,e,i){},_get_path_function:function(t,e){},_chroms_layout:function(){var t=this.genome.get_chroms_info(),e=St.layout.pie().value(function(t){return t.len}).sort(null)(t),i=2*Math.PI*this.total_gap/t.length;return r.a.map(e,function(t,e){var n=t.endAngle-i;return t.endAngle=n>t.startAngle?n:t.startAngle,t})}}),Rt=Mt.extend({initialize:function(t){Mt.prototype.initialize.call(this,t),this.innerRadius=this.radius_bounds[0],this.radius_bounds[0]=this.radius_bounds[1],this.bg_stroke="#fff",this.bg_fill="#fff",this.min_arc_len=.05},_render_data:function(t){var e=this,i=t.selectAll("g");i.selectAll("path").attr("id",function(t){return"label-".concat(t.data.chrom)}),i.append("svg:text").filter(function(t){return t.endAngle-t.startAngle>e.min_arc_len}).attr("text-anchor","middle").append("svg:textPath").attr("class","chrom-label").attr("xlink:href",function(t){return"#label-".concat(t.data.chrom)}).attr("startOffset","25%").text(function(t){return t.data.chrom});var n=r.a.filter(this.chroms_layout,function(t){return t.endAngle-t.startAngle>e.min_arc_len});this.drawTicks(this.parent_elt,n,function(t){var i=(t.endAngle-t.startAngle)/t.value,n=St.range(0,t.value,25e6).map(function(n,a){return{radius:e.innerRadius,angle:n*i+t.startAngle,label:0===a?0:a%3?null:e.formatNum(n)}});return n.length<4&&(n[n.length-1].label=e.formatNum(Math.round((n[n.length-1].angle-t.startAngle)/i))),n},function(t){return t.angle>Math.PI?"rotate(180)translate(-16)":null})}});r.a.extend(Rt.prototype,jt);var Et=Mt.extend({initialize:function(t){Mt.prototype.initialize.call(this,t);var e=this.track.get("config");e.get("min_value").on("change:value",this._update_min_max,this),e.get("max_value").on("change:value",this._update_min_max,this),e.get("color").on("change:value",this._transition_chrom_data,this)},_update_min_max:function(){var t=this.track.get("config"),e=[t.get_value("min_value"),t.get_value("max_value")];this._update_data_bounds(e),this.parent_elt.selectAll(".min_max").text(function(t,i){return e[i]})},_quantile:function(t,e){return t.sort(St.ascending),St.quantile(t,e)},_render_chrom_data:function(t,e,i){var n=this._get_path_function(e,i);return n?t.datum(i.data).append("path").attr("class","chrom-data").attr("chrom",e.data.chrom).attr("d",n):null},_get_path_function:function(t,e){if("string"==typeof e||!e.data||0===e.data.length)return null;var i=St.scale.linear().domain(this.data_bounds).range(this.radius_bounds).clamp(!0),n=St.scale.linear().domain([0,e.data.length]).range([t.startAngle,t.endAngle]),a=St.svg.line.radial().interpolate("linear").radius(function(t){return i(t[1])}).angle(function(t,e){return n(e)});return St.svg.area.radial().interpolate(a.interpolate()).innerRadius(i(0)).outerRadius(a.radius()).angle(a.angle())},render_labels:function(){var t=this,e=this.drawTicks(this.parent_elt,[this.chroms_layout[0]],this._data_bounds_ticks_fn(),function(){return"rotate(90)"},!0).classed("min_max",!0);r.a.each(e,function(e){a()(e).click(function(){new $t.a.ConfigSettingCollectionView({collection:t.track.get("config")}).render_in_modal("Configure Track")})})},_transition_labels:function(){if(0!==this.data_bounds.length){var t=this,e=r.a.filter(this.chroms_layout,function(t){return t.endAngle-t.startAngle>.08}),i=r.a.filter(e,function(t,e){return e%3==0}),n=r.a.flatten(r.a.map(i,function(e){return t._data_bounds_ticks_fn()(e)}));this.parent_elt.selectAll("g.tick").data(n).transition().attr("transform",function(t){return"rotate(".concat(180*t.angle/Math.PI-90,")translate(").concat(t.radius,",0)")})}},_data_bounds_ticks_fn:function(){var t=this;return function(e){return[{radius:t.radius_bounds[0],angle:e.startAngle,label:t.formatNum(t.data_bounds[0])},{radius:t.radius_bounds[1],angle:e.startAngle,label:t.formatNum(t.data_bounds[1])}]}},get_data_bounds:function(t){}});r.a.extend(Et.prototype,jt);var Pt=Et.extend({get_data_bounds:function(t){var e=r.a.flatten(r.a.map(t,function(t){return t?r.a.map(t.data,function(t){return parseInt(t[1],10)||0}):0}));return[r.a.min(e),this._quantile(e,.98)||r.a.max(e)]}}),Vt=Mt.extend({render:function(){var t=this;a.a.when(t.track.get("data_manager").data_is_ready()).then(function(){a.a.when(t.track.get("data_manager").get_genome_wide_data(t.genome)).then(function(e){var i=[],n=t.genome.get_chroms_info();r.a.each(e,function(e,a){var o=n[a].chrom,s=r.a.map(e.data,function(e){var i=t._get_region_angle(o,e[1]),n=t._get_region_angle(e[3],e[4]);return{source:{startAngle:i,endAngle:i+.01},target:{startAngle:n,endAngle:n+.01}}});i=i.concat(s)}),t.parent_elt.append("g").attr("class","chord").selectAll("path").data(i).enter().append("path").style("fill",t.get_fill_color()).attr("d",St.svg.chord().radius(t.radius_bounds[0])).style("opacity",1)})})},update_radius_bounds:function(t){this.radius_bounds=t,this.parent_elt.selectAll("path").transition().attr("d",St.svg.chord().radius(this.radius_bounds[0]))},_get_region_angle:function(t,e){var i=r.a.find(this.chroms_layout,function(e){return e.data.chrom===t});return i.endAngle-(i.endAngle-i.startAngle)*(i.data.len-e)/i.data.len}}),Lt={GalaxyApp:c.a.View.extend({initialize:function(){p.a.cssLoadFile("static/style/circster.css");var t=new Tt.a.Genome(window.galaxy_config.app.genome),e=new Tt.a.GenomeVisualization(window.galaxy_config.app.viz_config);e.get("config").add([{key:"arc_dataset_height",label:"Arc Dataset Height",type:"int",value:25,view:"circster"},{key:"track_gap",label:"Gap Between Tracks",type:"int",value:5,view:"circster"},{key:"total_gap",label:"Gap [0-1]",type:"float",value:.4,view:"circster",hidden:!0}]),new It({el:a()("#center .unified-panel-body"),genome:t,model:e}).render(),a()("#center .unified-panel-header-inner").append("".concat(window.galaxy_config.app.viz_config.title," ").concat(window.galaxy_config.app.viz_config.dbkey));var i=Ot.a.create_icon_buttons_menu([{icon_class:"plus-button",title:h()("Add tracks"),on_click:function(){Tt.a.select_datasets({dbkey:e.get("dbkey")},function(t){e.add_tracks(t)})}},{icon_class:"gear",title:h()("Settings"),on_click:function(){new $t.a.ConfigSettingCollectionView({collection:e.get("config")}).render_in_modal("Configure Visualization")}},{icon_class:"disk--arrow",title:h()("Save"),on_click:function(){var t=Object(o.a)();t.modal.show({title:h()("Saving..."),body:"progress"}),a.a.ajax({url:"".concat(Object(d.getAppRoot)(),"visualization/save"),type:"POST",dataType:"json",data:{id:e.get("vis_id"),title:e.get("title"),dbkey:e.get("dbkey"),type:"trackster",vis_json:JSON.stringify(e)}}).success(function(i){t.modal.hide(),e.set("vis_id",i.vis_id)}).error(function(){t.modal.show({title:h()("Could Not Save"),body:"Could not save visualization. Please try again later.",buttons:{Cancel:function(){t.modal.hide()}}})})}},{icon_class:"cross-circle",title:h()("Close"),on_click:function(){window.top.location="".concat(Object(d.getAppRoot)(),"visualizations/list")}}],{tooltip_config:{placement:"bottom"}});i.$el.attr("style","float: right"),a()("#center .unified-panel-header-inner").append(i.$el),a()(".menu-button").tooltip({placement:"bottom"})}})},zt=i(22),Nt=c.a.View.extend({className:"UserMenuBase",isAcceptableValue:function(t,e,i){var n,a=t.val(),o=t.attr("displayLabel")||t.attr("id").replace("phyloViz","");return n=a,isNaN(parseFloat(n))||!isFinite(n)?(alert("".concat(o," is not a number!")),!1):a>i?(alert("".concat(o," is too large.")),!1):!(a<e)||(alert("".concat(o," is too small.")),!1)},hasIllegalJsonCharacters:function(t){return-1!==t.val().search(/"|'|\\/)&&(alert("Named fields cannot contain these illegal characters: double quote(\"), single guote('), or back slash(\\). "),!0)}});function Ft(){var t=this,e=St.layout.hierarchy().sort(null).value(null),i=360,n="Linear",a=18,o=200,s=0,r=.5,l=50;return t.leafHeight=function(e){return void 0===e?a:(a=e,t)},t.layoutMode=function(e){return void 0===e?n:(n=e,t)},t.layoutAngle=function(e){return void 0===e?i:isNaN(e)||e<0||e>360?t:(i=e,t)},t.separation=function(e){return void 0===e?o:(o=e,t)},t.links=function(t){return St.layout.tree().links(t)},t.nodes=function(c,d){"[object Array]"===toString.call(c)&&(c=c[0]);var u=e.call(t,c,d),h=[],p=0,f=0;return window._d=c,window._nodes=u,u.forEach(function(t){p=t.depth>p?t.depth:p,h.push(t)}),h.forEach(function(t){t.children||(f+=1,t.depth=p)}),a="Circular"===n?i/f:a,s=0,function t(e,i,n,a){var c=e.children;var d=0;var u=e.dist||r;u=u>1?1:u;e.dist=u;e.y0=null!==a?a.y0+u*o:l;c?(c.forEach(function(a){a.parent=e,d+=t(a,i,n,e)}),e.x0=d/c.length):(e.x0=s*n,s+=1);e.x=e.x0;e.y=e.y0;return e.x0}(h[0],p,a,null),h},t}var Ht=Tt.a.Visualization.extend({defaults:{layout:"Linear",separation:250,leafHeight:18,type:"phyloviz",title:h()("Title"),scaleFactor:1,translate:[0,0],fontSize:12,selectedNode:null,nodeAttrChangedTime:0},initialize:function(t){this.set("dataset",new zt.a({id:t.dataset_id}))},root:{},toggle:function(t){void 0!==t&&(t.children?(t._children=t.children,t.children=null):(t.children=t._children,t._children=null))},toggleAll:function(t){t.children&&0!==t.children.length&&(t.children.forEach(this.toggleAll),this.toggle(t))},getData:function(){return this.root},save:function(){!function t(e){delete e.parent;e._selected&&delete e._selected;e.children&&e.children.forEach(t);e._children&&e._children.forEach(t)}(this.root);var t=a.a.extend(!0,{},this.attributes);return t.selectedNode=null,vt("Saving to Galaxy","progress"),a.a.ajax({url:this.url(),type:"POST",dataType:"json",data:{config:JSON.stringify(t),type:"phyloviz"},success:function(t){gt()}})}}),Ut=c.a.View.extend({defaults:{nodeRadius:4.5},stdInit:function(t){this.model.on("change:separation change:leafHeight change:fontSize change:nodeAttrChangedTime",this.updateAndRender,this),this.vis=t.vis,this.i=0,this.maxDepth=-1,this.width=t.width,this.height=t.height},updateAndRender:function(t){t=t||this.model.root,this.renderNodes(t),this.renderLinks(t),this.addTooltips()},renderLinks:function(t){var e=this.vis.selectAll("g.completeLink").data(this.tree.links(this.nodes),function(t){return t.target.id}),i=function(t){t.pos0="".concat(t.source.y0," ").concat(t.source.x0),t.pos1="".concat(t.source.y0," ").concat(t.target.x0),t.pos2="".concat(t.target.y0," ").concat(t.target.x0)};e.enter().insert("svg:g","g.node").attr("class","completeLink").append("svg:path").attr("class","link").attr("d",function(t){return i(t),"M ".concat(t.pos0," L ").concat(t.pos1)}),e.transition().duration(500).select("path.link").attr("d",function(t){return i(t),"M ".concat(t.pos0," L ").concat(t.pos1," L ").concat(t.pos2)}),e.exit().remove()},selectNode:function(t){St.selectAll("g.node").classed("selectedHighlight",function(e){return t.id===e.id&&(t._selected?(delete t._selected,!1):(t._selected=!0,!0))}),this.model.set("selectedNode",t),a()("#phyloVizSelectedNodeName").val(t.name),a()("#phyloVizSelectedNodeDist").val(t.dist),a()("#phyloVizSelectedNodeAnnotation").val(t.annotation||"")},addTooltips:function(){a()(".tooltip").remove(),a()(".node").attr("data-original-title",function(){var t=this.__data__,e=t.annotation||"None";return t?"".concat(t.name?"".concat(t.name,"<br/>"):"","Dist: ").concat(t.dist," <br/>Annotation1: ").concat(e).concat(t.bootstrap?"<br/>Confidence level: ".concat(Math.round(100*t.bootstrap)):""):""}).tooltip({placement:"top",trigger:"hover"})}}).extend({initialize:function(t){this.margins=t.margins,this.layoutMode="Linear",this.stdInit(t),this.layout(),this.updateAndRender(this.model.root)},layout:function(){this.tree=(new Ft).layoutMode("Linear"),this.diagonal=St.svg.diagonal().projection(function(t){return[t.y,t.x]})},renderNodes:function(t){var e=this,i="".concat(e.model.get("fontSize"),"px");e.tree.separation(e.model.get("separation")).leafHeight(e.model.get("leafHeight"));var n=e.tree.separation(e.model.get("separation")).nodes(e.model.root),a=e.vis.selectAll("g.node").data(n,function(t){return t.name+t.id||(t.id=++e.i)});e.nodes=n,e.duration=500;var o=a.enter().append("svg:g").attr("class","node").on("dblclick",function(){St.event.stopPropagation()}).on("click",function(t){if(St.event.altKey)e.selectNode(t);else{if(t.children&&0===t.children.length)return;e.model.toggle(t),e.updateAndRender(t)}});"[object Array]"===toString.call(t)&&(t=t[0]),o.attr("transform",function(e){return"translate(".concat(t.y0,",").concat(t.x0,")")}),o.append("svg:circle").attr("r",1e-6).style("fill",function(t){return t._children?"lightsteelblue":"#fff"}),o.append("svg:text").attr("class","nodeLabel").attr("x",function(t){return t.children||t._children?-10:10}).attr("dy",".35em").attr("text-anchor",function(t){return t.children||t._children?"end":"start"}).style("fill-opacity",1e-6);var s=a.transition().duration(500);s.attr("transform",function(t){return"translate(".concat(t.y,",").concat(t.x,")")}),s.select("circle").attr("r",e.defaults.nodeRadius).style("fill",function(t){return t._children?"lightsteelblue":"#fff"}),s.select("text").style("fill-opacity",1).style("font-size",i).text(function(t){return t.name&&""!==t.name?t.name:t.bootstrap?Math.round(100*t.bootstrap):""});var r=a.exit().transition().duration(500).remove();r.select("circle").attr("r",1e-6),r.select("text").style("fill-opacity",1e-6),n.forEach(function(t){t.x0=t.x,t.y0=t.y})}}),Bt=c.a.View.extend({className:"phyloviz",initialize:function(t){var e=this;e.MIN_SCALE=.05,e.MAX_SCALE=5,e.MAX_DISPLACEMENT=500,e.margins=[10,60,10,80],e.width=a()("#PhyloViz").width(),e.height=a()("#PhyloViz").height(),e.radius=e.width,e.data=t.data,a()(window).resize(function(){e.width=a()("#PhyloViz").width(),e.height=a()("#PhyloViz").height(),e.render()}),e.phyloTree=new Ht(t.config),e.phyloTree.root=e.data,e.zoomFunc=St.behavior.zoom().scaleExtent([e.MIN_SCALE,e.MAX_SCALE]),e.zoomFunc.translate(e.phyloTree.get("translate")),e.zoomFunc.scale(e.phyloTree.get("scaleFactor")),e.navMenu=new qt(e),e.settingsMenu=new Gt({phyloTree:e.phyloTree}),e.nodeSelectionView=new Wt({phyloTree:e.phyloTree}),e.search=new Jt,setTimeout(function(){e.zoomAndPan()},1e3)},render:function(){var t=this;a()("#PhyloViz").empty(),t.mainSVG=St.select("#PhyloViz").append("svg:svg").attr("width",t.width).attr("height",t.height).attr("pointer-events","all").call(t.zoomFunc.on("zoom",function(){t.zoomAndPan()})),t.boundingRect=t.mainSVG.append("svg:rect").attr("class","boundingRect").attr("width",t.width).attr("height",t.height).attr("stroke","black").attr("fill","white"),t.vis=t.mainSVG.append("svg:g").attr("class","vis"),t.layoutOptions={model:t.phyloTree,width:t.width,height:t.height,vis:t.vis,margins:t.margins},a()("#title").text("Phylogenetic Tree from ".concat(t.phyloTree.get("title"),":")),new Ut(t.layoutOptions)},zoomAndPan:function(t){var e,i;void 0!==t&&(e=t.zoom,i=t.translate);var n,a=this.zoomFunc.scale(),o=this.zoomFunc.translate(),s="";switch(e){case"reset":a=1,o=[0,0];break;case"+":a*=1.1;break;case"-":a*=.9;break;default:"number"==typeof e?a=e:null!==St.event&&(a=St.event.scale)}if(!(a<this.MIN_SCALE||a>this.MAX_SCALE)){if(this.zoomFunc.scale(a),n="translate(".concat(this.margins[3],",").concat(this.margins[0],") scale(").concat(a,")"),null!==St.event)s="translate(".concat(St.event.translate,")");else{if(void 0!==i){var r=i.split(",")[0],l=i.split(",")[1];isNaN(r)||isNaN(l)||(o=[o[0]+parseFloat(r),o[1]+parseFloat(l)])}this.zoomFunc.translate(o),s="translate(".concat(o,")")}this.phyloTree.set("scaleFactor",a),this.phyloTree.set("translate",o),this.vis.attr("transform",s+n)}},reloadViz:function(){var t=this,e=a()("#phylovizNexSelector :selected").val();a.a.getJSON(t.phyloTree.get("dataset").url(),{tree_index:e,data_type:"raw_data"},function(e){t.data=e.data,t.config=e,t.render()})}}),qt=c.a.View.extend({initialize:function(t){var e=this;e.phylovizView=t,a()("#panelHeaderRightBtns").empty(),a()("#phyloVizNavBtns").empty(),a()("#phylovizNexSelector").off(),e.initNavBtns(),e.initRightHeaderBtns(),a()("#phylovizNexSelector").off().on("change",function(){e.phylovizView.reloadViz()})},initRightHeaderBtns:function(){var t=this,e=Ot.a.create_icon_buttons_menu([{icon_class:"gear",title:h()("PhyloViz Settings"),on_click:function(){a()("#SettingsMenu").show(),t.settingsMenu.updateUI()}},{icon_class:"disk",title:h()("Save visualization"),on_click:function(){var e=a()("#phylovizNexSelector option:selected").text();e&&t.phylovizView.phyloTree.set("title",e),t.phylovizView.phyloTree.save()}},{icon_class:"chevron-expand",title:"Search / Edit Nodes",on_click:function(){a()("#nodeSelectionView").show()}},{icon_class:"information",title:h()("Phyloviz Help"),on_click:function(){window.open("https://galaxyproject.org/learn/visualization/phylogenetic-tree/")}}],{tooltip_config:{placement:"bottom"}});a()("#panelHeaderRightBtns").append(e.$el)},initNavBtns:function(){var t=this,e=Ot.a.create_icon_buttons_menu([{icon_class:"zoom-in",title:h()("Zoom in"),on_click:function(){t.phylovizView.zoomAndPan({zoom:"+"})}},{icon_class:"zoom-out",title:h()("Zoom out"),on_click:function(){t.phylovizView.zoomAndPan({zoom:"-"})}},{icon_class:"arrow-circle",title:"Reset Zoom/Pan",on_click:function(){t.phylovizView.zoomAndPan({zoom:"reset"})}}],{tooltip_config:{placement:"bottom"}});a()("#phyloVizNavBtns").append(e.$el)}}),Gt=Nt.extend({className:"Settings",initialize:function(t){var e=this;e.phyloTree=t.phyloTree,e.el=a()("#SettingsMenu"),e.inputs={separation:a()("#phyloVizTreeSeparation"),leafHeight:a()("#phyloVizTreeLeafHeight"),fontSize:a()("#phyloVizTreeFontSize")},a()("#settingsCloseBtn").off().on("click",function(){e.el.hide()}),a()("#phylovizResetSettingsBtn").off().on("click",function(){e.resetToDefaults()}),a()("#phylovizApplySettingsBtn").off().on("click",function(){e.apply()})},apply:function(){var t=this;t.isAcceptableValue(t.inputs.separation,50,2500)&&t.isAcceptableValue(t.inputs.leafHeight,5,30)&&t.isAcceptableValue(t.inputs.fontSize,5,20)&&a.a.each(t.inputs,function(e,i){t.phyloTree.set(e,i.val())})},updateUI:function(){var t=this;a.a.each(t.inputs,function(e,i){i.val(t.phyloTree.get(e))})},resetToDefaults:function(){a()(".tooltip").remove();var t=this;a.a.each(t.phyloTree.defaults,function(e,i){t.phyloTree.set(e,i)}),t.updateUI()},render:function(){}}),Wt=Nt.extend({className:"Settings",initialize:function(t){var e,i=this;i.el=a()("#nodeSelectionView"),i.phyloTree=t.phyloTree,i.UI={enableEdit:a()("#phylovizEditNodesCheck"),saveChanges:a()("#phylovizNodeSaveChanges"),cancelChanges:a()("#phylovizNodeCancelChanges"),name:a()("#phyloVizSelectedNodeName"),dist:a()("#phyloVizSelectedNodeDist"),annotation:a()("#phyloVizSelectedNodeAnnotation")},i.valuesOfConcern={name:null,dist:null,annotation:null},a()("#nodeSelCloseBtn").off().on("click",function(){i.el.hide()}),i.UI.saveChanges.off().on("click",function(){i.updateNodes()}),i.UI.cancelChanges.off().on("click",function(){i.cancelChanges()}),(e=a.a).fn.enable=function(t){return e(this).each(function(){t?e(this).removeAttr("disabled"):e(this).attr("disabled","disabled")})},i.UI.enableEdit.off().on("click",function(){i.toggleUI()})},toggleUI:function(){var t=this,e=t.UI.enableEdit.is(":checked");e||t.cancelChanges(),a.a.each(t.valuesOfConcern,function(i,n){t.UI[i].enable(e)}),e?(t.UI.saveChanges.show(),t.UI.cancelChanges.show()):(t.UI.saveChanges.hide(),t.UI.cancelChanges.hide())},cancelChanges:function(){var t=this,e=t.phyloTree.get("selectedNode");e&&a.a.each(t.valuesOfConcern,function(i,n){t.UI[i].val(e[i])})},updateNodes:function(){var t=this,e=t.phyloTree.get("selectedNode");if(e){if(!t.isAcceptableValue(t.UI.dist,0,1)||t.hasIllegalJsonCharacters(t.UI.name)||t.hasIllegalJsonCharacters(t.UI.annotation))return;a.a.each(t.valuesOfConcern,function(i,n){e[i]=t.UI[i].val()}),t.phyloTree.set("nodeAttrChangedTime",new Date)}else alert("No node selected")}}),Jt=Nt.extend({initialize:function(){var t=this;a()("#phyloVizSearchBtn").on("click",function(){var e=a()("#phyloVizSearchTerm"),i=a()("#phyloVizSearchCondition").val().split("-"),n=i[0],o=i[1];t.hasIllegalJsonCharacters(e),"dist"===n&&t.isAcceptableValue(e,0,1),t.searchTree(n,o,e.val())})},searchTree:function(t,e,i){St.selectAll("g.node").classed("searchHighlight",function(n){var a=n[t];if(null!=a)if("dist"===t)switch(e){case"greaterEqual":return a>=+i;case"lesserEqual":return a<=+i;default:return}else if("name"===t||"annotation"===t)return-1!==a.toLowerCase().indexOf(i.toLowerCase())})}}),Yt=i(43),Kt=i(41),Qt=c.a.Model.extend({defaults:{inputs:null,values:null}}),Xt=c.a.Model.extend({defaults:{tool:null,tree_data:null},initialize:function(t){var e=this;this.get("tool").get("inputs").each(function(t){t.on("change:min change:max change:num_samples",function(t){t.get("in_ptree")&&e.set_tree_data()},e),t.on("change:in_ptree",function(t){t.get("in_ptree")?e.add_param(t):e.remove_param(t),e.set_tree_data()},e)}),t.config&&r.a.each(t.config,function(t){var i=e.get("tool").get("inputs").find(function(e){return e.get("name")===t.name});e.add_param(i),i.set(t)})},add_param:function(t){t.get("ptree_index")||(t.set("in_ptree",!0),t.set("ptree_index",this.get_tree_params().length))},remove_param:function(t){t.set("in_ptree",!1),t.set("ptree_index",null),r()(this.get_tree_params()).each(function(t,e){t.set("ptree_index",e+1)})},set_tree_data:function(){var t=r.a.map(this.get_tree_params(),function(t){return{param:t,samples:t.get_samples()}}),e=0;this.set("tree_data",{name:"Root",id:e++,children:0!==t.length?function t(i,n){var a=i[n],o=a.param,s=a.samples;return i.length-1===n?r.a.map(s,function(t){return{id:e++,name:t,param:o,value:t}}):r.a.map(s,function(a){return{id:e++,name:a,param:o,value:a,children:t(i,n+1)}})}(t,0):null})},get_tree_params:function(){return r()(this.get("tool").get("inputs").where({in_ptree:!0})).sortBy(function(t){return t.get("ptree_index")})},get_num_leaves:function(){return this.get_tree_params().reduce(function(t,e){return t*e.get_samples().length},1)},get_node_settings:function(t){var e=this.get("tool").get_inputs_dict(),i=t.parent;if(i)for(;0!==i.depth;)e[i.param.get("name")]=i.value,i=i.parent;var n=this,a=function t(e,i){return e.param&&(i[e.param.get("name")]=e.value),e.children?r.a.flatten(r.a.map(e.children,function(e){return t(e,r.a.clone(i))})):new Qt({inputs:n.get("tool").get("inputs"),values:i})}(t,e);return r.a.isArray(a)||(a=[a]),a},get_connected_nodes:function(t){for(var e=[],i=t.parent;i;)e.push(i),i=i.parent;return r.a.flatten([e,function t(e){return e.children?r.a.flatten([e,r.a.map(e.children,function(e){return t(e)})]):e}(t)])},get_leaf:function(t){for(var e,i=this.get("tree_data");i.children;)e=i.children,i=r.a.find(e,function(e){return t[e.param.get("name")]===e.value});return i},toJSON:function(){return this.get_tree_params().map(function(t){return{name:t.get("name"),min:t.get("min"),max:t.get("max"),num_samples:t.get("num_samples")}})}}),Zt=c.a.Model.extend({defaults:{track:null,mode:"Pack",settings:null,regions:null},initialize:function(t){if(this.set("regions",t.regions),t.track){var e=r.a.extend({data_url:"".concat(Object(d.getAppRoot)(),"dummy1"),converted_datasets_state_url:"".concat(Object(d.getAppRoot)(),"dummy2")},t.track);this.set("track",Yt.a.object_from_template(e,{},null))}},same_settings:function(t){var e=this.get("settings"),i=t.get("settings");for(var n in e)if(!i[n]||e[n]!==i[n])return!1;return!0},toJSON:function(){return{track:this.get("track").to_dict(),settings:this.get("settings"),regions:this.get("regions")}}}),te=c.a.Collection.extend({model:Zt}),ee=Tt.a.Visualization.extend({defaults:r.a.extend({},Tt.a.Visualization.prototype.defaults,{dataset:null,tool:null,parameter_tree:null,regions:null,tracks:null,default_mode:"Pack"}),initialize:function(t){this.set("dataset",new zt.a(t.dataset)),this.set("tool",new Kt.a.Tool(t.tool)),this.set("regions",new Tt.a.GenomeRegionCollection(t.regions)),this.set("tracks",new te(t.tracks));var e=this.get("tool");this.set("tool_with_samplable_inputs",e),e.remove_inputs(["data","hidden_data","conditional","text"]),this.set("parameter_tree",new Xt({tool:e,config:t.tree_config}))},add_track:function(t){this.get("tracks").add(t)},toJSON:function(){return{id:this.get("id"),title:"Parameter exploration for dataset '".concat(this.get("dataset").get("name"),"'"),type:"sweepster",dataset_id:this.get("dataset").id,tool_id:this.get("tool").id,regions:this.get("regions").toJSON(),tree_config:this.get("parameter_tree").toJSON(),tracks:this.get("tracks").toJSON()}}}),ie=c.a.View.extend({tagName:"tr",TILE_LEN:250,initialize:function(t){this.canvas_manager=t.canvas_manager,this.render(),this.model.on("change:track change:mode",this.draw_tiles,this)},render:function(){var t=this.model.get("settings"),e=t.get("values"),i=a()("<td/>").addClass("settings").appendTo(this.$el),n=a()("<div/>").addClass("track-info").hide().appendTo(i);n.append(a()("<div/>").css("font-weight","bold").text("Track Settings")),t.get("inputs").each(function(t){n.append("".concat(t.get("label"),": ").concat(e[t.get("name")],"<br/>"))});var o=this;a()("<button/>").appendTo(n).text("Run on complete dataset").click(function(){n.toggle(),o.trigger("run_on_dataset",t)});var s=Ot.a.create_icon_buttons_menu([{title:h()("Settings"),icon_class:"gear track-settings",on_click:function(){n.toggle()}},{title:h()("Remove"),icon_class:"cross-circle",on_click:function(){o.$el.remove(),a()(".tooltip").remove()}}]);i.prepend(s.$el),this.model.get("regions").each(function(){o.$el.append(a()("<td/>").addClass("tile").html(a()("<img/>").attr("src","".concat(Object(d.getAppRoot)(),"images/loading_large_white_bg.gif"))))}),this.model.get("track")&&this.draw_tiles()},draw_tiles:function(){var t=this,e=this.model.get("track"),i=this.model.get("regions"),n=this.$el.find("td.tile");e&&a.a.when(e.data_manager.data_is_ready()).then(function(o){i.each(function(i,o){var s=i.length()/t.TILE_LEN,r=1/s,l=t.model.get("mode");a.a.when(e.data_manager.get_data(i,l,s,{})).then(function(s){var c=t.canvas_manager.new_canvas();c.width=t.TILE_LEN,c.height=e.get_canvas_height(s,l,r,c.width),e.draw_tile(s,c.getContext("2d"),l,i,r),a()(n[o]).empty().append(c)})})})}}),ne=c.a.View.extend({number_input_template:'<div class="form-row-input sweep"><input class="min" type="text" size="6" value="<%= min %>"> - <input class="max" type="text" size="6" value="<%= max %>"> samples: <input class="num_samples" type="text" size="1" value="<%= num_samples %>"></div>',select_input_template:'<div class="form-row-input sweep"><%= options %></div>',initialize:function(t){this.$el=t.tool_row,this.render()},render:function(){var t=this.model,e=this.$el.find(".form-row-input"),i=null;if(e.find(":input").change(function(){t.set("value",a()(this).val())}),t instanceof Kt.a.IntegerToolParameter)i=a()(r.a.template(this.number_input_template)(this.model.toJSON()));else if(t instanceof Kt.a.SelectToolParameter){var n=r.a.map(this.$el.find("select option"),function(t){return a()(t).val()}).join(", ");i=a()(r.a.template(this.select_input_template)({options:n}))}i.insertAfter(e);var o=this,s=Ot.a.create_icon_buttons_menu([{title:h()("Add parameter to tree"),icon_class:"plus-button",on_click:function(){t.set("in_ptree",!0),e.hide(),i.show(),a()(this).hide(),o.$el.find(".icon-button.toggle").show()}},{title:h()("Remove parameter from tree"),icon_class:"toggle",on_click:function(){t.set("in_ptree",!1),i.hide(),e.show(),a()(this).hide(),o.$el.find(".icon-button.plus-button").show()}}],{});this.$el.prepend(s.$el),t.get("in_ptree")?(e.hide(),o.$el.find(".icon-button.plus-button").hide()):(o.$el.find(".icon-button.toggle").hide(),i.hide()),r.a.each(["min","max","num_samples"],function(e){i.find(".".concat(e)).change(function(){t.set(e,parseFloat(a()(this).val()))})})}}),ae=c.a.View.extend({className:"tree-design",initialize:function(t){this.render()},render:function(){var t=new Kt.a.ToolFormView({model:this.model.get("tool")});t.render(),this.$el.append(t.$el);var e=this.model.get("tool").get("inputs");this.$el.find(".form-row").not(".form-actions").each(function(t){new ne({model:e.at(t),tool_row:a()(this)})})}}),oe=c.a.View.extend({className:"tool-parameter-tree",initialize:function(t){this.model.on("change:tree_data",this.render,this)},render:function(){this.$el.children().remove();var t=this.model.get_tree_params();if(t.length){this.width=100*(2+t.length),this.height=15*this.model.get_num_leaves();var e=this,i=St.layout.cluster().size([this.height,this.width-160]),n=St.svg.diagonal().projection(function(t){return[t.y,t.x]}),o=i.nodes(this.model.get("tree_data")),s=r.a.uniq(r.a.pluck(o,"y"));r.a.each(t,function(t,i){var n=s[i+1],o=a()("#center").position().left;e.$el.append(a()("<div>").addClass("label").text(t.get("label")).css("left",n+o))});var l=St.select(this.$el[0]).append("svg").attr("width",this.width).attr("height",this.height+30).append("g").attr("transform","translate(40, 20)");l.selectAll("path.link").data(i.links(o)).enter().append("path").attr("class","link").attr("d",n);var c=l.selectAll("g.node").data(o).enter().append("g").attr("class","node").attr("transform",function(t){return"translate(".concat(t.y,",").concat(t.x,")")}).on("mouseover",function(t){var i=r.a.pluck(e.model.get_connected_nodes(t),"id");c.filter(function(t){return void 0!==r.a.find(i,function(e){return e===t.id})}).style("fill","#f00")}).on("mouseout",function(){c.style("fill","#000")});c.append("circle").attr("r",9),c.append("text").attr("dx",function(t){return t.children?-12:12}).attr("dy",3).attr("text-anchor",function(t){return t.children?"end":"start"}).text(function(t){return t.name})}}}),se=c.a.View.extend({className:"Sweepster",helpText:"<div><h4>Getting Started</h4><ol><li>Create a parameter tree by using the icons next to the tool's parameter names to add or remove parameters.<li>Adjust the tree by using parameter inputs to select min, max, and number of samples<li>Run the tool with different settings by clicking on tree nodes</ol></div>",initialize:function(t){this.canvas_manager=new Tt.a.CanvasManager(this.$el.parents("body")),this.tool_param_tree_view=new oe({model:this.model.get("parameter_tree")}),this.track_collection_container=a()("<table/>").addClass("tracks"),this.model.get("parameter_tree").on("change:tree_data",this.handle_node_clicks,this);var e=this;this.model.get("tracks").each(function(t){t.get("track").view=e}),this.config=$t.a.ConfigSettingCollection.from_models_and_saved_values([{key:"name",label:"Name",type:"text",default_value:""},{key:"a_color",label:"A Color",type:"color",default_value:"#FF0000"},{key:"c_color",label:"C Color",type:"color",default_value:"#00FF00"},{key:"g_color",label:"G Color",type:"color",default_value:"#0000FF"},{key:"t_color",label:"T Color",type:"color",default_value:"#FF00FF"},{key:"n_color",label:"N Color",type:"color",default_value:"#AAAAAA"},{key:"block_color",label:"Block color",type:"color"},{key:"reverse_strand_color",label:"Antisense strand color",type:"color"}],{})},render:function(){var t=new ae({model:this.model.get("parameter_tree")});a()("#left").append(t.$el);var e=this,i=e.model.get("regions"),n=a()("<tr/>").appendTo(this.track_collection_container);i.each(function(t){n.append(a()("<th>").text(t.toString()))}),n.children().first().attr("colspan",2);var o=a()("<div>").addClass("tiles");a()("#right").append(o.append(this.track_collection_container)),e.model.get("tracks").each(function(t){e.add_track(t)});var s=a()(this.helpText).addClass("help"),l=Ot.a.create_icon_buttons_menu([{title:h()("Close"),icon_class:"cross-circle",on_click:function(){a()(".tooltip").remove(),s.remove()}}]);s.prepend(l.$el.css("float","right")),a()("#center").append(s),this.tool_param_tree_view.render(),a()("#center").append(this.tool_param_tree_view.$el),this.handle_node_clicks();var c=Ot.a.create_icon_buttons_menu([{icon_class:"chevron-expand",title:"Set display mode"},{icon_class:"cross-circle",title:h()("Close"),on_click:function(){window.top.location="".concat(Object(d.getAppRoot)(),"visualizations/list")}}],{tooltip_config:{placement:"bottom"}}),u={};r.a.each(["Squish","Pack"],function(t){u[t]=function(){e.model.set("default_mode",t),e.model.get("tracks").each(function(e){e.set("mode",t)})}}),Object(wt.b)(c.$el.find(".chevron-expand"),u),c.$el.attr("style","float: right"),a()("#right .unified-panel-header-inner").append(c.$el)},get_base_color:function(t){return this.config.get_value("".concat(t.toLowerCase(),"_color"))||this.config.get_value("n_color")},run_tool_on_dataset:function(t){var e=this.model.get("tool"),i=e.get("name"),n=this.model.get("dataset");e.set_input_values(t.get("values")),a.a.when(e.rerun(n)).then(function(t){}),_t("Running ".concat(i," on complete dataset"),"".concat(i," is running on dataset '").concat(n.get("name"),"'. Outputs are in the dataset's history."),{Ok:function(){gt()}})},add_track:function(t){var e=this,i=this.model.get("parameter_tree");e.model.add_track(t);var n=new ie({model:t,canvas_manager:e.canvas_manager});return n.on("run_on_dataset",e.run_tool_on_dataset,e),e.track_collection_container.append(n.$el),n.$el.hover(function(){var n=i.get_leaf(t.get("settings").get("values")),a=r.a.pluck(i.get_connected_nodes(n),"id");St.select(e.tool_param_tree_view.$el[0]).selectAll("g.node").filter(function(t){return void 0!==r.a.find(a,function(e){return e===t.id})}).style("fill","#f00")},function(){St.select(e.tool_param_tree_view.$el[0]).selectAll("g.node").style("fill","#000")}),t},handle_node_clicks:function(){var t=this,e=this.model.get("parameter_tree"),i=this.model.get("regions");St.select(this.tool_param_tree_view.$el[0]).selectAll("g.node").on("click",function(n,o){var s=t.model.get("tool"),l=t.model.get("dataset"),c=e.get_node_settings(n),d=a.a.Deferred();c.length>=10?_t("Whoa there cowboy!","You clicked on a node to try ".concat(t.model.get("tool").get("name")," with ").concat(c.length," different combinations of settings. You can only run 10 jobs at a time."),{Ok:function(){gt(),d.resolve(!1)}}):d.resolve(!0),a.a.when(d).then(function(e){if(e){var n=r.a.map(c,function(e){var n=new Zt({settings:e,regions:i,mode:t.model.get("default_mode")});return t.add_track(n),n});r.a.each(n,function(e,n){setTimeout(function(){s.set_input_values(e.get("settings").get("values")),a.a.when(s.rerun(l,i)).then(function(i){var n=i.first(),a=n.get("track_config");a.dataset=n,a.tool=null,a.prefs=t.config.to_key_value_dict();var o=Yt.a.object_from_template(a,t,null);o.init_for_tool_data(),e.set("track",o)})},1e4*n)})}})})}}),re=i(7),le=function(t,e){return function(i,n){return i.get("type")===n.get("type")?i.has(t)||n.has(t)?i.has(t)?n.has(t)?i.get(t).toLowerCase()>n.get(t).toLowerCase()?"asc"===e?1:-1:n.get(t).toLowerCase()>i.get(t).toLowerCase()?"asc"===e?-1:1:0:-1:1:0:"folder"===i.get("type")?-1:1}},ce=function(t,e){return function(i,n){return i.get(t).toLowerCase()>n.get(t).toLowerCase()?"asc"===e?1:-1:n.get(t).toLowerCase()>i.get(t).toLowerCase()?"asc"===e?-1:1:0}},de=c.a.Model.extend({urlRoot:"".concat(Object(d.getAppRoot)(),"api/libraries/"),isVisible:function(t){var e=!0;return!t&&this.get("deleted")&&(e=!1),e}}),ue=c.a.Collection.extend({urlRoot:"".concat(Object(d.getAppRoot)(),"api/libraries"),model:de,initialize:function(t){t=t||{}},search:function(t){if(""==t)return this;var e=t.toLowerCase();return this.filter(function(t){return-1!==t.get("name").toLowerCase().indexOf(e)})},getVisible:function(t,e){return e=e||[],new ue(this.filter(function(e){return e.isVisible(t)}))},sortLibraries:function(t,e){this.comparator=ce(t,e),this.sort()}}),he=c.a.Model.extend({}),pe=he.extend({urlRoot:"".concat(Object(d.getAppRoot)(),"api/libraries/datasets/")}),fe=he.extend({urlRoot:"".concat(Object(d.getAppRoot)(),"api/folders/")}),me=c.a.Collection.extend({model:he,sortFolder:function(t,e){this.comparator=le(t,e),this.sort()}}),ge=c.a.Model.extend({defaults:{folder:new me,urlRoot:"".concat(Object(d.getAppRoot)(),"api/folders/"),id:"unknown"},parse:function(t){var e=Object(o.a)();this.get("folder").reset();for(var i=0;i<t.folder_contents.length;i++)if("folder"===t.folder_contents[i].type){var n=new fe(t.folder_contents[i]);this.get("folder").add(n)}else if("file"===t.folder_contents[i].type){var a=new pe(t.folder_contents[i]);this.get("folder").add(a)}else e.emit.error("Unknown folder item type encountered while parsing response.");return t}}),_e=c.a.Model.extend({urlRoot:"".concat(Object(d.getAppRoot)(),"api/histories/")}),ve=c.a.Collection.extend({urlRoot:"".concat(Object(d.getAppRoot)(),"api/histories/"),initialize:function(t){this.id=t.id},url:function(){return"".concat(this.urlRoot+this.id,"/contents")},model:_e}),be=c.a.Model.extend({urlRoot:"".concat(Object(d.getAppRoot)(),"api/histories/")}),we=c.a.Collection.extend({url:"".concat(Object(d.getAppRoot)(),"api/histories"),model:be}),ye=c.a.Model.extend({urlRoot:"".concat(Object(d.getAppRoot)(),"api/remote_files")}),xe={Library:de,Libraries:ue,Item:pe,Ldda:pe,FolderAsModel:fe,Folder:me,FolderContainer:ge,HistoryItem:_e,HistoryContents:ve,GalaxyHistory:be,GalaxyHistories:we,Jstree:ye},ke=i(17),Ce={LibraryDatasetView:c.a.View.extend({el:"#center",model:null,options:{},defaults:{edit_mode:!1},events:{"click .toolbtn_modify_dataset":"enableModification","click .toolbtn_cancel_modifications":"render","click .toolbtn-download-dataset":"downloadDataset","click .toolbtn-import-dataset":"importIntoHistory","click .copy-link-to-clipboard":"copyToClipboard","click .make-private":"makeDatasetPrivate","click .remove-restrictions":"removeDatasetRestrictions","click .toolbtn_save_permissions":"savePermissions","click .toolbtn_save_modifications":"saveModifications","click .toolbtn_detect_datatype":"detectDatatype"},select_genome:null,select_extension:null,list_extensions:[],auto:{id:"auto",text:"Auto-detect",description:"This system will try to detect the file type automatically. If your file is not detected properly as one of the known formats, it most likely means that it has some format problems (e.g., different number of columns on different rows). You can still coerce the system to set your data to the format you think it should be. You can also upload compressed files, which will automatically be decompressed."},list_genomes:[],initialize:function(t){this.options=r.a.extend(this.options,t),this.fetchExtAndGenomes(),this.options.id&&this.fetchDataset()},fetchDataset:function(t){var e=Object(o.a)();this.options=r.a.extend(this.options,t),this.model=new xe.Item({id:this.options.id});var i=this;this.model.fetch({success:function(){i.options.show_permissions?i.showPermissions():i.options.show_version?i.fetchVersion():i.render()},error:function(t,i){void 0!==i.responseJSON?f.a.error("".concat(i.responseJSON.err_msg," Click this to go back."),"",{onclick:function(){e.libraries.library_router.back()}}):f.a.error("An error occurred. Click this to go back.","",{onclick:function(){e.libraries.library_router.back()}})}})},render:function(t){this.options=r.a.extend(this.options,t),a()(".tooltip").remove();var e=this.templateDataset();this.$el.html(e({item:this.model})),a()(".peek").html(this.model.get("peek")),a()('#center [data-toggle="tooltip"]').tooltip({trigger:"hover"})},fetchVersion:function(t){this.options=r.a.extend(this.options,t);var e=this;this.options.ldda_id?(this.ldda=new xe.Ldda({id:this.options.ldda_id}),this.ldda.url="".concat(this.ldda.urlRoot+this.model.id,"/versions/").concat(this.ldda.id),this.ldda.fetch({success:function(){e.renderVersion()},error:function(t,e){void 0!==e.responseJSON?f.a.error(e.responseJSON.err_msg):f.a.error("An error occurred.")}})):(this.render(),f.a.error("Library dataset version requested but no id provided."))},renderVersion:function(){a()(".tooltip").remove();var t=this.templateVersion();this.$el.html(t({item:this.model,ldda:this.ldda})),a()(".peek").html(this.ldda.get("peek"))},enableModification:function(){a()(".tooltip").remove();var t=this.templateModifyDataset();this.$el.html(t({item:this.model})),this.renderSelectBoxes({genome_build:this.model.get("genome_build"),file_ext:this.model.get("file_ext")}),a()(".peek").html(this.model.get("peek")),a()('#center [data-toggle="tooltip"]').tooltip({trigger:"hover"})},downloadDataset:function(){var t="".concat(Object(d.getAppRoot)(),"api/libraries/datasets/download/uncompressed"),e={ld_ids:this.id};this.processDownload(t,e)},processDownload:function(t,e,i){if(t&&e){e="string"==typeof e?e:a.a.param(e);var n="";a.a.each(e.split("&"),function(){var t=this.split("=");n+='<input type="hidden" name="'.concat(t[0],'" value="').concat(t[1],'" />')}),a()('<form action="'.concat(t,'" method="').concat(i||"post",'">').concat(n,"</form>")).appendTo("body").submit().remove(),f.a.info("Your download will begin soon.")}},importIntoHistory:function(){this.refreshUserHistoriesList(function(t){var e=Object(o.a)(),i=t.templateBulkImportInModal();t.modal=e.modal,t.modal.show({closing_events:!0,title:h()("Import into History"),body:i({histories:t.histories.models}),buttons:{Import:function(){t.importCurrentIntoHistory()},Close:function(){e.modal.hide()}}})})},refreshUserHistoriesList:function(t){var e=this;this.histories=new xe.GalaxyHistories,this.histories.fetch({success:function(i){0===i.length?f.a.warning("You have to create history first. Click this to do so.","",{onclick:function(){window.location=Object(d.getAppRoot)()}}):t(e)},error:function(t,e){void 0!==e.responseJSON?f.a.error(e.responseJSON.err_msg):f.a.error("An error occurred.")}})},importCurrentIntoHistory:function(){this.modal.disableButton("Import");var t=this.modal.$("input[name=history_name]").val(),e=this;if(""!==t)a.a.post("".concat(Object(d.getAppRoot)(),"api/histories"),{name:t}).done(function(t){e.processImportToHistory(t.id)}).fail(function(t,e,i){f.a.error("An error occurred.")}).always(function(){e.modal.enableButton("Import")});else{var i=a()(this.modal.$el).find("select[name=dataset_import_single] option:selected").val();this.processImportToHistory(i),this.modal.enableButton("Import")}},processImportToHistory:function(t){var e=Object(o.a)(),i=new xe.HistoryItem;i.url="".concat(i.urlRoot+t,"/contents"),a.a.getJSON("".concat(Object(d.getAppRoot)(),"history/set_as_current?id=").concat(t)),i.save({content:this.id,source:"library"},{success:function(){e.modal.hide(),f.a.success("Dataset imported. Click this to start analyzing it.","",{onclick:function(){window.location=Object(d.getAppRoot)()}})},error:function(t,e){void 0!==e.responseJSON?f.a.error("Dataset not imported. ".concat(e.responseJSON.err_msg)):f.a.error("An error occurred. Dataset not imported. Please try again.")}})},showPermissions:function(t){var e=Object(o.a)(),i=this.templateDatasetPermissions(),n=this;this.options=r.a.extend(this.options,t),a()(".tooltip").remove(),void 0!==this.options.fetched_permissions&&(0===this.options.fetched_permissions.access_dataset_roles.length?this.model.set({is_unrestricted:!0}):this.model.set({is_unrestricted:!1})),this.$el.html(i({item:this.model,is_admin:e.config.is_admin_user})),a.a.get("".concat(Object(d.getAppRoot)(),"api/libraries/datasets/").concat(n.id,"/permissions?scope=current")).done(function(t){n.prepareSelectBoxes({fetched_permissions:t,is_admin:e.config.is_admin_user})}).fail(function(){f.a.error("An error occurred while attempting to fetch dataset permissions.")}),a()('#center [data-toggle="tooltip"]').tooltip({trigger:"hover"}),a()("#center").css("overflow","auto")},_serializeRoles:function(t){for(var e=[],i=0;i<t.length;i++)e.push("".concat(t[i][1],":").concat(t[i][0].replace(":"," ").replace(","," &")));return e},prepareSelectBoxes:function(t){this.options=r.a.extend(this.options,t),this.accessSelectObject=new ke.a.View(this._generate_select_options({selector:"access_perm",initialData:this._serializeRoles(this.options.fetched_permissions.access_dataset_roles)})),this.modifySelectObject=new ke.a.View(this._generate_select_options({selector:"modify_perm",initialData:this._serializeRoles(this.options.fetched_permissions.modify_item_roles)})),this.manageSelectObject=new ke.a.View(this._generate_select_options({selector:"manage_perm",initialData:this._serializeRoles(this.options.fetched_permissions.manage_dataset_roles)}))},_generate_select_options:function(t){var e={minimumInputLength:0,multiple:!0,placeholder:"Click to select a role",formatResult:function(t){return"".concat(t.name," type: ").concat(t.type)},formatSelection:function(t){return t.name},initSelection:function(t,e){var i=[];a()(t.val().split(",")).each(function(){var t=this.split(":");i.push({id:t[0],name:t[1]})}),e(i)},dropdownCssClass:"bigdrop"};return e.container=this.$el.find("#".concat(t.selector)),e.css=t.selector,e.initialData=t.initialData.join(","),e.ajax={url:"".concat(Object(d.getAppRoot)(),"api/libraries/datasets/").concat(this.id,"/permissions?scope=available"),dataType:"json",quietMillis:100,data:function(t,e){return{q:t,page_limit:10,page:e}},results:function(t,e){var i=10*e<t.total;return{results:t.roles,more:i}}},e},detectDatatype:function(t){var e=this.model;e.set("file_ext","auto"),this._submitModification(e)},saveModifications:function(t){var e=!1,i=this.model,n=this.$el.find(".input_dataset_name").val();if(void 0!==n&&n!==i.get("name")){if(!(n.length>0))return void f.a.warning("Library dataset name has to be at least 1 character long.");i.set("name",n),e=!0}var a=this.$el.find(".input_dataset_misc_info").val();void 0!==a&&a!==i.get("misc_info")&&(i.set("misc_info",a),e=!0);var o=this.$el.find(".input_dataset_message").val();void 0!==o&&o!==i.get("message")&&(i.set("message",o),e=!0);var s=this.select_genome.$el.select2("data").id;void 0!==s&&s!==i.get("genome_build")&&(i.set("genome_build",s),e=!0);var r=this.select_extension.$el.select2("data").id;void 0!==r&&r!==i.get("file_ext")&&(i.set("file_ext",r),e=!0),e?this._submitModification(i):(this.render(),f.a.info("Nothing has changed."))},_submitModification:function(t){var e=this;t.save(null,{patch:!0,success:function(t){e.render(),f.a.success("Changes to library dataset saved.")},error:function(t,e){void 0!==e.responseJSON?f.a.error(e.responseJSON.err_msg):f.a.error("An error occurred while attempting to update the library dataset.")}})},copyToClipboard:function(t){t.preventDefault();var e=c.a.history.location.href;-1!==e.lastIndexOf("/permissions")&&(e=e.substr(0,e.lastIndexOf("/permissions"))),window.prompt("Copy to clipboard: Ctrl+C, Enter",e)},makeDatasetPrivate:function(){var t=this;a.a.post("".concat(Object(d.getAppRoot)(),"api/libraries/datasets/").concat(t.id,"/permissions?action=make_private")).done(function(e){t.model.set({is_unrestricted:!1}),t.showPermissions({fetched_permissions:e}),f.a.success("The dataset is now private to you.")}).fail(function(){f.a.error("An error occurred while attempting to make dataset private.")})},removeDatasetRestrictions:function(){var t=this;a.a.post("".concat(Object(d.getAppRoot)(),"api/libraries/datasets/").concat(t.id,"/permissions?action=remove_restrictions")).done(function(e){t.model.set({is_unrestricted:!0}),t.showPermissions({fetched_permissions:e}),f.a.success("Access to this dataset is now unrestricted.")}).fail(function(){f.a.error("An error occurred while attempting to make dataset unrestricted.")})},_extractIds:function(t){for(var e=[],i=t.length-1;i>=0;i--)e.push(t[i].id);return e},savePermissions:function(t){var e=this,i=this._extractIds(this.accessSelectObject.$el.select2("data")),n=this._extractIds(this.manageSelectObject.$el.select2("data")),o=this._extractIds(this.modifySelectObject.$el.select2("data"));a.a.post("".concat(Object(d.getAppRoot)(),"api/libraries/datasets/").concat(e.id,"/permissions?action=set_permissions"),{"access_ids[]":i,"manage_ids[]":n,"modify_ids[]":o}).done(function(t){e.showPermissions({fetched_permissions:t}),f.a.success("Permissions saved.")}).fail(function(){f.a.error("An error occurred while attempting to set dataset permissions.")})},fetchExtAndGenomes:function(){var t=this;0==this.list_genomes.length&&p.a.get({url:"".concat(Object(d.getAppRoot)(),"api/datatypes?extension_only=False"),success:function(e){for(var i in e)t.list_extensions.push({id:e[i].extension,text:e[i].extension,description:e[i].description,description_url:e[i].description_url});t.list_extensions.sort(function(t,e){return t.id>e.id?1:t.id<e.id?-1:0}),t.list_extensions.unshift(t.auto)}}),0==this.list_extensions.length&&p.a.get({url:"".concat(Object(d.getAppRoot)(),"api/genomes"),success:function(e){for(var i in e)t.list_genomes.push({id:e[i][1],text:e[i][0]});t.list_genomes.sort(function(t,e){return t.id>e.id?1:t.id<e.id?-1:0})}})},renderSelectBoxes:function(t){var e="?",i="auto";void 0!==t&&(void 0!==t.genome_build&&(e=t.genome_build),void 0!==t.file_ext&&(i=t.file_ext)),this.select_genome=new ke.a.View({css:"dataset-genome-select",data:this.list_genomes,container:this.$el.find("#dataset_genome_select"),value:e}),this.select_extension=new ke.a.View({css:"dataset-extension-select",data:this.list_extensions,container:this.$el.find("#dataset_extension_select"),value:i})},templateDataset:function(){return r.a.template(['<div class="library_style_container">','<div class="d-flex mb-2">','<button data-toggle="tooltip" data-placement="top" title="Download dataset" class="btn btn-secondary toolbtn-download-dataset toolbar-item mr-1" type="button">','<span class="fa fa-download"></span>',"&nbsp;Download","</button>",'<button data-toggle="tooltip" data-placement="top" title="Import dataset into history" class="btn btn-secondary toolbtn-import-dataset toolbar-item mr-1" type="button">','<span class="fa fa-book"></span>',"&nbsp;to History","</button>",'<% if (item.get("can_user_modify")) { %>','<button data-toggle="tooltip" data-placement="top" title="Modify library item" class="btn btn-secondary toolbtn_modify_dataset toolbar-item mr-1" type="button">','<span class="fa fa-pencil"></span>',"&nbsp;Modify","</button>",'<button data-toggle="tooltip" data-placement="top" title="Attempt to detect the format of dataset" class="btn btn-secondary toolbtn_detect_datatype toolbar-item mr-1" type="button">','<span class="fa fa-undo"></span>',"&nbsp;Auto-detect datatype","</button>","<% } %>",'<% if (item.get("can_user_manage")) { %>','<a href="#folders/<%- item.get("folder_id") %>/datasets/<%- item.id %>/permissions">','<button data-toggle="tooltip" data-placement="top" title="Manage permissions" class="btn btn-secondary toolbtn_change_permissions toolbar-item mr-1" type="button">','<span class="fa fa-group"></span>',"&nbsp;Permissions","</button>","</a>","<% } %>","</div>",'<ol class="breadcrumb">','<li class="breadcrumb-item"><a title="Return to the list of libraries" href="#">Libraries</a></li>','<% _.each(item.get("full_path"), function(path_item) { %>',"<% if (path_item[0] != item.id) { %>",'<li class="breadcrumb-item"><a title="Return to this folder" href="#/folders/<%- path_item[0] %>"><%- path_item[1] %></a> </li> ',"<% } else { %>",'<li class="breadcrumb-item active"><span title="You are here"><%- path_item[1] %></span></li>',"<% } %>","<% }); %>","</ol>",'<% if (item.get("is_unrestricted")) { %>',"<div>",'This dataset is unrestricted so everybody with the link can access it. Just share <span class="copy-link-to-clipboard"><a href=""a>this page</a></span>.',"</div>","<% } %>",'<div class="dataset_table">','<table class="grid table table-striped table-sm">',"<tr>",'<th class="dataset-first-column" scope="row" id="id_row" data-id="<%= _.escape(item.get("ldda_id")) %>">Name</th>','<td><%= _.escape(item.get("name")) %></td>',"</tr>",'<% if (item.get("file_ext")) { %>',"<tr>",'<th scope="row">Data type</th>','<td><%= _.escape(item.get("file_ext")) %></td>',"</tr>","<% } %>",'<% if (item.get("genome_build")) { %>',"<tr>",'<th scope="row">Genome build</th>','<td><%= _.escape(item.get("genome_build")) %></td>',"</tr>","<% } %>",'<% if (item.get("file_size")) { %>',"<tr>",'<th scope="row">Size</th>','<td><%= _.escape(item.get("file_size")) %></td>',"</tr>","<% } %>",'<% if (item.get("date_uploaded")) { %>',"<tr>",'<th scope="row">Date uploaded (UTC)</th>','<td><%= _.escape(item.get("date_uploaded")) %></td>',"</tr>","<% } %>",'<% if (item.get("uploaded_by")) { %>',"<tr>",'<th scope="row">Uploaded by</th>','<td><%= _.escape(item.get("uploaded_by")) %></td>',"</tr>","<% } %>",'<% if (item.get("metadata_data_lines")) { %>',"<tr>",'<th scope="row">Data Lines</th>','<td scope="row"><%= _.escape(item.get("metadata_data_lines")) %></td>',"</tr>","<% } %>",'<% if (item.get("metadata_comment_lines")) { %>',"<tr>",'<th scope="row">Comment Lines</th>','<td scope="row"><%= _.escape(item.get("metadata_comment_lines")) %></td>',"</tr>","<% } %>",'<% if (item.get("metadata_columns")) { %>',"<tr>",'<th scope="row">Number of Columns</th>','<td scope="row"><%= _.escape(item.get("metadata_columns")) %></td>',"</tr>","<% } %>",'<% if (item.get("metadata_column_types")) { %>',"<tr>",'<th scope="row">Column Types</th>','<td scope="row"><%= _.escape(item.get("metadata_column_types")) %></td>',"</tr>","<% } %>",'<% if (item.get("message")) { %>',"<tr>",'<th scope="row">Message</th>','<td scope="row"><%= _.escape(item.get("message")) %></td>',"</tr>","<% } %>",'<% if (item.get("misc_blurb")) { %>',"<tr>",'<th scope="row">Misc. blurb</th>','<td scope="row"><%= _.escape(item.get("misc_blurb")) %></td>',"</tr>","<% } %>",'<% if (item.get("misc_info")) { %>',"<tr>",'<th scope="row">Misc. info</th>','<td scope="row"><%= _.escape(item.get("misc_info")) %></td>',"</tr>","<% } %>",'<% if (item.get("tags")) { %>',"<tr>",'<th scope="row">Tags</th>','<td scope="row"><%= _.escape(item.get("tags")) %></td>',"</tr>","<% } %>",'<% if ( item.get("uuid") !== "ok" ) { %>',"<tr>",'<th scope="row">UUID</th>','<td scope="row"><%= _.escape(item.get("uuid")) %></td>',"</tr>","<% } %>",'<% if ( item.get("state") !== "ok" ) { %>',"<tr>",'<th scope="row">State</th>','<td scope="row"><%= _.escape(item.get("state")) %></td>',"</tr>","<% } %>","</table>",'<% if (item.get("job_stderr")) { %>',"<h4>Job Standard Error</h4>",'<pre class="code">','<%= _.escape(item.get("job_stderr")) %>',"</pre>","<% } %>",'<% if (item.get("job_stdout")) { %>',"<h4>Job Standard Output</h4>",'<pre class="code">','<%= _.escape(item.get("job_stdout")) %>',"</pre>","<% } %>","<div>",'<pre class="peek">',"</pre>","</div>",'<% if (item.get("has_versions")) { %>',"<div>","<h3>Expired versions:</h3>","<ul>",'<% _.each(item.get("expired_versions"), function(version) { %>','<li><a title="See details of this version" href="#folders/<%- item.get("folder_id") %>/datasets/<%- item.id %>/versions/<%- version[0] %>"><%- version[1] %></a></li>',"<% }) %>","<ul>","</div>","<% } %>","</div>","</div>"].join(""))},templateVersion:function(){return r.a.template(['<div class="library_style_container">','<div class="d-flex mb-2">','<a href="#folders/<%- item.get("folder_id") %>/datasets/<%- item.id %>">','<button data-toggle="tooltip" data-placement="top" title="Go to latest dataset" class="btn btn-secondary toolbar-item mr-1" type="button">','<span class="fa fa-caret-left fa-lg"></span>',"&nbsp;Latest dataset","</button>","<a>","</div>",'<ol class="breadcrumb">','<li class="breadcrumb-item"><a title="Return to the list of libraries" href="#">Libraries</a></li>','<% _.each(item.get("full_path"), function(path_item) { %>',"<% if (path_item[0] != item.id) { %>",'<li class="breadcrumb-item"><a title="Return to this folder" href="#/folders/<%- path_item[0] %>"><%- path_item[1] %></a> </li> ',"<% } else { %>",'<li class="breadcrumb-item active"><span title="You are here"><%- path_item[1] %></span></li>',"<% } %>","<% }); %>","</ol>",'<div class="alert alert-warning">This is an expired version of the library dataset: <%= _.escape(item.get("name")) %></div>','<div class="dataset_table">','<table class="grid table table-striped table-sm">',"<tr>",'<th scope="row" id="id_row" data-id="<%= _.escape(ldda.id) %>">Name</th>','<td><%= _.escape(ldda.get("name")) %></td>',"</tr>",'<% if (ldda.get("file_ext")) { %>',"<tr>",'<th scope="row">Data type</th>','<td><%= _.escape(ldda.get("file_ext")) %></td>',"</tr>","<% } %>",'<% if (ldda.get("genome_build")) { %>',"<tr>",'<th scope="row">Genome build</th>','<td><%= _.escape(ldda.get("genome_build")) %></td>',"</tr>","<% } %>",'<% if (ldda.get("file_size")) { %>',"<tr>",'<th scope="row">Size</th>','<td><%= _.escape(ldda.get("file_size")) %></td>',"</tr>","<% } %>",'<% if (ldda.get("date_uploaded")) { %>',"<tr>",'<th scope="row">Date uploaded (UTC)</th>','<td><%= _.escape(ldda.get("date_uploaded")) %></td>',"</tr>","<% } %>",'<% if (ldda.get("uploaded_by")) { %>',"<tr>",'<th scope="row">Uploaded by</th>','<td><%= _.escape(ldda.get("uploaded_by")) %></td>',"</tr>","<% } %>",'<% if (ldda.get("metadata_data_lines")) { %>',"<tr>",'<th scope="row">Data Lines</th>','<td scope="row"><%= _.escape(ldda.get("metadata_data_lines")) %></td>',"</tr>","<% } %>",'<% if (ldda.get("metadata_comment_lines")) { %>',"<tr>",'<th scope="row">Comment Lines</th>','<td scope="row"><%= _.escape(ldda.get("metadata_comment_lines")) %></td>',"</tr>","<% } %>",'<% if (ldda.get("metadata_columns")) { %>',"<tr>",'<th scope="row">Number of Columns</th>','<td scope="row"><%= _.escape(ldda.get("metadata_columns")) %></td>',"</tr>","<% } %>",'<% if (ldda.get("metadata_column_types")) { %>',"<tr>",'<th scope="row">Column Types</th>','<td scope="row"><%= _.escape(ldda.get("metadata_column_types")) %></td>',"</tr>","<% } %>",'<% if (ldda.get("message")) { %>',"<tr>",'<th scope="row">Message</th>','<td scope="row"><%= _.escape(ldda.get("message")) %></td>',"</tr>","<% } %>",'<% if (ldda.get("misc_blurb")) { %>',"<tr>",'<th scope="row">Miscellaneous blurb</th>','<td scope="row"><%= _.escape(ldda.get("misc_blurb")) %></td>',"</tr>","<% } %>",'<% if (ldda.get("misc_info")) { %>',"<tr>",'<th scope="row">Miscellaneous information</th>','<td scope="row"><%= _.escape(ldda.get("misc_info")) %></td>',"</tr>","<% } %>",'<% if (item.get("tags")) { %>',"<tr>",'<th scope="row">Tags</th>','<td scope="row"><%= _.escape(item.get("tags")) %></td>',"</tr>","<% } %>","</table>","<div>",'<pre class="peek">',"</pre>","</div>","</div>","</div>"].join(""))},templateModifyDataset:function(){return r.a.template(['<div class="library_style_container">','<ol class="breadcrumb">','<li class="breadcrumb-item"><a title="Return to the list of libraries" href="#">Libraries</a></li>','<% _.each(item.get("full_path"), function(path_item) { %>',"<% if (path_item[0] != item.id) { %>",'<li class="breadcrumb-item"><a title="Return to this folder" href="#/folders/<%- path_item[0] %>"><%- path_item[1] %></a> </li> ',"<% } else { %>",'<li class="breadcrumb-item active"><span title="You are here"><%- path_item[1] %></span></li>',"<% } %>","<% }); %>","</ol>",'<div class="dataset_table">','<table class="grid table table-striped table-sm">',"<tr>",'<th class="dataset-first-column" scope="row" id="id_row" data-id="<%= _.escape(item.get("ldda_id")) %>">Name</th>','<td><input class="input_dataset_name form-control" type="text" placeholder="name" value="<%= _.escape(item.get("name")) %>"></td>',"</tr>","<tr>",'<th scope="row">Data type</th>',"<td>",'<span id="dataset_extension_select" class="dataset-extension-select" />',"</td>","</tr>","<tr>",'<th scope="row">Genome build</th>',"<td>",'<span id="dataset_genome_select" class="dataset-genome-select" />',"</td>","</tr>","<tr>",'<th scope="row">Size</th>','<td><%= _.escape(item.get("file_size")) %></td>',"</tr>","<tr>",'<th scope="row">Date uploaded (UTC)</th>','<td><%= _.escape(item.get("date_uploaded")) %></td>',"</tr>","<tr>",'<th scope="row">Uploaded by</th>','<td><%= _.escape(item.get("uploaded_by")) %></td>',"</tr>",'<tr scope="row">','<th scope="row">Data Lines</th>','<td scope="row"><%= _.escape(item.get("metadata_data_lines")) %></td>',"</tr>",'<th scope="row">Comment Lines</th>','<% if (item.get("metadata_comment_lines") === "") { %>','<td scope="row"><%= _.escape(item.get("metadata_comment_lines")) %></td>',"<% } else { %>",'<td scope="row">unknown</td>',"<% } %>","</tr>","<tr>",'<th scope="row">Number of Columns</th>','<td scope="row"><%= _.escape(item.get("metadata_columns")) %></td>',"</tr>","<tr>",'<th scope="row">Column Types</th>','<td scope="row"><%= _.escape(item.get("metadata_column_types")) %></td>',"</tr>","<tr>",'<th scope="row">Message</th>','<td scope="row"><input class="input_dataset_message form-control" type="text" placeholder="message" value="<%= _.escape(item.get("message")) %>"></td>',"</tr>","<tr>",'<th scope="row">Misc. blurb</th>','<td scope="row"><%= _.escape(item.get("misc_blurb")) %></td>',"</tr>","<tr>",'<th scope="row">Misc. information</th>','<td><input class="input_dataset_misc_info form-control" type="text" placeholder="info" value="<%= _.escape(item.get("misc_info")) %>"></td>',"</tr>",'<% if (item.get("tags")) { %>',"<tr>",'<th scope="row">Tags</th>','<td scope="row"><%= _.escape(item.get("tags")) %></td>',"</tr>","<% } %>","</table>","<div>",'<pre class="peek">',"</pre>","</div>","</div>",'<div class="d-flex">','<button data-toggle="tooltip" data-placement="top" title="Cancel modifications" class="btn btn-secondary toolbtn_cancel_modifications toolbar-item mr-1" type="button">','<span class="fa fa-times"></span>',"&nbsp;Cancel","</button>",'<button data-toggle="tooltip" data-placement="top" title="Save modifications" class="btn btn-secondary toolbtn_save_modifications toolbar-item mr-1" type="button">','<span class="fa fa-floppy-o"></span>',"&nbsp;Save","</button>","</div>","</div>"].join(""))},templateDatasetPermissions:function(){return r.a.template(['<div class="library_style_container">','<div class="d-flex mb-2">','<a href="#folders/<%- item.get("folder_id") %>/datasets/<%- item.id %>">','<button data-toggle="tooltip" data-placement="top" title="Go back to dataset" class="btn btn-secondary toolbar-item mr-1" type="button">','<span class="fa fa-file-o"></span>',"&nbsp;Dataset Details","</button>","<a>","</div>",'<ol class="breadcrumb">','<li class="breadcrumb-item"><a title="Return to the list of libraries" href="#">Libraries</a></li>','<% _.each(item.get("full_path"), function(path_item) { %>',"<% if (path_item[0] != item.id) { %>",'<li class="breadcrumb-item"><a title="Return to this folder" href="#/folders/<%- path_item[0] %>"><%- path_item[1] %></a> </li> ',"<% } else { %>",'<li class="breadcrumb-item active"><span title="You are here"><%- path_item[1] %></span></li>',"<% } %>","<% }); %>","</ol>",'<h1>Dataset: <%= _.escape(item.get("name")) %></h1>','<div class="alert alert-warning">',"<% if (is_admin) { %>","You are logged in as an <strong>administrator</strong> therefore you can manage any dataset on this Galaxy instance. Please make sure you understand the consequences.","<% } else { %>","You can assign any number of roles to any of the following permission types. However please read carefully the implications of such actions.","<% } %>","</div>",'<div class="dataset_table">',"<h2>Library-related permissions</h2>","<h4>Roles that can modify the library item</h4>",'<div id="modify_perm" class="modify_perm roles-selection"></div>','<div class="alert alert-info roles-selection">User with <strong>any</strong> of these roles can modify name, metadata, and other information about this library item.</div>',"<hr/>","<h2>Dataset-related permissions</h2>",'<div class="alert alert-warning">Changes made below will affect <strong>every</strong> library item that was created from this dataset and also every history this dataset is part of.</div>','<% if (!item.get("is_unrestricted")) { %>','<p>You can <span class="remove-restrictions"><a href="">remove all access restrictions</a></span> on this dataset.</p>',"<% } else { %>",'<p>You can <span class="make-private"><a href="">make this dataset private</a></span> to you.</p>',"<% } %>","<h4>Roles that can access the dataset</h4>",'<div id="access_perm" class="access_perm roles-selection"></div>','<div class="alert alert-info roles-selection">',"User has to have <strong>all these roles</strong> in order to access this dataset."," Users without access permission <strong>cannot</strong> have other permissions on this dataset."," If there are no access roles set on the dataset it is considered <strong>unrestricted</strong>.","</div>","<h4>Roles that can manage permissions on the dataset</h4>",'<div id="manage_perm" class="manage_perm roles-selection"></div>','<div class="alert alert-info roles-selection">',"User with <strong>any</strong> of these roles can manage permissions of this dataset. If you remove yourself you will lose the ability manage this dataset unless you are an admin.","</div>",'<button data-toggle="tooltip" data-placement="top" title="Save modifications made on this page" class="btn btn-secondary toolbtn_save_permissions  type="button">','<span class="fa fa-floppy-o"></span>',"&nbsp;Save","</button>","</div>","</div>"].join(""))},templateBulkImportInModal:function(){return r.a.template(["<div>",'<div class="library-modal-item">',"Select history: ",'<select id="dataset_import_single" name="dataset_import_single" style="width:50%; margin-bottom: 1em; " autofocus>',"<% _.each(histories, function(history) { %>",'<option value="<%= _.escape(history.get("id")) %>"><%= _.escape(history.get("name")) %></option>',"<% }); %>","</select>","</div>",'<div class="library-modal-item">',"or create new: ",'<input type="text" name="history_name" value="" placeholder="name of the new history" style="width:50%;">',"</input>","</div>","</div>"].join(""))}})},Se={FolderRowView:c.a.View.extend({events:{"click .undelete_dataset_btn":"undeleteDataset","click .undelete_folder_btn":"undeleteFolder","click .edit_folder_btn":"startModifications","click .cancel_folder_btn":"cancelModifications","click .save_folder_btn":"saveModifications"},defaults:{type:null,visibility_config:{edit_folder_btn:!1,save_folder_btn:!1,cancel_folder_btn:!1,permission_folder_btn:!1},edit_mode:!1},initialize:function(t){this.options=r.a.defaults(t||{},this.defaults),this.render(this.options)},render:function(t){this.options=r.a.extend(this.options,t);var e=this.options.model,i=null,n=Object(o.a)();return"folder"===e.get("type")||"LibraryFolder"===e.get("model_class")?(this.options.type="folder",this.prepareButtons(e),i=e.get("deleted")?this.templateRowDeletedFolder():this.templateRowFolder()):"file"===e.get("type")||"LibraryDatasetDatasetAssociation"===e.get("model_class")||"LibraryDataset"===e.get("model_class")?(this.options.type="file",i=e.get("deleted")?this.templateRowDeletedFile():this.templateRowFile()):(n.emit.error("Unknown library item type found."),n.emit.error(e.get("type")||e.get("model_class"))),this.setElement(i({content_item:e,edit_mode:this.options.edit_mode,button_config:this.options.visibility_config})),this.$el.show(),this},prepareButtons:function(t){var e=this.options.visibility_config;!1===this.options.edit_mode?(e.save_folder_btn=!1,e.cancel_folder_btn=!1,!0===t.get("deleted")?(e.edit_folder_btn=!1,e.permission_folder_btn=!1):!1===t.get("deleted")&&(e.save_folder_btn=!1,e.cancel_folder_btn=!1,!0===t.get("can_modify")&&(e.edit_folder_btn=!0),!0===t.get("can_manage")&&(e.permission_folder_btn=!0))):!0===this.options.edit_mode&&(e.edit_folder_btn=!1,e.permission_folder_btn=!1,e.save_folder_btn=!0,e.cancel_folder_btn=!0),this.options.visibility_config=e},showDatasetDetails:function(){Object(o.a)().libraries.datasetView=new Ce.LibraryDatasetView({id:this.id})},undeleteDataset:function(t){a()(".tooltip").hide();var e=Object(o.a)(),i=this,n=a()(t.target).closest("tr").data("id"),s=e.libraries.folderListView.collection.get(n);s.url="".concat(s.urlRoot+s.id,"?undelete=true"),s.destroy({success:function(t,a){e.libraries.folderListView.collection.remove(n);var o=new xe.Item(a);e.libraries.folderListView.collection.add(o),e.libraries.folderListView.collection.sortFolder("name","asc"),f.a.success("Dataset undeleted. Click this to see it.","",{onclick:function(){var t=i.model.get("folder_id");window.location="".concat(Object(d.getAppRoot)(),"library/list#folders/").concat(t,"/datasets/").concat(i.id)}})},error:function(t,e){void 0!==e.responseJSON?f.a.error("Dataset was not undeleted. ".concat(e.responseJSON.err_msg)):f.a.error("An error occurred! Dataset was not undeleted. Please try again.")}})},undeleteFolder:function(t){var e=Object(o.a)();a()(".tooltip").hide();var i=a()(t.target).closest("tr").data("id"),n=e.libraries.folderListView.collection.get(i);n.url="".concat(n.urlRoot+n.id,"?undelete=true"),n.destroy({success:function(t,n){e.libraries.folderListView.collection.remove(i);var a=new xe.FolderAsModel(n);e.libraries.folderListView.collection.add(a),e.libraries.folderListView.collection.sortFolder("name","asc"),f.a.success("Folder undeleted.")},error:function(t,e){void 0!==e.responseJSON?f.a.error("Folder was not undeleted. ".concat(e.responseJSON.err_msg)):f.a.error("An error occurred! Folder was not undeleted. Please try again.")}})},startModifications:function(){this.options.edit_mode=!0,this.repaint()},cancelModifications:function(){this.options.edit_mode=!1,this.repaint()},saveModifications:function(){var t=Object(o.a)().libraries.folderListView.collection.get(this.$el.data("id")),e=!1,i=this.$el.find(".input_folder_name").val();if(void 0!==i&&i!==t.get("name")){if(!(i.length>2))return void f.a.warning("Folder name has to be at least 3 characters long.");t.set("name",i),e=!0}var n=this.$el.find(".input_folder_description").val();if(void 0!==n&&n!==t.get("description")&&(t.set("description",n),e=!0),e){var a=this;t.save(null,{patch:!0,success:function(t){a.options.edit_mode=!1,a.repaint(t),f.a.success("Changes to folder saved.")},error:function(t,e){void 0!==e.responseJSON?f.a.error(e.responseJSON.err_msg):f.a.error("An error occurred while attempting to update the folder.")}})}else this.options.edit_mode=!1,this.repaint(t),f.a.info("Nothing has changed.")},repaint:function(){a()(".tooltip").hide();var t=this.$el;this.render(),t.replaceWith(this.$el),this.$el.find('[data-toggle="tooltip"]').tooltip({trigger:"hover"})},templateRowFolder:function(){return r.a.template(['<tr class="folder_row library-row" data-id="<%- content_item.id %>">','<td class="mid">','<span title="Folder" class="fa fa-folder-o"/>',"</td>",'<td class="mid"><input style="margin: 0;" type="checkbox"></td>',"<% if(!edit_mode) { %>","<td>",'<a href="#folders/<%- content_item.id %>"><%- content_item.get("name") %></a>',"</td>","<td>",'<%- content_item.get("description") %>',"</td>","<% } else if(edit_mode){ %>",'<td><textarea rows="4" class="form-control input_folder_name" placeholder="name" ><%- content_item.get("name") %></textarea></td>','<td><textarea rows="4" class="form-control input_folder_description" placeholder="description" ><%- content_item.get("description") %></textarea></td>',"<% } %>","<td>folder</td>","<td></td>","<td>",'<%= _.escape(content_item.get("update_time")) %>',"</td>","<td></td>","<td>","<% if(edit_mode) { %>",'<button data-toggle="tooltip" data-placement="top" title="Save changes" class="primary-button btn-sm save_folder_btn" type="button" style="<% if(button_config.save_folder_btn === false) { print("display:none;") } %>">','<span class="fa fa-floppy-o"/> Save',"</button>",'<button data-toggle="tooltip" data-placement="top" title="Discard changes" class="primary-button btn-sm cancel_folder_btn" type="button" style="<% if(button_config.cancel_folder_btn === false) { print("display:none;") } %>">','<span class="fa fa-times"/> Cancel',"</button>","<% } else if (!edit_mode){%>",'<button data-toggle="tooltip" data-placement="top" title="Modify \'<%- content_item.get("name") %>\'" class="primary-button btn-sm edit_folder_btn" type="button" style="<% if(button_config.edit_folder_btn === false) { print("display:none;") } %>">','<span class="fa fa-pencil"/> Edit',"</button>",'<a href="#/folders/<%- content_item.id %>/permissions">','<button data-toggle="tooltip" data-placement="top" class="primary-button btn-sm permission_folder_btn" title="Permissions of \'<%- content_item.get("name") %>\'" style="<% if(button_config.permission_folder_btn === false) { print("display:none;") } %>">','<span class="fa fa-group"/> Manage',"</button>","</a>","<% } %>","</td>","</tr>"].join(""))},templateRowFile:function(){return r.a.template(['<tr class="dataset_row library-row" data-id="<%- content_item.id %>">','<td class="mid">','<span title="Dataset" class="fa fa-file-o"/>',"</td>",'<td class="mid">','<input style="margin: 0;" type="checkbox">',"</td>","<td>",'<a href="#folders/<%- content_item.get("folder_id") %>/datasets/<%- content_item.id %>" class="library-dataset">','<%- content_item.get("name") %>',"<a>","</td>",'<td><%- content_item.get("message") %></td>','<td><%= _.escape(content_item.get("file_ext")) %></td>','<td><%= _.escape(content_item.get("file_size")) %></td>','<td><%= _.escape(content_item.get("update_time")) %></td>',"<td>",'<% if ( content_item.get("state") !== "ok" ) { %>','<%= _.escape(content_item.get("state")) %>',"<% } %>","</td>","<td>",'<% if (content_item.get("is_unrestricted")) { %>','<span data-toggle="tooltip" data-placement="top" title="Unrestricted dataset" style="color:grey;" class="fa fa-globe"/>',"<% } %>",'<% if (content_item.get("is_private")) { %>','<span data-toggle="tooltip" data-placement="top" title="Private dataset" style="color:grey;" class="fa fa-key"/>',"<% } %>",'<% if ((content_item.get("is_unrestricted") === false) && (content_item.get("is_private") === false)) { %>','<span data-toggle="tooltip" data-placement="top" title="Restricted dataset" style="color:grey;" class="fa fa-shield"/>',"<% } %>",'<% if (content_item.get("can_manage")) { %>','<a href="#folders/<%- content_item.get("folder_id") %>/datasets/<%- content_item.id %>/permissions">','<button data-toggle="tooltip" data-placement="top" class="primary-button btn-sm permissions-dataset-btn" title="Permissions of \'<%- content_item.get("name") %>\'">','<span class="fa fa-group"/> Manage',"</button>","</a>","<% } %>","</td>","</tr>"].join(""))},templateRowDeletedFile:function(){return r.a.template(['<tr class="active deleted_dataset library-row" data-id="<%- content_item.id %>">','<td class="mid">','<span title="Dataset" class="fa fa-file-o"/>',"</td>","<td></td>",'<td style="color:grey;">','<%- content_item.get("name") %>',"</td>","<td>",'<%- content_item.get("message") %>',"</td>","<td>",'<%= _.escape(content_item.get("file_ext")) %>',"</td>","<td>",'<%= _.escape(content_item.get("file_size")) %>',"</td>","<td>",'<%= _.escape(content_item.get("update_time")) %>',"</td>","<td>",'<% if ( content_item.get("state") !== "ok" ) { %>','<%= _.escape(content_item.get("state")) %>',"<% } %>","</td>","<td>",'<span data-toggle="tooltip" data-placement="top" title="Marked deleted" style="color:grey;" class="fa fa-ban"/>','<button data-toggle="tooltip" data-placement="top" title="Undelete \'<%- content_item.get("name") %>\'" class="primary-button btn-sm undelete_dataset_btn" type="button" style="margin-left:1em;">','<span class="fa fa-unlock"/> Undelete',"</button>","</td>","</tr>"].join(""))},templateRowDeletedFolder:function(){return r.a.template(['<tr class="active deleted_folder library-row" data-id="<%- content_item.id %>">','<td class="mid">','<span title="Folder" class="fa fa-folder-o"/>',"</td>","<td></td>",'<td style="color:grey;">','<%- content_item.get("name") %>',"</td>","<td>",'<%- content_item.get("description") %>',"</td>","<td>","folder","</td>","<td></td>","<td>",'<%= _.escape(content_item.get("update_time")) %>',"</td>","<td></td>","<td>",'<span data-toggle="tooltip" data-placement="top" title="Marked deleted" style="color:grey;" class="fa fa-ban"/>','<button data-toggle="tooltip" data-placement="top" title="Undelete \'<%- content_item.get("name") %>\'" class="primary-button btn-sm undelete_folder_btn" type="button" style="margin-left:1em;">','<span class="fa fa-unlock"/> Undelete',"</button>","</td>","</tr>"].join(""))}})},Te={FolderListView:c.a.View.extend({el:"#folder_items_element",progress:0,progressStep:1,folderContainer:null,current_sort_order:"asc",current_sort_key:"name",events:{"click #select-all-checkboxes":"selectAll","click .dataset_row":"selectClickedRow","click .folder_row":"selectClickedRow","click .sort-folder-name":"sortColumnClicked","click .sort-folder-file_ext":"sortColumnClicked","click .sort-folder-description":"sortColumnClicked","click .sort-folder-state":"sortColumnClicked"},collection:null,defaults:{include_deleted:!1,page_count:null,show_page:null},initialize:function(t){this.options=r.a.defaults(this.options||{},this.defaults,t),this.modal=null,this.rowViews={},this.collection=new xe.Folder,this.listenTo(this.collection,"add",this.renderOne),this.listenTo(this.collection,"remove",this.removeOne),this.listenTo(this.collection,"sort",this.rePaint),this.listenTo(this.collection,"reset",this.rePaint),this.fetchFolder()},fetchFolder:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.options.include_deleted=t.include_deleted;var e=this;this.folderContainer=new xe.FolderContainer({id:this.options.id}),this.folderContainer.url="".concat(this.folderContainer.attributes.urlRoot+this.options.id,"/contents"),this.options.include_deleted&&(this.folderContainer.url="".concat(this.folderContainer.url,"?include_deleted=true")),this.folderContainer.fetch({success:function(t){e.folder_container=t,e.render()},error:function(t,e){var i=Object(o.a)();void 0!==e.responseJSON?f.a.error("".concat(e.responseJSON.err_msg," Click this to go back."),"",{onclick:function(){i.libraries.library_router.back()}}):f.a.error("An error occurred. Click this to go back.","",{onclick:function(){i.libraries.library_router.back()}})}})},render:function(t){this.options=r.a.extend(this.options,t);var e=this.templateFolder();a()(".tooltip").hide();var i,n=this.folderContainer.attributes.metadata.full_path;if(i=1===n.length?0:n[n.length-2][0],this.$el.html(e({path:this.folderContainer.attributes.metadata.full_path,parent_library_id:this.folderContainer.attributes.metadata.parent_library_id,id:this.options.id,upper_folder_id:i,order:this.current_sort_order})),this.options.dataset_id){var o=r.a.findWhere(self.rowViews,{id:this.options.dataset_id});o?o.showDatasetDetails():f.a.error("Requested dataset not found. Showing folder instead.")}else(null===this.options.show_page||this.options.show_page<1)&&(this.options.show_page=1),this.paginate();a()('#center [data-toggle="tooltip"]').tooltip({trigger:"hover"}),a()("#center").css("overflow","auto")},paginate:function(t){var e=Object(o.a)();this.options=r.a.extend(this.options,t),(null===this.options.show_page||this.options.show_page<1)&&(this.options.show_page=1),this.options.total_items_count=this.folder_container.get("folder").models.length,this.options.page_count=Math.ceil(this.options.total_items_count/e.libraries.preferences.get("folder_page_size"));var i=e.libraries.preferences.get("folder_page_size")*(this.options.show_page-1),n=null;n=this.folder_container.get("folder").models.slice(i,i+e.libraries.preferences.get("folder_page_size")),this.options.items_shown=n.length,e.libraries.preferences.get("folder_page_size")*this.options.show_page>this.options.total_items_count+e.libraries.preferences.get("folder_page_size")&&(n=[]),e.libraries.folderToolbarView.renderPaginator(this.options),this.collection.reset(n)},rePaint:function(t){this.options=r.a.extend(this.options,t),this.removeAllRows(),this.renderAll(),this.checkEmptiness()},addAll:function(t){var e=Object(o.a)();r.a.each(t,function(t){e.libraries.folderListView.collection.add(t,{current_sort_order:!1})}),a()('#center [data-toggle="tooltip"]').tooltip({trigger:"hover"}),this.checkEmptiness(),this.postRender()},postRender:function(){var t=Object(o.a)(),e=this.folderContainer.attributes.metadata;e.contains_file_or_folder=void 0!==this.collection.findWhere({type:"file"})||void 0!==this.collection.findWhere({type:"folder"}),t.libraries.folderToolbarView.configureElements(e)},renderAll:function(){var t=this;r.a.each(this.collection.models.reverse(),function(e){t.renderOne(e)}),this.postRender()},renderOne:function(t){this.options.contains_file_or_folder=!0,t.set("folder_id",this.id);var e=new Se.FolderRowView({model:t});this.rowViews[t.get("id")]=e,this.$el.find("#first_folder_item").after(e.el)},removeOne:function(t){this.$el.find("tr").filter(function(){return a()(this).data("id")&&a()(this).data("id")===t.id}).remove()},removeAllRows:function(){a()(".library-row").remove()},checkEmptiness:function(){0===this.$el.find(".dataset_row").length&&0===this.$el.find(".folder_row").length?this.$el.find(".empty-folder-message").show():this.$el.find(".empty-folder-message").hide()},sortColumnClicked:function(t){t.preventDefault(),this.current_sort_order="asc"===this.current_sort_order?"desc":"asc",this.current_sort_key=t.currentTarget.className.replace("sort-folder-",""),this.collection.sortFolder(this.current_sort_key,this.current_sort_order),this.renderSortIcon()},selectAll:function(t){var e=t.target.checked,i=this;a()(":checkbox","#folder_list_body").each(function(){this.checked=e;var t=a()(this).closest("tr");e?i.makeDarkRow(t):i.makeWhiteRow(t)})},selectClickedRow:function(t){var e,i,n="";e=a()(t.target).closest("tr"),"input"===t.target.localName?(n=t.target,i="input"):"td"===t.target.localName&&(n=e.find(":checkbox")[0],i="td"),n.checked?"td"===i?(n.checked="",this.makeWhiteRow(e)):"input"===i&&this.makeDarkRow(e):"td"===i?(n.checked="selected",this.makeDarkRow(e)):"input"===i&&this.makeWhiteRow(e)},makeDarkRow:function(t){t.removeClass("light").addClass("dark"),t.find("a").removeClass("light").addClass("dark"),t.find(".fa-file-o").removeClass("fa-file-o").addClass("fa-file"),t.find(".fa-folder-o").removeClass("fa-folder-o").addClass("fa-folder")},makeWhiteRow:function(t){t.removeClass("dark").addClass("light"),t.find("a").removeClass("dark").addClass("light"),t.find(".fa-file").removeClass("fa-file").addClass("fa-file-o"),t.find(".fa-folder").removeClass("fa-folder").addClass("fa-folder-o")},renderSortIcon:function(){"asc"===this.current_sort_order?(a()('[class*="sort-icon"]').removeClass("fa-sort-alpha-desc").removeClass("fa-sort-alpha-asc"),a()(".sort-icon-".concat(this.current_sort_key)).addClass("fa-sort-alpha-asc")):a()(".sort-icon-".concat(this.current_sort_key)).addClass("fa-sort-alpha-desc")},templateFolder:function(){return r.a.template(['<ol class="breadcrumb">','<li class="breadcrumb-item"><a title="Return to the list of libraries" href="#">Libraries</a></li>',"<% _.each(path, function(path_item) { %>","<% if (path_item[0] != id) { %>",'<li class="breadcrumb-item"><a title="Return to this folder" href="#/folders/<%- path_item[0] %>"><%- path_item[1] %></a> </li> ',"<% } else { %>",'<li class="breadcrumb-item active"><span title="You are in this folder"><%- path_item[1] %></span></li>',"<% } %>","<% }); %>","</ol>",'<table data-library-id="<%- parent_library_id  %>" class="grid table table-sm">',"<thead>",'<th class="button_heading"></th>','<th class="mid" style="width: 20px; " title="Check to select all datasets"><input id="select-all-checkboxes" style="margin: 0;" type="checkbox"></th>','<th><a class="sort-folder-name" title="Click to reverse order" href="#">name</a> <span title="Sorted alphabetically" class="sort-icon-name fa fa-sort-alpha-<%- order %>"></span></th>','<th style="width:20%;"><a class="sort-folder-description" title="Click to reverse order" href="#">description</a> <span title="Sorted alphabetically" class="sort-icon-description fa"></span></th>','<th style="width:5%;"><a class="sort-folder-file_ext" title="Click to reverse order" href="#">data type</a> <span title="Sorted alphabetically" class="sort-icon-file_ext fa"></span></th>','<th style="width:10%;">size</th>','<th style="width:160px;">time updated (UTC)</th>','<th style="width:5%;"><a class="sort-folder-state" title="Click to reverse order" href="#">state</a> <span title="Sorted alphabetically" class="sort-icon-state fa"></span></th>','<th style="width:150px;"></th> ',"</thead>",'<tbody id="folder_list_body">','<tr id="first_folder_item">',"<td>",'<a href="#<% if (upper_folder_id !== 0){ print("folders/" + upper_folder_id)} %>" title="Go to parent folder" class="btn_open_folder btn btn-secondary btn-sm">..<a>',"</td>","<td></td>","<td></td>","<td></td>","<td></td>","<td></td>","<td></td>","<td></td>","<td></td>","</tr>","</tbody>","</table>",'<div class="empty-folder-message" style="display:none;">',"This folder is either empty or you do not have proper access permissions to see the contents. If you expected something to show up",' please consult the <a href="https://galaxyproject.org/data-libraries/#permissions" target="_blank">library security wikipage</a>.',"</div>"].join(""))}})},$e={LibraryRowView:c.a.View.extend({events:{"click .edit_library_btn":"edit_button_clicked","click .cancel_library_btn":"cancel_library_modification","click .save_library_btn":"save_library_modification","click .delete_library_btn":"delete_library","click .undelete_library_btn":"undelete_library"},edit_mode:!1,element_visibility_config:{upload_library_btn:!1,edit_library_btn:!1,permission_library_btn:!1,save_library_btn:!1,cancel_library_btn:!1,delete_library_btn:!1,undelete_library_btn:!1},initialize:function(t){this.render(t)},render:function(t){void 0===t&&(t=Object(o.a)().libraries.libraryListView.collection.get(this.$el.data("id")),console.log(t));this.prepareButtons(t);var e=this.templateRow();return this.setElement(e({library:t,button_config:this.element_visibility_config,edit_mode:this.edit_mode})),this.$el.show(),this},repaint:function(t){this.$el.find('[data-toggle="tooltip"]').tooltip("dispose");var e=this.$el;this.render(),e.replaceWith(this.$el),this.$el.find('[data-toggle="tooltip"]').tooltip({trigger:"hover"})},prepareButtons:function(t){var e=this.element_visibility_config;!1===this.edit_mode?(e.save_library_btn=!1,e.cancel_library_btn=!1,e.delete_library_btn=!1,!0===t.get("deleted")?(e.undelete_library_btn=!0,e.upload_library_btn=!1,e.edit_library_btn=!1,e.permission_library_btn=!1):!1===t.get("deleted")&&(e.save_library_btn=!1,e.cancel_library_btn=!1,e.undelete_library_btn=!1,!0===t.get("can_user_add")&&(e.upload_library_btn=!0),!0===t.get("can_user_modify")&&(e.edit_library_btn=!0),!0===t.get("can_user_manage")&&(e.permission_library_btn=!0))):!0===this.edit_mode&&(e.upload_library_btn=!1,e.edit_library_btn=!1,e.permission_library_btn=!1,e.save_library_btn=!0,e.cancel_library_btn=!0,e.delete_library_btn=!0,e.undelete_library_btn=!1),this.element_visibility_config=e},edit_button_clicked:function(){this.edit_mode=!0,this.repaint()},cancel_library_modification:function(){this.edit_mode=!1,this.repaint()},save_library_modification:function(){var t=Object(o.a)().libraries.libraryListView.collection.get(this.$el.data("id")),e=!1,i=this.$el.find(".input_library_name").val();if(void 0!==i&&i!==t.get("name")){if(!(i.length>2))return void f.a.warning("Library name has to be at least 3 characters long.");t.set("name",i),e=!0}var n=this.$el.find(".input_library_description").val();void 0!==n&&n!==t.get("description")&&(t.set("description",n),e=!0);var a=this.$el.find(".input_library_synopsis").val();if(void 0!==a&&a!==t.get("synopsis")&&(t.set("synopsis",a),e=!0),e){var s=this;t.save(null,{patch:!0,success:function(t){s.edit_mode=!1,s.repaint(t),f.a.success("Changes to library saved.")},error:function(t,e){void 0!==e.responseJSON?f.a.error(e.responseJSON.err_msg):f.a.error("An error occurred while attempting to update the library.")}})}else this.edit_mode=!1,this.repaint(t),f.a.info("Nothing has changed.")},delete_library:function(){var t=Object(o.a)(),e=t.libraries.libraryListView.collection.get(this.$el.data("id")),i=this;e.destroy({success:function(e){e.set("deleted",!0),t.libraries.libraryListView.collection.add(e),i.edit_mode=!1,!1===t.libraries.preferences.get("with_deleted")?(a()(".tooltip").hide(),i.repaint(e),i.$el.remove()):!0===t.libraries.preferences.get("with_deleted")&&i.repaint(e),f.a.success("Library has been marked deleted.")},error:function(t,e){void 0!==e.responseJSON?f.a.error(e.responseJSON.err_msg):f.a.error("An error occurred during deleting the library.")}})},undelete_library:function(){var t=Object(o.a)(),e=t.libraries.libraryListView.collection.get(this.$el.data("id")),i=this;e.url="".concat(e.urlRoot+e.id,"?undelete=true"),e.destroy({success:function(e){e.set("deleted",!1),t.libraries.libraryListView.collection.add(e),i.edit_mode=!1,i.repaint(e),f.a.success("Library has been undeleted.")},error:function(t,e){void 0!==e.responseJSON?f.a.error(e.responseJSON.err_msg):f.a.error("An error occurred while undeleting the library.")}})},templateRow:function(){return r.a.template(['<tr class="<% if(library.get("deleted") === true) { print("active") } %>" style="display:none;" data-id="<%- library.get("id") %>">',"<% if(!edit_mode) { %>",'<% if(library.get("deleted")) { %>','<td style="color:grey;"><%- library.get("name") %></td>',"<% } else { %>",'<td><a href="#folders/<%- library.get("root_folder_id") %>"><%- library.get("name") %></a></td>',"<% } %>",'<% if(library.get("description")) { %>','<% if( (library.get("description")).length> 80 ) { %>','<td data-toggle="tooltip" data-placement="bottom" title="<%= _.escape(library.get("description")) %>"><%= _.escape(library.get("description")).substring(0, 80) + "..." %></td>',"<% } else { %>",'<td><%= _.escape(library.get("description"))%></td>',"<% } %>","<% } else { %>","<td></td>","<% } %>",'<% if(library.get("synopsis")) { %>','<% if( (library.get("synopsis")).length> 120 ) { %>','<td data-toggle="tooltip" data-placement="bottom" title="<%= _.escape(library.get("synopsis")) %>"><%= _.escape(library.get("synopsis")).substring(0, 120) + "..." %></td>',"<% } else { %>",'<td><%= _.escape(library.get("synopsis"))%></td>',"<% } %>","<% } else { %>","<td></td>","<% } %>","<% } else if(edit_mode){ %>",'<td><textarea rows="4" class="form-control input_library_name" placeholder="name" ><%- library.get("name") %></textarea></td>','<td><textarea rows="4" class="form-control input_library_description" placeholder="description" ><%- library.get("description") %></textarea></td>','<td><textarea rows="4" class="form-control input_library_synopsis" placeholder="synopsis" ><%- library.get("synopsis") %></textarea></td>',"<% } %>",'<td class="right-center">','<% if( (library.get("public")) && (library.get("deleted") === false) ) { %>','<span data-toggle="tooltip" data-placement="left" title="Unrestricted library" style="color:grey;" class="fa fa-globe fa-lg"> </span>',"<% }%>",'<button data-toggle="tooltip" data-placement="left" title="Modify \'<%- library.get("name") %>\'" class="btn btn-sm edit_library_btn" type="button" style="<% if(button_config.edit_library_btn === false) { print("display:none;") } %>"><span class="fa fa-pencil"></span> Edit</button>','<a data-toggle="tooltip" data-placement="left" title="Permissions of \'<%- library.get("name") %>\'" href="#library/<%- library.get("id") %>/permissions"><button class="btn btn-sm permission_library_btn" type="button" style="<% if(button_config.permission_library_btn === false) { print("display:none;") } %>"><span class="fa fa-group"></span> Manage</button></a>','<button data-toggle="tooltip" data-placement="left" title="Save changes" class="btn btn-sm save_library_btn" type="button" style="<% if(button_config.save_library_btn === false) { print("display:none;") } %>"><span class="fa fa-floppy-o"></span> Save</button>','<button data-toggle="tooltip" data-placement="left" title="Discard changes" class="btn btn-sm cancel_library_btn" type="button" style="<% if(button_config.cancel_library_btn === false) { print("display:none;") } %>"><span class="fa fa-times"></span> Cancel</button>','<button data-toggle="tooltip" data-placement="left" title="Delete \'<%- library.get("name") %>\'" class="btn btn-sm delete_library_btn" type="button" style="<% if(button_config.delete_library_btn === false) { print("display:none;") } %>"><span class="fa fa-trash-o"></span> Delete</button>','<span data-toggle="tooltip" data-placement="left" title="Marked deleted" style="color:grey; <% if(button_config.undelete_library_btn === false) { print("display:none;") } %>" class="fa fa-ban fa-lg"></span>','<button data-toggle="tooltip" data-placement="left" title="Undelete \'<%- library.get("name") %>\' " class="btn btn-sm undelete_library_btn" type="button" style="<% if(button_config.undelete_library_btn === false) { print("display:none;") } %>"><span class="fa fa-unlock"></span> Undelete</button>',"</td>","</tr>"].join(""))}})},Oe={LibraryListView:c.a.View.extend({el:"#libraries_element",events:{"click .sort-libraries-link":"sort_clicked"},defaults:{page_count:null,show_page:null,all_fetched:!1},initialize:function(t){this.options=$.a.defaults(this.options||{},t,this.defaults);var e=this;this.modal=null,this.collection=new xe.Libraries,this.collection.url="".concat(this.collection.urlRoot,"?deleted=false"),this.collection.fetch({success:function(){e.render()},error:function(t,e){void 0!==e.responseJSON?f.a.error(e.responseJSON.err_msg):f.a.error("An error occurred.")}})},render:function(t){var e=Object(o.a)();this.options=$.a.extend(this.options,t),this.setElement("#libraries_element");var i=this.templateLibraryList(),n=null,s=null,r=function(t){return!0===t.get("public")};if(a()(".tooltip").hide(),void 0!==t&&(s=void 0!==t.models?t.models:null),null!==this.collection&&null===s)this.sortLibraries(),n=e.libraries.preferences.get("with_deleted")?this.collection.models:this.collection.where({deleted:!1}),e.libraries.preferences.get("without_restricted")&&(n=$.a.filter(n,r));else if(null!==s){if(e.libraries.preferences.get("with_deleted"))n=s;else{n=$.a.filter(s,function(t){return!1===t.get("deleted")})}e.libraries.preferences.get("without_restricted")&&(n=$.a.filter(n,r))}else n=[];(null===this.options.show_page||this.options.show_page<1)&&(this.options.show_page=1),this.options.total_libraries_count=n.length;var l=e.libraries.preferences.get("library_page_size")*(this.options.show_page-1);this.options.page_count=Math.ceil(this.options.total_libraries_count/e.libraries.preferences.get("library_page_size")),this.options.total_libraries_count>0&&l<this.options.total_libraries_count?(n=n.slice(l,l+e.libraries.preferences.get("library_page_size")),this.options.libraries_shown=n.length,e.libraries.preferences.get("library_page_size")*this.options.show_page>this.options.total_libraries_count+e.libraries.preferences.get("library_page_size")&&(n=[]),this.$el.html(i({length:1,order:e.libraries.preferences.get("sort_order"),search_term:e.libraries.libraryToolbarView.options.search_term})),e.libraries.libraryToolbarView.renderPaginator(this.options),this.renderRows(n)):(this.$el.html(i({length:0,order:e.libraries.preferences.get("sort_order"),search_term:e.libraries.libraryToolbarView.options.search_term})),e.libraries.libraryToolbarView.renderPaginator(this.options)),a()('#center [data-toggle="tooltip"]').tooltip({trigger:"hover"}),a()("#center").css("overflow","auto")},fetchDeleted:function(){if(this.options.all_fetched)this.render();else{var t=this;this.collection.url="".concat(this.collection.urlRoot,"?deleted=true"),this.collection.fetch({remove:!1,success:function(){t.options.all_fetched=!0,t.render()},error:function(t,e){void 0!==e.responseJSON?f.a.error(e.responseJSON.err_msg):f.a.error("An error occurred.")}})}},renderRows:function(t){for(var e=0;e<t.length;e++){var i=t[e];this.renderOne({library:i})}},renderOne:function(t){var e=t.library,i=new $e.LibraryRowView(e);this.$el.find("#library_list_body").append(i.el)},sort_clicked:function(){var t=Object(o.a)();"asc"===t.libraries.preferences.get("sort_order")?t.libraries.preferences.set({sort_order:"desc"}):t.libraries.preferences.set({sort_order:"asc"}),this.render()},sortLibraries:function(){var t=Object(o.a)();"name"===t.libraries.preferences.get("sort_by")&&("asc"===t.libraries.preferences.get("sort_order")?this.collection.sortLibraries("name","asc"):"desc"===t.libraries.preferences.get("sort_order")&&this.collection.sortLibraries("name","desc"))},searchLibraries:function(t){if(""!==a.a.trim(t)){var e;e=this.collection.search(t),this.options.searching=!0,this.render({models:e,show_page:1})}else this.options.searching=!1,this.render()},templateLibraryList:function(){return $.a.template(['<div class="library_container table-responsive">',"<% if(length === 0) { %>","<% if(search_term.length > 0) { %>","<div>","There are no libraries matching your search. Try different keyword.","</div>","<% } else{ %>","<div>","There are no libraries visible to you here. If you expected some to show up please consult the",' <a href="https://galaxyproject.org/data-libraries/#permissions" target="_blank">library security wikipage</a>.',"</div>","<% }%>","<% } else{ %>",'<table class="grid table table-sm">',"<thead>",'<th style="width:30%;">','<a class="sort-libraries-link" title="Click to reverse order" href="#">',"name","</a>",'<span title="Sorted alphabetically" class="fa fa-sort-alpha-<%- order %>"/>',"</th>",'<th style="width:22%;">description</th>','<th style="width:22%;">synopsis</th> ','<th style="width:26%;"></th>',"</thead>",'<tbody id="library_list_body">',"</tbody>","</table>","<% }%>","</div>"].join(""))}})},Ae={LibraryToolbarView:c.a.View.extend({el:"#center",defaults:{search_term:""},events:{"click #create_new_library_btn":"createLibraryFromModal","click #include_deleted_chk":"includeDeletedChecked","click #exclude_restricted_chk":"excludeRestrictedChecked","click .page_size_prompt":"showPageSizePrompt","keyup .library-search-input":"searchLibraries"},initialize:function(t){this.options=r.a.defaults(this.options||{},t,this.defaults),this.render()},render:function(){var t=Object(o.a)(),e=this.templateToolBar(),i=!1,n=!0;t.user&&(i=t.user.isAdmin(),n=t.user.isAnonymous()),this.$el.html(e({admin_user:i,anon_user:n})),i&&(this.$el.find("#include_deleted_chk")[0].checked=t.libraries.preferences.get("with_deleted"),this.$el.find("#exclude_restricted_chk")[0].checked=t.libraries.preferences.get("without_restricted"))},renderPaginator:function(t){var e=Object(o.a)();this.options=r.a.extend(this.options,t);var i=this.templatePaginator();this.$el.find(".library-paginator").html(i({show_page:parseInt(this.options.show_page),page_count:parseInt(this.options.page_count),total_libraries_count:this.options.total_libraries_count,libraries_shown:this.options.libraries_shown,library_page_size:e.libraries.preferences.get("library_page_size")}))},createLibraryFromModal:function(t){t.preventDefault(),t.stopPropagation();var e=Object(o.a)(),i=this;this.modal=e.modal,this.modal.show({closing_events:!0,title:h()("Create New Library"),body:this.templateNewLibraryInModal(),buttons:{Create:function(){i.createNewLibrary()},Close:function(){i.modal.hide()}}})},createNewLibrary:function(){var t=Object(o.a)(),e=this.serializeNewLibrary();if(this.validateNewLibrary(e)){var i=new xe.Library,n=this;i.save(e,{success:function(e){t.libraries.libraryListView.collection.add(e),n.modal.hide(),n.clearLibraryModal(),t.libraries.libraryListView.render(),f.a.success("Library created.")},error:function(t,e){void 0!==e.responseJSON?f.a.error(e.responseJSON.err_msg):f.a.error("An error occurred.")}})}else f.a.error("Library's name is missing.");return!1},showPageSizePrompt:function(t){t.preventDefault();var e=Object(o.a)(),i=prompt("How many libraries per page do you want to see?",e.libraries.preferences.get("library_page_size"));null!=i&&i==parseInt(i)&&(e.libraries.preferences.set({library_page_size:parseInt(i)}),e.libraries.libraryListView.render({show_page:1}))},clearLibraryModal:function(){a()("input[name='Name']").val(""),a()("input[name='Description']").val(""),a()("input[name='Synopsis']").val("")},serializeNewLibrary:function(){return{name:a()("input[name='Name']").val(),description:a()("input[name='Description']").val(),synopsis:a()("input[name='Synopsis']").val()}},validateNewLibrary:function(t){return""!==t.name},includeDeletedChecked:function(t){var e=Object(o.a)();t.target.checked?(e.libraries.preferences.set({with_deleted:!0}),e.libraries.libraryListView.fetchDeleted()):(e.libraries.preferences.set({with_deleted:!1}),e.libraries.libraryListView.render())},excludeRestrictedChecked:function(t){var e=Object(o.a)();t.target.checked?e.libraries.preferences.set({without_restricted:!0}):e.libraries.preferences.set({without_restricted:!1}),e.libraries.libraryListView.render()},searchLibraries:function(t){var e=Object(o.a)(),i=a()(".library-search-input").val();this.options.search_term=i,e.libraries.libraryListView.searchLibraries(i)},templateToolBar:function(){return r.a.template('<div class="library_style_container">\n                <div class="d-flex align-items-center mb-2">\n                    <a class="btn btn-secondary mr-1" data-toggle="tooltip" data-placement="top" title="Go to first page" href="#">\n                        <span class="fa fa-home"/>\n                    </a>\n                    <a class="library-help-button btn btn-secondary mr-1" data-toggle="tooltip" title="See this screen annotated" href="https://galaxyproject.org/data-libraries/screen/list-of-libraries/" target="_blank">\n                        <span class="fa fa-question"/>\n                    </a>\n                    <% if(admin_user === true) { %>\n                        <button data-toggle="tooltip" data-placement="top" title="Create new library" id="create_new_library_btn" class="mr-1 btn btn-secondary" type="button">\n                            <span class="fa fa-plus"/>\n                        </button>\n                    <% } %>\n                    <div class="d-flex align-items-center library-paginator mr-1" />\n                        <form class="form-inline mr-1">\n                            <input type="text" class="form-control library-search-input mr-1" placeholder="Great Library" size="15">\n                            <% if(admin_user === true) { %>\n                                <div class="form-check mr-1">\n                                    <input class="form-check-input" id="include_deleted_chk" type="checkbox"/>\n                                    <label class="form-check-label" for="include_deleted_chk">include deleted</label>\n                                </div>\n                                <div class="form-check mr-1">\n                                    <input class="form-check-input" id="exclude_restricted_chk" type="checkbox"/>\n                                    <label class="form-check-label" for="exclude_restricted_chk">exclude restricted</label>\n                                </div>\n                            <% } %>\n                        </form>\n                    </div>\n                    <div id="libraries_element" />\n                </div>\n            </div>')},templatePaginator:function(){return r.a.template(['<ul class="pagination mr-1">',"<% if ( ( show_page - 1 ) > 0 ) { %>","<% if ( ( show_page - 1 ) > page_count ) { %>",'<li class="page-item"><a class="page-link" href="#page/1"><span class="fa fa-angle-double-left"></span></a></li>','<li class="page-item disabled"><a class="page-link" href="#page/<% print( show_page ) %>"><% print( show_page - 1 ) %></a></li>',"<% } else { %>",'<li class="page-item"><a class="page-link" href="#page/1"><span class="fa fa-angle-double-left"></span></a></li>','<li class="page-item"><a class="page-link" href="#page/<% print( show_page - 1 ) %>"><% print( show_page - 1 ) %></a></li>',"<% } %>","<% } else { %>",'<li class="page-item disabled"><a class="page-link" href="#page/1"><span class="fa fa-angle-double-left"></span></a></li>','<li class="page-item disabled"><a class="page-link" href="#page/<% print( show_page ) %>"><% print( show_page - 1 ) %></a></li>',"<% } %>",'<li class="page-item active">','<a class="page-link" href="#page/<% print( show_page ) %>"><% print( show_page ) %></a>',"</li>","<% if ( ( show_page ) < page_count ) { %>",'<li class="page-item"><a class="page-link" href="#page/<% print( show_page + 1 ) %>"><% print( show_page + 1 ) %></a></li>','<li class="page-item"><a class="page-link" href="#page/<% print( page_count ) %>"><span class="fa fa-angle-double-right"></span></a></li>',"<% } else { %>",'<li class="page-item disabled"><a class="page-link" href="#page/<% print( show_page  ) %>"><% print( show_page + 1 ) %></a></li>','<li class="page-item disabled"><a class="page-link" href="#page/<% print( page_count ) %>"><span class="fa fa-angle-double-right"></span></a></li>',"<% } %>","</ul>",'<span class="mr-1">',' <%- libraries_shown %> libraries shown <a href="" data-toggle="tooltip" data-placement="top" title="currently <%- library_page_size %> per page" class="page_size_prompt">(change)</a>',"</span>",'<span class="mr-1">'," <%- total_libraries_count %> total","</span>"].join(""))},templateNewLibraryInModal:function(){return r.a.template(['<div id="new_library_modal">',"<form>",'<input type="text" name="Name" value="" placeholder="Name" autofocus>','<input type="text" name="Description" value="" placeholder="Description">','<input type="text" name="Synopsis" value="" placeholder="Synopsis">',"</form>","</div>"].join(""))}})},je=i(28),De=i(103),Ie=i(110),Me=i(46),Re=(i(165),{FolderToolbarView:c.a.View.extend({el:"#center",events:{"click .toolbtn-create-folder":"createFolderFromModal","click .toolbtn-bulk-import":"importToHistoryModal","click .include-deleted-datasets-chk":"checkIncludeDeleted","click .toolbtn-bulk-delete":"deleteSelectedItems","click .toolbtn-show-locinfo":"showLocInfo","click .page-size-prompt":"showPageSizePrompt","click .toolbtn-collection-import":"showCollectionSelect"},defaults:{can_add_library_item:!1,contains_file_or_folder:!1,chain_call_control:{total_number:0,failed_number:0},disabled_jstree_element:"folders"},modal:null,jstree:null,histories:null,select_genome:null,select_extension:null,list_extensions:[],auto:{id:"auto",text:"Auto-detect",description:"This system will try to detect the file type automatically. If your file is not detected properly as one of the known formats, it most likely means that it has some format problems (e.g., different number of columns on different rows). You can still coerce the system to set your data to the format you think it should be. You can also upload compressed files, which will automatically be decompressed."},list_genomes:[],initialize:function(t){this.options=r.a.defaults(t||{},this.defaults),this.fetchExtAndGenomes(),this.render()},render:function(t){this.options=r.a.extend(this.options,t);var e=Object(o.a)(),i=this.templateToolBar(),n={id:this.options.id,is_admin:!1,is_anonym:!0,multiple_add_dataset_options:!1,Galaxy:e};e.user&&(n.is_admin=e.user.isAdmin(),n.is_anonym=e.user.isAnonymous(),null===e.config.user_library_import_dir&&!1===e.config.allow_library_path_paste&&null===e.config.library_import_dir||(n.multiple_add_dataset_options=!0)),this.$el.html(i(n))},renderPaginator:function(t){this.options=r.a.extend(this.options,t);var e=Object(o.a)(),i=this.templatePaginator();a()("body").find(".folder-paginator").html(i({id:this.options.id,show_page:parseInt(this.options.show_page),page_count:parseInt(this.options.page_count),total_items_count:this.options.total_items_count,items_shown:this.options.items_shown,folder_page_size:e.libraries.preferences.get("folder_page_size")}))},configureElements:function(t){this.options=r.a.extend(this.options,t);var e=Object(o.a)();!0===this.options.can_add_library_item?a()(".add-library-items").show():a()(".add-library-items").hide(),!0===this.options.contains_file_or_folder&&e.user?e.user.isAnonymous()?(a()(".dataset-manipulation").show(),a()(".logged-dataset-manipulation").hide()):(a()(".logged-dataset-manipulation").show(),a()(".dataset-manipulation").show()):(a()(".logged-dataset-manipulation").hide(),a()(".dataset-manipulation").hide()),this.$el.find('[data-toggle="tooltip"]').tooltip({trigger:"hover"})},createFolderFromModal:function(t){var e=this;t.preventDefault(),t.stopPropagation();var i=Object(o.a)(),n=this.templateNewFolderInModal();this.modal=i.modal,this.modal.show({closing_events:!0,title:h()("Create New Folder"),body:n(),buttons:{Create:function(){e.createNewFolderEvent()},Close:function(){i.modal.hide()}}})},createNewFolderEvent:function(){var t=Object(o.a)(),e=this.serializeNewFolder();if(this.validateNewFolder(e)){var i,n=new xe.FolderAsModel,a=c.a.history.fragment.split("/");i=a.indexOf("page")>-1?a[a.length-3]:a[a.length-1],n.url=n.urlRoot+i,n.save(e,{success:function(e){t.modal.hide(),f.a.success("Folder created."),e.set({type:"folder"}),t.libraries.folderListView.collection.add(e)},error:function(e,i){t.modal.hide(),void 0!==i.responseJSON?f.a.error(i.responseJSON.err_msg):f.a.error("An error occurred.")}})}else f.a.error("Folder's name is missing.");return!1},serializeNewFolder:function(){return{name:a()("input[name='Name']").val(),description:a()("input[name='Description']").val()}},validateNewFolder:function(t){return""!==t.name},importToHistoryModal:function(t){var e=this;t.preventDefault();var i=Object(o.a)(),n=this.findCheckedRows(),a=this.templateImportIntoHistoryModal();0===n.length?f.a.info("You must select some datasets first."):this.fetchUserHistories().done(function(){e.modal=i.modal,e.modal.show({closing_events:!0,title:h()("Import into History"),body:a({histories:e.histories.models}),buttons:{Import:function(){e.importAllIntoHistory()},Close:function(){i.modal.hide()}}})}).fail(function(t,e){void 0!==e.responseJSON?f.a.error(e.responseJSON.err_msg):f.a.error("An error occurred.")})},fetchUserHistories:function(){return this.histories=new xe.GalaxyHistories,this.histories.fetch()},importAllIntoHistory:function(){var t=this;this.modal.disableButton("Import");var e=this.modal.$("input[name=history_name]").val();if(""!==e)this.createNewHistory(e).done(function(e){t.processImportToHistory(e.id,e.name)}).fail(function(t,e,i){f.a.error("An error occurred.")}).always(function(){t.modal.enableButton("Import")});else{var i=a()("select[name=import_to_history] option:selected").val(),n=a()("select[name=import_to_history] option:selected").text();this.processImportToHistory(i,n),this.modal.enableButton("Import")}},createNewHistory:function(t){return a.a.post("".concat(Object(d.getAppRoot)(),"api/histories"),{name:t})},processImportToHistory:function(t,e){for(var i=this.findCheckedItems(),n=[],o=i.dataset_ids.length-1;o>=0;o--){var s=i.dataset_ids[o],r=new xe.HistoryItem;r.url="".concat(r.urlRoot+t,"/contents"),r.content=s,r.source="library",n.push(r)}for(var l=i.folder_ids.length-1;l>=0;l--){var c=i.folder_ids[l],u=new xe.HistoryItem;u.url="".concat(u.urlRoot+t,"/contents"),u.content=c,u.source="library_folder",n.push(u)}this.initChainCallControl({length:n.length,action:"to_history",history_name:e}),a.a.getJSON("".concat(Object(d.getAppRoot)(),"history/set_as_current?id=").concat(t)),this.chainCallImportingIntoHistory(n,e)},updateProgress:function(){this.progress+=this.progressStep,a()(".progress-bar-import").width("".concat(Math.round(this.progress),"%"));var t="".concat(Math.round(this.progress),"% Complete");a()(".completion_span").text(t)},download:function(t){var e=this.findCheckedItems(),i="".concat(Object(d.getAppRoot)(),"api/libraries/datasets/download/").concat(t),n={ld_ids:e.dataset_ids,folder_ids:e.folder_ids};this.processDownload(i,n,"get")},processDownload:function(t,e,i){if(t&&e){e="string"==typeof e?e:a.a.param(e);var n="";a.a.each(e.split("&"),function(){var t=this.split("=");n+='<input type="hidden" name="'.concat(t[0],'" value="').concat(t[1],'" />')}),a()('<form action="'.concat(t,'" method="').concat(i||"post",'">').concat(n,"</form>")).appendTo("body").submit().remove(),f.a.info("Your download will begin soon.")}else f.a.error("An error occurred.")},addFilesFromHistoryModal:function(){var t=this,e=Object(o.a)();this.histories=new xe.GalaxyHistories,this.histories.fetch().done(function(){t.modal=e.modal;var i=t.templateAddFilesFromHistory();t.modal.show({closing_events:!0,title:h()("Adding datasets from your history"),body:i({histories:t.histories.models}),buttons:{Add:function(){t.addAllDatasetsFromHistory()},Close:function(){e.modal.hide()}},closing_callback:function(){e.libraries.library_router.navigate("folders/".concat(t.id),{trigger:!0})}}),t.fetchAndDisplayHistoryContents(t.histories.models[0].id),a()("#dataset_add_bulk").change(function(e){t.fetchAndDisplayHistoryContents(e.target.value)})}).fail(function(t,e){void 0!==e.responseJSON?f.a.error(e.responseJSON.err_msg):f.a.error("An error occurred.")})},importFilesFromPathModal:function(){var t=this,e=Object(o.a)();this.modal=e.modal;var i=this.templateImportPathModal();this.modal.show({closing_events:!0,title:h()("Please enter paths to import"),body:i({}),buttons:{Import:function(){t.importFromPathsClicked(t)},Close:function(){e.modal.hide()}},closing_callback:function(){e.libraries.library_router.navigate("folders/".concat(t.id),{trigger:!0})}}),this.renderSelectBoxes()},fetchExtAndGenomes:function(){var t=this;p.a.get({url:"".concat(Object(d.getAppRoot)(),"api/datatypes?extension_only=False"),success:function(e){for(var i in t.list_extensions=[],e)t.list_extensions.push({id:e[i].extension,text:e[i].extension,description:e[i].description,description_url:e[i].description_url});t.list_extensions.sort(function(t,e){return t.id>e.id?1:t.id<e.id?-1:0}),t.list_extensions.unshift(t.auto)},cache:!0}),p.a.get({url:"".concat(Object(d.getAppRoot)(),"api/genomes"),success:function(e){for(var i in t.list_genomes=[],e)t.list_genomes.push({id:e[i][1],text:e[i][0]});t.list_genomes.sort(function(t,e){return t.id>e.id?1:t.id<e.id?-1:0})},cache:!0})},renderSelectBoxes:function(){var t=Object(o.a)();this.select_genome=new ke.a.View({css:"library-genome-select",data:this.list_genomes,container:t.modal.$el.find("#library_genome_select"),value:"?"}),this.select_extension=new ke.a.View({css:"library-extension-select",data:this.list_extensions,container:t.modal.$el.find("#library_extension_select"),value:"auto"})},importFilesFromGalaxyFolderModal:function(t){var e=this,i=this.templateBrowserModal(),n=Object(o.a)();this.modal=n.modal,this.modal.show({closing_events:!0,title:h()("Please select folders or files"),body:i({}),buttons:{Import:function(){e.importFromJstreePath(e,t)},Close:function(){n.modal.hide()}},closing_callback:function(){n.libraries.library_router.navigate("folders/".concat(e.id),{trigger:!0})}}),a()(".libimport-select-all").bind("click",function(){a()("#jstree_browser").jstree("check_all")}),a()(".libimport-select-none").bind("click",function(){a()("#jstree_browser").jstree("uncheck_all")}),this.renderSelectBoxes(),t.disabled_jstree_element="folders",this.renderJstree(t),a()("input[type=radio]").change(function(i){"jstree-disable-folders"===i.target.value?(t.disabled_jstree_element="folders",e.renderJstree(t),a()(".jstree-folders-message").hide(),a()(".jstree-preserve-structure").hide(),a()(".jstree-files-message").show()):"jstree-disable-files"===i.target.value&&(a()(".jstree-files-message").hide(),a()(".jstree-folders-message").show(),a()(".jstree-preserve-structure").show(),t.disabled_jstree_element="files",e.renderJstree(t))})},renderJstree:function(t){this.options=r.a.extend(this.options,t);var e=t.source||"userdir",i=this.options.disabled_jstree_element;this.jstree=new xe.Jstree,this.jstree.url="".concat(this.jstree.urlRoot,"?target=").concat(e,"&format=jstree&disable=").concat(i),this.jstree.fetch({success:function(t,e){a()("#jstree_browser").jstree("destroy"),a()("#jstree_browser").jstree({core:{data:t},plugins:["types","checkbox"],types:{folder:{icon:"jstree-folder"},file:{icon:"jstree-file"}},checkbox:{three_state:!1}})},error:function(t,e){void 0!==e.responseJSON?404001===e.responseJSON.err_code?f.a.warning(e.responseJSON.err_msg):f.a.error(e.responseJSON.err_msg):f.a.error("An error occurred.")}})},importFromPathsClicked:function(){var t=this.modal.$el.find(".preserve-checkbox").is(":checked"),e=this.modal.$el.find(".link-checkbox").is(":checked"),i=this.modal.$el.find(".spacetab-checkbox").is(":checked"),n=this.modal.$el.find(".posix-checkbox").is(":checked"),o=this.modal.$el.find(".tag-files").is(":checked"),s=this.select_extension.value(),r=this.select_genome.value(),l=a()("textarea#import_paths").val(),c=[];if(l){this.modal.disableButton("Import");for(var d=(l=l.split("\n")).length-1;d>=0;d--){var u=l[d].trim();0!==u.length&&c.push(u)}this.initChainCallControl({length:c.length,action:"adding_datasets"}),this.chainCallImportingFolders({paths:c,preserve_dirs:t,link_data:e,space_to_tab:i,to_posix_lines:n,source:"admin_path",file_type:s,tag_using_filenames:o,dbkey:r})}else f.a.info("Please enter a path relative to Galaxy root.")},initChainCallControl:function(t){var e,i=Object(o.a)();switch(t.action){case"adding_datasets":e=this.templateAddingDatasetsProgressBar(),this.modal.$el.find(".modal-body").html(e({folder_name:this.options.folder_name}));break;case"deleting_datasets":e=this.templateDeletingItemsProgressBar(),this.modal.$el.find(".modal-body").html(e());break;case"to_history":e=this.templateImportIntoHistoryProgressBar(),this.modal.$el.find(".modal-body").html(e({history_name:t.history_name}));break;default:i.emit.error("Wrong action specified.","datalibs")}this.progress=0,this.progressStep=100/t.length,this.options.chain_call_control.total_number=t.length,this.options.chain_call_control.failed_number=0},importFromJstreePath:function(t,e){var i=a()("#jstree_browser").jstree().get_selected(!0),n=r.a.filter(i,function(t){return 0==t.state.disabled}),o=this.modal.$el.find(".preserve-checkbox").is(":checked"),s=this.modal.$el.find(".link-checkbox").is(":checked"),l=this.modal.$el.find(".spacetab-checkbox").is(":checked"),c=this.modal.$el.find(".posix-checkbox").is(":checked"),d=this.select_extension.value(),u=this.select_genome.value(),h=this.modal.$el.find(".tag-files").is(":checked"),p=n[0].type,m=[];if(n.length<1)f.a.info("Please select some items first.");else{this.modal.disableButton("Import");for(var g=n.length-1;g>=0;g--)void 0!==n[g].li_attr.full_path&&m.push(n[g].li_attr.full_path);if(this.initChainCallControl({length:m.length,action:"adding_datasets"}),"folder"===p){var _="".concat(e.source,"_folder");this.chainCallImportingFolders({paths:m,preserve_dirs:o,link_data:s,space_to_tab:l,to_posix_lines:c,source:_,file_type:d,dbkey:u,tag_using_filenames:h})}else if("file"===p){var v="".concat(e.source,"_file");this.chainCallImportingUserdirFiles({paths:m,file_type:d,dbkey:u,link_data:s,space_to_tab:l,to_posix_lines:c,source:v,tag_using_filenames:h})}}},fetchAndDisplayHistoryContents:function(t){var e=this;new xe.HistoryContents({id:t}).fetch({success:function(i){var n=e.templateHistoryContents();e.histories.get(t).set({contents:i}),e.modal.$el.find(".library_selected_history_content").html(n({history_contents:i.models.reverse()})),e.modal.$el.find(".history-import-select-all").bind("click",function(){a()(".library_selected_history_content [type=checkbox]").prop("checked",!0)}),e.modal.$el.find(".history-import-unselect-all").bind("click",function(){a()(".library_selected_history_content [type=checkbox]").prop("checked",!1)})},error:function(t,e){void 0!==e.responseJSON?f.a.error(e.responseJSON.err_msg):f.a.error("An error occurred.")}})},addAllDatasetsFromHistory:function(){var t=this.modal.$el.find(".library_selected_history_content").find(":checked"),e=[],i=[],n=[];if(t.length<1)f.a.info("You must select some datasets first.");else{this.modal.disableButton("Add"),t.each(function(){var t=a()(this).closest("li").data("id");if(t){var n=a()(this).closest("li").data("name");e.push(t),i.push(n)}});for(var o=e.length-1;o>=0;o--){var s=e[o],r=new xe.Item;r.url="".concat(Object(d.getAppRoot)(),"api/folders/").concat(this.options.id,"/contents"),"collection"===i[o]?r.set({from_hdca_id:s}):r.set({from_hda_id:s}),n.push(r)}this.initChainCallControl({length:n.length,action:"adding_datasets"}),this.chainCallAddingHdas(n)}},chainCallImportingIntoHistory:function(t,e){var i=this,n=Object(o.a)(),s=t.pop();if(void 0===s)return 0===this.options.chain_call_control.failed_number?f.a.success("Selected datasets imported into history. Click this to start analyzing it.","",{onclick:function(){window.location=Object(d.getAppRoot)()}}):this.options.chain_call_control.failed_number===this.options.chain_call_control.total_number?f.a.error("There was an error and no datasets were imported into history."):this.options.chain_call_control.failed_number<this.options.chain_call_control.total_number&&f.a.warning("Some of the datasets could not be imported into history. Click this to see what was imported.","",{onclick:function(){window.location=Object(d.getAppRoot)()}}),n.modal.hide(),!0;a.a.when(s.save({content:s.content,source:s.source})).done(function(){i.updateProgress(),i.chainCallImportingIntoHistory(t,e)}).fail(function(){i.options.chain_call_control.failed_number+=1,i.updateProgress(),i.chainCallImportingIntoHistory(t,e)})},chainCallImportingUserdirFiles:function(t){var e=this,i=Object(o.a)(),n=t.paths.pop();if(void 0===n)return 0===this.options.chain_call_control.failed_number?(f.a.success("Selected files imported into the current folder"),i.modal.hide()):f.a.error("An error occurred."),!0;var s="".concat(Object(d.getAppRoot)(),"api/libraries/datasets"),r={encoded_folder_id:this.id,source:t.source,path:n,file_type:t.file_type,link_data:t.link_data,space_to_tab:t.space_to_tab,to_posix_lines:t.to_posix_lines,dbkey:t.dbkey,tag_using_filenames:t.tag_using_filenames};a.a.when(a.a.post(s,r)).done(function(i){e.updateProgress(),e.chainCallImportingUserdirFiles(t)}).fail(function(){e.options.chain_call_control.failed_number+=1,e.updateProgress(),e.chainCallImportingUserdirFiles(t)})},chainCallImportingFolders:function(t){var e=this,i=Object(o.a)(),n=t.paths.pop();if(void 0===n)return 0===this.options.chain_call_control.failed_number?(f.a.success("Selected folders and their contents imported into the current folder."),i.modal.hide()):f.a.error("An error occurred."),!0;var s="".concat(Object(d.getAppRoot)(),"api/libraries/datasets"),r={encoded_folder_id:this.id,source:t.source,path:n,preserve_dirs:t.preserve_dirs,link_data:t.link_data,to_posix_lines:t.to_posix_lines,space_to_tab:t.space_to_tab,file_type:t.file_type,dbkey:t.dbkey,tag_using_filenames:t.tag_using_filenames};a.a.when(a.a.post(s,r)).done(function(i){e.updateProgress(),e.chainCallImportingFolders(t)}).fail(function(){e.options.chain_call_control.failed_number+=1,e.updateProgress(),e.chainCallImportingFolders(t)})},chainCallAddingHdas:function(t){var e=this,i=Object(o.a)();this.added_hdas=new xe.Folder;var n=t.pop();if(void 0===n)return 0===this.options.chain_call_control.failed_number?f.a.success("Selected datasets from history added to the folder"):this.options.chain_call_control.failed_number===this.options.chain_call_control.total_number?f.a.error("There was an error and no datasets were added to the folder."):this.options.chain_call_control.failed_number<this.options.chain_call_control.total_number&&f.a.warning("Some of the datasets could not be added to the folder"),i.modal.hide(),this.added_hdas;a.a.when(n.save({from_hda_id:n.get("from_hda_id")})).done(function(n){i.libraries.folderListView.collection.add(n),e.updateProgress(),e.chainCallAddingHdas(t)}).fail(function(){e.options.chain_call_control.failed_number+=1,e.updateProgress(),e.chainCallAddingHdas(t)})},chainCallDeletingItems:function(t){var e=this,i=Object(o.a)();this.deleted_items=new xe.Folder;var n=t.pop();if(void 0===n)return 0===this.options.chain_call_control.failed_number?f.a.success("Selected items were deleted."):this.options.chain_call_control.failed_number===this.options.chain_call_control.total_number?f.a.error("There was an error and no items were deleted. Please make sure you have sufficient permissions."):this.options.chain_call_control.failed_number<this.options.chain_call_control.total_number&&f.a.warning("Some of the items could not be deleted. Please make sure you have sufficient permissions."),i.modal.hide(),this.deleted_items;n.destroy().done(function(a){if(i.libraries.folderListView.collection.remove(n.id),e.updateProgress(),i.libraries.folderListView.options.include_deleted){var o=null;"folder"===a.type||"LibraryFolder"===a.model_class?o=new xe.FolderAsModel(a):"file"===a.type||"LibraryDataset"===a.model_class?o=new xe.Item(a):(i.emit.error("Unknown library item type found.","datalibs"),i.emit.error(a.type||a.model_class,"datalibs")),i.libraries.folderListView.collection.add(o)}e.chainCallDeletingItems(t)}).fail(function(){e.options.chain_call_control.failed_number+=1,e.updateProgress(),e.chainCallDeletingItems(t)})},checkIncludeDeleted:function(t){var e=Object(o.a)();t.target.checked?e.libraries.folderListView.fetchFolder({include_deleted:!0}):e.libraries.folderListView.fetchFolder({include_deleted:!1})},deleteSelectedItems:function(){var t=Object(o.a)(),e=[],i=[],n=this.findCheckedRows();if(0===n.length)f.a.info("You must select at least one item for deletion.");else{var s=this.templateDeletingItemsProgressBar();this.modal=t.modal,this.modal.show({closing_events:!0,title:h()("Deleting selected items"),body:s({}),buttons:{Close:function(){t.modal.hide()}}}),this.options.chain_call_control.total_number=0,this.options.chain_call_control.failed_number=0,n.each(function(){var t=a()(this).closest("tr").data("id").toString();void 0!==t&&("F"==t.substring(0,1)?i.push(t):e.push(t))});var r=e.length+i.length;this.progressStep=100/r,this.progress=0;for(var l=[],c=e.length-1;c>=0;c--){var d=new xe.Item({id:e[c]});l.push(d)}for(var u=i.length-1;u>=0;u--){var p=new xe.FolderAsModel({id:i[u]});l.push(p)}this.options.chain_call_control.total_number=r,this.chainCallDeletingItems(l)}},showLocInfo:function(){var t=this,e=Object(o.a)(),i=null;null!==e.libraries.libraryListView?(i=e.libraries.libraryListView.collection.get(this.options.parent_library_id),this.showLocInfoModal(i)):(i=new xe.Library({id:this.options.parent_library_id})).fetch({success:function(){t.showLocInfoModal(i)},error:function(t,e){void 0!==e.responseJSON?f.a.error(e.responseJSON.err_msg):f.a.error("An error occurred.")}})},showLocInfoModal:function(t){var e=Object(o.a)(),i=this.templateLocInfoInModal();this.modal=e.modal,this.modal.show({closing_events:!0,title:h()("Location Details"),body:i({library:t,options:this.options}),buttons:{Close:function(){e.modal.hide()}}})},showImportModal:function(t){var e=Object(o.a)();switch(t.source){case"history":this.addFilesFromHistoryModal();break;case"importdir":this.importFilesFromGalaxyFolderModal({source:"importdir"});break;case"path":this.importFilesFromPathModal();break;case"userdir":this.importFilesFromGalaxyFolderModal({source:"userdir"});break;default:e.libraries.library_router.back(),f.a.error("Invalid import source.")}},showPageSizePrompt:function(t){t.preventDefault();var e=Object(o.a)(),i=prompt("How many items per page do you want to see?",e.libraries.preferences.get("folder_page_size"));null!=i&&i==parseInt(i)&&(e.libraries.preferences.set({folder_page_size:parseInt(i)}),e.libraries.folderListView.render({id:this.options.id,show_page:1}))},findCheckedRows:function(){return a()("#folder_list_body").find(":checked")},findCheckedItems:function(){var t=[],e=[];return this.findCheckedRows().each(function(){var i=a()(this).closest("tr").data("id").toString();"F"==i.substring(0,1)?t.push(i):e.push(i)}),{folder_ids:t,dataset_ids:e}},showCollectionSelect:function(t){var e=this;t.preventDefault();var i=Object(o.a)(),n=this.findCheckedItems(),a=this.templateCollectionSelectModal();this.modal=i.modal,this.modal.show({closing_events:!0,title:"Create History Collection from Datasets",body:a({selected_datasets:n.dataset_ids.length}),buttons:{Continue:function(){e.showCollectionBuilder(n.dataset_ids)},Close:function(){i.modal.hide()}}}),this.prepareCollectionTypeSelect(),this.prepareHistoryTypeSelect()},prepareCollectionTypeSelect:function(){var t=this;this.collectionType="list",this.select_collection_type=new ke.a.View({css:"library-collection-type-select",container:this.modal.$el.find(".library-collection-type-select"),data:[{id:"list",text:"List"},{id:"paired",text:"Paired"},{id:"list:paired",text:"List of Pairs"},{id:"rules",text:"From Rules"}],value:"list",onchange:function(e){t.updateCollectionType(e)}})},prepareHistoryTypeSelect:function(){var t=this;this.fetchUserHistories().done(function(){for(var e=[],i=t.histories.length-1;i>=0;i--)e.unshift({id:t.histories.models[i].id,text:t.histories.models[i].get("name")});t.select_collection_history=new ke.a.View({css:"library-collection-history-select",container:t.modal.$el.find(".library-collection-history-select"),data:e,value:e[0].id})})},updateCollectionType:function(t){this.collectionType=t},showCollectionBuilder:function(t){var e=this,i=Object(o.a)(),n=[],a=this.modal.$('input[type="radio"]:checked').val();if("selection"===a)for(var s=t.length-1;s>=0;s--){var r={},l=i.libraries.folderListView.folder_container.get("folder").get(t[s]);r.id=l.get("ldda_id"),r.name=l.get("name"),r.deleted=l.get("deleted"),r.state=l.get("state"),n.push(r)}else if("folder"===a)for(var d=i.libraries.folderListView.folder_container.get("folder").where({type:"file"}),u=(n=new c.a.Collection(d).toJSON()).length-1;u>=0;u--)n[u].id=n[u].ldda_id;var h=this.modal.$("input[name=history_name]").val();if(""!==h)this.createNewHistory(h).done(function(t){f.a.success("History created"),e.collectionImport(n,t.id,t.name)}).fail(function(t,e,i){f.a.error("An error occurred.")});else{var p=this.select_collection_history.value(),m=this.select_collection_history.text();this.collectionImport(n,p,m)}},collectionImport:function(t,e,i){var n,a,o=this,s="Creating Collection in ".concat(i);if("list"===this.collectionType)n=je.a.ListCollectionCreator,a=function(t,i,n){return t=t.map(function(t){return{id:t.id,name:t.name,src:"ldda"}}),o.createHDCA(t,o.collectionType,i,n,e)},je.a.collectionCreatorModal(t,{creationFn:a,title:s,defaultHideSourceItems:!0},n);else if("paired"===this.collectionType)n=De.a.PairCollectionCreator,a=function(t,i,n){return t=[{name:"forward",src:"ldda",id:t[0].id},{name:"reverse",src:"ldda",id:t[1].id}],o.createHDCA(t,o.collectionType,i,n,e)},je.a.collectionCreatorModal(t,{creationFn:a,title:s,defaultHideSourceItems:!0},n);else if("list:paired"===this.collectionType){var r=t.map(function(t){return{id:t.id,name:t.name,src:"ldda"}});Ie.a.pairedCollectionCreatorModal(r,{historyId:e,title:s,defaultHideSourceItems:!0})}else if("rules"===this.collectionType){je.a.ruleBasedCollectionCreatorModal(t,"library_datasets","collections",{creationFn:function(t,i,n,a){return o.createHDCA(t,i,n,a,e)},defaultHideSourceItems:!0})}},createHDCA:function(t,e,i,n,a,o){return new Me.a.HistoryDatasetCollection({history_content_type:"dataset_collection",collection_type:e,history_id:a,name:i,hide_source_items:n||!1,element_identifiers:t}).save(o)},templateToolBar:function(){return r.a.template('<div class="library_style_container">\n                <div class="d-flex align-items-center mb-2">\n                    <a class="mr-1 btn btn-secondary" href="list" data-toggle="tooltip" title="Go to first page">\n                        <span class="fa fa-home"/>\n                    </a>\n                    <a class="mr-1 btn btn-secondary" data-toggle="tooltip" title="See this screen annotated" href="https://galaxyproject.org/data-libraries/screen/folder-contents/" target="_blank">\n                        <span class="fa fa-question"/>\n                    </a>\n                    <div>\n                        <form class="form-inline">\n                            <div class="form-check logged-dataset-manipulation mr-1" style="display:none;">\n                                <input class="form-check-input include-deleted-datasets-chk" id="include_deleted_datasets_chk" type="checkbox">\n                                <label class="form-check-label" for="include_deleted_datasets_chk">include deleted</label>\n                            </div>\n                            <button style="display:none;" title="Create new folder" class="btn btn-secondary toolbtn-create-folder add-library-items add-library-items-folder mr-1" type="button">\n                            <span class="fa fa-folder"/> Create Folder</button>\n                            <% if(multiple_add_dataset_options) { %>\n                                <div title="Add datasets to current folder" class="dropdown add-library-items add-library-items-datasets mr-1" style="display:none;">\n                                <button type="button" class="btn btn-secondary dropdown-toggle" data-toggle="dropdown">\n                                    <span class="fa fa-file"/> Add Datasets <span class="caret"/>\n                                </button>\n                                <div class="dropdown-menu">\n                                    <a class="dropdown-item" href="#folders/<%= id %>/import/history"> from History</a>\n                                    <% if(Galaxy.config.user_library_import_dir !== null) { %>\n                                        <a class="dropdown-item" href="#folders/<%= id %>/import/userdir"> from User Directory</a>\n                                    <% } %>\n                                    <% if(Galaxy.config.library_import_dir !== null || Galaxy.config.allow_library_path_paste) { %>\n                                        <h5 class="dropdown-header">Admins only</h5>\n                                        <% if(Galaxy.config.library_import_dir !== null) { %>\n                                            <a class="dropdown-item" href="#folders/<%= id %>/import/importdir">from Import Directory</a>\n                                        <% } %>\n                                        <% if(Galaxy.config.allow_library_path_paste) { %>\n                                            <a class="dropdown-item" href="#folders/<%= id %>/import/path">from Path</a>\n                                        <% } %>\n                                    <% } %>\n                                </div>\n                            </div>\n                            <% } else { %>\n                                <a title="Add Datasets to Current Folder" style="display:none;" class="btn btn-secondary add-library-items add-library-items-datasets mr-1" href="#folders/<%= id %>/import/history" role="button">\n                                    <span class="fa fa-file"/> Add Datasets\n                                </a>\n                            <% } %>\n                            <div class="dropdown mr-1">\n                                <button type="button" class="primary-button dropdown-toggle add-to-history" data-toggle="dropdown">\n                                    <span class="fa fa-book"></span> Export to History <span class="caret"/>\n                                </button>\n                                <div class="dropdown-menu" role="menu">\n                                    <a href="#" class="toolbtn-bulk-import add-to-history-datasets dropdown-item">as Datasets</a>\n                                    <a href="#" class="toolbtn-collection-import add-to-history-collection dropdown-item">as a Collection</a>\n                                </div>\n                            </div>\n                            <div title="Download items as archive" class="dropdown dataset-manipulation mr-1" style="display:none; ">\n                                <button type="button" class="primary-button dropdown-toggle" data-toggle="dropdown">\n                                    <span class="fa fa-save"/> Download <span class="caret"/>\n                                </button>\n                                <div class="dropdown-menu" role="menu">\n                                    <a class="dropdown-item" href="#/folders/<%= id %>/download/tgz">.tar.gz</a>\n                                    <a class="dropdown-item" href="#/folders/<%= id %>/download/tbz">.tar.bz</a>\n                                    <a class="dropdown-item" href="#/folders/<%= id %>/download/zip">.zip</a>\n                                </div>\n                            </div>\n                            <button data-toggle="tooltip" title="Mark items deleted" class="primary-button toolbtn-bulk-delete logged-dataset-manipulation mr-1" style="display:none;" type="button">\n                                <span class="fa fa-trash"/> Delete\n                            </button>\n                            <span class="mr-1" data-toggle="tooltip" title="Show location details">\n                                <button data-id="<%- id %>" class="primary-button toolbtn-show-locinfo" type="button">\n                                    <span class="fa fa-info-circle"/>&nbsp;Details\n                                </button>\n                            </span>\n                        </form>\n                    </div>\n                </div>\n                <div id="folder_items_element" />\n                <div class="d-flex justify-content-center align-items-center folder-paginator mt-2 mb-2" />\n            </div>')},templateLocInfoInModal:function(){return r.a.template(["<div>",'<table class="grid table table-sm">',"<thead>",'<th style="width: 25%;">library</th>',"<th></th>","</thead>","<tbody>","<tr>","<td>name</td>",'<td><%- library.get("name") %></td>',"</tr>",'<% if(library.get("description") !== "") { %>',"<tr>","<td>description</td>",'<td><%- library.get("description") %></td>',"</tr>","<% } %>",'<% if(library.get("synopsis") !== "") { %>',"<tr>","<td>synopsis</td>",'<td><%- library.get("synopsis") %></td>',"</tr>","<% } %>",'<% if(library.get("create_time_pretty") !== "") { %>',"<tr>","<td>created</td>",'<td><span title="<%- library.get("create_time") %>"><%- library.get("create_time_pretty") %></span></td>',"</tr>","<% } %>","<tr>","<td>id</td>",'<td><%- library.get("id") %></td>',"</tr>","</tbody>","</table>",'<table class="grid table table-sm">',"<thead>",'<th style="width: 25%;">folder</th>',"<th></th>","</thead>","<tbody>","<tr>","<td>name</td>","<td><%- options.folder_name %></td>","</tr>",'<% if(options.folder_description !== "") { %>',"<tr>","<td>description</td>","<td><%- options.folder_description %></td>","</tr>","<% } %>","<tr>","<td>id</td>","<td><%- options.id %></td>","</tr>","</tbody>","</table>","</div>"].join(""))},templateNewFolderInModal:function(){return r.a.template(['<div id="new_folder_modal">',"<form>",'<input type="text" name="Name" value="" placeholder="Name" autofocus>','<input type="text" name="Description" value="" placeholder="Description">',"</form>","</div>"].join(""))},templateImportIntoHistoryModal:function(){return r.a.template(["<div>",'<div class="library-modal-item">',"Select history: ",'<select name="import_to_history" style="width:50%; margin-bottom: 1em; " autofocus>',"<% _.each(histories, function(history) { %>",'<option value="<%= _.escape(history.get("id")) %>"><%= _.escape(history.get("name")) %></option>',"<% }); %>","</select>","</div>",'<div class="library-modal-item">',"or create new: ",'<input type="text" name="history_name" value="" placeholder="name of the new history" style="width:50%;" />',"</div>","</div>"].join(""))},templateImportIntoHistoryProgressBar:function(){return r.a.template(['<div class="import_text">',"Importing selected items to history <b><%= _.escape(history_name) %></b>","</div>",'<div class="progress">','<div class="progress-bar progress-bar-import" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" style="width: 00%;">','<span class="completion_span">0% Complete</span>',"</div>","</div>"].join(""))},templateAddingDatasetsProgressBar:function(){return r.a.template(['<div class="import_text">',"Adding selected datasets to library folder <b><%= _.escape(folder_name) %></b>","</div>",'<div class="progress">','<div class="progress-bar progress-bar-import" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" style="width: 00%;">','<span class="completion_span">0% Complete</span>',"</div>","</div>"].join(""))},templateDeletingItemsProgressBar:function(){return r.a.template(['<div class="import_text">',"</div>",'<div class="progress">','<div class="progress-bar progress-bar-import" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" style="width: 00%;">','<span class="completion_span">0% Complete</span>',"</div>","</div>"].join(""))},templateBrowserModal:function(){return r.a.template(['<div id="file_browser_modal">','<div style="margin-bottom:1em;">','<label title="Switch to selecting files" class="radio-inline import-type-switch">','<input type="radio" name="jstree-radio" value="jstree-disable-folders" checked="checked"> Choose Files',"</label>",'<label title="Switch to selecting folders" class="radio-inline import-type-switch">','<input type="radio" name="jstree-radio" value="jstree-disable-files"> Choose Folders',"</label>","</div>",'<div class="alert alert-info jstree-files-message">All files you select will be imported into the current folder ignoring their folder structure.</div>','<div class="alert alert-info jstree-folders-message" style="display:none;">All files within the selected folders and their subfolders will be imported into the current folder.</div>','<div style="margin-bottom:1em;">','<label class="checkbox-inline jstree-preserve-structure" style="display:none;">','<input class="preserve-checkbox" type="checkbox" value="preserve_directory_structure">',"Preserve directory structure","</label>",'<label class="checkbox-inline">','<input class="link-checkbox" type="checkbox" value="link_files">',"Link files instead of copying","</label>",'<label class="checkbox-inline">','<input class="posix-checkbox" type="checkbox" value="to_posix_lines" checked="checked">',"Convert line endings to POSIX","</label>",'<label class="checkbox-inline">','<input class="spacetab-checkbox" type="checkbox" value="space_to_tab">',"Convert spaces to tabs","</label>","</div>",'<button title="Select all files" type="button" class="button primary-button libimport-select-all">',"Select all","</button>",'<button title="Select no files" type="button" class="button primary-button libimport-select-none">',"Unselect all","</button>","<hr />",'<div id="jstree_browser">',"</div>","<hr />","<p>You can set extension type and genome for all imported datasets at once:</p>","<div>",'Type: <span id="library_extension_select" class="library-extension-select" />','Genome: <span id="library_genome_select" class="library-genome-select" />',"</div>","<br>","<div>",'<label class="checkbox-inline tag-files">',"Tag datasets based on file names",'<input class="tag-files" type="checkbox" value="tag_using_filenames">',"</label>","</div>","</div>"].join(""))},templateImportPathModal:function(){return r.a.template(['<div id="file_browser_modal">','<div class="alert alert-info jstree-folders-message">All files within the given folders and their subfolders will be imported into the current folder.</div>','<div style="margin-bottom: 0.5em;">','<label class="checkbox-inline">','<input class="preserve-checkbox" type="checkbox" value="preserve_directory_structure">',"Preserve directory structure","</label>",'<label class="checkbox-inline">','<input class="link-checkbox" type="checkbox" value="link_files">',"Link files instead of copying","</label>","<br>",'<label class="checkbox-inline">','<input class="posix-checkbox" type="checkbox" value="to_posix_lines" checked="checked">',"Convert line endings to POSIX","</label>",'<label class="checkbox-inline">','<input class="spacetab-checkbox" type="checkbox" value="space_to_tab">',"Convert spaces to tabs","</label>","</div>",'<textarea id="import_paths" class="form-control" rows="5" placeholder="Absolute paths (or paths relative to Galaxy root) separated by newline" autofocus></textarea>',"<hr />","<p>You can set extension type and genome for all imported datasets at once:</p>","<div>",'Type: <span id="library_extension_select" class="library-extension-select" />','Genome: <span id="library_genome_select" class="library-genome-select" />',"</div>","<div>",'<label class="checkbox-inline tag-files">',"Tag datasets based on file names",'<input class="tag-files" type="checkbox" value="tag_using_filenames">',"</label>","</div>","</div>"].join(""))},templateAddFilesFromHistory:function(){return r.a.template(['<div id="add_files_modal">',"<div>","1.&nbsp;Select history:&nbsp;",'<select id="dataset_add_bulk" name="dataset_add_bulk" style="width:66%; "> ',"<% _.each(histories, function(history) { %>",'<option value="<%= _.escape(history.get("id")) %>"><%= _.escape(history.get("name")) %></option>',"<% }); %>","</select>","</div>","<br/>",'<div class="library_selected_history_content">',"</div>","</div>"].join(""))},templateHistoryContents:function(){return r.a.template(["<p>2.&nbsp;Choose the datasets to import:</p>","<div>",'<button title="Select all datasets" type="button" class="button primary-button history-import-select-all">',"Select all","</button>",'<button title="Select all datasets" type="button" class="button primary-button history-import-unselect-all">',"Unselect all","</button>","</div>","<br>","<ul>","<% _.each(history_contents, function(history_item) { %>",'<% if (history_item.get("deleted") != true ) { %>','<% var item_name = history_item.get("name") %>','<% if (history_item.get("type") === "collection") { %>','<% var collection_type = history_item.get("collection_type") %>','<% if (collection_type === "list") { %>','<li data-id="<%= _.escape(history_item.get("id")) %>" data-name="<%= _.escape(history_item.get("type")) %>">',"<label>",'<label title="<%= _.escape(item_name) %>">','<input style="margin: 0;" type="checkbox"> <%= _.escape(history_item.get("hid")) %>: ','<%= item_name.length > 75 ? _.escape("...".concat(item_name.substr(-75))) : _.escape(item_name) %> (Dataset Collection)',"</label>","</li>","<% } else { %>",'<li><input style="margin: 0;" type="checkbox" onclick="return false;" disabled="disabled">','<span title="You can convert this collection into a collection of type list using the Collection Tools">','<%= _.escape(history_item.get("hid")) %>: ','<%= item_name.length > 75 ? _.escape("...".concat(item_name.substr(-75))) : _.escape(item_name) %> (Dataset Collection of type <%= _.escape(collection_type) %> not supported.)',"</span>","</li>","<% } %>",'<% } else if (history_item.get("visible") === true && history_item.get("state") === "ok") { %>','<li data-id="<%= _.escape(history_item.get("id")) %>" data-name="<%= _.escape(history_item.get("type")) %>">','<label title="<%= _.escape(item_name) %>">','<input style="margin: 0;" type="checkbox"> <%= _.escape(history_item.get("hid")) %>: ','<%= item_name.length > 75 ? _.escape("...".concat(item_name.substr(-75))) : _.escape(item_name) %>',"</label>","</li>","<% } %>","<% } %>","<% }); %>","</ul>"].join(""))},templatePaginator:function(){return r.a.template(['<ul class="pagination mr-1">',"<% if ( ( show_page - 1 ) > 0 ) { %>","<% if ( ( show_page - 1 ) > page_count ) { %>",'<li class="page-item"><a class="page-link" href="#folders/<%= id %>/page/1"><span class="fa fa-angle-double-left"></span></a></li>','<li class="page-item disabled"><a class="page-link" href="#folders/<%= id %>/page/<% print( show_page ) %>"><% print( show_page - 1 ) %></a></li>',"<% } else { %>",'<li class="page-item"><a class="page-link" href="#folders/<%= id %>/page/1"><span class="fa fa-angle-double-left"></span></a></li>','<li class="page-item"><a class="page-link" href="#folders/<%= id %>/page/<% print( show_page - 1 ) %>"><% print( show_page - 1 ) %></a></li>',"<% } %>","<% } else { %>",'<li class="page-item disabled"><a class="page-link" href="#folders/<%= id %>/page/1"><span class="fa fa-angle-double-left"></span></a></li>','<li class="page-item disabled"><a class="page-link" href="#folders/<%= id %>/page/<% print( show_page ) %>"><% print( show_page - 1 ) %></a></li>',"<% } %>",'<li class="page-item active">','<a class="page-link" href="#folders/<%= id %>/page/<% print( show_page ) %>"><% print( show_page ) %></a>',"</li>","<% if ( ( show_page ) < page_count ) { %>",'<li class="page-item"><a class="page-link" href="#folders/<%= id %>/page/<% print( show_page + 1 ) %>"><% print( show_page + 1 ) %></a></li>','<li class="page-item"><a class="page-link" href="#folders/<%= id %>/page/<% print( page_count ) %>"><span class="fa fa-angle-double-right"></span></a></li>',"<% } else { %>",'<li class="page-item disabled"><a class="page-link" href="#folders/<%= id %>/page/<% print( show_page  ) %>"><% print( show_page + 1 ) %></a></li>','<li class="page-item disabled"><a class="page-link" href="#folders/<%= id %>/page/<% print( page_count ) %>"><span class="fa fa-angle-double-right"></span></a></li>',"<% } %>","</ul>",'<span class="mr-1">',' <%- items_shown %> items shown <a href="" data-toggle="tooltip" data-placement="top" title="currently <%- folder_page_size %> per page" class="page-size-prompt">(change)</a>',"</span>",'<span class="mr-1">'," <%- total_items_count %> total","</span>"].join(""))},templateCollectionSelectModal:function(){return r.a.template(["<div>",'<div class="library-modal-item">',"<h4>Which datasets?</h4>",'<form class="form-inline">','<label class="radio-inline">','<input type="radio" name="radio_elements" id="selection_radio" value="selection" <% if (!selected_datasets) { %> disabled <% } else { %> checked <% } %> > current selection',"<% if (selected_datasets) { %>"," (<%- selected_datasets %>)","<% } %>","</label>",'<label class="radio-inline">','<input type="radio" name="radio_elements" id="folder_radio" value="folder" <% if (!selected_datasets) { %> checked <% } %> > all datasets in current folder',"</label>","</form>","</div>",'<div class="library-modal-item">',"<h4>Collection type</h4>",'<span class="library-collection-type-select"/>',"<h5>Which type to choose?</h5>","<ul>","<li>","List: Generic collection which groups any number of datasets into a set; similar to file system folder.","</li>","<li>","Paired: Simple collection containing exactly two sequence datasets; one reverse and the other forward.","</li>","<li>","List of Pairs: Advanced collection containing any number of Pairs; imagine as Pair-type collections inside of a List-type collection.","</li>","<li>","From Rules: Use Galaxy's rule builder to describe collections. This is more of an advanced feature that allows building any number of collections or any type.","</li>","</ul>","</div>",'<div class="library-modal-item">',"<h4>Select history</h4>",'<span class="library-collection-history-select"/>'," or create new: ",'<input type="text" name="history_name" value="" placeholder="name of the new history" />',"</div>","</div>"].join(""))}})}),Ee={LibraryView:c.a.View.extend({el:"#center",model:null,options:{},events:{"click .toolbtn_save_permissions":"savePermissions"},initialize:function(t){this.options=r.a.extend(this.options,t),this.options.id&&this.fetchLibrary()},fetchLibrary:function(t){this.options=r.a.extend(this.options,t),this.model=new xe.Library({id:this.options.id});var e=this;this.model.fetch({success:function(){e.options.show_permissions&&e.showPermissions()},error:function(t,e){var i=Object(o.a)();void 0!==e.responseJSON?f.a.error("".concat(e.responseJSON.err_msg," Click this to go back."),"",{onclick:function(){i.libraries.library_router.back()}}):f.a.error("An error occurred. Click this to go back.","",{onclick:function(){i.libraries.library_router.back()}})}})},showPermissions:function(t){this.options=r.a.extend(this.options,t),a()(".tooltip").remove(),void 0!==this.options.fetched_permissions&&(0===this.options.fetched_permissions.access_library_role_list.length?this.model.set({is_unrestricted:!0}):this.model.set({is_unrestricted:!1}));var e=!1,i=Object(o.a)();i.user&&(e=i.user.isAdmin());var n=this.templateLibraryPermissions();this.$el.html(n({library:this.model,is_admin:e}));var s=this;a.a.get("".concat(Object(d.getAppRoot)(),"api/libraries/").concat(s.id,"/permissions?scope=current")).done(function(t){s.prepareSelectBoxes({fetched_permissions:t})}).fail(function(){f.a.error("An error occurred while attempting to fetch library permissions.")}),a()('#center [data-toggle="tooltip"]').tooltip({trigger:"hover"}),a()("#center").css("overflow","auto")},_serializeRoles:function(t){for(var e=[],i=0;i<t.length;i++)e.push("".concat(t[i][1],":").concat(t[i][0]));return e},prepareSelectBoxes:function(t){this.options=r.a.extend(this.options,t);var e=this.options.fetched_permissions,i=this._serializeRoles(e.access_library_role_list),n=this._serializeRoles(e.add_library_item_role_list),a=this._serializeRoles(e.manage_library_role_list),o=this._serializeRoles(e.modify_library_role_list);this.accessSelectObject=new ke.a.View(this._createSelectOptions(this,"access_perm",i,!0)),this.addSelectObject=new ke.a.View(this._createSelectOptions(this,"add_perm",n,!1)),this.manageSelectObject=new ke.a.View(this._createSelectOptions(this,"manage_perm",a,!1)),this.modifySelectObject=new ke.a.View(this._createSelectOptions(this,"modify_perm",o,!1))},_createSelectOptions:function(t,e,i,n){return n=!0===n&&n,{minimumInputLength:0,css:e,multiple:!0,placeholder:"Click to select a role",container:t.$el.find("#".concat(e)),ajax:{url:"".concat(Object(d.getAppRoot)(),"api/libraries/").concat(t.id,"/permissions?scope=available&is_library_access=").concat(n),dataType:"json",quietMillis:100,data:function(t,e){return{q:t,page_limit:10,page:e}},results:function(t,e){var i=10*e<t.total;return{results:t.roles,more:i}}},formatResult:function(t){return"".concat(t.name," type: ").concat(t.type)},formatSelection:function(t){return t.name},initSelection:function(t,e){var i=[];a()(t.val().split(",")).each(function(){var t=this.split(":");i.push({id:t[0],name:t[1]})}),e(i)},initialData:i,dropdownCssClass:"bigdrop"}},makeDatasetPrivate:function(){var t=this;a.a.post("".concat(Object(d.getAppRoot)(),"api/libraries/datasets/").concat(t.id,"/permissions?action=make_private")).done(function(e){t.model.set({is_unrestricted:!1}),t.showPermissions({fetched_permissions:e}),f.a.success("The dataset is now private to you.")}).fail(function(){f.a.error("An error occurred while attempting to make dataset private.")})},removeDatasetRestrictions:function(){var t=this;a.a.post("".concat(Object(d.getAppRoot)(),"api/libraries/datasets/").concat(t.id,"/permissions?action=remove_restrictions")).done(function(e){t.model.set({is_unrestricted:!0}),t.showPermissions({fetched_permissions:e}),f.a.success("Access to this dataset is now unrestricted.")}).fail(function(){f.a.error("An error occurred while attempting to make dataset unrestricted.")})},_extractIds:function(t){for(var e=[],i=t.length-1;i>=0;i--)e.push(t[i].id);return e},savePermissions:function(t){var e=this,i=this._extractIds(this.accessSelectObject.$el.select2("data")),n=this._extractIds(this.addSelectObject.$el.select2("data")),o=this._extractIds(this.manageSelectObject.$el.select2("data")),s=this._extractIds(this.modifySelectObject.$el.select2("data"));a.a.post("".concat(Object(d.getAppRoot)(),"api/libraries/").concat(e.id,"/permissions?action=set_permissions"),{"access_ids[]":i,"add_ids[]":n,"manage_ids[]":o,"modify_ids[]":s}).done(function(t){e.showPermissions({fetched_permissions:t}),f.a.success("Permissions saved.")}).fail(function(){f.a.error("An error occurred while attempting to set library permissions.")})},templateLibraryPermissions:function(){return r.a.template(['<div class="library_style_container">',"<div>",'<a href="#">','<button data-toggle="tooltip" data-placement="top" title="Go back to the list of Libraries" class="btn btn-secondary primary-button" type="button">','<span class="fa fa-list"/>',"&nbsp;Libraries","</button>","</a>","</div>","<h1>",'Library: <%= _.escape(library.get("name")) %>',"</h1>",'<div class="alert alert-warning">',"<% if (is_admin) { %>","You are logged in as an <strong>administrator</strong> therefore you can manage any library on this Galaxy instance. Please make sure you understand the consequences.","<% } else { %>","You can assign any number of roles to any of the following permission types. However please read carefully the implications of such actions.","<% }%>","</div>",'<div class="dataset_table">',"<h2>Library permissions</h2>","<h4>Roles that can access the library</h4>",'<div id="access_perm" class="access_perm roles-selection"/>','<div class="alert alert-info roles-selection">',"User with <strong>any</strong> of these roles can access this library. If there are no access roles set on the library it is considered <strong>unrestricted</strong>.","</div>","<h4>Roles that can manage permissions on this library</h4>",'<div id="manage_perm" class="manage_perm roles-selection"/>','<div class="alert alert-info roles-selection">',"User with <strong>any</strong> of these roles can manage permissions on this library (includes giving access).","</div>","<h4>Roles that can add items to this library</h4>",'<div id="add_perm" class="add_perm roles-selection"/>','<div class="alert alert-info roles-selection">',"User with <strong>any</strong> of these roles can add items to this library (folders and datasets).","</div>","<h4>Roles that can modify this library</h4>",'<div id="modify_perm" class="modify_perm roles-selection"/>','<div class="alert alert-info roles-selection">',"User with <strong>any</strong> of these roles can modify this library (name, synopsis, etc.).","</div>",'<button data-toggle="tooltip" data-placement="top" title="Save modifications made on this page" class="btn btn-secondary toolbtn_save_permissions primary-button" type="button">','<span class="fa fa-floppy-o"/>',"&nbsp;Save","</button>","</div>","</div>"].join(""))}})},Pe={FolderView:c.a.View.extend({el:"#center",model:null,options:{},events:{"click .toolbtn_save_permissions":"savePermissions"},initialize:function(t){this.options=r.a.extend(this.options,t),this.options.id&&this.fetchFolder()},fetchFolder:function(t){var e=Object(o.a)();this.options=r.a.extend(this.options,t),this.model=new xe.FolderAsModel({id:this.options.id});var i=this;this.model.fetch({success:function(){i.options.show_permissions&&i.showPermissions()},error:function(t,i){void 0!==i.responseJSON?f.a.error("".concat(i.responseJSON.err_msg," Click this to go back."),"",{onclick:function(){e.libraries.library_router.back()}}):f.a.error("An error occurred. Click this to go back.","",{onclick:function(){e.libraries.library_router.back()}})}})},showPermissions:function(t){var e=Object(o.a)();this.options=r.a.extend(this.options,t),a()(".tooltip").remove();var i=!1;e.user&&(i=e.user.isAdmin());var n=this.templateFolderPermissions();this.$el.html(n({folder:this.model,is_admin:i}));var s=this;a.a.get("".concat(Object(d.getAppRoot)(),"api/folders/").concat(s.id,"/permissions?scope=current")).done(function(t){s.prepareSelectBoxes({fetched_permissions:t})}).fail(function(){f.a.error("An error occurred while attempting to fetch folder permissions.")}),a()('#center [data-toggle="tooltip"]').tooltip({trigger:"hover"}),a()("#center").css("overflow","auto")},_serializeRoles:function(t){for(var e=[],i=0;i<t.length;i++)e.push("".concat(t[i][1],":").concat(t[i][0]));return e},prepareSelectBoxes:function(t){this.options=r.a.extend(this.options,t);var e=this.options.fetched_permissions,i=this._serializeRoles(e.add_library_item_role_list),n=this._serializeRoles(e.manage_folder_role_list),a=this._serializeRoles(e.modify_folder_role_list);this.addSelectObject=new ke.a.View(this._createSelectOptions(this,"add_perm",i,!1)),this.manageSelectObject=new ke.a.View(this._createSelectOptions(this,"manage_perm",n,!1)),this.modifySelectObject=new ke.a.View(this._createSelectOptions(this,"modify_perm",a,!1))},_createSelectOptions:function(t,e,i){return{minimumInputLength:0,css:e,multiple:!0,placeholder:"Click to select a role",container:t.$el.find("#".concat(e)),ajax:{url:"".concat(Object(d.getAppRoot)(),"api/folders/").concat(t.id,"/permissions?scope=available"),dataType:"json",quietMillis:100,data:function(t,e){return{q:t,page_limit:10,page:e}},results:function(t,e){var i=10*e<t.total;return{results:t.roles,more:i}}},formatResult:function(t){return"".concat(t.name," type: ").concat(t.type)},formatSelection:function(t){return t.name},initSelection:function(t,e){var i=[];a()(t.val().split(",")).each(function(){var t=this.split(":");i.push({id:t[0],name:t[1]})}),e(i)},initialData:i.join(","),dropdownCssClass:"bigdrop"}},_extractIds:function(t){for(var e=[],i=t.length-1;i>=0;i--)e.push(t[i].id);return e},savePermissions:function(t){var e=this,i=this._extractIds(this.addSelectObject.$el.select2("data")),n=this._extractIds(this.manageSelectObject.$el.select2("data")),o=this._extractIds(this.modifySelectObject.$el.select2("data"));a.a.post("".concat(Object(d.getAppRoot)(),"api/folders/").concat(e.id,"/permissions?action=set_permissions"),{"add_ids[]":i,"manage_ids[]":n,"modify_ids[]":o}).done(function(t){e.showPermissions({fetched_permissions:t}),f.a.success("Permissions saved.")}).fail(function(){f.a.error("An error occurred while attempting to set folder permissions.")})},templateFolderPermissions:function(){return r.a.template(['<div class="library_style_container">',"<div>",'<a href="#/folders/<%= folder.get("parent_id") %>">','<button data-toggle="tooltip" data-placement="top" title="Go back to the parent folder" class="btn btn-secondary primary-button" type="button">','<span class="fa fa-caret-left fa-lg"/>',"&nbsp;Parent folder","</button>","</a>","</div>","<h1>",'Folder: <%= _.escape(folder.get("name")) %>',"</h1>",'<div class="alert alert-warning">',"<% if (is_admin) { %>","You are logged in as an <strong>administrator</strong> therefore you can manage any folder on this Galaxy instance. Please make sure you understand the consequences.","<% } else { %>","You can assign any number of roles to any of the following permission types. However please read carefully the implications of such actions.","<% }%>","</div>",'<div class="dataset_table">',"<h2>Folder permissions</h2>","<h4>","Roles that can manage permissions on this folder","</h4>",'<div id="manage_perm" class="manage_perm roles-selection"/>','<div class="alert alert-info roles-selection">',"User with <strong>any</strong> of these roles can manage permissions on this folder.","</div>","<h4>","Roles that can add items to this folder","</h4>",'<div id="add_perm" class="add_perm roles-selection"/>','<div class="alert alert-info roles-selection">',"User with <strong>any</strong> of these roles can add items to this folder (folders and datasets).","</div>","<h4>","Roles that can modify this folder","</h4>",'<div id="modify_perm" class="modify_perm roles-selection"/>','<div class="alert alert-info roles-selection">',"User with <strong>any</strong> of these roles can modify this folder (name, etc.).","</div>",'<button data-toggle="tooltip" data-placement="top" title="Save modifications" class="btn btn-secondary toolbtn_save_permissions primary-button" type="button">','<span class="fa fa-floppy-o"/>',"&nbsp;Save","</button>","</div>","</div>"].join(""))}})},Ve=c.a.Router.extend({initialize:function(){this.routesHit=0,c.a.history.on("route",function(){this.routesHit++},this),this.bind("route",this.trackPageview)},routes:{"":"libraries","page/:show_page":"libraries_page","library/:library_id/permissions":"library_permissions","folders/:folder_id/permissions":"folder_permissions","folders/:id":"folder_content","folders/:id/page/:show_page":"folder_page","folders/:folder_id/datasets/:dataset_id":"dataset_detail","folders/:folder_id/datasets/:dataset_id/permissions":"dataset_permissions","folders/:folder_id/datasets/:dataset_id/versions/:ldda_id":"dataset_version","folders/:folder_id/download/:format":"download","folders/:folder_id/import/:source":"import_datasets"},back:function(){this.routesHit>1?window.history.back():this.navigate("#",{trigger:!0,replace:!0})},trackPageview:function(){var t=c.a.history.getFragment();/^\//.test(t)||""==t||(t="/".concat(t)),"undefined"!=typeof ga&&ga("send","pageview","".concat(Object(d.getAppRoot)(),"library/list").concat(t))}}),Le=re.a.SessionStorageModel.extend({defaults:{with_deleted:!1,without_restricted:!1,sort_order:"asc",sort_by:"name",library_page_size:20,folder_page_size:15}}),ze={GalaxyApp:c.a.View.extend({libraryToolbarView:null,libraryListView:null,library_router:null,libraryView:null,folderToolbarView:null,folderListView:null,datasetView:null,initialize:function(){var t,e,i,n,s,r,l=Object(o.a)();l.config.ga_code&&(t=window,e=document,i="script",n="ga",t.GoogleAnalyticsObject=n,t.ga=t.ga||function(){(t.ga.q=t.ga.q||[]).push(arguments)},t.ga.l=1*new Date,s=e.createElement(i),r=e.getElementsByTagName(i)[0],s.async=1,s.src="//www.google-analytics.com/analytics.js",r.parentNode.insertBefore(s,r),ga("create",l.config.ga_code,"auto"),ga("send","pageview")),l.libraries=this,this.preferences=new Le({id:"global-lib-prefs"}),this.library_router=new Ve,this.library_router.on("route:libraries",function(){l.libraries.libraryToolbarView&&l.libraries.libraryToolbarView.$el.unbind("click"),l.libraries.libraryToolbarView=new Ae.LibraryToolbarView,l.libraries.libraryListView=new Oe.LibraryListView}),this.library_router.on("route:libraries_page",function(t){null===l.libraries.libraryToolbarView?(l.libraries.libraryToolbarView=new Ae.LibraryToolbarView,l.libraries.libraryListView=new Oe.LibraryListView({show_page:t})):l.libraries.libraryListView.render({show_page:t})}),this.library_router.on("route:folder_content",function(t){l.libraries.folderToolbarView&&l.libraries.folderToolbarView.$el.unbind("click"),l.libraries.folderToolbarView=new Re.FolderToolbarView({id:t}),l.libraries.folderListView=new Te.FolderListView({id:t})}),this.library_router.on("route:folder_page",function(t,e){null===l.libraries.folderToolbarView?(l.libraries.folderToolbarView=new Re.FolderToolbarView({id:t}),l.libraries.folderListView=new Te.FolderListView({id:t,show_page:e})):l.libraries.folderListView.render({id:t,show_page:parseInt(e)})}),this.library_router.on("route:download",function(t,e){0===a()("#folder_list_body").find(":checked").length?(f.a.info("You must select at least one dataset to download"),l.libraries.library_router.navigate("folders/".concat(t),{trigger:!0,replace:!0})):(l.libraries.folderToolbarView.download(e),l.libraries.library_router.navigate("folders/".concat(t),{trigger:!1,replace:!0}))}),this.library_router.on("route:dataset_detail",function(t,e){l.libraries.datasetView&&l.libraries.datasetView.$el.unbind("click"),l.libraries.datasetView=new Ce.LibraryDatasetView({id:e,show_version:!1,show_permissions:!1})}),this.library_router.on("route:dataset_version",function(t,e,i){l.libraries.datasetView&&l.libraries.datasetView.$el.unbind("click"),l.libraries.datasetView=new Ce.LibraryDatasetView({id:e,ldda_id:i,show_version:!0})}),this.library_router.on("route:dataset_permissions",function(t,e){l.libraries.datasetView&&l.libraries.datasetView.$el.unbind("click"),l.libraries.datasetView=new Ce.LibraryDatasetView({id:e,show_permissions:!0})}),this.library_router.on("route:library_permissions",function(t){l.libraries.libraryView&&l.libraries.libraryView.$el.unbind("click"),l.libraries.libraryView=new Ee.LibraryView({id:t,show_permissions:!0})}),this.library_router.on("route:folder_permissions",function(t){l.libraries.folderView&&l.libraries.folderView.$el.unbind("click"),l.libraries.folderView=new Pe.FolderView({id:t,show_permissions:!0})}),this.library_router.on("route:import_datasets",function(t,e){l.libraries.folderToolbarView&&l.libraries.folderListView?l.libraries.folderToolbarView.showImportModal({source:e}):(l.libraries.folderToolbarView=new Re.FolderToolbarView({id:t}),l.libraries.folderListView=new Te.FolderListView({id:t}),l.libraries.folderToolbarView.showImportModal({source:e}))}),c.a.history.start({pushState:!1})}})},Ne=c.a.Model.extend({defaults:{url:"https://toolshed.g2.bx.psu.edu/",name:"Galaxy Main Tool Shed"},urlRoot:"".concat(Object(d.getAppRoot)(),"api/tool_shed")}),Fe=c.a.Collection.extend({url:"".concat(Object(d.getAppRoot)(),"api/tool_shed"),model:Ne}),He=c.a.Model.extend({defaults:[{}],urlRoot:"".concat(Object(d.getAppRoot)(),"api/tool_shed/contents")}),Ue=c.a.Collection.extend({url:"".concat(Object(d.getAppRoot)(),"api/tool_shed/contents"),model:He}),Be=c.a.Model.extend({defaults:[{}],urlRoot:"".concat(Object(d.getAppRoot)(),"api/tool_shed/category")}),qe=c.a.Collection.extend({url:"".concat(Object(d.getAppRoot)(),"api/tool_shed/category"),model:Be}),Ge=c.a.Model.extend({defaults:[{}],urlRoot:"".concat(Object(d.getAppRoot)(),"api/tool_shed/repository")}),We=c.a.Collection.extend({url:"".concat(Object(d.getAppRoot)(),"api/tool_shed/repository"),model:Ge}),Je=c.a.Model.extend({url:"#"}),Ye=c.a.Collection.extend({url:"#",model:Je,fetch:function(){var t,e=Array();t=window.localStorage.hasOwnProperty("repositories")?JSON.parse(window.localStorage.repositories):[];var i=Object.keys(t);return r.a.each(i,function(i){var n=t[i];n.queue_key=i,e.push(n)}),this.reset(e),c.a.Collection.prototype.fetch.call(this)}}),Ke=c.a.Model.extend({defaults:[{}],urlRoot:"".concat(Object(d.getAppRoot)(),"api/tool_shed/status")}),Qe=c.a.Collection.extend({url:"".concat(Object(d.getAppRoot)(),"api/tool_shed/status"),model:Ke}),Xe=c.a.Model.extend({defaults:[{}],urlRoot:"".concat(Object(d.getAppRoot)(),"api/workflows?missing_tools=True")}),Ze={ShedModel:Ne,ShedsCollection:Fe,Category:He,Categories:Ue,CategoryModel:Be,CategoryCollection:qe,RepositoryModel:Ge,RepositoryCollection:We,RepoQueue:Ye,RepoStatus:Qe,WorkflowTools:c.a.Collection.extend({url:"".concat(Object(d.getAppRoot)(),"api/workflows?missing_tools=True"),model:Xe})},ti={searchShed:function(t,e){var i=this,n=this.shed_url,o="".concat(Object(d.getAppRoot)(),"api/tool_shed/search");a.a.get(o,{term:t.term,tool_shed_url:n},function(t){var n=i.shedParser(t);e(n)})},shedParser:function(t){var e=[],i=t.hits;return a.a.each(i,function(t){var n=i[t],a="".concat(n.repository.name," by ").concat(n.repository.repo_owner_username,": ").concat(n.repository.description),o={value:n.repository.id,label:a};e.push(o)}),e},addToQueue:function(t){"/"==t.tool_shed_url.substr(-1)&&(t.tool_shed_url=t.tool_shed_url.substr(0,t.tool_shed_url.length-1));var e="".concat(t.tool_shed_url,"|").concat(t.repository_id,"|").concat(t.changeset_revision),i={};window.localStorage.repositories&&(i=JSON.parse(window.localStorage.repositories)),i[e]=t,window.localStorage.repositories=JSON.stringify(i)},queueLength:function(){if(window.localStorage.hasOwnProperty("repositories")){var t=JSON.parse(window.localStorage.repositories);return Object.keys(t).length}return 0},toolByGuid:function(t,e,i){var n;return i.forEach(function(e){e.guid==t.value&&(n=e)}),n}},ei={ShedListView:c.a.View.extend({defaults:{tool_sheds:[{url:"https://toolshed.g2.bx.psu.edu/",name:"Galaxy Main Tool Shed"}]},initialize:function(t){this.options=r.a.defaults(this.options||{},this.defaults),this.model=new Ze.ShedsCollection,this.listenTo(this.model,"sync",this.render),this.model.fetch()},el:"#center",render:function(t){this.options=r.a.defaults(this.options||{},t,this.defaults);var e=this.templateToolshedList;this.$el.html(e({title:h()("Configured Galaxy Tool Sheds"),tool_sheds:this.model.models,queue:ti.queueLength()}))},templateToolshedList:r.a.template(['<div class="unified-panel-header" id="panel_header" unselectable="on">','<div class="unified-panel-header-inner"><%= title %><a class="ml-auto" href="#/queue">Repository Queue (<%= queue %>)</a></div>',"</div>",'<div class="unified-panel-body" id="list_toolsheds">','<div class="form-row">','<table class="grid">',"<% _.each(tool_sheds, function(shed) { %>",'<tr class="libraryTitle">',"<td>",'<div style="float: left; margin-left: 1px;" class="menubutton split">','<a class="view-info shed-selector" href="#/categories/s/<%= shed.get("url") %>"><%= shed.get("name") %></a>',"</div>","</td>","</tr>","<% }); %>","</table>","</div>",'<div style="clear: both"></div>',"</div>"].join(""))})},ii=(i(134),{CategoryView:c.a.View.extend({el:"#center",defaults:{tool_shed:"https://toolshed.g2.bx.psu.edu/"},initialize:function(t){var e=t.tool_shed.replace(/\//g,"%2f");this.options=r.a.defaults(this.options||t,this.defaults),this.model=new Ze.Categories,this.listenTo(this.model,"sync",this.render),this.model.url="".concat(this.model.url,"?tool_shed_url=").concat(this.options.tool_shed),this.model.tool_shed=e,this.model.fetch()},render:function(t){this.options=r.a.extend(this.options,t),this.options.categories=this.model.models,this.options.queue=ti.queueLength();var e=this.templateCategoryList;this.$el.html(e(this.options)),a()("#center").css("overflow","auto"),this.bindEvents()},bindEvents:function(){var t=this;a()("#search_box").autocomplete({source:function(e,i){var n=t.model.tool_shed.replace(/%2f/g,"/"),o="".concat(Object(d.getAppRoot)(),"api/tool_shed/search"),s={term:e.term,tool_shed_url:n};a.a.post(o,s,function(t){console.log(t);var e=ti.shedParser(t);i(e)})},minLength:3,select:function(e,i){var n=i.item.value,a="repository/s/".concat(t.model.tool_shed,"/r/").concat(n);c.a.history.navigate(a,{trigger:!0,replace:!0})}})},templateCategoryList:r.a.template(['<style type="text/css">',".ui-autocomplete { background-color: #fff; }","li.ui-menu-item { list-style-type: none; }","</style>",'<div class="unified-panel-header" id="panel_header" unselectable="on">','<div class="unified-panel-header-inner" style="layout: inline;">Categories in <%= tool_shed.replace(/%2f/g, "/") %><a class="ml-auto" href="#/queue">Repository Queue (<%= queue %>)</a></div>',"</div>",'<div class="unified-panel-body" id="list_categories">','<div id="standard-search" style="height: 2em; margin: 1em;">','<span class="ui-widget" >','<input class="search-box-input" id="search_box" data-shedurl="<%= tool_shed.replace(/%2f/g, "/") %>" name="search" placeholder="Search repositories by name or id" size="60" type="text" />',"</span>","</div>",'<div style="clear: both; margin-top: 1em;">','<table class="grid">','<thead id="grid-table-header">',"<tr>","<th>Name</th>","<th>Description</th>","<th>Repositories</th>","</tr>","</thead>","<% _.each(categories, function(category) { %>","<tr>","<td>",'<a href="#/category/s/<%= tool_shed %>/c/<%= category.get("id") %>/k/name/p/1/t/asc"><%= category.get("name") %></a>',"</td>",'<td><%= category.get("description") %></td>','<td><%= category.get("repositories") %></td>',"</tr>","<% }); %>","</table>","</div>","</div>"].join(""))})}),ni={Category:c.a.View.extend({el:"#center",initialize:function(t){this.params=t,this.model=new Ze.CategoryCollection,this.listenTo(this.model,"sync",this.render);var e=t.tool_shed.replace(/\//g,"%2f");this.model.url+="?tool_shed_url=".concat(e,"&category_id=").concat(t.category_id,"&sort_key=").concat(t.sort_key,"&sort_order=").concat(t.sort_order,"&page=").concat(t.page),this.model.tool_shed=e,this.model.category=t.category_id,this.model.fetch()},render:function(t){this.options=r.a.defaults(this.options||{},t);var e=this.templateCategoryContents,i=this.templatePageNavigation,n={class:{owner:"fa-sort",description:"fa-sort",name:"fa-sort"},direction:{owner:"asc",description:"asc",name:"asc"}};n.class[this.params.sort_key]="desc"==this.params.sort_order?"fa-sort-down":"fa-sort-up",n.direction[this.params.sort_key]="asc"==this.params.sort_order?"desc":"asc";var o=Math.max(this.params.page-1,1),s=parseInt(this.model.models[0].get("repository_count")%25)+1,l=Math.min(parseInt(this.params.page)+1,s),c={page:this.params.page,next:l,previous:o,pages:s};if(s>5){var d=parseInt(this.params.page),u=Array(),h=Math.max(d-2,2),p=h,f=Math.min(Math.min(d+2,h+4),s);for(p=h;p<=f;p++)u.push(p);c.page_slice=u}this.$el.html(e({page_navigation:i(c),category:this.model.models[0],tool_shed:this.model.tool_shed,queue:ti.queueLength(),sorting:n,page:this.params.page})),a()("#center").css("overflow","auto"),this.bindEvents()},bindEvents:function(){var t=this;a()("#search_box").autocomplete({source:function(e,i){var n=t.model.tool_shed.replace(/%2f/g,"/"),o="".concat(Object(d.getAppRoot)(),"api/tool_shed/search"),s={term:e.term,tool_shed_url:n};a.a.post(o,s,function(t){var e=ti.shedParser(t);i(e)})},minLength:3,select:function(t,e){var i=e.item.value,n="repository/s/".concat(this.model.tool_shed,"/r/").concat(i);c.a.history.navigate(n,{trigger:!0,replace:!0})}}),a()(".fa-fw").on("click",function(e){var i={};i.field=a()(e.target).attr("data-field"),i.direction=a()(e.target).attr("data-direction");var n="category/s/".concat(t.model.tool_shed,"/c/").concat(t.model.category,"/k/").concat(i.field,"/p/").concat(t.params.page,"/t/").concat(i.direction);c.a.history.navigate(n,{trigger:!0,replace:!0})}),a()(".pagenav").on("click",function(e){var i=a()(e.target).attr("data-page"),n="category/s/".concat(t.model.tool_shed,"/c/").concat(t.model.category,"/k/").concat(t.params.sort_key,"/p/").concat(i,"/t/").concat(t.params.sort_order);c.a.history.navigate(n,{trigger:!0,replace:!0})})},templatePageNavigation:r.a.template(['<div class="navigation">',"<% if (page != 1) { %>",'<a data-page="1" class="pagenav fa fa-fast-backward" />','<a data-page="<%= previous %>" class="pagenav fa fa-step-backward" />',"<% } else { %>",'<a data-page="1" class="pagenav-inactive fa fa-fast-backward" />','<a data-page="<%= previous %>" class="pagenav-inactive fa fa-step-backward" />',"<% } %>","<% if (pages > 5) { %>","<% if (page != 1) { %>",'<a data-page="1" class="pagenav fa"><a>1</a>',"<% if (page != 2) { %>",'<a class="fa">&hellip;</a>',"<% } %>","<% } else { %>",'<a data-page="1" class="pagenav-inactive fa"><a>1</a>',"<% } %>","<% _.each(page_slice, function(i) { %>","<% if (i == page) { %>",'<a data-page="<%= i %>" class="fa"><strong><%= i %></strong></a>',"<% } else { %>",'<a data-page="<%= i %>" class="pagenav fa"><%= i %></a>',"<% } %>","<% }); %>","<% var last_pages = [pages - 2, pages - 1, pages]; %>","<% if (last_pages.indexOf(parseInt(page)) == -1) { %>",'<a class="fa">&hellip;</a>','<a data-page="<%= pages %>" class="pagenav fa"><%= pages %></a>',"<% } %>","<% } else { %>","<% for (i = 1; i <= pages; i++) { %>","<% if (i == page) { %>",'<a data-page="<%= i %>" class="fa"><strong><%= i %></strong></a>',"<% } else { %>",'<a data-page="<%= i %>" class="pagenav fa"><%= i %></a>',"<% } %>","<% } %>","<% } %>","<% if (page < pages) { %>",'<a data-page="<%= next %>" class="pagenav fa fa-step-forward" />','<a data-page="<%= pages %>" class="pagenav fa fa-fast-forward" />',"<% } else { %>",'<a data-page="<%= next %>" class="pagenav-inactive fa fa-step-forward" />','<a data-page="<%= pages %>" class="pagenav-inactive fa fa-fast-forward" />',"<% } %>","</div>"].join("")),templateCategoryContents:r.a.template(['<style type="text/css">',".ui-autocomplete { background-color: #fff; }","li.ui-menu-item { list-style-type: none; }","div.navigation { width: 100%; text-align: center; }","div.navigation a { margin-left: 0.5em; margin-right: 0.5em; display: inline; text-decoration: underline; }","a.pagenav-inactive { opacity: 0.5; }","</style>",'<div class="unified-panel-header" id="panel_header" unselectable="on">','<div class="unified-panel-header-inner">Repositories in <%= category.get("name") %><a class="ml-auto" href="#/queue">Repository Queue (<%= queue %>)</a></div>',"</div>",'<div class="unified-panel-body" id="list_repositories">','<div id="standard-search" style="height: 2em; margin: 1em;">','<span class="ui-widget" >','<input class="search-box-input" id="search_box" name="search" data-shedurl="<%= tool_shed.replace(/%2f/g, "/") %>" placeholder="Search repositories by name or id" size="60" type="text" />',"</span>","</div>","<% if (category.get('repository_count') > 25) { %>","<%= page_navigation %>","<% } %>",'<div style="clear: both; margin-top: 1em;">','<table class="grid table-striped">','<thead id="grid-table-header">',"<tr>",'<th style="width: 10%;"><a class="fa fa-fw <%= sorting.class.owner %>" data-direction="<%= sorting.direction.owner %>" data-field="owner">Owner</a></th>','<th style="width: 15%;"><a class="fa fa-fw <%= sorting.class.name %>" data-direction="<%= sorting.direction.name %>" data-field="name">Name</a></th>','<th><a class="fa fa-fw <%= sorting.class.description %>" data-direction="<%= sorting.direction.description %>" data-field="description">Synopsis</a></th>','<th style="width: 10%;">Type</th>',"</tr>","</thead>",'<% _.each(category.get("repositories"), function(repository) { %>',"<tr>","<td><%= repository.owner %></td>","<td>",'<div style="float: left; margin-left: 1px;" class="menubutton split">','<a href="#/repository/s/<%= tool_shed %>/r/<%= repository.id %>"><%= repository.name %></a>',"</div>","</td>","<td><%= repository.description %></td>","<td><%= repository.type %></td>","</tr>","<% }); %>","</table>","</div>","</div>"].join(""))})},ai={RepoDetails:c.a.View.extend({el:"#center",initialize:function(t){this.options=r.a.defaults(this.options||{},this.defaults),this.model=new Ze.RepositoryCollection,this.listenTo(this.model,"sync",this.render);var e=t.tool_shed.replace(/\//g,"%2f");this.model.url+="?tool_shed_url=".concat(e,"&repository_id=").concat(t.repository_id),this.model.tool_shed_url=t.tool_shed.replace(/%2f/g,"/"),this.model.tool_shed=e,this.model.category=t.repository_id,this.model.fetch()},render:function(t){var e=this.templateRepoDetails,i=this.model.models[0];this.options={repository:i.get("repository"),tool_shed:this.model.tool_shed,queue:ti.queueLength()};var n=Object.keys(this.options.repository.metadata).sort(function(t,e){return parseInt(t.split(":")[0]-e.split(":")[0])}),o={},s=this.options.repository.metadata;n.forEach(function(t){o[t]=s[t]}),this.options.repository.metadata=o,this.options.current_changeset=this.options.current_changeset||n[n.length-1],this.options.current_metadata=this.options.repository.metadata[this.options.current_changeset],this.options.current_metadata.tool_shed_url=this.model.tool_shed_url,this.options.tools=this.options.current_metadata.tools,this.options.repository_dependencies_template=this.templateRepoDependencies,this.options.repository_dependency_template=this.templateRepoDependency,this.options.tps_template_global_select=this.templateGlobalSectionSelect,this.options.tps_template_global_create=this.templateGlobalSectionCreate,this.options.tps_template_tool_select=this.templateToolSectionSelect,this.options.tps_template_tool_create=this.templateToolSectionCreate,this.options.panel_section_options=this.templatePanelSelectOptions,this.options.tool_dependencies=i.get("tool_dependencies"),this.options.shed_tool_conf=this.templateShedToolConf({shed_tool_confs:i.get("shed_conf")}),this.options.panel_section_dict=i.get("panel_section_dict"),this.options.api_url="".concat(Object(d.getAppRoot)(),"api/tool_shed_repositories/install?async=True"),this.options=r.a.extend(this.options,t),this.$el.html(e(this.options)),this.checkInstalled(this.options.current_metadata),this.bindEvents(),a()("#center").css("overflow","auto")},bindEvents:function(){var t=this;a()("#changeset").on("change",function(){t.options.current_changeset=a()("#changeset").find("option:selected").text(),t.options.current_metadata=t.options.repository.metadata[t.options.current_changeset],t.checkInstalled(t.options.current_metadata),t.reDraw(t.options)}),a()("#tool_panel_section_select").on("change",function(){t.tpsSelection()}),a()("#install_repository").on("click",function(e){e.preventDefault();var i={};i.repositories=JSON.stringify([[a()("#install_repository").attr("data-tsrid"),a()("#changeset").find("option:selected").val()]]),i.tool_shed_repository_ids=JSON.stringify([a()("#install_repository").attr("data-tsrid")]),i.tool_shed_url=t.model.tool_shed_url,i.install_tool_dependencies=a()("#install_tool_dependencies").val(),i.install_repository_dependencies=a()("#install_repository_dependencies").val(),i.install_resolver_dependencies=a()("#install_resolver_dependencies").val(),i.tool_panel_section=JSON.stringify(t.panelSelect(i)),i.shed_tool_conf=a()("select[name='shed_tool_conf']").find("option:selected").val(),i.changeset=a()("#changeset").find("option:selected").val();var n=a()("#repository_installation").attr("action");t.prepareInstall(i,n)}),a()("#queue_install").on("click",function(e){t.options.current_changeset=a()("#changeset").find("option:selected").text(),t.options.current_metadata=t.options.repository.metadata[t.options.current_changeset];var i={};r.a.each(Object.keys(t.options.current_metadata),function(e){i[e]||(i[e]=t.options.current_metadata[e])}),i.install_tool_dependencies=a()("#install_tool_dependencies").val(),i.install_repository_dependencies=a()("#install_repository_dependencies").val(),i.install_resolver_dependencies=a()("#install_resolver_dependencies").val(),i.tool_panel_section=JSON.stringify(t.panelSelect({})),i.shed_tool_conf=a()("select[name='shed_tool_conf']").find("option:selected").val(),i.tool_shed_url=t.model.tool_shed_url,"/"==i.tool_shed_url.substr(-1)&&(i.tool_shed_url=i.tool_shed_url.substr(0,i.tool_shed_url.length-1)),ti.addToQueue(i),t.checkInstalled(i)}),this.toolTPSSelectionEvents(),a()(function(){a()("#repository_dependencies").jstree()}),a()(".tool_form").on("click",function(e){var i=a()(e.target).attr("data-guid"),n=a()(e.target).attr("data-name"),o=a()(e.target).attr("data-desc"),s=t.model.tool_shed_url,r=a()("#repository_details").attr("data-tsrid"),l=a()("#changeset").find("option:selected").val(),c="".concat(Object(d.getAppRoot)(),"api/tool_shed/tool_json"),u={guid:i,tool_shed_url:s,tsr_id:r,changeset:l};a.a.get(c,u,function(t){var e=new st.a(t);p.a.deepeach(t.inputs,function(t){t.type&&-1!=["data","data_collection"].indexOf(t.type)&&(t.type="hidden",t.info="Data input '".concat(t.name,"' (").concat(p.a.textify(t.extensions),")"))});var i=new pt.a.View,a="<u>".concat(n,"</u> ").concat(o);i.show({closing_events:!0,title:a,body:e.$el,buttons:{Close:function(){i.hide()}}})})}),a()(".select-tps-button").on("click",function(e){var i=t.selectedChangeset(),n=e.target.attributes.getNamedItem("data-toolguid");t.showToolTPSSelect(n,i)}),a()(".create-tps-button").on("click",function(e){var i=t.selectedChangeset(),n=e.target.attributes.getNamedItem("data-toolguid");t.showToolTPSCreate(n,i)}),a()(".global-select-tps-button").on("click",function(){a()("#tool_panel_section").replaceWith(t.options.tps_template_global_select(t.options)),t.propagateTPS(),t.bindEvents()}),a()(".global-create-tps-button").on("click",function(){a()("#tool_panel_section").replaceWith(t.options.tps_template_global_create()),t.bindEvents()})},checkInstalled:function(t){var e=this,i={name:t.name,owner:t.owner},n=!1;a.a.get("".concat(Object(d.getAppRoot)(),"api/tool_shed_repositories"),i,function(i){for(var o=0;o<i.length;o++){var s=i[o],r=!s.deleted&&!s.uninstalled,l=s.changeset_revision==t.changeset_revision||s.installed_changeset_revision==t.changeset_revision;s.name==t.repository.name&&s.owner==t.repository.owner&&r&&l&&(n=!0),n?(a()("#install_repository").prop("disabled",!0),a()("#install_repository").val("This revision is already installed")):(a()("#install_repository").prop("disabled",!1),a()("#install_repository").val("Install this revision"))}e.repoQueued(t)||n?(a()("#queue_install").hide(),a()("#queue_install").val("This revision is already in the queue")):(a()("#queue_install").show(),a()("#queue_install").val("Install this revision later"))})},panelSelect:function(t){var e={};return a()("#tool_panel_section_select").length?t.tool_panel_section_id=a()("#tool_panel_section_select").find("option:selected").val():t.new_tool_panel_section=a()("#new_tool_panel_section").val(),a()(".tool_panel_section_picker").each(function(){var t=a()(this).attr("name"),i=a()(this).attr("data-toolguid");e[i]="tool_panel_section_id"===t?{tool_panel_section:a()(this).find("option:selected").val(),action:"append"}:{tool_panel_section:a()(this).val(),action:"create"}}),e},reDraw:function(t){this.$el.empty(),this.render(t)},repoQueued:function(t){if(window.localStorage.repositories){var e,i=this.queueKey(t);return window.localStorage.repositories&&(e=JSON.parse(window.localStorage.repositories)),!(!e||!e.hasOwnProperty(i))}},queueKey:function(t){var e=this.model.tool_shed_url;return"/"==e.substr(-1)&&(e=e.substr(0,e.length-1)),"".concat(e,"|").concat(t.repository_id,"|").concat(t.changeset_revision)},tpsSelection:function(){var t=a()("#tool_panel_section_select").find("option:selected").val();a()('.tool_panel_section_picker[default="active"]').each(function(){a()(this).val(t)})},prepareInstall:function(t,e){var i=this;a.a.post(e,t,function(t){var e=JSON.parse(t);i.doInstall(e)})},doInstall:function(t){var e="".concat(Object(d.getAppRoot)(),"admin_toolshed/install_repositories"),i=t.repositories,n="status/r/".concat(i.join("|"));a.a.post(e,t,function(t){console.log("Initializing repository installation succeeded")}),c.a.history.navigate(n,{trigger:!0,replace:!0})},selectedChangeset:function(){return a()("#changeset").find("option:selected").val()},showToolTPSCreate:function(t,e){var i=this,n=this.options.current_metadata.tools,o=ti.toolByGuid(t,e,n),s="#tool_tps_"+o.clean;a()(s).empty(),a()(s).append(this.options.tps_template_tool_create({tool:o})),a()(".select-tps-button").click(function(t){var e=i.selectedChangeset(),n=t.target.attributes.getNamedItem("data-toolguid");i.showToolTPSSelect(n,e)}),this.bindEvents()},showToolTPSSelect:function(t,e){var i=this,n=this.options.current_metadata.tools,o=ti.toolByGuid(t,e,n),s="#tool_tps_"+o.clean;a()(s).empty(),a()(s).append(this.options.tps_template_tool_select({tool:o,panel_section_dict:this.options.panel_section_dict,panel_section_options:this.options.panel_section_options})),a()(".create-tps-button").click(function(t){var e=i.selectedChangeset(),n=t.target.attributes.getNamedItem("data-toolguid");i.showToolTPSCreate(n,e)}),this.bindEvents()},propagateTPS:function(){a()("#tool_panel_section_select").change(function(){var t=a()("#tool_panel_section_select").find("option:selected").val();a()('.tool_panel_section_picker[default="active"]').each(function(e){e.val(t)})}),this.toolTPSSelectionEvents()},toolTPSSelectionEvents:function(){a()(".tool_panel_section_picker").on("change",function(t){var e=a()(t.target);e.find("option:selected").val()==a()("#tool_panel_section_select").find("option:selected").val()?e.attr("default","active"):e.removeAttr("default")})},templateRepoDetails:r.a.template(['<div class="unified-panel-header" id="panel_header" unselectable="on">','<div class="unified-panel-header-inner">Repository information for&nbsp;<strong><%= repository.name %></strong>&nbsp;from&nbsp;<strong><%= repository.owner %></strong><a class="ml-auto" href="#/queue">Repository Queue (<%= queue %>)</a></div>',"</div>",'<div class="unified-panel-body" id="repository_details" data-tsrid="<%= repository.id %>">','<form id="repository_installation" name="install_repository" method="post" action="<%= api_url %>">','<input type="hidden" id="repositories" name="<%= repository.id %>" value="ID" />','<input type="hidden" id="tool_shed_url" name="tool_shed_url" value="<%= tool_shed %>" />','<div class="toolForm">','<div class="toolFormTitle">Changeset</div>','<div class="toolFormBody changeset">','<select id="changeset" name="changeset" style="margin: 5px;">',"<% _.each(Object.keys(repository.metadata), function(changeset) { %>",'<% if (changeset == current_changeset) { var selected = "selected "; } else { var selected = ""; } %>','<option <%= selected %>value="<%= changeset.split(":")[1] %>"><%= changeset %></option>',"<% }); %>","</select>",'<input class="btn btn-primary preview-button" data-tsrid="<%= current_metadata.repository.id %>" type="submit" id="install_repository" name="install_repository" value="Install this revision now" />','<input class="btn btn-primary preview-button" type="button" id="queue_install" name="queue_install" value="Install this revision later" />','<div class="toolParamHelp" style="clear: both;">Please select a revision and review the settings below before installing.</div>',"</div>","</div>","<%= shed_tool_conf %>","<% if (current_metadata.has_repository_dependencies) { %>",'<div class="toolFormTitle">Repository dependencies for <strong id="current_changeset"><%= current_changeset %></strong></div>','<div class="toolFormBody">','<p id="install_repository_dependencies_checkbox">','<input type="checkbox" checked id="install_repository_dependencies" />','<label for="install_repository_dependencies">Install repository dependencies</label>',"</p>","<% current_metadata.repository_dependency_template = repository_dependency_template; %>",'<div class="tables container-table" id="repository_dependencies">','<div class="expandLink">','<a class="toggle_folder" data_target="repository_dependencies_table">',"Repository dependencies &ndash; <em>installation of these additional repositories is required</em>","</a>","</div>","<%= repository_dependencies_template(current_metadata) %>","</div>","</div>","<% } %>","<% if (current_metadata.includes_tool_dependencies) { %>",'<div class="toolFormTitle">Tool dependencies</div>','<div class="toolFormBody">','<p id="install_resolver_dependencies_checkbox">','<input type="checkbox" checked id="install_resolver_dependencies" />','<label for="install_resolver_dependencies">Install resolver dependencies</label>',"</p>",'<p id="install_tool_dependencies_checkbox">','<input type="checkbox" checked id="install_tool_dependencies" />','<label for="install_tool_dependencies">Install tool dependencies</label>',"</p>",'<div class="tables container-table" id="tool_dependencies">','<div class="expandLink">','<a class="toggle_folder" data_target="tool_dependencies_table">',"Tool dependencies &ndash; <em>repository tools require handling of these dependencies</em>","</a>","</div>",'<table class="tables container-table" id="tool_dependencies_table" border="0" cellpadding="2" cellspacing="2" width="100%">',"<thead>",'<tr style="display: table-row;" class="datasetRow" parent="0" id="libraryItem-rt-f9cad7b01a472135">','<th style="padding-left: 40px;">Name</th>',"<th>Version</th>","<th>Type</th>","</tr>","</thead>",'<tbody id="tool_deps">',"<% _.each(tool_dependencies[current_changeset], function(dependency) { %>",'<tr class="datasetRow tool_dependency_row" style="display: table-row;">','<td style="padding-left: 40px;">',"<%= dependency.name %></td>","<td><%= dependency.version %></td>","<td><%= dependency.type %></td>","</tr>","<% }); %>","</tbody>","</table>","</div>","</div>","<% } %>","<% if (current_metadata.includes_tools_for_display_in_tool_panel) { %>",'<div class="toolFormTitle">Tools &ndash; <em>click the name to preview the tool and use the pop-up menu to inspect all metadata</em></div>','<div class="toolFormBody">','<div class="tables container-table" id="tools_toggle">','<table class="tables container-table" id="valid_tools" border="0" cellpadding="2" cellspacing="2" width="100%">',"<thead>",'<tr style="display: table-row;" class="datasetRow" parent="0" id="libraryItem-rt-f9cad7b01a472135">','<th style="padding-left: 40px;">Name</th>',"<th>Description</th>","<th>Version</th>","<th><%= tps_template_global_select({panel_section_dict: panel_section_dict, panel_section_options: panel_section_options}) %></tr>","</thead>",'<tbody id="tools_in_repo">',"<% _.each(current_metadata.tools, function(tool) { %>",'<tr id="libraryItem-<%= tool.clean %>" class="tool_row" style="display: table-row;" style="width: 15%">','<td style="padding-left: 40px;">','<div id="tool-<%= tool.clean %>" class="menubutton split popup" style="float: left;">','<a class="tool_form view-info" data-toggle="modal" data-target="toolform_<%= tool.clean %>" data-clean="<%= tool.clean %>" data-guid="<%= tool.guid %>" data-name="<%= tool.name %>" data-desc="<%= tool.description %>"><%= tool["name"] %></a>',"</div>","</td>","<td><%= tool.description %></td>",'<td style="width: 15%"><%= tool.version %></td>','<td style="width: 35%" id="tool_tps_<%= tool.clean %>">',"<%= tps_template_tool_select({tool: tool, panel_section_dict: panel_section_dict, panel_section_options: panel_section_options}) %>","</td>","</tr>","<% }); %>","</tbody>","</table>","</div>","</div>","<% } %>","</form>","</div>"].join("")),templateRepoDependencies:r.a.template(['<div class="toolFormTitle">Repository Dependencies</div>','<div class="toolFormBody tables container-table" id="repository_dependencies">',"<ul>","<li>Repository installation requires the following","<% if (has_repository_dependencies) { %>","<% _.each(repository_dependencies, function(dependency) { %>","<% dependency.repository_dependency_template = repository_dependency_template; %>","<%= repository_dependency_template(dependency) %>","<% }); %>","<% } %>","</li>","</ul>","</div>"].join("")),templateRepoDependency:r.a.template(['<li id="metadata_<%= id %>" class="datasetRow repository_dependency_row">',"Repository <b><%= repository.name %></b> revision <b><%= changeset_revision %></b> owned by <b><%= repository.owner %></b>","<% if (has_repository_dependencies) { %>",'<ul class="child_dependencies">',"<% _.each(repository_dependencies, function(dependency) { %>","<% dependency.repository_dependency_template = repository_dependency_template; %>","<%= repository_dependency_template(dependency) %>","<% }); %>","</ul>","<% } %>","</li>"].join("")),templateShedToolConf:r.a.template(['<div class="toolFormTitle">Shed tool configuration file:</div>','<div class="toolFormBody">','<div class="form-row">','<select name="shed_tool_conf">',"<% _.each(shed_tool_confs.options, function(conf) { %>",'<option value="<%= conf.value %>"><%= conf.label %></option>',"<% }); %>","</select>",'<div class="toolParamHelp" style="clear: both;">Select the file whose <b>tool_path</b> setting you want used for installing repositories.</div>',"</div>","</div>"].join("")),templateToolDependency:r.a.template(["<% if (has_repository_dependencies) { %>","<% _.each(repository_dependencies, function(dependency) { %>","<% if (dependency.includes_tool_dependencies) { %>","<% dependency.tool_dependency_template = tool_dependency_template %>","<%= tool_dependency_template(dependency) %>","<% } %>","<% }); %>","<% } %>"].join("")),templateGlobalSectionCreate:r.a.template(['<div id="tool_panel_section">','<div class="form-row" id="new_tps">','<input id="new_tool_panel_section" name="new_tool_panel_section" type="textfield" value="" size="40"/>','<input class="btn btn-primary global-select-tps-button" type="button" id="select_existing" value="Select existing" />','<div class="toolParamHelp" style="clear: both;">',"Add a new tool panel section to contain the installed tools (optional).","</div>","</div>","</div>"].join("")),templateGlobalSectionSelect:r.a.template(['<div id="tool_panel_section">','<div class="toolFormTitle">Tool Panel Section</div>','<div class="toolFormBody">','<div class="tab-pane" id="select_tps">','<select name="<%= name %>" id="<%= panel_section_dict.id %>">',"<%= panel_section_options({sections: panel_section_dict.sections}) %>","</select>",'<input class="btn btn-primary global-create-tps-button" type="button" id="create_new" value="Create new" />','<div class="toolParamHelp" style="clear: both;">',"Select an existing tool panel section to contain the installed tools (optional).","</div>","</div>","</div>","</div>"].join("")),templateToolSectionCreate:r.a.template(['<div id="new_tps_<%= tool.clean %>" data-clean="<%= tool.clean %>" class="form-row">','<input data-toolguid="<%= tool.guid %>" class="tool_panel_section_picker" size="40" name="new_tool_panel_section" id="new_tool_panel_section_<%= tool.clean %>" type="text">','<input id="per_tool_select_<%= tool.clean %>" class="btn btn-primary select-tps-button" data-toolguid="<%= tool.guid %>" value="Select existing" id="select_existing_<%= tool.clean %>" type="button">',"</div>"].join("")),templateToolSectionSelect:r.a.template(['<div id="select_tps_<%= tool.clean %>" data-clean="<%= tool.clean %>" class="tps_creator">','<select default="active" style="width: 30em;" data-toolguid="<%= tool.guid %>" class="tool_panel_section_picker" name="tool_panel_section_id" id="tool_panel_section_select_<%= tool.clean %>">',"<%= panel_section_options({sections: panel_section_dict.sections}) %>","</select>",'<input id="per_tool_create_<%= tool.clean %>" data-clean="<%= tool.clean %>" class="btn btn-primary create-tps-button" data-toolguid="<%= tool.guid %>" value="Create new" id="create_new_<%= tool.clean %>" type="button">','<div style="clear: both;" class="toolParamHelp"></div>',"</div>"].join("")),templatePanelSelectOptions:r.a.template(["<% _.each(sections, function(section) { %>",'<option value="<%= section.id %>"><%= section.name %></option>',"<% }); %>"].join(""))})},oi={RepoQueueView:c.a.View.extend({el:"#center",defaults:[],initialize:function(t){this.model=new Ze.RepoQueue,this.listenTo(this.model,"sync",this.render),this.model.fetch(),this.render()},render:function(t){var e=this.templateRepoQueue,i=this.model.models;this.$el.html(e({title:h()("Repository Installation Queue"),repositories:i,empty:h()("No repositories in queue."),queue:ti.queueLength()})),a()("#center").css("overflow","auto"),this.bindEvents()},bindEvents:function(){var t=this;a()(".install_one").on("click",function(e){var i=t.loadFromQueue(a()(e.target).attr("data-repokey"));t.installFromQueue(i,a()(e.target).attr("data-repokey"))}),a()(".remove_one").on("click",function(t){var e=a()(t.target).attr("data-repokey"),i=JSON.parse(window.localStorage.repositories);if(i.hasOwnProperty(e)){var n=i[e].repository.id;delete i[e],a()("#queued_repository_".concat(n)).remove()}window.localStorage.repositories=JSON.stringify(i)}),a()("#clear_queue").on("click",function(){window.localStorage.repositories="{}"}),a()("#from_workflow").on("click",function(){c.a.history.navigate("workflows",{trigger:!0,replace:!0})})},installFromQueue:function(t,e){var i={};i.install_tool_dependencies=t.install_tool_dependencies,i.install_repository_dependencies=t.install_repository_dependencies,i.install_resolver_dependencies=t.install_resolver_dependencies,i.tool_panel_section=t.tool_panel_section,i.shed_tool_conf=t.shed_tool_conf,i.repositories=JSON.stringify([[t.repository.id,t.changeset_revision]]),i.tool_shed_repository_ids=JSON.stringify([t.repository.id]),i.tool_shed_url=e.split("|")[0],i.changeset=t.changeset_revision;var n="".concat(Object(d.getAppRoot)(),"api/tool_shed_repositories/install?async=True");if(a()("#queued_repository_".concat(t.repository.id)).remove(),window.localStorage.repositories){void 0===e&&(e=ti.queueKey(t));var o=JSON.parse(window.localStorage.repositories);o.hasOwnProperty(e)&&(delete o[e],window.localStorage.repositories=JSON.stringify(o))}a.a.post(n,i,function(t){var e=JSON.parse(t),i=e.repositories,n="status/r/".concat(i.join("|"));a.a.post("".concat(Object(d.getAppRoot)(),"admin_toolshed/install_repositories"),e,function(t){console.log("Initializing repository installation succeeded")}),c.a.history.navigate(n,{trigger:!0,replace:!0})})},loadFromQueue:function(t){var e=JSON.parse(window.localStorage.repositories);return e.hasOwnProperty(t)?e[t]:this.defaults},templateRepoQueue:r.a.template(['<div class="unified-panel-header" id="panel_header" unselectable="on">','<div class="unified-panel-header-inner"><%= title %><a class="ml-auto" href="#/queue">Repository Queue (<%= queue %>)</a></div>',"</div>",'<div class="tab-pane" id="panel_header" id="repository_queue">','<table id="queued_repositories" class="grid" border="0" cellpadding="2" cellspacing="2" width="100%">','<thead id="grid-table-header">',"<tr>",'<th class="datasetRow">Name</th>','<th class="datasetRow">Owner</th>','<th class="datasetRow">Revision</th>','<th class="datasetRow">ToolShed</th>','<th class="datasetRow">Install</th>','<th class="datasetRow"><input class="btn btn-primary" type="submit" id="clear_queue" name="clear_queue" value="Clear queue" /></th>',"</tr>","</thead>","<tbody>","<% if (repositories.length > 0) { %>","<% _.each(repositories, function(repository) { %>",'<tr id="queued_repository_<%= repository.get("id") %>">','<td class="datasetRow"><%= repository.get("repository").name %></td>','<td class="datasetRow"><%= repository.get("repository").owner %></td>','<td class="datasetRow"><%= repository.get("changeset_revision") %></td>','<td class="datasetRow"><%= repository.get("tool_shed_url") %></td>','<td class="datasetRow">','<input class="btn btn-primary install_one" data-repokey="<%= repository.get("queue_key") %>" type="submit" id="install_repository_<%= repository.get("id") %>" name="install_repository" value="Install now" />',"</td>",'<td class="datasetRow">','<input class="btn btn-primary remove_one" data-repokey="<%= repository.get("queue_key") %>" type="submit" id="unqueue_repository_<%= repository.get("id") %>" name="unqueue_repository" value="Remove from queue" />',"</td>","</tr>","<% }); %>","<% } else { %>",'<tr><td colspan="6"><%= empty %></td></tr>',"<% } %>","</tbody>","</table>",'<input type="button" class="btn btn-primary" id="from_workflow" value="Add from workflow" />',"</div>"].join(""))})},si={RepoStatus:c.a.View.extend({el:"#center",initialize:function(t){var e=this;this.options=r.a.defaults(this.options||[{}],t,this.defaults),this.model=new Ze.RepoStatus,this.listenTo(this.model,"sync",this.render),this.model.url+="?repositories=".concat(this.options.repositories.join("|")),this.model.fetch(),this.timer=window.setInterval(function(){var t=["installed","error"],i=!0;r.a.some(e.model.models,function(e){var n=e.get("status").toLowerCase();if(-1===t.indexOf(n))return i=!1,!0}),i?window.clearInterval(e.timer):e.model.fetch()},2e3)},close:function(){window.clearInterval(this.timer)},render:function(t){this.options=r.a.extend(this.options,t);var e=this.templateRepoStatus;this.$el.html(e({title:h()("Repository Status"),repositories:this.model.models,queue:ti.queueLength()})),a()("#center").css("overflow","auto")},templateRepoStatus:r.a.template(['<div class="unified-panel-header" id="panel_header" unselectable="on">','<div class="unified-panel-header-inner"><%= title %><a class="ml-auto" href="#/queue">Repository Queue (<%= queue %>)</a></div>',"</div>",'<style type="text/css">',".state-color-new,",".state-color-deactivated,",".state-color-uninstalled { border-color:#bfbfbf; background:#eee }",".state-color-cloning,",".state-color-setting-tool-versions,",".state-color-installing-repository-dependencies,",".state-color-installing-tool-dependencies,",".state-color-loading-proprietary-datatypes { border-color:#AAAA66; background:#FFFFCC }",".state-color-installed { border-color:#20b520; background:#b0f1b0 }",".state-color-error { border-color:#dd1b15; background:#f9c7c5 }","</style>",'<table id="grid-table" class="grid">','<thead id="grid-table-header">',"<tr>",'<th id="null-header">Name<span class="sort-arrow"></span></th>','<th id="null-header">Description<span class="sort-arrow"></span></th>','<th id="null-header">Owner<span class="sort-arrow"></span></th>','<th id="null-header">Revision<span class="sort-arrow"></span></th>','<th id="null-header">Installation Status<span class="sort-arrow"></span></th>',"</tr>","</thead>",'<tbody id="grid-table-body">',"<% _.each(repositories, function(repository) { %>","<tr>","<td>",'<div id="" class="">','<label id="repo-name-<%= repository.get("id") %>" for="<%= repository.get("id") %>">','<%= repository.get("name") %>',"</label>","</div>","</td>","<td>",'<div id="" class="">','<label id="repo-desc-<%= repository.get("id") %>" for="<%= repository.get("id") %>">','<%= repository.get("description") %>',"</label>","</div>","</td>","<td>",'<div id="" class="">','<label id="repo-user-<%= repository.get("id") %>" for="<%= repository.get("id") %>">','<%= repository.get("owner") %>',"</label>","</div>","</td>","<td>",'<div id="" class="">','<label id="repo-changeset-<%= repository.get("id") %>" for="<%= repository.get("id") %>">','<%= repository.get("changeset_revision") %>',"</label>","</div>","</td>","<td>",'<div id="" class="">','<label id="RepositoryStatus-<%= repository.get("id") %>" for="<%= repository.get("id") %>">','<div class="repo-status count-box state-color-<%= repository.get("status").toLowerCase().replace(/ /g, "-") %>" id="RepositoryStatus-<%= repository.get("id") %>">','<%= repository.get("status") %>',"</div>","</label>","</div>","</td>","</tr>","<% }); %>","</tbody>",'<tfoot id="grid-table-footer"></tfoot>',"</table>"].join(""))})},ri={Workflows:c.a.View.extend({el:"#center",defaults:[{}],initialize:function(t){this.model=new Ze.WorkflowTools,this.listenTo(this.model,"sync",this.render),this.model.fetch(),this.render()},render:function(t){var e=this.templateWorkflows,i=this.model.models;this.$el.html(e({title:h()("Workflows Missing Tools"),workflows:i,queue:ti.queueLength()})),a()("#center").css("overflow","auto"),this.bindEvents()},bindEvents:function(){var t;a()(".show_wf_repo").on("click",function(e){var i=a()(e.target).attr("data-toolids"),n=a()(e.target).attr("data-shed"),o="".concat(Object(d.getAppRoot)(),"api/tool_shed/repository"),s={tool_ids:i};a.a.get(o,s,function(e){t=e.repository.id;var i="repository/s/".concat(n.replace(/:/g,"%3a").replace(/\//g,"%2f"),"/r/").concat(e.repository.id);c.a.history.navigate(i,{trigger:!0,replace:!0})})}),a()(".queue_wf_repo").on("click",function(e){var i=a()(e.target),n=i.attr("data-toolids"),o=i.attr("data-shed"),s="".concat(Object(d.getAppRoot)(),"api/tool_shed/repository"),r={tool_ids:n};a.a.get(s,r,function(e){t=e.repository.id,r={tool_shed_url:o,repository_id:t},a.a.get(s,r,function(t){var e=Object.keys(t.repository.metadata)[0],n=t.repository.metadata[e];n.tool_shed_url=o,ti.addToQueue(n),i.remove()})})}),a()("#from_workflow").on("click",this.loadWorkflows)},templateWorkflows:r.a.template(['<div class="unified-panel-header" id="panel_header" unselectable="on">','<div class="unified-panel-header-inner"><%= title %><a class="ml-auto" href="#/queue">Repository Queue (<%= queue %>)</a></div>',"</div>",'<style type="text/css">',".workflow_names, .workflow_tools { list-style-type: none; } ul.workflow_tools, ul.workflow_names {  padding-left: 0px; }","</style>",'<table id="workflows_missing_tools" class="grid" border="0" cellpadding="2" cellspacing="2" width="100%">','<thead id="grid-table-header">',"<tr>",'<th class="datasetRow">Workflows</th>','<th class="datasetRow">Tool IDs</th>','<th class="datasetRow">Shed</th>','<th class="datasetRow">Name</th>','<th class="datasetRow">Owner</th>','<th class="datasetRow">Actions</th>',"</tr>","</thead>","<tbody>","<% _.each(workflows, function(workflow) { %>","<tr>",'<td class="datasetRow">','<ul class="workflow_names">','<% _.each(workflow.get("workflows"), function(name) { %>','<li class="workflow_names"><%= name %></li>',"<% }); %>","</ul>","</td>",'<td class="datasetRow">','<ul class="workflow_tools">','<% _.each(workflow.get("tools"), function(tool) { %>','<li class="workflow_tools"><%= tool %></li>',"<% }); %>","</ul>","</td>",'<td class="datasetRow"><%= workflow.get("shed") %></td>','<td class="datasetRow"><%= workflow.get("repository") %></td>','<td class="datasetRow"><%= workflow.get("owner") %></td>','<td class="datasetRow">','<ul class="workflow_tools">','<li class="workflow_tools">','<input type="button" class="show_wf_repo btn btn-primary" data-shed="<%= workflow.get("shed") %>" data-owner="<%= workflow.get("owner") %>" data-repo="<%= workflow.get("repository") %>" data-toolids="<%= workflow.get("tools").join(",") %>" value="Show Repository" /></li>',"</ul>","</td>","</tr>","<% }); %>","</ul>","</div>"].join(""))})},li=c.a.Router.extend({initialize:function(){this.routesHit=0,c.a.history.on("route",function(){this.routesHit++},this),this.bind("route",this.trackPageview)},routes:{"":"toolsheds",sheds:"toolsheds",queue:"queue",workflows:"workflows","status/r/:repositories":"status",status:"status","categories/s/:tool_shed":"categories","category/s/:tool_shed/c/:category_id/k/:sort_key/p/:page/t/:sort_order":"repositories","repository/s/:tool_shed/r/:repository_id":"repository"},back:function(){this.routesHit>1?window.history.back():this.navigate("#",{trigger:!0,replace:!0})}}),ci={GalaxyApp:c.a.View.extend({app_config:{known_views:["toolsheds","queue","status","categories","repositories","repository"]},initialize:function(){var t=Object(o.a)();t.admintoolshedapp=this,this.admin_toolshed_router=new li,this.admin_toolshed_router.on("route:queue",function(){t.admintoolshedapp.adminRepoQueueView=new oi.RepoQueueView}),this.admin_toolshed_router.on("route:toolsheds",function(){t.admintoolshedapp.adminShedListView=new ei.ShedListView}),this.admin_toolshed_router.on("route:categories",function(e){t.admintoolshedapp.adminShedCategoriesView=new ii.CategoryView({tool_shed:e.replace(/\//g,"%2f")})}),this.admin_toolshed_router.on("route:repositories",function(e,i){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"name",a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"asc";t.admintoolshedapp.adminShedCategoryView=new ni.Category({tool_shed:e.replace(/\//g,"%2f"),category_id:i,page:a,sort_order:o,sort_key:n})}),this.admin_toolshed_router.on("route:repository",function(e,i){t.admintoolshedapp.adminRepositoryView=new ai.RepoDetails({tool_shed:e.replace(/\//g,"%2f"),repository_id:i})}),this.admin_toolshed_router.on("route:status",function(e){t.admintoolshedapp.adminRepoStatusView=new si.RepoStatus({repositories:e.split("|")})}),this.admin_toolshed_router.on("route:workflows",function(){t.admintoolshedapp.adminWorkflowsView=new ri.Workflows}),c.a.history.start({pushState:!1})}})},di=i(33);var ui=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=Object.assign({},t);return new Proxy(e,{get:function(t,e){if(e in t)return t[e];console.warn("Requested missing config prop",e)}})}();var hi=window.WYMeditor,pi={ITEM_HISTORY:"item_history",ITEM_DATASET:"item_dataset",ITEM_WORKFLOW:"item_workflow",ITEM_PAGE:"item_page",ITEM_VISUALIZATION:"item_visualization",DIALOG_HISTORY_LINK:"link_history",DIALOG_DATASET_LINK:"link_dataset",DIALOG_WORKFLOW_LINK:"link_workflow",DIALOG_PAGE_LINK:"link_page",DIALOG_VISUALIZATION_LINK:"link_visualization",DIALOG_EMBED_HISTORY:"embed_history",DIALOG_EMBED_DATASET:"embed_dataset",DIALOG_EMBED_WORKFLOW:"embed_workflow",DIALOG_EMBED_PAGE:"embed_page",DIALOG_EMBED_VISUALIZATION:"embed_visualization"};function fi(t){var e,i,n,a;switch(t){case pi.ITEM_HISTORY:e="History",i="Histories",n="history",a="History";break;case pi.ITEM_DATASET:e="Dataset",i="Datasets",n="dataset",a="HistoryDatasetAssociation";break;case pi.ITEM_WORKFLOW:e="Workflow",i="Workflows",n="workflow",a="StoredWorkflow";break;case pi.ITEM_PAGE:e="Page",i="Pages",n="page",a="Page";break;case pi.ITEM_VISUALIZATION:e="Visualization",i="Visualizations",n="visualization",a="Visualization"}var o="list_".concat(i.toLowerCase(),"_for_selection");return{singular:e,plural:i,controller:n,iclass:a,list_ajax_url:ui.list_objects_url.replace("LIST_ACTION",o)}}function mi(t,e,i){var n=ui.set_accessible_url.replace("ITEM_CONTROLLER",t);a.a.ajax({type:"POST",url:n,data:{id:e,accessible:"True"},error:function(){alert("Making ".concat(i," accessible failed"))}})}function gi(){!function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Object.assign(ui,t)}(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}),a()(document).ajaxError(function(t,e){return _t("Server error",e.responseText||e.statusText||"Could not connect to server",{"Ignore error":gt}),!1}),a()("[name=page_content]").wymeditor({skin:"galaxy",basePath:ui.editor_base_path,iframeBasePath:ui.iframe_base_path,boxHtml:"<table class='wym_box' width='100%' height='100%'><tr><td><div class='wym_area_top'>".concat(hi.TOOLS,"</div></td></tr><tr height='100%'><td><div class='wym_area_main' style='height: 100%;'>").concat(hi.IFRAME).concat(hi.STATUS,"</div></div></td></tr></table>"),toolsItems:[{name:"Bold",title:"Strong",css:"wym_tools_strong"},{name:"Italic",title:"Emphasis",css:"wym_tools_emphasis"},{name:"Superscript",title:h()("Superscript"),css:"wym_tools_superscript"},{name:"Subscript",title:h()("Subscript"),css:"wym_tools_subscript"},{name:"InsertOrderedList",title:"Ordered_List",css:"wym_tools_ordered_list"},{name:"InsertUnorderedList",title:"Unordered_List",css:"wym_tools_unordered_list"},{name:"Indent",title:"Indent",css:"wym_tools_indent"},{name:"Outdent",title:"Outdent",css:"wym_tools_outdent"},{name:"Undo",title:"Undo",css:"wym_tools_undo"},{name:"Redo",title:"Redo",css:"wym_tools_redo"},{name:"CreateLink",title:"Link",css:"wym_tools_link"},{name:"Unlink",title:"Unlink",css:"wym_tools_unlink"},{name:"InsertImage",title:"Image",css:"wym_tools_image"},{name:"InsertTable",title:"Table",css:"wym_tools_table"}]});var t=a.a.wymeditors(0),e=function(e){_t("Saving page","progress"),a.a.ajax({url:ui.save_url,type:"POST",data:{id:ui.page_id,content:t.xhtml(),annotations:JSON.stringify({}),_:"true"},success:function(){e()}})};a()("#save-button").click(function(){e(function(){gt()})}),a()("#close-button").click(function(){window.document.location=ui.page_list_url});var i=a()("<div class='galaxy-page-editor-button'><a id='insert-galaxy-link' class='action-button popup' href='#'>Paragraph type</a></div>");a()(".wym_area_top").append(i);var n={};a.a.each(t._options.containersItems,function(e,i){var a=i.name;n[i.title.replace("_"," ")]=function(){t.container(a)}}),Object(wt.b)(i,n);var o=a()("<div><a id='insert-galaxy-link' class='action-button popup' href='#'>Insert Link to Galaxy Object</a></div>").addClass("galaxy-page-editor-button");a()(".wym_area_top").append(o),Object(wt.b)(o,{"Insert History Link":function(){t.dialog(pi.DIALOG_HISTORY_LINK)},"Insert Dataset Link":function(){t.dialog(pi.DIALOG_DATASET_LINK)},"Insert Workflow Link":function(){t.dialog(pi.DIALOG_WORKFLOW_LINK)},"Insert Page Link":function(){t.dialog(pi.DIALOG_PAGE_LINK)},"Insert Visualization Link":function(){t.dialog(pi.DIALOG_VISUALIZATION_LINK)}});var s=a()("<div><a id='embed-galaxy-object' class='action-button popup' href='#'>Embed Galaxy Object</a></div>").addClass("galaxy-page-editor-button");a()(".wym_area_top").append(s),Object(wt.b)(s,{"Embed History":function(){t.dialog(pi.DIALOG_EMBED_HISTORY)},"Embed Dataset":function(){t.dialog(pi.DIALOG_EMBED_DATASET)},"Embed Workflow":function(){t.dialog(pi.DIALOG_EMBED_WORKFLOW)},"Embed Visualization":function(){t.dialog(pi.DIALOG_EMBED_VISUALIZATION)}})}hi.editor.prototype.dialog=function(t,e,i){var n,s,r=this,l=r.uniqueStamp(),c=r.selected();t==hi.DIALOG_LINK&&(c&&(a()(r._options.hrefSelector).val(a()(c).attr(hi.HREF)),a()(r._options.srcSelector).val(a()(c).attr(hi.SRC)),a()(r._options.titleSelector).val(a()(c).attr(hi.TITLE)),a()(r._options.altSelector).val(a()(c).attr(hi.ALT))),c&&(null==(n=a()(c).attr("href"))&&(n=""),null==(s=a()(c).attr("title"))&&(s="")),_t("Create Link","<div><div><label id='link_attribute_label'>URL <span style='float: right; font-size: 90%'><a href='#' id='set_link_id'>Create in-page anchor</a></span></label><br><input type='text' class='wym_href' value='".concat(n,"' size='40' /></div><div><label>Title</label><br><input type='text' class='wym_title' value='").concat(s,"' size='40' /></div><div>"),{"Make link":function(){var t=a()(r._options.hrefSelector).val()||"",e=a()(".wym_id").val()||"",i=a()(r._options.titleSelector).val()||"";if(t||e){r._exec(hi.CREATE_LINK,l);var n=a()("a[href=".concat(l,"]"),r._doc.body);n.attr(hi.HREF,t).attr(hi.TITLE,i).attr("id",e),0===n.text().indexOf("wym-")&&n.text(i)}gt()},Cancel:function(){gt()}},{},function(){a()("#set_link_id").click(function(){a()("#link_attribute_label").text("ID/Name");var t=a()(".wym_href");t.addClass("wym_id").removeClass("wym_href"),c&&t.val(a()(c).attr("id")),a()(this).remove()})}));if(t==hi.DIALOG_IMAGE)return r._selected_image&&(a()("".concat(r._options.dialogImageSelector," ").concat(r._options.srcSelector)).val(a()(r._selected_image).attr(hi.SRC)),a()("".concat(r._options.dialogImageSelector," ").concat(r._options.titleSelector)).val(a()(r._selected_image).attr(hi.TITLE)),a()("".concat(r._options.dialogImageSelector," ").concat(r._options.altSelector)).val(a()(r._selected_image).attr(hi.ALT))),void _t("Image","<div class='row'><label>URL</label><br><input type='text' class='wym_src' value='' size='40' /></div><div class='row'><label>Alt text</label><br><input type='text' class='wym_alt' value='' size='40' /></div><div class='row'><label>Title</label><br><input type='text' class='wym_title' value='' size='40' /></div>",{Insert:function(){var t=a()(r._options.srcSelector).val();t.length>0&&(r._exec(hi.INSERT_IMAGE,l),a()("img[src$=".concat(l,"]"),r._doc.body).attr(hi.SRC,t).attr(hi.TITLE,a()(r._options.titleSelector).val()).attr(hi.ALT,a()(r._options.altSelector).val())),gt()},Cancel:function(){gt()}});if(t==hi.DIALOG_TABLE&&_t("Table","<div class='row'><label>Caption</label><br><input type='text' class='wym_caption' value='' size='40' /></div><div class='row'><label>Summary</label><br><input type='text' class='wym_summary' value='' size='40' /></div><div class='row'><label>Number Of Rows<br></label><input type='text' class='wym_rows' value='3' size='3' /></div><div class='row'><label>Number Of Cols<br></label><input type='text' class='wym_cols' value='2' size='3' /></div>",{Insert:function(){var t=a()(r._options.rowsSelector).val(),e=a()(r._options.colsSelector).val();if(t>0&&e>0){var i=r._doc.createElement(hi.TABLE),n=null,o=a()(r._options.captionSelector).val();i.createCaption().innerHTML=o;for(var s=0;s<t;s++){n=i.insertRow(s);for(var l=0;l<e;l++)n.insertCell(l)}a()(i).attr("summary",a()(r._options.summarySelector).val());var c=a()(r.findUp(r.container(),hi.MAIN_CONTAINERS)).get(0);c&&c.parentNode?a()(c).after(i):a()(r._doc.body).append(i)}gt()},Cancel:function(){gt()}}),t==pi.DIALOG_HISTORY_LINK||t==pi.DIALOG_DATASET_LINK||t==pi.DIALOG_WORKFLOW_LINK||t==pi.DIALOG_PAGE_LINK||t==pi.DIALOG_VISUALIZATION_LINK){var d;switch(t){case pi.DIALOG_HISTORY_LINK:d=fi(pi.ITEM_HISTORY);break;case pi.DIALOG_DATASET_LINK:d=fi(pi.ITEM_DATASET);break;case pi.DIALOG_WORKFLOW_LINK:d=fi(pi.ITEM_WORKFLOW);break;case pi.DIALOG_PAGE_LINK:d=fi(pi.ITEM_PAGE);break;case pi.DIALOG_VISUALIZATION_LINK:d=fi(pi.ITEM_VISUALIZATION)}var u=new di.a({url_base:d.list_ajax_url,embedded:!0}),h=Object(o.a)();h.modal.show({title:"Insert Link to ".concat(d.singular),body:a()("<div/>").append(u.$el).append(a()("<div/>").append('<input id="make-importable" type="checkbox" checked/>').append("Make the selected ".concat(d.plural.toLowerCase()," accessible so that they can viewed by everyone."))),closing_events:!0,buttons:{Insert:function(){var t=!1;null!=a()("#make-importable:checked").val()&&(t=!0),u.$("input[name=id]:checked").each(function(){var e=a()(this).val();t&&mi(d.controller,e,d.singular);var i=(ui.get_name_and_link_url+e).replace("ITEM_CONTROLLER",d.controller);a.a.getJSON(i,function(t){r._exec(hi.CREATE_LINK,l);var i=a()("a[href=".concat(l,"]"),r._doc.body).text();""==i||i==l?r.insert("<a href='".concat(t.link,"'>").concat(d.singular," '").concat(t.name,"'</a>")):a()("a[href=".concat(l,"]"),r._doc.body).attr(hi.HREF,t.link).attr(hi.TITLE,d.singular+e)})}),h.modal.hide()},Close:function(){h.modal.hide()}}})}if(t==pi.DIALOG_EMBED_HISTORY||t==pi.DIALOG_EMBED_DATASET||t==pi.DIALOG_EMBED_WORKFLOW||t==pi.DIALOG_EMBED_PAGE||t==pi.DIALOG_EMBED_VISUALIZATION){var p;switch(t){case pi.DIALOG_EMBED_HISTORY:p=fi(pi.ITEM_HISTORY);break;case pi.DIALOG_EMBED_DATASET:p=fi(pi.ITEM_DATASET);break;case pi.DIALOG_EMBED_WORKFLOW:p=fi(pi.ITEM_WORKFLOW);break;case pi.DIALOG_EMBED_PAGE:p=fi(pi.ITEM_PAGE);break;case pi.DIALOG_EMBED_VISUALIZATION:p=fi(pi.ITEM_VISUALIZATION)}var f=new di.a({url_base:p.list_ajax_url,embedded:!0}),m=Object(o.a)();m.modal.show({title:"Insert Link to ".concat(p.singular),body:a()("<div/>").append(f.$el).append(a()("<div/>").append('<input id="make-importable" type="checkbox" checked/>').append("Make the selected ".concat(p.plural.toLowerCase()," accessible so that they can viewed by everyone."))),closing_events:!0,buttons:{Embed:function(){var t=!1;null!=a()("#make-importable:checked").val()&&(t=!0),f.$("input[name=id]:checked").each(function(){var e=a()(this),i=e.val(),n=e.closest("td").next("td").find("label").text();t&&mi(p.controller,i,p.singular);var o=["<div id='","".concat(p.iclass,"-").concat(i),"' class='embedded-item ",p.singular.toLowerCase()," placeholder'>","<p class='title'>","Embedded Galaxy ",p.singular," '",n,"'","</p>","<p class='content'>","[Do not edit this block; Galaxy will fill it in with the annotated ",p.singular.toLowerCase()," when it is displayed.]","</p>","</div>"].join("");r.insert(o)}),m.modal.hide()},Close:function(){m.modal.hide()}}})}};var _i=i(39),vi=i(65),bi=i(78),wi=i(100),yi=i(51),xi=i(34),ki=i(49),Ci=(i(120),c.a.View.extend(re.a.LoggableMixin).extend({_logNamespace:"history",tagName:"div",className:"history-column flex-column flex-row-container",id:function(){return this.model?"history-column-".concat(this.model.get("id")):""},initialize:function(t){t=t||{},this.purgeAllowed=!r.a.isUndefined(t.purgeAllowed)&&t.purgeAllowed,this.panel=t.panel||this.createPanel(t),this.setUpListeners()},createPanel:function(t){return new bi.a.HistoryViewEdit(r.a.defaults(t,{model:this.model,purgeAllowed:this.purgeAllowed,dragItems:!0,$scrollContainer:function(){return this.$el}}))},setUpListeners:function(){var t=this;this.once("rendered",function(){t.trigger("rendered:initial",t)}),this.setUpPanelListeners()},setUpPanelListeners:function(){var t=this;this.listenTo(this.panel,{rendered:function(){t.trigger("rendered",t)},"view:expanded view:rendered":function(t){t.$(".rerun-btn").off()}},this)},inView:function(t,e){var i=this.$el.offset().left;return!(i+this.$el.width()<t)&&!(i>e)},$panel:function(){return this.$(".history-panel")},render:function(t){t=void 0!==t?t:"fast";var e=this.model?this.model.toJSON():{};return this.$el.html(this.template(e)),this.renderPanel(t),this.panel.$el.css("display","flex"),this.setUpBehaviors(),this},setUpBehaviors:function(){},template:function(t){return t=r.a.extend(t||{},{isCurrentHistory:this.currentHistory}),a()('\n            <div class="panel-controls mb-1">\n                <div class="flex-row flex-column-container no-gutters justify-content-between">\n                    '.concat(this.controlsLeftTemplate({history:t,view:this}),"\n                    ").concat(this.controlsRightTemplate({history:t,view:this}),'\n                </div>\n            </div>\n            <div class="inner flex-row flex-column-container">\n                <div id="history-').concat(t.id,'" class="history-column history-panel flex-column"></div>\n            </div>'))},renderPanel:function(t){return t=void 0!==t?t:"fast",this.panel.setElement(this.$panel()).render(t),this.currentHistory&&this.panel.$list().before(this.panel._renderDropTargetHelp()),this},events:{"click .switch-to.btn":function(){this.model.setAsCurrent()},"click .delete-history":function(){var t=this;this.model._delete().done(function(e){t.render()})},"click .undelete-history":function(){var t=this;this.model.undelete().done(function(e){t.render()})},"click .purge-history":function(){var t=this;window.confirm(h()("This will permanently remove the data. Are you sure?"))&&this.model.purge().done(function(e){t.render()})},"click .copy-history":"copy"},copy:function(){Object(yi.a)(this.model)},controlsLeftTemplate:r.a.template('\n        <div class="text-left col-8">\n            <% if( data.history.isCurrentHistory ){ %>\n                <strong class="current-label">\n                    '.concat(h()("Current History"),'\n                </strong>\n            <% } else { %>\n                <button class="switch-to btn btn-secondary">\n                    ').concat(h()("Switch to"),"\n                </button>\n            <% } %>\n        </div>"),{variable:"data"}),controlsRightTemplate:r.a.template('<div class="text-right col-4">\n            <% if( !data.history.purged ){ %>\n                <div class="panel-menu btn-group">\n                    <button type="button" class="btn btn-secondary dropdown-toggle" data-toggle="dropdown">\n                        <span class="caret"></span>\n                    </button>\n                    <ul class="dropdown-menu" role="menu">\n                        <% if( !data.history.deleted ){ %>\n                            <li><a href="javascript:void(0);" class="copy-history">\n                                '.concat(h()("Copy"),'\n                            </a></li>\n                            <li><a href="javascript:void(0);" class="delete-history">\n                                ').concat(h()("Delete"),'\n                            </a></li>\n                        <% } else /* if is deleted */ { %>\n                            <li><a href="javascript:void(0);" class="undelete-history">\n                                ').concat(h()("Undelete"),'\n                            </a></li>\n                        <% } %>\n                        <% if( data.view.purgeAllowed ){ %>\n                            <li><a href="javascript:void(0);" class="purge-history">\n                                ').concat(h()("Purge"),"\n                            </a></li>\n                        <% } %>\n                    </ul>\n                </div>\n            <% } %>\n        </div>"),{variable:"data"}),toString:function(){return"HistoryViewColumn(".concat(this.panel?this.panel:"",")")}})),Si={MultiPanelColumns:c.a.View.extend(re.a.LoggableMixin).extend({_logNamespace:"history",className:"multi-panel-history",initialize:function(t){t=t||{},this.log("".concat(this,".init"),t),this.$el.addClass(this.className),this.options={columnWidth:312,borderWidth:1,columnGap:8,headerHeight:29,footerHeight:0,controlsHeight:20},this.perPage=t.perPage||10,this.hdaQueue=new ki.a.NamedAjaxQueue([],!1),this.collection=null,this.columnMap={},this.columnOptions=t.columnOptions||{},this.historySearch=null,this.datasetSearch=null,this.setCollection(t.histories),this.setUpListeners()},setUpListeners:function(){var t=this;this.on("end-of-scroll",function(){t.collection.fetchMore()})},setCollection:function(t){return this.stopListening(this.collection),this.collection=t||new _i.b,this.setUpCollectionListeners(),this.createColumns(),this.hdaQueue.clear(),this.trigger("new-collection",this),this},addModels:function(t,e,i){var n=this;return i=i||{},(t=r.a.isArray(t)?t:[t]).forEach(function(t){n.addColumn(t,!1)}),this},setUpCollectionListeners:function(){this.listenTo(this.collection,{error:this.errorHandler,add:this.addModels,"all-fetched":this._postFetchAll,"new-current":this.addAsCurrentColumn,"set-as-current":this.setCurrentHistory,"change:deleted change:purged":this.handleDeletedHistory,sort:function(){this.renderColumns(0)}})},_postFetchAll:function(t){if(this.$(".histories-loading-indicator").remove(),!this.historySearch){var e=this.$(".outer-middle");e.scrollLeft(e.scrollLeft()+24)}},setCurrentHistory:function(t){this.log("setCurrentHistory:",t);var e=r.a.findWhere(this.columnMap,{currentHistory:!0});e&&(e.currentHistory=!1,e.$el.height(""));var i=this.columnMap[this.collection.currentHistoryId];return i.currentHistory=!0,this.collection.sort(),this._recalcFirstColumnHeight(),i},handleDeletedHistory:function(t){if(t.get("deleted")||t.get("purged")){this.log("handleDeletedHistory",this.collection.includeDeleted,t);var e=this.columnMap[t.id];if(!e)return;e.model.id===this.collection.currentHistoryId||this.collection.includeDeleted||this.removeColumn(e)}},errorHandler:function(t,e,i){if(!e||0!==e.status||0!==e.readyState){if(this.error(t,e,i),r.a.isString(t)&&r.a.isString(e)){var n=t,a=e;return xi.a.errorModal(n,a,i)}return e&&502===e.status?xi.a.badGatewayErrorModal():xi.a.ajaxErrorModal(t,e,i)}},_ajaxErrorHandler:function(){xi.a.ajaxErrorModal.apply(null,r.a.toArray(arguments))},create:function(t){return this.collection.create({current:!0})},createColumns:function(t,e){var i=this;e=e||this.options.columnOptions,this.columnMap={},this.collection.each(function(t,n){i.columnMap[t.id]=i.createColumn(t,e)})},createColumn:function(t,e){var i=Object(o.a)();e=r.a.extend({},e,{model:t,purgeAllowed:i.config.allow_user_dataset_purge});var n=new Ci(e);return t.id===this.collection.currentHistoryId&&(n.currentHistory=!0),this.setUpColumnListeners(n),this.datasetSearch&&(n.panel.searchItems(this.datasetSearch),this.queueHdaFetchDetails(n)),n},addColumn:function(t,e){e=void 0===e||e;var i=this.createColumn(t);return this.columnMap[t.id]=i,e&&this.renderColumns(),i},addAsCurrentColumn:function(t,e,i){var n=this,a=this.addColumn(t,!1);return this.setCurrentHistory(t),a.once("rendered",function(){n.queueHdaFetch(a)}),a},removeColumn:function(t,e){var i=this;if(e=void 0===e||e,this.log("removeColumn",t),t){var n=this.options.columnWidth+this.options.columnGap;t.$el.fadeOut("fast",function(){e&&(a()(i).remove(),i.$(".middle").width(i.$(".middle").width()-n),i.checkColumnsInView(),i._recalcFirstColumnHeight()),i.stopListening(t.panel),i.stopListening(t),delete i.columnMap[t.model.id],t.remove()})}},setUpColumnListeners:function(t){var e=this;this.listenTo(t,{"in-view":this.queueHdaFetch}),this.listenTo(t.panel,{"view:draggable:dragstart":function(t,i,n,a){e._dropData=JSON.parse(t.dataTransfer.getData("text")),e.currentColumnDropTargetOn()},"view:draggable:dragend":function(t,i,n,a){e._dropData=null,e.currentColumnDropTargetOff()},"droptarget:drop":function(t,i,n){var a=e._dropData.filter(function(t){return n.model.contents.isCopyable(t)});e._dropData=null;var o=new ki.a.NamedAjaxQueue;0!==n.model.contents.currentPage&&o.add({name:"fetch-front-page",fn:function(){return n.model.contents.fetchPage(0)}}),a.reverse().forEach(function(t){o.add({name:"copy-".concat(t.id),fn:function(){return n.model.contents.copy(t)}})}),o.start(),o.done(function(t){n.model.fetch()})}})},columnMapLength:function(){return Object.keys(this.columnMap).length},sortedFilteredColumns:function(t){return(t=t||this.filters)&&t.length?this.sortedColumns().filter(function(e,i){return e.currentHistory||r.a.every(t.map(function(t){return t.call(e)}))}):this.sortedColumns()},sortedColumns:function(){var t=this;return this.collection.map(function(e,i){return t.columnMap[e.id]})},render:function(t){return t=void 0!==t?t:this.fxSpeed,this.log("".concat(this,".render")),this.$el.html(this.mainTemplate),this.renderColumns(t),this.setUpBehaviors(),this.trigger("rendered",this),this},renderColumns:function(t){t=r.a.isNumber(t)?t:this.fxSpeed;var e=this.sortedFilteredColumns(),i=this.$(".middle").empty();return this._addColumns(e,t),this.collection.allFetched||i.append(this.loadingIndicatorTemplate),this.trigger("columns-rendered",e,this),(!this.datasetSearch||e.length>1)&&(this.checkColumnsInView(),this._recalcFirstColumnHeight()),e},_addColumns:function(t,e){e=r.a.isNumber(e)?e:this.fxSpeed;var i=this.$(".middle"),n=i.children(".history-column").length;i.width(this._calcMiddleWidth(t.length+n)),t.forEach(function(t,n){t.delegateEvents().render(e).$el.appendTo(i)})},_calcMiddleWidth:function(t){return t*(this.options.columnWidth+this.options.columnGap)+this.options.columnGap+16},queueHdaFetch:function(t){var e=t.model.contents;if(0===e.length&&t.model.contentsShown()){var i={silent:!0},n=r.a.values(e.storage.allExpanded()).join();n&&(i.details=n),this.hdaQueue.add({name:t.model.id,fn:function(){return e.fetchCurrentPage(i).done(function(){t.panel.renderItems()}).done(function(){wi.a.FETCH_STATE_ON_ADD||e.jobStateSummariesCollection.fetch()})}}),this.hdaQueue.running||this.hdaQueue.start()}},queueHdaFetchDetails:function(t){var e=t.model.contents;!(0===e.length&&t.model.contentsShown())&&e.haveDetails()||(this.hdaQueue.add({name:t.model.id,fn:function(){return e.progressivelyFetchDetails().done(function(){t.panel._renderEmptyMessage()})}}),this.hdaQueue.running||this.hdaQueue.start())},renderInfo:function(t){return this.$(".header .header-info").text(t)},events:{"click .done.btn":"close","click .create-new.btn":"create","click #include-deleted":"_clickToggleDeletedHistories","click .order .set-order":"_chooseOrder","click #toggle-deleted":"_clickToggleDeletedDatasets","click #toggle-hidden":"_clickToggleHiddenDatasets"},close:function(t){window.location=Object(d.getAppRoot)()},_clickToggleDeletedHistories:function(t){this.toggleDeletedHistories(a()(t.currentTarget).is(":checked")),this.toggleOptionsPopover()},toggleDeletedHistories:function(t){window.location="".concat(Object(d.getAppRoot)(),t?"history/view_multiple?include_deleted_histories=True":"history/view_multiple")},_clickToggleDeletedDatasets:function(t){this.toggleDeletedDatasets(a()(t.currentTarget).is(":checked")),this.toggleOptionsPopover()},toggleDeletedDatasets:function(t){t=void 0!==t&&t,this.sortedFilteredColumns().forEach(function(e,i){r.a.delay(function(){e.panel.toggleShowDeleted(t,!1)},200*i)})},_clickToggleHiddenDatasets:function(t){this.toggleHiddenDatasets(a()(t.currentTarget).is(":checked")),this.toggleOptionsPopover()},toggleHiddenDatasets:function(t){t=void 0!==t&&t,this.sortedFilteredColumns().forEach(function(e,i){r.a.delay(function(){e.panel.toggleShowHidden(t,!1)},200*i)})},_chooseOrder:function(t){var e=this,i=this.collection,n=a()(t.currentTarget).data("order");this.$(".current-order").text(this.orderDescriptions[n]),this.toggleOptionsPopover(),i.setOrder(n);var o=i.slice(0,1);i.fetchFirst().done(function(){i.unshift(o,{silent:!0}),e.createColumns(),e.hdaQueue.clear(),e.render()}),this.once("columns-rendered",this._scrollLeft)},_scrollLeft:function(t){t=r.a.isNumber(t)?t:0,this.$(".outer-middle").scrollLeft(t)},setUpBehaviors:function(){var t=this;this._moreOptionsPopover();var e=function(e){var i=t;t.historySearch=e,t.filters=[function(){return this.model.matchesAll(i.historySearch)}],t.renderColumns(0)};this.$("#search-histories").searchInput({name:"search-histories",placeholder:h()("search histories"),onfirstsearch:function(i){t.$("#search-histories").searchInput("toggle-loading"),t.renderInfo(h()("loading all histories for search")),t.collection.fetchAll().done(function(){t.$("#search-histories").searchInput("toggle-loading"),t.renderInfo(""),e(i)})},onsearch:e,onclear:function(e){t.historySearch=null,t.filters=[],t.renderColumns(0)}}),this.$("#search-datasets").searchInput({name:"search-datasets",placeholder:h()("search all datasets"),onfirstsearch:function(e){t.hdaQueue.clear(),t.$("#search-datasets").searchInput("toggle-loading"),t.datasetSearch=e,t.sortedFilteredColumns().forEach(function(i){i.panel.searchItems(e),t.queueHdaFetchDetails(i)}),t.hdaQueue.progress(function(e){t.renderInfo([h()("searching"),e.curr+1,h()("of"),e.total].join(" "))}),t.hdaQueue.deferred.done(function(){t.renderInfo(""),t.$("#search-datasets").searchInput("toggle-loading")})},onsearch:function(e){t.datasetSearch=e,t.sortedFilteredColumns().forEach(function(t){t.panel.searchItems(e)})},onclear:function(e){t.datasetSearch=null,t.sortedFilteredColumns().forEach(function(t){t.panel.clearSearch()})}}),a()(window).resize(function(){t._recalcFirstColumnHeight()});var i=r.a.debounce(function(){var e=t._viewport();t.checkColumnsInView(e),t.checkForEndOfScroll(e)},100);this.$(".middle").parent().scroll(i)},_moreOptionsPopover:function(){return this.$(".open-more-options.btn").popover({container:".header",placement:"bottom",html:!0,content:a()(this.optionsPopoverTemplate(this))})},toggleOptionsPopover:function(t){this.$(".open-more-options.btn").popover("toggle")},_recalcFirstColumnHeight:function(){var t=this.$(".history-column").first(),e=this.$(".middle").height(),i=t.find(".panel-controls").height();t.height(e).find(".inner").height(e-i)},_viewport:function(){var t=this.$(".middle").parent(),e=t.offset().left;return{left:e,right:e+t.width()}},columnsInView:function(t){var e=t||this._viewport();return this.sortedFilteredColumns().filter(function(t){return t.currentHistory||t.inView(e.left,e.right)})},checkColumnsInView:function(){this.columnsInView().forEach(function(t){t.trigger("in-view",t)})},checkForEndOfScroll:function(t){t=t||this._viewport();var e=this.$(".middle");e.parent().scrollLeft()+t.right>=e.width()-16&&this.trigger("end-of-scroll")},currentColumnDropTargetOn:function(){var t=this.columnMap[this.collection.currentHistoryId];t&&(t.panel.dataDropped=function(t){},t.panel.dropTargetOn())},currentColumnDropTargetOff:function(){var t=this.columnMap[this.collection.currentHistoryId];t&&(t.panel.dataDropped=bi.a.HistoryViewEdit.prototype.dataDrop,t.panel.dropTarget=!1,t.panel.$(".history-drop-target").remove())},toString:function(){return"MultiPanelColumns(".concat(this.columns?this.columns.length:0,")")},mainTemplate:'\n        <div class="header flex-column-container">\n            <div class="control-column control-column-left flex-column">\n                <div id="search-histories" class="search-control"></div>\n                <div id="search-datasets" class="search-control"></div>\n                <a class="open-more-options btn btn-secondary" tabindex="3">\n                    <span class="fa fa-ellipsis-h"></span>\n                </a>\n            </div>\n            <div class="control-column control-column-center flex-column">\n                <div class="header-info">\n                </div>\n            </div>\n            <div class="control-column control-column-right flex-column">\n                <button class="create-new btn btn-secondary" tabindex="4">\n                    '.concat(h()("Create new"),'\n                </button>\n            </div>\n        </div>\n        <div class="outer-middle flex-row flex-row-container">\n            <div class="middle flex-column-container flex-row"></div>\n        </div>\n        <div class="footer flex-column-container"></div>'),loadingIndicatorTemplate:'\n        <div class="histories-loading-indicator">\n            <span class="fa fa-spin fa-spinner"></span>\n            '.concat(h()("Loading histories")," ...\n        </div>"),orderDescriptions:{update_time:h()("most recent first"),"update_time-asc":h()("least recent first"),name:h()("name, a to z"),"name-dsc":h()("name, z to a"),size:h()("size, large to small"),"size-asc":h()("size, small to large")},optionsPopoverTemplate:r.a.template(['<div class="more-options d-flex flex-column">','<div class="order btn-group mb-2">','<button type="button" class="btn btn-secondary dropdown-toggle" data-toggle="dropdown">',"".concat(h()("Order histories by")," "),'<span class="current-order"><%- view.orderDescriptions[ view.collection.order ] %></span> ','<span class="caret"></span>',"</button>",'<ul class="dropdown-menu" role="menu">',"<% _.each( view.orderDescriptions, function( text, order ){ %>",'<li class="dropdown-item"><a href="javascript:void(0);" class="set-order" data-order="<%- order %>">',"<%- text %>","</a></li>","<% }); %>","</ul>","</div>",'<div class="checkbox"><label><input id="include-deleted" type="checkbox"','<%= view.collection.includeDeleted? " checked" : "" %>>',h()("Include deleted histories"),"</label></div>",'<div class="checkbox"><label><input id="toggle-deleted" type="checkbox">',h()("Include deleted datasets"),"</label></div>",'<div class="checkbox"><label><input id="toggle-hidden" type="checkbox">',h()("Include hidden datasets"),"</label></div>","</div>"].join(""),{variable:"view"})})},Ti=i(59),$i=Ti.a.HistoryView,Oi={AnnotatedHistoryView:$i.extend({className:"".concat($i.prototype.className," annotated-history-panel"),_buildNewRender:function(){var t=$i.prototype._buildNewRender.call(this);return this.renderHistoryAnnotation(t),t},renderHistoryAnnotation:function(t){var e=this.model.get("annotation");e&&t.find("> .controls .subtitle").text(e)},renderItems:function(t){t=t||this.$el,$i.prototype.renderItems.call(this,t);var e=t.find("> .controls");return e.find(".contents-container.headers").remove(),a()('<div class="contents-container headers"/>').append([a()('<div class="history-content header"/>').text(h()("Dataset")),a()('<div class="additional-info header"/>').text(h()("Annotation"))]).appendTo(e),self.views},_renderItemView$el:function(t){return a()('<div class="contents-container"/>').append([t.render(0).$el,a()('<div class="additional-info"/>').text(t.model.get("annotation")||"")])},events:r.a.extend(r.a.clone($i.prototype.events),{"click .contents-container":function(t){t.stopPropagation(),a()(t.currentTarget).find(".list-item .title-bar").click()},"click .icon-btn":function(t){t.stopPropagation();var e=a()(t.currentTarget);e.length&&"dropdown"===e.attr("data-toggle")&&e.dropdown("toggle")}}),_clickSectionLink:function(t){var e=a()(t.currentTarget).parent().parent().data("section");this.openSection(e)},toString:function(){return"AnnotatedHistoryView(".concat(this.model?this.model.get("name"):"",")")}})},Ai=i(87),ji=i(47),Di=i(140),Ii=i(53),Mi=i(89),Ri=i(69);a.a.ajaxSettings.traditional=!0;var Ei=a.a,Pi=c.a.View.extend({grid:null,initialize:function(t){this.grid=new Di.a,this.dict_format=t.dict_format,this.title=t.title,this.title_id=t.title_id;var e=this;if(window.add_tag_to_grid_filter=function(t,i){var n=t+(void 0!==i&&""!==i?":".concat(i):"");Ei("#advanced-search").is(":visible")||(Ei("#standard-search").slideToggle("fast"),Ei("#advanced-search").slideToggle("fast")),e.add_filter_condition("tags",n)},this.dict_format)if(this.setElement("<div/>"),t.url_base&&!t.items){var i=t.url_data||{};r.a.each(t.filters,function(t,e){i["f-".concat(e)]=t}),Ei.ajax({url:"".concat(t.url_base,"?").concat(Ei.param(i)),success:function(i){i.embedded=t.embedded,i.filters=t.filters||{},e.init_grid(i)}})}else this.init_grid(t);else this.setElement("#grid-container"),this.init_grid(t);t.use_panels&&Ei("#center").css({padding:"10px",overflow:"auto"})},handle_refresh:function(t){t&&Ei.inArray("history",t)>-1&&window.top.Galaxy&&window.top.Galaxy.currHistoryPanel&&window.top.Galaxy.currHistoryPanel.loadCurrentHistory()},init_grid:function(t){this.grid.set(t);var e=this.grid.attributes;this.allow_title_display&&e.title&&p.a.setWindowTitle(e.title),this.handle_refresh(e.refresh_frames);var i=this.grid.get("url_base");if(i=i.replace(/^.*\/\/[^\/]+/,""),this.grid.set("url_base",i),this.$el.html(Ii.a.grid(e)),this.$el.find("#grid-table-header").html(Ii.a.header(e)),this.$el.find("#grid-table-body").html(Ii.a.body(e)),this.$el.find("#grid-table-footer").html(Ii.a.footer(e)),e.message){this.$el.find("#grid-message").html(Ii.a.message(e));var n=this;e.use_hide_message&&setTimeout(function(){n.$el.find("#grid-message").html("")},5e3)}this.init_grid_elements(),this.init_grid_controls(),Object(Ri.a)()},init_grid_controls:function(){var t=this;this.$el.find(".operation-button").each(function(){Ei(this).off(),Ei(this).click(function(){return t.submit_operation(this),!1})}),this.$el.find("input[type=text]").each(function(){Ei(this).off(),Ei(this).click(function(){Ei(this).select()}).keyup(function(){Ei(this).css("font-style","normal")})}),this.$el.find(".sort-link").each(function(){Ei(this).off(),Ei(this).click(function(){return t.set_sort_condition(Ei(this).attr("sort_key")),!1})}),this.$el.find(".text-filter-form").each(function(){Ei(this).off(),Ei(this).submit(function(){var e=Ei(this).attr("column_key"),i=Ei("#input-".concat(e,"-filter")),n=i.val();return i.val(""),t.add_filter_condition(e,n),!1})}),this.$el.find(".text-filter-val > a").each(function(){Ei(this).off(),Ei(this).click(function(){return Ei(this).parent().remove(),t.remove_filter_condition(Ei(this).attr("filter_key"),Ei(this).attr("filter_val")),!1})}),this.$el.find(".categorical-filter > a").each(function(){Ei(this).off(),Ei(this).click(function(){return t.set_categorical_filter(Ei(this).attr("filter_key"),Ei(this).attr("filter_val")),!1})}),this.$el.find(".advanced-search-toggle").each(function(){Ei(this).off(),Ei(this).click(function(){return t.$el.find("#standard-search").slideToggle("fast"),t.$el.find("#advanced-search").slideToggle("fast"),!1})}),this.$el.find("#check_all").off(),this.$el.find("#check_all").on("click",function(){t.check_all_items()})},init_grid_elements:function(){this.$el.find(".grid").each(function(){var t=Ei(this).find("input.grid-row-select-checkbox"),e=Ei(this).find("span.grid-selected-count"),i=function(){e.text(Ei(t).filter(":checked").length)};Ei(t).each(function(){Ei(this).change(i)}),i()}),0!==this.$el.find(".community_rating_star").length&&this.$el.find(".community_rating_star").rating({});var t=this.grid.attributes,e=this;this.$el.find(".page-link > a").each(function(){Ei(this).click(function(){return e.set_page(Ei(this).attr("page_num")),!1})}),this.$el.find(".use-target").each(function(){Ei(this).click(function(){return e.execute({href:Ei(this).attr("href"),target:Ei(this).attr("target")}),!1})}),0!==t.items.length&&r.a.each(t.items,function(i,n){var a=e.$("#grid-".concat(i.encode_id,"-popup")).off(),o=new Mi.a(a);r.a.each(t.operations,function(t){e._add_operation(o,t,i)})})},_add_operation:function(t,e,i){var n=this,a=i.operation_config[e.label];a.allowed&&e.allow_popup&&t.addItem({html:e.label,href:a.url_args,target:a.target,confirmation_text:e.confirm,func:function(t){t.preventDefault();var a=Ei(t.target).html();e.onclick?e.onclick(i.encode_id):n.execute(this.findItemByHtml(a))}})},add_filter_condition:function(t,e){if(""===e)return!1;this.grid.add_filter(t,e,!0);var i=Ei(Ii.a.filter_element(t,e)),n=this;i.click(function(){Ei(this).remove(),n.remove_filter_condition(t,e)}),this.$el.find("#".concat(t,"-filtering-criteria")).append(i),this.go_page_one(),this.execute()},remove_filter_condition:function(t,e){this.grid.remove_filter(t,e),this.go_page_one(),this.execute()},set_sort_condition:function(t){var e=this.grid.get("sort_key"),i=t;-1!==e.indexOf(t)&&"-"!==e.substring(0,1)&&(i="-".concat(t)),this.$el.find(".sort-arrow").remove();var n="-"==i.substring(0,1)?"&uarr;":"&darr;",a=Ei("<span>".concat(n,"</span>")).addClass("sort-arrow");this.$el.find("#".concat(t,"-header")).append(a),this.grid.set("sort_key",i),this.go_page_one(),this.execute()},set_categorical_filter:function(t,e){var i=this.grid.get("categorical_filters")[t],n=this.grid.get("filters")[t],a=this;this.$el.find(".".concat(t,"-filter")).each(function(){var o=Ei.trim(Ei(this).text()),s=i[o][t];if(s==e)Ei(this).empty(),Ei(this).addClass("current-filter"),Ei(this).append(o);else if(s==n){Ei(this).empty();var r=Ei('<a href="#">'.concat(o,"</a>"));r.click(function(){a.set_categorical_filter(t,s)}),Ei(this).removeClass("current-filter"),Ei(this).append(r)}}),this.grid.add_filter(t,e),this.go_page_one(),this.execute()},set_page:function(t){var e=this;this.$el.find(".page-link").each(function(){var i,n=Ei(this).attr("id"),a=parseInt(n.split("-")[2],10),o=e.grid.get("cur_page");if(a===t)i=Ei(this).children().text(),Ei(this).empty(),Ei(this).addClass("inactive-link"),Ei(this).text(i);else if(a===o){i=Ei(this).text(),Ei(this).empty(),Ei(this).removeClass("inactive-link");var s=Ei('<a href="#">'.concat(i,"</a>"));s.click(function(){e.set_page(a)}),Ei(this).append(s)}}),"all"===t?this.grid.set("cur_page",t):this.grid.set("cur_page",parseInt(t,10)),this.execute()},submit_operation:function(t,e){var i=Ei(t).val();if(this.$el.find('input[name="id"]:checked').length<1)return!1;var n=r.a.findWhere(this.grid.attributes.operations,{label:i});n&&!e&&(e=n.confirm||"");var a=[];this.$el.find("input[name=id]:checked").each(function(){a.push(Ei(this).val())});var o={operation:i,id:a,confirmation_text:e};return"top"!=n.target&&"center"!=n.target||(o=r.a.extend(o,{href:n.href,target:n.target})),this.execute(o),!0},check_all_items:function(){var t=this.$(".grid-row-select-checkbox"),e=this.$("#check_all").prop("checked");r.a.each(t,function(t){Ei(t).prop("checked",e)}),this.init_grid_elements()},go_page_one:function(){var t=this.grid.get("cur_page");null!=t&&"all"!==t&&this.grid.set("cur_page",1)},execute:function(t){var e=null,i=null,n=null,a=null,o=null;if(t&&(i=t.href,n=t.operation,e=t.id,a=t.confirmation_text,o=t.target,void 0!==i&&-1!=i.indexOf("operation="))){var s=i.split("?");if(s.length>1)for(var r=s[1].split("&"),l=0;l<r.length;l++)-1!=r[l].indexOf("operation")?n=(n=r[l].split("=")[1]).replace(/\+/g," "):-1!=r[l].indexOf("id")&&(e=r[l].split("=")[1])}return n&&e?!(a&&""!==a&&"None"!=a&&"null"!=a&&!confirm(a))&&(n=n.toLowerCase(),this.grid.set({operation:n,item_ids:e}),"top"==o?window.top.location="".concat(i,"?").concat(Ei.param(this.grid.get_url_data())):"center"==o?Ei("#galaxy_main").attr("src","".concat(i,"?").concat(Ei.param(this.grid.get_url_data()))):this.grid.can_async_op(n)||this.dict_format?this.update_grid():this.go_to(o,i),!1):i?(this.go_to(o,i),!1):(this.grid.get("async")||this.dict_format?this.update_grid():this.go_to(o,i),!1)},go_to:function(t,e){var i=this.grid.get("async");this.grid.set("async",!1);var n=this.$el.find("#advanced-search").is(":visible");switch(this.grid.set("advanced_search",n),e||(e="".concat(this.grid.get("url_base"),"?").concat(Ei.param(this.grid.get_url_data()))),this.grid.set({operation:void 0,item_ids:void 0,async:i}),t){case"center":Ei("#galaxy_main").attr("src",e);break;case"top":window.top.location=e;break;default:window.location=e}},update_grid:function(){var t=this.grid.get("operation")?"POST":"GET";this.$el.find(".loading-elt-overlay").show();var e=this;Ei.ajax({type:t,url:e.grid.get("url_base"),data:e.grid.get_url_data(),error:function(){alert("Grid refresh failed")},success:function(t){var i=e.grid.get("embedded"),n=e.grid.get("insert"),a=e.$el.find("#advanced-search").is(":visible"),o=e.dict_format?t:Ei.parseJSON(t);o.embedded=i,o.insert=n,o.advanced_search=a,e.init_grid(o),e.$el.find(".loading-elt-overlay").hide()},complete:function(){e.grid.set({operation:void 0,item_ids:void 0})}})}});function Vi(t,e){return new Date(t.getFullYear(),t.getMonth(),t.getDate()-e,t.getHours(),t.getMinutes(),t.getSeconds(),t.getMilliseconds())}function Li(t,e){return new Date(t.getFullYear(),t.getMonth(),t.getDate(),t.getHours()-e,t.getMinutes(),t.getSeconds(),t.getMilliseconds())}function zi(t,e,i,n){var o,s,r=t,l=[],c=(o=new Date,new Date(o.getUTCFullYear(),o.getUTCMonth(),o.getUTCDate(),o.getUTCHours(),0,0));for(s=0;s<24;s++)l.push(Li(c,s));var d=[];for(s=0;s<30;s++)d.push(Vi(c,s));var u=60,h=50,p=60,f=0;"hours"==i?f=12.5:"days"==i&&(f=10);var m,g=300+p+30,_=1.75;m=0!==St.max(r)?150/St.max(r):1;var v=150+u+h;a()(".charts").css("height",v*_);var b=St.select("#".concat(e)).attr("width",g).attr("height",v).attr("preserveAspectRatio","xMidYMin").attr("viewBox","0 0 ".concat(g," ").concat(v)).on("click",function(){var t=St.select(this).attr("class");t=t.split(" "),St.selectAll(".".concat(t[0])).filter(".".concat(t[1])).style("cursor","zoom-in").transition().duration(750).attr("height",v).attr("width",g),St.select(this).style("cursor","default").transition().duration(750).attr("height",v*_).attr("width",g*_)}),w=b.selectAll("g").data(r).enter().append("g").attr("transform",function(t,e){var i=p;return"translate(".concat(i+=+e*f,",").concat(u,")")}).on("mouseenter",function(t){for(var e=1,i=t;i>=10;)i/=10,e++;var n=4*e+10;St.select(St.event.target.parentElement).select(".tool_tip").select("text").attr("transform","translate( ".concat(p-5,", ").concat(150-t*m+u+10," )")).attr("visibility","visible").text(t),St.select(St.event.target.parentElement).select(".tool_tip").attr("width","".concat(n,"px")).attr("height","15px").select("rect").attr("transform","translate( ".concat(p-n,", ").concat(150-t*m+u," )")).attr("width","".concat(n,"px")).attr("height","15px").attr("fill","#ebd9b2")}).on("mouseleave",function(t){St.select(St.event.target.parentElement).select(".tool_tip").select("text").attr("visibility","hidden"),St.select(St.event.target.parentElement).select(".tool_tip").select("rect").attr("width","0").attr("height","0").attr("fill","").text(t)});b.append("g").append("text").attr("class","title").attr("text-anchor","end").attr("transform",function(){return"translate( ".concat(300,",15 )")}).text(n),b.append("g").attr("class","axis").append("path").attr("class","x").attr("d",function(){var t=u+150,e=p+300,i=t;return"M".concat(p," ").concat(t," L ").concat(e," ").concat(i)});var y=St.scale.linear().range([150,0]),x=St.svg.axis().scale(y).orient("left").tickFormat(function(t){return St.round(t*St.max(r),0)});b.append("g").attr("class","y axis").attr("id","y_".concat(e)).attr("text-anchor","end").attr("transform","translate( ".concat(p,",").concat(u,")")).call(x).select(".domain"),b.append("g").append("text").attr("class","ax_title").attr("transform",function(){var t=St.select("#y_".concat(e)).node(),i=p-t.getBoundingClientRect().width-5,n=u+t.getBoundingClientRect().height/2-30;return"translate(".concat(i,",").concat(n,")rotate(-90)")}).text("Number of Jobs"),w.append("rect").attr("y",function(t){return 150-t*m}).attr("height",function(t){return t*m}).attr("width",f-1);var k=!1;if("hours"==i){w.append("line").attr("x1",0).attr("y1",0).attr("x2",0).attr("y2",3).attr("stroke","black").attr("stroke-width",1).attr("pointer-events","none").attr("transform",function(){return"translate( ".concat(f/2,", ").concat(150,")")}),w.append("text").attr("fill","rgb(0,0,0)").attr("transform","translate( 10, ".concat(160," )")).text(function(t,e){return l[e].getHours()<10?"0".concat(String(l[e].getHours())):l[e].getHours()});var C="";k=!1,w.append("line").attr("x1",0).attr("y1",0).attr("x2",0).attr("y2",function(t,e){var i=0;return l[e].getDate()!=C&&(k?i=20:(i=27,k=!0),C=l[e].getDate()),i}).attr("stroke","black").attr("stroke-width",1).attr("pointer-events","none").attr("transform",function(){return"translate( 0, ".concat(150,")")}),C="";var S="";k=!1,w.append("text").attr("fill","rgb(0,0,0)").attr("pointer-events","none").text(function(t,e){var i="";return l[e].getDate()!=S&&(i=String(l[e].toLocaleString("en-us",{month:"long"})),i+=" ".concat(String(l[e].getDate())),S=l[e].getDate()),i}).attr("transform",function(t,e){var i=150,n=St.select(this).node().getBBox().width;return l[e].getDate()!=C&&(k?i+=18:(i+=26,k=!0),C=l[e].getDate()),"translate( ".concat(n+2,", ").concat(i," )")})}else if("days"==i){w.append("line").attr("x1",0).attr("y1",0).attr("x2",0).attr("y2",3).attr("stroke","black").attr("stroke-width",1).attr("pointer-events","none").attr("transform",function(){return"translate( ".concat(f/2,", ").concat(150,")")}),w.append("text").attr("fill","rgb(0,0,0)").attr("transform","translate( 9, ".concat(160," )")).text(function(t,e){return d[e].getDate()<10?"0".concat(String(d[e].getDate())):d[e].getDate()});var T="";k=!1,w.append("line").attr("x1",0).attr("y1",0).attr("x2",0).attr("y2",function(t,e){var i=0;return d[e].getMonth()!=T&&(k?i=20:(i=27,k=!0),T=d[e].getMonth()),i}).attr("stroke","black").attr("stroke-width",1).attr("pointer-events","none").attr("transform",function(){return"translate( 0, ".concat(150,")")}),T="";var $="";k=!1,w.append("text").attr("fill","rgb(0,100,0)").attr("pointer-events","none").text(function(t,e){var i="";return d[e].getMonth()!=$&&(i=String(d[e].toLocaleString("en-us",{month:"long"})),i+=" ".concat(String(d[e].getFullYear())),$=d[e].getMonth()),i}).attr("transform",function(t,e){var i=150,n=St.select(this).node().getBBox().width;return d[e].getMonth()!=T&&(k?i+=18:(i+=26,k=!0),T=d[e].getMonth()),"translate( ".concat(n+2,", ").concat(i," )")})}b.append("g").attr("class","tool_tip").append("rect"),b.select(".tool_tip").append("text"),"jc_dy_chart"!=e&&"jc_hr_chart"!=e||St.select("#".concat(e)).attr("height",v*_).attr("width",g*_).style("cursor","default")}function Ni(t,e,i){var n=t,a=1.75,o=60,s=60,r=150+o+50,l=300+s+30,c=St.scale.linear().domain([0,St.max(n)]).range([0,300]);n=St.layout.histogram().bins(c.ticks(20))(n);for(var d,u=[],h=0;h<n.length;h++)u.push(n[h].length);d=0!==St.max(n)?150/St.max(u):1;var p=St.scale.linear().domain([0,St.max(n,function(t){return t.y})]).range([150,0]);var f=St.select("#".concat(e)).attr("viewBox","0 0 ".concat(l," ").concat(r)).attr("width",l).attr("height",r).attr("preserveAspectRatio","xMidYMin").on("click",function(){var t=St.select(this).attr("class");t=t.split(" "),St.selectAll(".".concat(t[0])).filter(".".concat(t[1])).style("cursor","zoom-in").transition().duration(750).attr("height",r).attr("width",l),St.select(this).style("cursor","default").transition().duration(750).attr("height",r*a).attr("width",l*a)});f.append("g").append("text").attr("class","title").attr("transform",function(){return"translate( ".concat(300,",15 )")}).text(i);var m,g=f.selectAll(".bar").data(n).enter().append("g").attr("class","bar").attr("transform",function(t){return"translate(".concat(+c(t.x)+s,",").concat(+p(t.y)+o,")")}).on("mouseenter",function(t){for(var e=0,i=t.length;i>=1;)i/=10,e++;var n=4*e+10;St.select(St.event.target.parentElement).select(".tool_tip").select("text").attr("transform","translate( ".concat(s-5,", ").concat(150-t.length*d+o+10," )")).attr("visibility","visible").text(t.length),St.select(St.event.target.parentElement).select(".tool_tip").attr("width","".concat(n,"px")).attr("height","15px").select("rect").attr("transform","translate( ".concat(s-n,", ").concat(150-t.length*d+o," )")).attr("width","".concat(n,"px")).attr("height","15px").attr("fill","#ebd9b2")}).on("mouseleave",function(){St.select(St.event.target.parentElement).select(".tool_tip").select("text").attr("visibility","hidden"),St.select(St.event.target.parentElement).select(".tool_tip").select("rect").attr("width","0").attr("height","0").attr("fill","")});m=void 0===n[0]?1:c(n[0].dx),g.append("rect").attr("x",1).attr("width",m-1).attr("height",function(t){return 150-p(t.y)});var _=St.svg.axis().scale(c).orient("bottom").tickFormat(function(t){var e=Math.floor(t/60),i=Math.floor(t-60*e);return e<10&&(e="0".concat(e)),i<10&&(i="0".concat(i)),"".concat(e,":").concat(i)});f.append("g").attr("class","x axis").attr("id","x_".concat(e)).attr("transform","translate( ".concat(s,",").concat(150+o,")")).call(_),f.append("g").append("text").attr("class","ax_title").attr("transform",function(){var t=St.select("#x_".concat(e)).node(),i=s+t.getBoundingClientRect().width/2+30,n=o+150+t.getBoundingClientRect().height+10;return"translate(".concat(i,",").concat(n,")")}).text("ETA - hrs:mins");var v=St.svg.axis().scale(p).orient("left");f.append("g").attr("class","y axis").attr("id","y_".concat(e)).attr("transform","translate( ".concat(s,",").concat(o,")")).call(v),f.append("g").append("text").attr("class","ax_title").attr("transform",function(){var t=St.select("#y_".concat(e)).node(),i=s-t.getBoundingClientRect().width-5,n=o+t.getBoundingClientRect().height/2-30;return"translate(".concat(i,",").concat(n,")rotate(-90)")}).text("Number of Jobs"),f.append("g").attr("class","tool_tip").append("rect"),f.select(".tool_tip").append("text")}var Fi=c.a.Model.extend({urlRoot:"".concat(Object(d.getAppRoot)(),"api/groups")}),Hi={Group:Fi,Groups:c.a.Collection.extend({url:"".concat(Object(d.getAppRoot)(),"api/groups"),model:Fi})},Ui={GroupListRowView:c.a.View.extend({events:{},initialize:function(t){this.render(t.group)},render:function(t){var e=this.templateRow();return this.setElement(e({group:t})),this.$el.show(),this},templateRow:function(){return r.a.template(['<tr class="" data-id="<%- group.get("id") %>">','<td><a href="groups#/<%= group.get("id") %>"><%= _.escape(group.get("name")) %></a></td>','<td><%= group.get("total_members") %></td>','<td><%= group.get("total_repos") %></td>',"</tr>"].join(""))}})},Bi={GroupListView:c.a.View.extend({el:"#groups_element",defaults:{},initialize:function(t){this.options=r.a.defaults(this.options||{},this.defaults,t);var e=this;window.globalTS.groups.collection=new Hi.Groups,window.globalTS.groups.collection.fetch({success:function(t){e.render()},error:function(t,e){void 0!==e.responseJSON?f.a.error(e.responseJSON.err_msg):f.a.error("An error occurred.")}})},fetch:function(){},render:function(t){this.options=r.a.extend(this.options,t),a()(".tooltip").hide();var e=this.templateGroupsList();this.$el.html(e({length:window.globalTS.groups.collection.models.length})),this.renderRows(window.globalTS.groups.collection.models),a()('#center [data-toggle="tooltip"]').tooltip({trigger:"hover"}),a()("#center").css("overflow","auto")},renderRows:function(t){for(var e=0;e<t.length;e++){var i=t[e];this.renderOne({group:i})}},renderOne:function(t){var e=new Ui.GroupListRowView(t);this.$el.find("#group_list_body").append(e.el)},templateGroupsList:function(){var t=[];return t.push('<div id="groups">'),t.push("</div>"),t.push('<div class="groups_container table-responsive">'),t.push("<% if(length === 0) { %>"),t.push("<div>There are no groups yet.</div>"),t.push("<% } else{ %>"),t.push('<table class="grid table table-sm">'),t.push("   <thead>"),t.push("     <th>Name</th>"),t.push("     <th>Members</th> "),t.push("     <th>Repositories</th>"),t.push("   </thead>"),t.push('   <tbody id="group_list_body">'),t.push("   </tbody>"),t.push("</table>"),t.push("<% }%>"),t.push("</div>"),r.a.template(t.join(""))}})},qi={GroupDetailView:c.a.View.extend({el:"#groups_element",options:{},app:null,initialize:function(t){this.options=r.a.extend(this.options,t),this.app=window.globalTS.groups,null!==this.app.collection?(this.model=this.app.collection.get(this.options.group_id),this.render()):this.fetchGroup()},fetchGroup:function(t){var e=this;this.options=r.a.extend(this.options,t),this.model=new Hi.Group({id:this.options.group_id}),this.model.fetch({success:function(t){console.log("received data: "),console.log(t),e.render()},error:function(t,e){void 0!==e.responseJSON?f.a.error(e.responseJSON.err_msg):f.a.error("An error occurred.")}})},render:function(){var t=this.templateRow();this.$el.html(t({group:this.model})),a()('#center [data-toggle="tooltip"]').tooltip({trigger:"hover"}),a()("#center").css("overflow","auto")},templateRow:function(){return r.a.template(["<div>",'<h3><%= _.escape(group.get("name")) %></h3>','<p class="" style="color:gray;">','A group of <%= group.get("members").length %> members with <%= group.get("repositories").length %> repositories and a total of <%= group.get("total_downloads") %> combined repository clones.</p>',"<h3>Members</h3>",'<table class="grid table table-sm">',"<thead>","<th>Name</th>","<th>Repositories</th>","<th>Registered</th>","</thead>","<tbody>",'<% _.each(group.get("members"), function(member) { %>',"<tr>","<td>","<%= _.escape(member.username) %>","</td>","<td>",'<a data-toggle="tooltip" data-placement="top" title="Repositories of <%= _.escape(member.username) %>" href="/repository/browse_repositories_by_user?user_id=<%= member.id %>&use_panels=true" id="<%= member.id %>"><%= member.user_repos_count %></a>',"</td>","<td>","<%= member.time_created %>","</td>","</tr>","<% }); %>","</tbody>","</table>","<h3>Repositories</h3>",'<table class="grid table table-sm">',"<thead>","<th>Name</th>","<th>Description</th>","<th>Clones</th>","<th>Owner</th>","<th>Categories</th>","<th>Created</th>","<th>Updated</th>","<th>Rating</th>","<th>Verified</th>","</thead>","<tbody>",'<% _.each(group.get("repositories"), function(repo) { %>',"<tr>","<td>",'<a data-toggle="tooltip" data-placement="top" title="Details of <%= _.escape(repo.name) %>" href="/view/<%= _.escape(repo.owner) %>/<%= _.escape(repo.name) %>" id="<%= repo.id %>"><%= _.escape(repo.name) %></a>',"</td>","<td>","<%= _.escape(repo.description) %>","</td>","<td>","<%= repo.times_downloaded %>","</td>","<td>","<%= _.escape(repo.owner) %>","</td>","<td>","<% _.each((repo.categories), function(cat) { %>",'<a data-toggle="tooltip" data-placement="top" title="Repositories in <%= cat.name %>" href="/repository/browse_repositories_in_category?id=<%= cat.id %>&use_panels=true"><%= cat.name %></a><br/>',"<% }); %>","</td>",'<td data-toggle="tooltip" data-placement="top" title="<%= repo.time_created_full %>">',"<%= repo.time_created %>","</td>",'<td data-toggle="tooltip" data-placement="top" title="<%= repo.time_updated_full %>">',"<%= repo.time_updated %>","</td>","<td>","<%= repo.ratings_mean %>","</td>","<td>","<%= repo.approved %>","</td>","</tr>","<% }); %>","</tbody>","</table>","</div>"].join(""))}})},Gi=c.a.Router.extend({routes:{"":"groups",":group_id":"group_page"}}),Wi={ToolshedGroups:c.a.View.extend({groupListView:null,groupDetailView:null,collection:null,initialize:function(){window.globalTS.groups=this,this.ts_router=new Gi,this.ts_router.on("route:groups",function(){window.globalTS.groups.groupListView=new Bi.GroupListView}),this.ts_router.on("route:group_page",function(t){window.globalTS.groups.groupDetailView=new qi.GroupDetailView({group_id:t})}),c.a.history.start({pushState:!1})}})};function Ji(){a()("#spinner").remove(),a()("#main").children().remove()}function Yi(){a()("#main").append('<div id="ie-loading-spinner"></div>')}function Ki(t,e,i,n,a,o,s,r){return{type:void 0!==t?t:"GIE spin",ajax_timeout:void 0!==e?e:2e3,ajax_timeout_max:void 0!==i?i:16e3,ajax_timeout_step:void 0!==n?n:500,sleep:void 0!==a?a:500,sleep_max:void 0!==o?o:8e3,sleep_step:void 0!==s?s:100,log_attempts:void 0===r||r,count:0}}function Qi(t,e,i){console.log(t),i&&Ji(),"string"==typeof e&&(f.a.clear(),f.a.error(e,"Error",{closeButton:!0,timeOut:0,extendedTimeOut:0,tapToDismiss:!1}))}function Xi(t){t.sleep<t.sleep_max&&(t.sleep+=t.sleep_step),t.log_attempts&&console.log("".concat(t.type," request ").concat(t.count," request timeout ").concat(t.ajax_timeout,"ms sleeping ").concat(t.sleep/1e3,"s")),window.setTimeout(t.spinner,t.sleep)}function Zi(t,e,i,n,o,s){var r=function(){var r={url:t,xhrFields:{withCredentials:!0},type:"GET",timeout:s.ajax_timeout,success:function(t,e,n){i(t,e,n)||(s.count++,Xi(s))},error:function(t,e,i){"timeout"==e?(s.ajax_timeout<s.ajax_timeout_max&&(s.ajax_timeout+=s.ajax_timeout_step),s.count++,n(t,e,i)||Xi(s)):(s.count++,o(t,e,i)||Xi(s))}};e&&(r.dataType="json"),a.a.ajax(r)};console.log("Setting up new spinner for ".concat(s.type," on ").concat(t)),s.spinner=r,window.setTimeout(r,s.sleep)}function tn(t,e,i,n,a){var o=function(t,e){1==e.count&&(Yi(),f.a.info(t,null,{closeButton:!0,timeOut:0,extendedTimeOut:0,tapToDismiss:!1}))},s=function(t,e,n){return o(i.waiting,a),40==a.count&&f.a.warning(i.wait_warn,"Warning",{closeButton:!0,timeOut:0,extendedTimeOut:0,tapToDismiss:!1}),!1};Zi(t,e,function(t){if(!e||e&&1==t)console.log(i.success),Ji(),f.a.clear(),n();else{if(e&&0==t)return o(i.not_ready,a),!1;Qi("Invalid response to ".concat(a.type," request"),i.invalid_response,!0)}return!0},s,s,a)}var en={append_notebook:function(t){Ji(),a()("#main").append('<iframe frameBorder="0" seamless="seamless" style="width: 100%; height: 100%; overflow:hidden;" scrolling="no" src="'.concat(t,'"></iframe>'))},clear_main_area:Ji,display_spinner:Yi,make_spin_state:Ki,spin_error:Qi,spin:Zi,test_ie_availability:function(t,e){tn(t,!1,{success:"IE connection succeeded, returning",waiting:"Interactive environment container is running, attempting to connect to the IE. Please wait...",wait_warn:"It is taking an usually long time to connect to the interactive environment. Attempts will continue but you may want to report this condition to a Galaxy administrator if it does not succeed soon.",error:"An error was encountered while attempting to connect to the interactive environment, contact your administrator."},e,Ki("IE availability"))},load_when_ready:function(t,e){tn(t,!0,{success:"Galaxy reports IE container ready, returning",not_ready:"Galaxy is launching a container in which to run this interactive environment. Please wait...",unknown_response:"Galaxy failed to launch a container in which to run this interactive environment, contact a Galaxy administrator.",waiting:"Galaxy is launching a container in which to run this interactive environment. Please wait...",wait_warn:"It is taking an usually long time to start a container. Attempts will continue but you may want to report this condition to a Galaxy administrator if it does not succeed soon.",error:"Galaxy encountered an error while attempting to determine the readiness of this interactive environment's container, contact a Galaxy administrator."},e,Ki("IE container readiness"))},keepAlive:function(t){var e=0,i=window.setInterval(function(){a.a.ajax({url:t,xhrFields:{withCredentials:!0},type:"GET",timeout:500,success:function(){console.log("Connected to IE, returning")},error:function(t,n,a){e++,console.log("Request "+e),e>30&&(window.clearInterval(i),Ji(),f.a.error("Could not connect to IE, contact your administrator","Error",{closeButton:!0,timeOut:2e4,tapToDismiss:!1}))}})},1e4)}},nn=i(93),an=i(88),on=c.a.Model.extend({defaults:{config:{}},urlRoot:function(){return Object(d.getAppRoot)()+"api/visualizations"},initialize:function(t){r.a.isObject(t.config)&&r.a.isObject(this.defaults.config)&&r.a.defaults(t.config,this.defaults.config),this._setUpListeners()},_setUpListeners:function(){},set:function(t,e){if("config"===t){var i=this.get("config");r.a.isObject(i)&&(e=r.a.extend(r.a.clone(i),e))}return c.a.Model.prototype.set.call(this,t,e),this},toString:function(){var t=this.get("id")||"";return this.get("title")&&(t+=":".concat(this.get("title"))),"Visualization(".concat(t,")")}}),sn=(c.a.Collection.extend({model:on,url:function(){return"".concat(Object(d.getAppRoot)(),"api/visualizations")},initialize:function(t,e){e=e||{}},set:function(t,e){var i=this;t=r.a.map(t,function(t){var e=i.get(t.id);if(!e)return t;var n=e.toJSON();return r.a.extend(n,t),n}),c.a.Collection.prototype.set.call(this,t,e)},toString:function(){return["VisualizationCollection(",[this.historyId,this.length].join(),")"].join("")}}),c.a.Model.extend({defaults:{title:"",type:"",date:null,state:"",state_info:"",modified:!0,dataset_id:"",dataset_id_job:null},initialize:function(t,e){this.groups=new c.a.Collection,this.settings=new c.a.Model,this.visualization_id=e.visualization_id,this.visualization_name=e.visualization_name,this.dataset_id=e.dataset_id,this.chart_dict=e.chart_dict,console.debug("model::initialize() - Initialized with configuration:"),console.debug(e)},reset:function(){this.clear().set({title:"New Chart",dataset_id:this.dataset_id}),this.settings.clear(),this.groups.reset(),this.groups.add({id:p.a.uid()})},state:function(t,e){this.set({state:t,state_info:e}),this.trigger("set:state"),console.debug("model::state() - "+e+" ("+t+")")},serialize:function(){var t={attributes:this.attributes,settings:this.settings.attributes,groups:[]};return this.groups.each(function(e){t.groups.push(e.attributes)}),t},save:function(t){var e=this;t=t||{},this.chart_dict=this.serialize(),new on({id:this.visualization_id||void 0,type:this.visualization_name,title:this.get("title")||"",config:{dataset_id:this.dataset_id,chart_dict:this.chart_dict}}).save().then(function(i){i&&i.id?(e.visualization_id=i.id,t.success&&t.success(),console.debug("model::save() - Received visualization id: "+i.id)):(t.error&&t.error(),console.debug("model::save() - Unrecognized response. Saving may have failed."))}).fail(function(e){t.error&&t.error(),console.debug("model::save() - Saving failed.")}),console.debug("model::save() - Saving with configuration.")},load:function(t){var e=t||this.chart_dict;return e&&(console.debug("model::load() - Attempting to load with configuration:"),console.debug(e)),this.reset(),e&&e.attributes?(this.set(e.attributes),this.state("ok","Loading saved visualization..."),this.settings.set(e.settings),this.groups.reset(),this.groups.add(e.groups),this.set("modified",!1),this.trigger("load"),console.debug("model::load() - Loading chart model "+e.attributes.type+"."),!0):(this.set("modified",!0),this.trigger("load"),console.debug("model::load() - Visualization attributes unavailable."),!1)}})),rn=i(81),ln=i(101),cn=i(58),dn=c.a.View.extend({initialize:function(t,e){var i=this;this.deferred=t.deferred,this.chart=t.chart,this.group=e.group,this.setElement(a()("<div/>")),this.listenTo(this.chart,"change:dataset_id",function(){i.render()}),this.render()},render:function(){var t=this,e=p.a.clone(this.chart.plugin.groups)||[],i=this.chart.get("dataset_id");i&&(this.chart.state("wait","Loading metadata..."),this.deferred.execute(function(n){p.a.get({url:Object(d.getAppRoot)()+"api/datasets/"+i,cache:!0,success:function(i){var a={};cn.a.visitInputs(e,function(e,n){if("data_column"==e.type){a[n]=p.a.clone(e);var o=[];e.is_auto&&o.push({label:"Column: Row Number",value:"auto"}),e.is_zero&&o.push({label:"Column: None",value:"zero"});var s=i.metadata_column_types;for(var r in s)(-1!=["int","float"].indexOf(s[r])&&e.is_numeric||e.is_label)&&o.push({label:"Column: "+(parseInt(r)+1),value:r});e.data=o}var l=t.group.get(n);void 0===l||e.hidden||(e.value=l)}),e.push({name:"__data_columns",type:"hidden",hidden:!0,value:a}),t.chart.state("ok","Metadata initialized..."),t.form=new st.a({inputs:e,onchange:function(){t.group.set(t.form.data.create()),t.chart.set("modified",!0),t.chart.trigger("redraw")}}),t.group.set(t.form.data.create()),t.$el.empty().append(t.form.$el),n.resolve(),t.chart.trigger("redraw")}})}))}}),un=c.a.View.extend({initialize:function(t){var e=this;this.app=t,this.chart=t.chart,this.repeat=new ln.a.View({title:"Data series",title_new:"Data series",min:1,onnew:function(){e.chart.groups.add({id:p.a.uid()})}}),this.setElement(a()("<div/>").append(this.repeat.$el)),this.listenTo(this.chart.groups,"remove",function(t){e.repeat.del(t.id),e.chart.trigger("redraw")}),this.listenTo(this.chart.groups,"reset",function(){e.repeat.delAll()}),this.listenTo(this.chart.groups,"add",function(t){e.repeat.add({id:t.id,$el:new dn(e.app,{group:t}).$el,ondel:function(){e.chart.groups.remove(t)}})})},render:function(){r.a.size(this.chart.plugin.groups)>0?this.repeat.$el.show():this.repeat.$el.hide()}}),hn=c.a.View.extend({initialize:function(t,e){var i=this;this.chart=t.chart,this.setElement("<div/>"),this.listenTo(this.chart,"load",function(){i.render()})},render:function(){var t=this,e=p.a.clone(this.chart.plugin.settings)||[],i=this.chart.plugin.specs.use_panels;"optional"==i?e.push({name:"__use_panels",type:"boolean",label:"Use multi-panels",help:"Would you like to separate your data into individual panels?"}):this.chart.settings.set("__use_panels","yes"==i?"true":"false"),this.$el.empty(),r.a.size(e)>0&&(cn.a.visitInputs(e,function(e,i){var n=t.chart.settings.get(i);void 0===n||e.hidden||(e.value=n)}),this.form=new st.a({inputs:e,onchange:function(){t.chart.settings.set(t.form.data.create()),t.chart.trigger("redraw")}}),this.chart.settings.set(this.form.data.create()),this.$el.append(this.form.$el))}}),pn=c.a.View.extend({initialize:function(t){this.plugin=t.chart.plugin,this.setElement(this._template()),this.$title=this.$(".charts-description-title"),this.$image=this.$(".charts-description-image"),this.$text=this.$(".charts-description-text"),this.render()},render:function(){this.plugin.logo?(this.$image.attr("src",Object(d.getAppRoot)()+this.plugin.logo),this.$title.html(this.plugin.html||"Unavailable"),this.$text.html(p.a.linkify(this.plugin.description||"")),this.$el.show()):this.$el.hide()},_template:function(){return'<div class="charts-description">\n                    <table>\n                    <tr>\n                        <td class="charts-description-image-td">\n                            <img class="charts-description-image"/>\n                        </td>\n                        <td>\n                            <div class="charts-description-title"/>\n                        </td>\n                    </tr>\n                    </table>\n                    <div class="charts-description-text"/>\n                </div>'}}),fn=c.a.View.extend({initialize:function(t,e){var i=this;this.app=t,this.chart=this.app.chart,this.description=new pn(this.app),this.title=new ht.a.Input({onchange:function(){i.chart.set("title",i.title.value())}}),this.tabs=new rn.a.View({}),this.tabs.add({id:"settings",icon:"fa fa-gear",tooltip:"Change settings.",$el:a()("<div/>").append("<label><b>Provide a title</b><label>").append(this.title.$el).append(a()("<div/>").addClass("form-text text-muted").html("This title will appear in the list of 'Saved Visualizations'.")).append(new hn(this.app).$el)}),this.chart.plugin.groups&&this.tabs.add({id:"groups",icon:"fa-database",tooltip:"Select data.",$el:new un(this.app).$el}),this.setElement("<div class='charts-editor'/>"),this.$el.append(this.description.$el),this.$el.append(this.tabs.$el),this.listenTo(this.chart,"load",function(){i.title.value(i.chart.get("title"))})}}),mn=c.a.View.extend({initialize:function(t,e){var i=this;this.app=t,this.chart=this.app.chart,this.options=e,this.setElement(a()("<div/>").addClass("charts-viewer").append(a()("<div/>").addClass("info").append(a()("<span/>").addClass("icon")).append(a()("<span/>").addClass("text")))),this.$info=this.$(".info"),this.$icon=this.$(".icon"),this.$text=this.$(".text"),this._fullscreen(this.$el,20),this._createContainer("div"),this.chart.on("redraw",function(t){i.chart.get("modified")&&i.chart.plugin.specs.confirm&&!t?i.chart.state("info","Please confirm the settings before rendering the results."):i.app.deferred.execute(function(t){console.debug("viewer:redraw() - Redrawing..."),i._draw(t,i.chart)})}),this.chart.on("set:state",function(){var t=i.$(".charts-viewer-container"),e=i.$info,n=i.$icon,a=i.$text;switch(n.removeClass(),e.show(),a.html(i.chart.get("state_info")),i.chart.get("state")){case"ok":e.hide(),t.show();break;case"failed":n.addClass("icon fa fa-warning"),t.hide();break;case"info":n.addClass("icon fa fa-info"),t.hide();break;default:n.addClass("icon fa fa-spinner fa-spin"),t.show()}})},_fullscreen:function(t,e){t.css("height",a()(window).height()-e),a()(window).resize(function(){t.css("height",a()(window).height()-e)})},_createContainer:function(t,e){t=t||"div",e=e||1,this.$(".charts-viewer-container").remove(),this.targets=[];for(var i=0;i<e;i++){var n=p.a.uid(),o=a()("<div/>").addClass("charts-viewer-container").width(parseInt(100/e)+"%").append(a()("<"+t+" class='charts-viewer-canvas' />").attr("id",n));this.$el.append(o),this.targets.push(n)}},_draw:function(t,e){var i="true"==e.settings.get("__use_panels")?e.groups.length:1;this._createContainer(e.plugin.specs.tag,i),e.set("date",p.a.time()),e.state("wait","Please wait..."),this.app.chart_load({process:t,chart:e,dataset:this.app.dataset,targets:this.targets})}});function gn(t,e){var i=document.createElement("a");i.download=e,i.href=t,i.click()}function _n(t,e){gn(t.replace("image/png","image/octet-stream"),"".concat(e||"GalaxyImage",".png"))}function vn(t){var e=t.$el.find("svg");if(0!=e.length||!t.error){var i=e.length,n=parseInt(e.first().css("height")),o=parseInt(e.first().css("width")),s=new XMLSerializer,r=a()("<svg/>").attr({version:"1.1",xmlns:"http://www.w3.org/2000/svg",width:o*i,height:n}),l=0;return e.each(function(){var t=a()(this).clone();!function(t){for(var e in document.styleSheets){var i=document.styleSheets[e],n=i.cssRules;if(n)for(var a=0,o=n.length;a<o;a++)try{t.find(n[a].selectorText).each(function(t,e){e.style.cssText+=n[a].style.cssText})}catch(t){console.error(t)}}}(t);var e=a()('<g transform="translate('+l+', 0)">').attr("xmlns","http://www.w3.org/2000/svg");e.append(t.find("g").first()),r.append(e),l+=o}),{string:s.serializeToString(r[0]),height:n,width:o}}t.error("No SVG found. This visualization type does not support SVG/PDF export.")}var bn={createPNG:function(t){t.$el.find("svg").length>0?function(t){var e=vn(t),i=document.createElement("canvas"),n=i.getContext("2d"),o=new Image,s=a()('<div style="display:none;"/>').append(a()(i));a()("body").append(s),i.width=5*e.width,i.height=5*e.height,o.src="data:image/svg+xml;base64,"+window.btoa(e.string),o.onload=function(){n.drawImage(o,0,0,i.width,i.height);var e=i.toDataURL("image/png");_n(e,t.title),s.remove()}}(t):function(t){var e=t.$el.find(".charts-viewer-canvas");try{if(0!==e.width()&&0!==e.height()){var i=document.createElement("canvas");i.width=e.outerWidth(!0),i.height=e.outerHeight(!0);var n=i.getContext("2d");n.save(),n.fillStyle="rgb(255,255,255)",n.fillRect(0,0,i.width,i.height),n.restore(),n.translate(0,0),n.textAlign="left",n.textBaseline="top",e.children().each(function(){!function t(e,i,n,o){var s=e.prop("tagName").toLowerCase(),r=e.position(),l=i+r.left+parseInt(e.css("marginLeft"),10)+parseInt(e.css("borderLeftWidth"),10)+parseInt(e.css("paddingLeft"),10),c=n+r.top+parseInt(e.css("marginTop"),10)+parseInt(e.css("borderTopWidth"),10)+parseInt(e.css("paddingTop"),10);"div"==s||"span"==s?e.children().each(function(){t(a()(this),l,c)}):"canvas"==s&&o.drawImage(e[0],l,c)}(a()(this),0,0,n)});var o=i.toDataURL("image/png");o&&_n(o,t.title)}}catch(e){console.debug("FAILED - screenshot::_canvas2png() - "+e),t.error&&t.error("Please reduce your visualization to a single panel and try again.")}}(t)},createSVG:function(t){gn("data:none/none;base64,".concat(window.btoa(vn(t).string)),"".concat(t.title||"GalaxyImage",".svg"))},createPDF:function(t){var e=vn(t),i={filename:"visualization",type:"application/pdf",height:e.height,width:e.width,scale:2,svg:e.string},n=a()("body"),o=n.find("#viewer-form");for(var s in 0===o.length&&(o=a()("<form>",{id:"viewer-form",method:"post",action:"http://export.highcharts.com/",display:"none"}),n.append(o)),o.empty(),i){var r=a()("<input/>",{type:"hidden",name:s,value:i[s]});o.append(r)}try{o.submit()}catch(t){console.log(t)}}},wn=c.a.View.extend({initialize:function(t){var e=this;this.app=t,this.model=new c.a.Model({visible:!0}),this.execute_button=new ht.a.Button({icon:"fa-check-square",tooltip:"Confirm",onclick:function(){t.chart.trigger("redraw",!0)}}),this.export_button=new ht.a.ButtonMenu({icon:"fa-camera",tooltip:"Export"}),this.export_button.addMenu({key:"png",title:"Save as PNG",icon:"fa-file",onclick:function(){e._wait(t.chart,function(){bn.createPNG({$el:t.viewer.$el,title:t.chart.get("title"),error:function(e){t.message.update({message:e,status:"danger"})}})})}}),this.export_button.addMenu({key:"svg",title:"Save as SVG",icon:"fa-file-text-o",onclick:function(){e._wait(t.chart,function(){bn.createSVG({$el:t.viewer.$el,title:t.chart.get("title"),error:function(e){t.message.update({message:e,status:"danger"})}})})}}),this.export_button.addMenu({key:"pdf",title:"Save as PDF",icon:"fa-file-o",onclick:function(){t.modal.show({title:"Send visualization data for PDF creation",body:"Galaxy does not provide integrated PDF export scripts. You may click 'Continue' to create the PDF by using a 3rd party service (https://export.highcharts.com).",buttons:{Cancel:function(){t.modal.hide()},Continue:function(){t.modal.hide(),e._wait(t.chart,function(){bn.createPDF({$el:t.viewer.$el,title:t.chart.get("title"),error:function(e){t.message.update({message:e,status:"danger"})}})})}}})}}),this.left_button=new ht.a.Button({icon:"fa-angle-double-left",tooltip:"Show",onclick:function(){e.model.set("visible",!0),window.dispatchEvent(new Event("resize"))}}),this.right_button=new ht.a.Button({icon:"fa-angle-double-right",tooltip:"Hide",onclick:function(){e.model.set("visible",!1),window.dispatchEvent(new Event("resize"))}}),this.save_button=new ht.a.Button({icon:"fa-save",tooltip:"Save",onclick:function(){t.chart.get("title")?(t.message.update({message:"Saving '".concat(t.chart.get("title"),"'. It will appear in the list of 'Saved Visualizations'."),status:"success"}),t.chart.save({error:function(){t.message.update({message:"Could not save visualization.",status:"danger"})}})):t.message.update({message:"Please provide a name.",status:"danger"})}}),this.buttons=[this.left_button,this.right_button,this.execute_button,this.export_button,this.save_button],this.setElement("<div/>");var i=!0,n=!1,a=void 0;try{for(var o,s=this.buttons[Symbol.iterator]();!(i=(o=s.next()).done);i=!0){var r=o.value;this.$el.append(r.$el)}}catch(t){n=!0,a=t}finally{try{i||null==s.return||s.return()}finally{if(n)throw a}}this.listenTo(this.model,"change",function(){return e.render()}),this.render()},render:function(){var t=this.model.get("visible");this.app.$el[t?"removeClass":"addClass"]("charts-fullscreen"),this.execute_button.model.set("visible",t&&!!this.app.chart.plugin.specs.confirm),this.save_button.model.set("visible",t),this.export_button.model.set("visible",t),this.right_button.model.set("visible",t),this.left_button.model.set("visible",!t);var e=this.app.chart.plugin.specs.exports||[];this.export_button.collection.each(function(t){t.set("visible",-1!==e.indexOf(t.get("key")))})},_wait:function(t,e){this.app.deferred.ready()?e():this.app.message.update({message:"Your visualization is currently being processed. Please wait and try again."})}}),yn=c.a.View.extend({initialize:function(t){var e=this,i=Object(o.a)();this.modal=i&&i.modal?i.modal:new pt.a.View,this.setElement(a()("<div/>").addClass("charts-client").append(a()("<div/>").addClass("charts-buttons")).append(a()("<div/>").addClass("charts-center")).append(a()("<div/>").addClass("charts-right"))),this.$center=this.$(".charts-center"),this.$right=this.$(".charts-right"),this.$buttons=this.$(".charts-buttons"),this.chart=new sn({},t),this.chart.plugin=t.visualization_plugin,this.chart.plugin.specs=this.chart.plugin.specs||{},this.chart_load=t.chart_load,this.message=new ht.a.Message,this.deferred=new an.a,this.viewer=new mn(this),this.editor=new fn(this),this.menu=new wn(this),this.$center.append(this.viewer.$el),this.$right.append(this.message.$el).append(this.editor.$el),this.$buttons.append(this.menu.$el),a.a.ajax({url:"".concat(Object(d.getAppRoot)(),"api/datasets/").concat(t.dataset_id)}).done(function(t){e.dataset=t,e.chart.load(),e.chart.trigger("redraw")}).fail(function(t){var i=t.responseJSON&&t.responseJSON.err_msg;e.errormessage=i||"Import failed for unkown reason."})}}),xn={},kn=function(t){var e=t.dataset_groups,i=t.dataset_id,n=[];e.each(function(t){r.a.each(t.get("__data_columns"),function(e,a){var o=t.get(a),s=Sn(i,o);-1!==n.indexOf(o)||xn[s]||"auto"==o||"zero"==o||void 0===o||n.push(o)})}),0!==n.length?p.a.get({url:Object(d.getAppRoot)()+"api/datasets/"+i,data:{data_type:"raw_data",provider:"dataset-column",indeces:n.toString()},success:function(e){for(var a=n.length,o=new Array(a),s=0;s<o.length;s++)o[s]=[];for(var r in e.data){var l=e.data[r];for(var c in l){var d=l[c];void 0!==d&&2147483647!=d&&c<a&&o[c].push(d)}}for(var u in console.debug("tabular-datasets::_fetch() - Fetching complete."),o){var h=n[u],p=Sn(i,h);xn[p]=o[u]}Cn(t)}}):Cn(t)},Cn=function(t){var e=t.dataset_groups,i=t.dataset_id;console.debug("tabular-datasets::_fillFromCache() - Filling request from cache.");var n=0;e.each(function(t){r.a.each(t.get("__data_columns"),function(e,a){var o=t.get(a),s=Sn(i,o),r=xn[s];r&&(n=Math.max(n,r.length))})}),0===n&&(console.debug("tabular-datasets::_fillFromCache() - No data available."),t.chart&&t.chart.state("failed","No data available."));var a=[];e.each(function(t,e){for(var i=p.a.merge({key:e+":"+t.get("key"),values:[]},t.attributes),o=0;o<n;o++)i.values[o]={x:parseInt(o)};a.push(i)}),e.each(function(t,e){var o=a[e].values;r.a.each(t.get("__data_columns"),function(e,a){var s=t.get(a);switch(s){case"auto":for(var r=0;r<n;r++)o[r][a]=parseInt(r);break;case"zero":for(var l=0;l<n;l++)o[l][a]=0;break;default:for(var c=Sn(i,s),d=xn[c],u=0;u<n;u++){var h=o[u],p=d[u];isNaN(p)&&!e.is_label&&(p=0),h[a]=p}}})}),t.success(a)},Sn=function(t,e){return t+"__"+e},Tn={request:kn,requestPanels:function(t){var e=t.process,i=t.chart,n=t.render,a=t.targets,o=t.dataset_id||t.chart.get("dataset_id"),s=t.dataset_groups||t.chart.groups;kn({chart:i,dataset_id:o,dataset_groups:s,success:function(t){try{if(a.length==t.length){var o=!0;for(var s in t){var r=t[s];if(!n(a[s],[r])){o=!1;break}}o&&i.state("ok","Multi-panel chart drawn.")}else 1==a.length?n(a[0],t)&&i.state("ok","Chart drawn."):i.state("failed","Invalid panel count.");e.resolve()}catch(t){console.debug("FAILED: tabular-utilities::panelHelper() - "+t),i.state("failed",t),e.reject()}}})}};function $n(t,e){r.a.each(e,function(e){r.a.each(e.values,function(e,i){for(var n in t)e[n]=parseInt(i)})})}var On={makeCategories:function(t,e){var i={},n=t[0].__data_columns;return r.a.each(e,function(t){n[t].is_label&&(i[t]=[])}),t&&t[0]&&r.a.each(t[0].values,function(t){for(var e in i)i[e].push(String(t[e]))}),$n(i,t),{array:i}},makeUniqueCategories:function(t,e){var i={},n={},a={},o=t[0].__data_columns;for(var s in r.a.each(o,function(t,e){t.is_label&&(i[e]={},n[e]=[],a[e]=0)}),t){var l=t[s];for(var c in l.values){var d=l.values[c];for(var u in i){var h=String(d[u]);void 0===i[u][h]&&(i[u][h]=a[u],n[u].push(e?[a[u],h]:h),a[u]++)}}}for(var p in t){var f=t[p];for(var m in f.values){var g=f.values[m];for(var _ in i){var v=String(g[_]);g[_]=i[_][v]}}}return{categories:i,array:n,counter:a}},makeSeries:function(t,e){var i=[];for(var n in t){var a=t[n],o=[];for(var s in a.values){var r=[];if(e)for(var l in e){var c=e[l];r.push(a.values[s][c])}else for(var d in a.values[s])r.push(a.values[s][d]);o.push(r)}i.push(o)}return i},getDomains:function(t,e){function i(e,i){var n;for(var a in t){var o=St[e](t[a].values,function(t){return t[i]});n=void 0===n?o:Math[e](n,o)}return n}var n={};for(var a in e){var o=e[a];n[o]={min:i("min",o),max:i("max",o)}}return n},mapCategories:$n,makeTickFormat:function(t){var e=t.type,i=t.precision,n=t.categories,a=t.formatter;if("hide"==e)a(function(){return""});else if("auto"==e)n&&a(function(t){return n[t]||""});else{var o=function(t){switch(e){case"s":var n=St.formatPrefix(t);return n.scale(t).toFixed()+n.symbol;default:return St.format("."+i+e)(t)}};a(n?function(t){var e=n[t];if(!e)return"";if(isNaN(e))return e;try{return o(e)}catch(t){return e}}:function(t){return o(t)})}},addZoom:function(t){var e=100,i=t.yAxis,n=t.xAxis,a=t.xDomain||n.scale().domain,o=t.yDomain||i.scale().domain,s=t.redraw,r=t.svg,l=n.scale(),c=i.scale(),d=l.domain().slice(),u=c.domain().slice(),h=St.behavior.zoom();function p(t,i){return t[0]=Math.min(Math.max(t[0],i[0]),i[1]-i[1]/e),t[1]=Math.max(i[0]+i[1]/e,Math.min(t[1],i[1])),t}return l.nice(),c.nice(),h.x(l).y(c).scaleExtent([1,e]).on("zoom",function(){o(p(c.domain(),u)),a(p(l.domain(),d)),s()}),r.call(h).on("dblclick.zoom",function(){a(d),o(u),s(),h.scale(1),h.translate([0,0])}),h}},An=function t(e,i,n){p.a.request({type:"GET",url:Object(d.getAppRoot)()+"api/datasets/"+e.get("dataset_id_job"),data:{},success:function(a){var o=!1;switch(a.state){case"ok":e.state("wait","Job completed successfully..."),i&&i(a),o=!0;break;case"error":e.state("failed","Job has failed. Please check the history for details."),n&&n(a),o=!0;break;case"running":e.state("wait","Your job is running in the background and you may close the browser tab. Results will be available in your saved visualizations list.")}o||window.setTimeout(function(){t(e,i,n)},1e3)}})},jn=function(){var t=Object(o.a)();t&&t.currHistoryPanel&&t.currHistoryPanel.refreshContents()},Dn={request:function(t,e,i,n){t.state("wait","Requesting job results..."),t.get("modified")&&t.get("dataset_id_job")&&(p.a.request({type:"PUT",url:Object(d.getAppRoot)()+"api/histories/none/contents/"+t.get("dataset_id_job"),data:{deleted:!0},success:function(){jn()}}),t.set("dataset_id_job",null),t.set("modified",!1)),t.get("dataset_id_job")?An(t,i,n):(t.state("wait","Sending job request..."),p.a.request({type:"POST",url:Object(d.getAppRoot)()+"api/tools",data:e,success:function(e){if(e.outputs&&0!==e.outputs.length){jn();var a=e.outputs[0];t.state("wait","Your job has been queued. You may close the browser window. The job will run in the background."),t.set("dataset_id_job",a.id),t.save(),An(t,i,n)}else t.state("failed","Job submission failed. No response."),n&&n()},error:function(i){var a="";i&&i.message&&i.message.data&&i.message.data.input&&(a=i.message.data.input+"."),t.state("failed","This visualization requires the '"+e.tool_id+"' tool. Please make sure it is installed. "+a),n&&n()}}))},requestCharts:function(t,e){var i="",n="",a=0;for(var o in t.settings.attributes){var s=t.settings.get(o);r.a.each([[" ","&#32;"],[",","&#44;"],[":","&#58;"]],function(t){s=s.replace(new RegExp(t[0],"g"),t[1])}),i+=o+":"+s+", "}return i=i.substring(0,i.length-2),t.groups.each(function(t){a++,r.a.each(t.get("__data_columns"),function(e,i){n+=i+"_"+a+":"+(parseInt(t.get(i))+1)+", "})}),n=n.substring(0,n.length-2),{tool_id:"toolshed.g2.bx.psu.edu/repos/iuc/charts/charts/1.0.1",inputs:{input:{id:t.get("dataset_id"),src:"hda"},module:e,columns:n,settings:i}}}},In=i(12),Mn=i(116),Rn={mounted:function(){this.backboneRender()},updated:function(){this.backboneRender()},methods:{backboneRender:function(){if(window.top===window){var t=Object(o.a)();t.masthead||(t.masthead=new Mn.a.View(this.$props));var e=t.masthead.render();this.$el.appendChild(e.$el[0])}}}},En=(i(196),i(13)),Pn=Object(En.a)(Rn,function(){var t=this.$createElement;return(this._self._c||t)("div",{attrs:{id:"masthead"}})},[],!1,null,null,null).exports;function Vn(t,e){return console.log("initMasthead"),new(In.a.extend(Pn))({props:Object.keys(t),propsData:t,el:e})}function Ln(t){console.log("panelManagement"),console.log("(looks like it's assinging some global handlers to window to manage the left and right panel views?)");var e=t.left_panel,i=t.right_panel,n=t.rightPanelSelector,a=t.leftPanelSelector;if(e){var o=new window.bundleEntries.panels.LeftPanel({el:a});window.force_left_panel=function(t){console.log("window.force_left_panel fired"),o.force_panel(t)}}if(i){var s=new window.bundleEntries.panels.RightPanel({el:n});window.handle_minwidth_hint=function(t){console.log("window.handle_minwidth_hint",t),s.handle_minwidth_hint(t)},window.force_right_panel=function(t){console.log("window.force_right_panel",t),s.force_panel(t)}}}var zn=i(44),Nn=i(166),Fn=i.n(Nn);function Hn(t){new ci.GalaxyApp(t)}function Un(t){new Ct.b(t)}function Bn(t){new Lt.GalaxyApp(t)}function qn(t){new kt(t)}function Gn(t){new ze.GalaxyApp(t)}function Wn(t){const e=new _i.b([],{includeDeleted:t.includingDeleted,order:t.order,limitOnFirstFetch:t.limit,limitPerFetch:t.limit,currentHistoryId:t.current_history_id}),i=new Si.MultiPanelColumns({el:a()("#center").get(0),histories:e});e.fetchFirst({silent:!0}).done(function(){i.createColumns(),i.render(0)})}function Jn(t){return new yn(t)}i.d(e,"adminToolshed",function(){return Hn}),i.d(e,"trackster",function(){return Un}),i.d(e,"circster",function(){return Bn}),i.d(e,"workflow",function(){return qn}),i.d(e,"library",function(){return Gn}),i.d(e,"multiHistory",function(){return Wn}),i.d(e,"chart",function(){return Jn}),i.d(e,"chartUtilities",function(){return Yn}),i.d(e,"getGalaxyInstance",function(){return o.a}),i.d(e,"setGalaxyInstance",function(){return o.b}),i.d(e,"TracksterUI",function(){return Ct.a}),i.d(e,"phyloviz",function(){return Bt}),i.d(e,"SweepsterVisualization",function(){return ee}),i.d(e,"SweepsterVisualizationView",function(){return se}),i.d(e,"pages",function(){return gi}),i.d(e,"createTabularDatasetChunkedView",function(){return zt.d}),i.d(e,"History",function(){return _i.a}),i.d(e,"HistoryContents",function(){return vi.a}),i.d(e,"history",function(){return Ti.b}),i.d(e,"HistoryViewAnnotated",function(){return Oi}),i.d(e,"HistoryCopyDialog",function(){return yi.a}),i.d(e,"HDAListItemEdit",function(){return Ai.a}),i.d(e,"HDAModel",function(){return ji.a}),i.d(e,"LegacyGridView",function(){return Pi}),i.d(e,"create_chart",function(){return zi}),i.d(e,"create_histogram",function(){return Ni}),i.d(e,"ToolshedGroups",function(){return Wi}),i.d(e,"IES",function(){return en}),i.d(e,"Toast",function(){return f.a}),i.d(e,"panels",function(){return nn.a}),i.d(e,"show_in_overlay",function(){return bt}),i.d(e,"hide_modal",function(){return gt}),i.d(e,"show_message",function(){return vt}),i.d(e,"show_modal",function(){return _t}),i.d(e,"Modal",function(){return mt}),i.d(e,"make_popupmenu",function(){return wt.b}),i.d(e,"make_popup_menus",function(){return wt.a}),i.d(e,"async_save_text",function(){return ft.a}),i.d(e,"initMasthead",function(){return Vn}),i.d(e,"panelManagement",function(){return Ln}),i.d(e,"mountMakoTags",function(){return zn.a}),i.d(e,"store",function(){return Fn.a});const Yn={Datasets:Tn,Jobs:Dn,Series:On}},199:function(t,e,i){"use strict";i.r(e);var n=i(209),a=i(268),o=i(269),s=i(881),r=i(884),l=i(63),c={options:{root:Object(l.a)()},bootstrapped:{},form_input_auto_focus:!1,sentry:{}},d=i(31);i.d(e,"config$",function(){return f}),i.d(e,"set",function(){return m}),i.d(e,"get",function(){return g}),i.d(e,"getAppRoot",function(){return _}),i.d(e,"addInitialization",function(){return d.a});const u=new n.a,h=u.pipe(Object(o.a)(t=>t instanceof Object),Object(s.a)((t,e)=>Object.assign({},t,e),c)),p=new a.a(c);h.subscribe(p);const f=p.asObservable().pipe(Object(o.a)(Boolean),Object(r.a)(100));function m(...t){t.forEach(t=>u.next(t))}function g(){return p.getValue()}function _(t="/"){let e=t;try{e=g().options.root}catch(i){try{e=Object(l.a)(t)}catch(t){console.warn("Unable to find index link in head",t)}}return e}},2:function(t,e,i){var n,a;n=[i(189)],void 0===(a=function(t){if(t.hasOwnProperty("__root")){var e=sessionStorage.getItem("currentLocale");e&&(t=t["__"+e]||t["__"+e.split("-")[0]]||t.__root)}var i=function(e){return t[e]||e};return i.cacheNonLocalized=!1,i}.apply(e,n))||(t.exports=a)},20:function(t,e,i){"use strict";i.d(e,"b",function(){return l}),i.d(e,"a",function(){return c});var n=i(0),a=i.n(n),o=i(1),s=i.n(o),r=a.a;function l(t,e){var i=t.data("menu_options");t.data("menu_options",e),i||t.bind("click.show_popup",function(e){return r(".popmenu-wrapper").remove(),setTimeout(function(){var i=r("<ul class='dropdown-menu' id='".concat(t.attr("id"),"-menu'></ul>")),n=t.data("menu_options");s.a.size(n)<=0&&r("<li>No Options.</li>").appendTo(i),r.each(n,function(t,e){if(e){var n=e.action||e,a=e.url||"javascript:void(0);";i.append(r("<li></li>").append(r("<a>").attr("href",a).html(t).click(n)))}else i.append(r("<li></li>").addClass("head").append(r("<a href='#'></a>").html(t)))});var a=r("<div class='popmenu-wrapper' style='position: absolute;left: 0; top: -1000;'></div>").append(i).appendTo("body"),o=e.pageX-a.width()/2;o=Math.min(o,r(document).scrollLeft()+r(window).width()-r(a).width()-5),o=Math.max(o,r(document).scrollLeft()+5),a.css({top:e.pageY,left:o})},10),setTimeout(function(){var t=function(t){r(t).bind("click.close_popup",function(){r(".popmenu-wrapper").remove(),t.unbind("click.close_popup")})};t(r(window.document)),t(r(window.top.document));for(var e=window.top.frames.length;e--;){t(r(window.top.frames[e].document))}},50),!1})}function c(){r("div[popupmenu]").each(function(){var t={},e=r(this);e.find("a").each(function(){var e=r(this),i=e.get(0),n=i.getAttribute("confirm"),a=i.getAttribute("href"),o=i.getAttribute("target");t[e.text()]=a?{url:a,action:function(t){if(!n||confirm(n)){if(o)return window.open(a,o),!1;e.click()}else t.preventDefault()}}:null});var i=r("#".concat(e.attr("popupmenu")));i.find("a").bind("click",function(t){return t.stopPropagation(),!0}),l(i,t),i.addClass("popup"),e.remove()})}},21:function(t,e,i){"use strict";var n=i(0),a=i.n(n),o=i(3);var s=i.n(o).a.Model.extend({defaults:{ajax_settings:{},interval:1e3,success_fn:function(t){return!0}},go:function(){var t=a.a.Deferred(),e=this.get("ajax_settings"),i=this.get("success_fn"),n=this.get("interval");return function o(){a.a.ajax(e).success(function(e){i(e)?t.resolve(e):setTimeout(o,n)})}(),t}});e.a={commatize:function(t){t+="";for(var e=/(\d+)(\d{3})/;e.test(t);)t=t.replace(e,"$1,$2");return t},is_deferred:function(t){return"promise"in t},ServerStateDeferred:s,get_random_color:function(t){t||(t="#ffffff"),"string"==typeof t&&(t=[t]);for(var e=0;e<t.length;e++)t[e]=parseInt(t[e].slice(1),16);var i,n,a,o,s,r,l,c,d,u,h,p,f,m,g,_,v,b=function(t,e,i){return(299*t+587*e+114*i)/1e3},w=!1,y=0;do{for(d=b(n=(16711680&(i=Math.round(16777215*Math.random())))>>16,a=(65280&i)>>8,o=255&i),w=!0,e=0;e<t.length;e++)if(u=b(r=(16711680&(s=t[e]))>>16,l=(65280&s)>>8,c=255&s),p=n,f=a,m=o,g=r,_=l,v=c,h=Math.max(p,g)-Math.min(p,g)+(Math.max(f,_)-Math.min(f,_))+(Math.max(m,v)-Math.min(m,v)),Math.abs(d-u)<40||h<200){w=!1;break}y++}while(!w&&y<=10);return"#".concat((16777216+i).toString(16).substr(1,6))}}},219:function(t,e,i){"use strict";var n=i(125);i.n(n).a},22:function(t,e,i){"use strict";i.d(e,"a",function(){return m}),i.d(e,"c",function(){return g}),i.d(e,"b",function(){return _}),i.d(e,"d",function(){return k});var n=i(1),a=i.n(n),o=i(0),s=i.n(o),r=i(3),l=i.n(r),c=i(4),d=i(2),u=i.n(d),h=i(26),p=i(5),f=l.a.Model.extend({}),m=l.a.Model.extend({defaults:{id:"",type:"",name:"",hda_ldda:"hda",metadata:null},initialize:function(){this.get("metadata")||this._set_metadata(),this.on("change",this._set_metadata,this)},_set_metadata:function(){var t=new f;a.a.each(a.a.keys(this.attributes),function(e){if(0===e.indexOf("metadata_")){var i=e.split("metadata_")[1];t.set(i,this.attributes[e]),delete this.attributes[e]}},this),this.set("metadata",t,{silent:!0})},get_metadata:function(t){return this.attributes.metadata.get(t)},urlRoot:"".concat(Object(c.getAppRoot)(),"api/datasets")}),g=m.extend({defaults:a.a.extend({},m.prototype.defaults,{chunk_url:null,first_data_chunk:null,offset:0,at_eof:!1}),initialize:function(t){m.prototype.initialize.call(this),this.attributes.first_data_chunk&&(this.attributes.offset=this.attributes.first_data_chunk.offset),this.attributes.chunk_url="".concat(Object(c.getAppRoot)(),"dataset/display?dataset_id=").concat(this.id),this.attributes.url_viz="".concat(Object(c.getAppRoot)(),"visualization")},get_next_chunk:function(){if(this.attributes.at_eof)return null;var t=this,e=s.a.Deferred();return s.a.getJSON(this.attributes.chunk_url,{offset:t.attributes.offset}).success(function(i){var n;""!==i.ck_data?(n=i,t.attributes.offset=i.offset):(t.attributes.at_eof=!0,n=null),e.resolve(n)}),e}}),_=l.a.Collection.extend({model:m}),v=l.a.View.extend({initialize:function(t){this.row_count=0,this.loading_chunk=!1,new x({model:t.model,$el:this.$el})},expand_to_container:function(){this.$el.height()<this.scroll_elt.height()&&this.attempt_to_fetch()},attempt_to_fetch:function(t){var e=this;!this.loading_chunk&&this.scrolled_to_bottom()&&(this.loading_chunk=!0,this.loading_indicator.show(),s.a.when(e.model.get_next_chunk()).then(function(t){t&&(e._renderChunk(t),e.loading_chunk=!1),e.loading_indicator.hide(),e.expand_to_container()}))},render:function(){this.loading_indicator=s()("<div/>").attr("id","loading_indicator"),this.$el.append(this.loading_indicator);var t=s()("<table/>").attr({id:"content_table",cellpadding:0});this.$el.append(t);var e=this.model.get_metadata("column_names"),i=s()("<thead/>").appendTo(t),n=s()("<tr/>").appendTo(i);if(e)n.append("<th>".concat(e.join("</th><th>"),"</th>"));else for(var a=1;a<=this.model.get_metadata("columns");a++)n.append("<th>".concat(a,"</th>"));var o=this,r=this.model.get("first_data_chunk");r?this._renderChunk(r):s.a.when(o.model.get_next_chunk()).then(function(t){o._renderChunk(t)}),this.scroll_elt.scroll(function(){o.attempt_to_fetch()})},scrolled_to_bottom:function(){return!1},_renderCell:function(t,e,i){var n=s()("<td>").text(t),a=this.model.get_metadata("column_types");return void 0!==i?n.attr("colspan",i).addClass("stringalign"):a&&e<a.length&&("str"!==a[e]&&"list"!==a[e]||n.addClass("stringalign")),n},_renderRow:function(t){var e=t.split("\t"),i=s()("<tr>"),n=this.model.get_metadata("columns");return this.row_count%2!=0&&i.addClass("dark_row"),e.length===n?a.a.each(e,function(t,e){i.append(this._renderCell(t,e))},this):e.length>n?(a.a.each(e.slice(0,n-1),function(t,e){i.append(this._renderCell(t,e))},this),i.append(this._renderCell(e.slice(n-1).join("\t"),n-1))):1===e.length?(e=t.split(",")).length===n?a.a.each(e,function(t,e){i.append(this._renderCell(t,e))},this):(e=t.split(" ")).length===n?a.a.each(e,function(t,e){i.append(this._renderCell(t,e))},this):i.append(this._renderCell(t,0,n)):(a.a.each(e,function(t,e){i.append(this._renderCell(t,e))},this),a.a.each(a.a.range(n-e.length),function(){i.append(s()("<td>"))})),this.row_count++,i},_renderChunk:function(t){var e=this.$el.find("table");a.a.each(t.ck_data.split("\n"),function(t,i){""!==t&&e.append(this._renderRow(t))},this)}}),b=v.extend({initialize:function(t){v.prototype.initialize.call(this,t);var e=a.a.find(this.$el.parents(),function(t){return"auto"===s()(t).css("overflow")});e||(e=window),this.scroll_elt=s()(e)},scrolled_to_bottom:function(){return this.$el.height()-this.scroll_elt.scrollTop()-this.scroll_elt.height()<=0}}),w=v.extend({initialize:function(t){v.prototype.initialize.call(this,t),this.scroll_elt=this.$el.css({position:"relative",overflow:"scroll",height:t.height||"500px"})},scrolled_to_bottom:function(){return this.$el.scrollTop()+this.$el.innerHeight()>=this.el.scrollHeight}});function y(t,e){for(var i=0;i<e.length;i++)if(e[i].match(t))return i;return-1}var x=l.a.View.extend({col:{chrom:null,start:null,end:null},url_viz:null,dataset_id:null,genome_build:null,file_ext:null,initialize:function(t){var e=Object(p.a)();if(e&&e.modal&&(this.modal=e.modal),e&&e.frame&&(this.frame=e.frame),this.modal&&this.frame){var i=t.model,n=i.get("metadata");if(i.get("file_ext")){if(this.file_ext=i.get("file_ext"),"bed"==this.file_ext){if(!(n.get("chromCol")&&n.get("startCol")&&n.get("endCol")))return void console.log("TabularButtonTrackster : Bed-file metadata incomplete.");this.col.chrom=n.get("chromCol")-1,this.col.start=n.get("startCol")-1,this.col.end=n.get("endCol")-1}if("vcf"!=this.file_ext||(this.col.chrom=y("Chrom",n.get("column_names")),this.col.start=y("Pos",n.get("column_names")),this.col.end=null,-1!=this.col.chrom&&-1!=this.col.start)){if(void 0!==this.col.chrom)if(i.id)if(this.dataset_id=i.id,i.get("url_viz")){this.url_viz=i.get("url_viz"),i.get("genome_build")&&(this.genome_build=i.get("genome_build"));var a=new h.a.IconButtonView({model:new h.a.IconButton({title:u()("Visualize"),icon_class:"chart_curve",id:"btn_viz"})});this.setElement(t.$el),this.$el.append(a.render().$el),this.hide()}else console.log("TabularButtonTrackster : Url for visualization controller is missing.");else console.log("TabularButtonTrackster : Dataset identification is missing.")}else console.log("TabularButtonTrackster : VCF-file metadata incomplete.")}}},events:{"mouseover tr":"show",mouseleave:"hide"},show:function(t){var e=this;if(null!==this.col.chrom){var i,n=s()(t.target).parent(),a=n.children().eq(this.col.chrom).html(),o=n.children().eq(this.col.start).html(),r=this.col.end?n.children().eq(this.col.end).html():o;if(a.match("^#")||""===a||(i=o,isNaN(parseFloat(i))||!isFinite(i)))s()("#btn_viz").hide();else{var l={dataset_id:this.dataset_id,gene_region:"".concat(a,":").concat(o,"-").concat(r)},c=n.offset(),d=c.left-10,h=c.top-s()(window).scrollTop()+3;s()("#btn_viz").css({position:"fixed",top:"".concat(h,"px"),left:"".concat(d,"px")}),s()("#btn_viz").off("click"),s()("#btn_viz").click(function(){e.frame.add({title:u()("Trackster"),url:"".concat(e.url_viz,"/trackster?").concat(s.a.param(l))})}),s()("#btn_viz").show()}}},hide:function(){this.$("#btn_viz").hide()}}),k=function(t){t.model||(t.model=new g(t.dataset_config));var e=t.parent_elt,i=t.embedded;delete t.embedded,delete t.parent_elt,delete t.dataset_config;var n=i?new w(t):new b(t);return n.render(),e&&(e.append(n.$el),n.expand_to_container()),n}},220:function(t,e,i){"use strict";var n=i(0),a=i.n(n),o=i(3),s=i.n(o),r=i(4),l=i(5),c=i(29),d=i(10),u=s.a.Router.extend({initialize:function(t,e){this.page=t,this.options=e},executeUseRouter:function(t){var e=Object(r.getAppRoot)();return t.startsWith(e)&&(t=t.replace(e,"/")),this.push(t)},push:function(t,e){(e=e||{}).__identifer=Math.random().toString(36).substr(2),t+=-1==t.indexOf("?")?"?":"&";var i=a.a.param(e,!0);t+=i,Object(l.a)().params=e,this.navigate(t,{trigger:!0}),window.history.replaceState(window.history.state,"",window.location.pathname.replace(i,""))},execute:function(t,e,i){Object(l.a)().debug("router execute:",t,e,i);var n=c.a.parse(e.pop());e.push(n),t&&(this.authenticate(e,i)?t.apply(this,e):this.access_denied())},authenticate:function(t,e){return!0},access_denied:function(){this.page.display(new d.a.Message({status:"danger",message:"You must be logged in with proper credentials to make this request.",persistent:!0}))}});e.a=u},23:function(t,e,i){"use strict";var n=i(0),a=i.n(n),o=i(1),s=i.n(o),r=a.a;e.a=function(t){(t=t||{}).tooltipConfig=t.tooltipConfig||{placement:"bottom"},t.classes=["icon-btn"].concat(t.classes||[]),t.disabled&&t.classes.push("disabled");var e=['<a class="',t.classes.join(" "),'"',t.title?' title="'.concat(t.title,'"'):"",!t.disabled&&t.target?' target="'.concat(t.target,'"'):"",' href="',!t.disabled&&t.href?t.href:"javascript:void(0);",'">','<span class="fa ',t.faIcon,'"></span>',"</a>"].join(""),i=r(e).tooltip(t.tooltipConfig);return s.a.isFunction(t.onclick)&&i.click(function(e){i.tooltip("hide"),i.parent().attr("tabindex",-1).focus(),t.onclick.apply(this,arguments)}),i}},24:function(t,e,i){"use strict";var n=i(0),a=i.n(n),o=i(1),s=i.n(o),r=i(3),l=i.n(r),c=i(67),d=i(10),u=i(8),h=i(101),p=l.a.View.extend({initialize:function(t,e){var i=this;this.app=t,this.app_options=t.model?t.model.attributes:{},this.field=e&&e.field||new l.a.View,this.model=e&&e.model||new l.a.Model({text_enable:this.app_options.text_enable||"Enable",text_disable:this.app_options.text_disable||"Disable",text_connected_enable:this.app_options.text_connected_enable||"Add connection to module",text_connected_disable:this.app_options.text_connected_disable||"Remove connection from module",cls_enable:this.app_options.cls_enable||"fa fa-caret-square-o-down",cls_disable:this.app_options.cls_disable||"fa fa-caret-square-o-up",always_refresh:this.app_options.always_refresh}).set(e),this.setElement(this._template()),this.$field=this.$(".ui-form-field"),this.$info=this.$(".ui-form-info"),this.$preview=this.$(".ui-form-preview"),this.$collapsible=this.$(".ui-form-collapsible"),this.$collapsible_text=this.$(".ui-form-collapsible-text"),this.$collapsible_icon=this.$(".ui-form-collapsible-icon"),this.$connected_icon=this.$(".ui-form-connected-icon"),this.$title=this.$(".ui-form-title"),this.$title_text=this.$(".ui-form-title-text"),this.$error_text=this.$(".ui-form-error-text"),this.$error=this.$(".ui-form-error"),this.$backdrop=this.$(".ui-form-backdrop"),this.$field.prepend(this.field.$el);var n=this.model.get("collapsible_value"),a=JSON.stringify(this.model.get("value"));this.field.connected=a==JSON.stringify({__class__:"ConnectedValue"}),this.field.collapsed=this.field.connected||void 0!==n&&JSON.stringify(this.model.get("value"))==JSON.stringify(n),this.listenTo(this.model,"change",this.render,this),this.render();var o=this;this.$collapsible_icon.on("click",function(){o.field.collapsed=!o.field.collapsed,o.field.connected=!1,t.trigger&&t.trigger("change"),o.render()}),this.$connected_icon.on("click",function(){o.field.connected=!o.field.connected,o.field.collapsed=o.field.connected,t.trigger&&t.trigger("change"),o.render()}),this.field.model&&!this.model.get("always_refresh")&&this.listenTo(this.field.model,"change:value",function(){o.reset()}),this.field.model&&this.listenTo(this.field.model,"error",function(t){t?i.error(t):i.reset()})},backdrop:function(){this.model.set("backdrop",!0)},error:function(t){this.model.set("error_text",t)},reset:function(){!this.model.get("fixed")&&this.model.set("error_text",null)},render:function(){a()(".tooltip").hide();var t=this.model.get("help",""),e=this.model.get("argument");e&&-1==t.indexOf("(".concat(e,")"))&&(t+=" (".concat(e,")")),this.$info.html(t),this.$el[this.model.get("hidden")?"hide":"show"]();var i=s.a.escape(this.model.get("text_value")).replace(/\n/g,"<br />");this.$preview[this.field.collapsed&&this.model.get("collapsible_preview")||this.model.get("disabled")?"show":"hide"]().html(i);var n=this.model.get("error_text");this.$error[n?"show":"hide"](),this.$el[n?"addClass":"removeClass"]("alert alert-danger"),this.$error_text.html(n),this.$backdrop[this.model.get("backdrop")?"show":"hide"](),this.field.collapsed||this.model.get("disabled")?this.$field.hide():this.$field.show(),this.field.model&&this.field.model.set({color:this.model.get("color"),style:this.model.get("style")});var o=this.field.connected,r=!this.field.collapsible_disabled&&!this.model.get("disabled")&&void 0!==this.model.get("collapsible_value"),l=r&&this.model.get("connectable");if(r||l){var c=this.field.collapsed?"enable":"disable";if(this.$title_text.hide(),this.$collapsible.show(),this.$collapsible_text.text(this.model.get("label")),r&&!o?this.$collapsible_icon.removeClass().addClass("icon ui-form-collapsible-icon").addClass(this.model.get("cls_".concat(c))).tooltip("dispose").attr("data-original-title",this.model.get("text_".concat(c))).tooltip({placement:"bottom"}).show():this.$collapsible_icon.hide(),l){var d=this.field.connected?"fa fa-times":"fa fa-arrows-h",u=!o&&r?"ml-1":"",h=this.field.connected?"disable":"enable";this.$connected_icon.removeClass().addClass("icon ui-form-connected-icon").addClass(d).addClass(u).tooltip("dispose").attr("data-original-title",this.model.get("text_connected_".concat(h))).tooltip({placement:"bottom"}).show()}else this.$connected_icon.hide()}else this.$title_text.show().text(this.model.get("label")),this.$collapsible.hide()},_template:function(){return a()("<div/>").addClass("ui-form-element").append(a()("<div/>").addClass("ui-form-error").append(a()("<span/>").addClass("fa fa-arrow-down mr-1")).append(a()("<span/>").addClass("ui-form-error-text"))).append(a()("<div/>").addClass("ui-form-title").append(a()("<div/>").addClass("ui-form-collapsible").append(a()("<i/>").addClass("ui-form-collapsible-icon")).append(a()("<i/>").addClass("ui-form-connected-icon")).append(a()("<span/>").addClass("ui-form-collapsible-text ml-1"))).append(a()("<span/>").addClass("ui-form-title-text"))).append(a()("<div/>").addClass("ui-form-field").append(a()("<span/>").addClass("ui-form-info form-text text-muted mt-2")).append(a()("<div/>").addClass("ui-form-backdrop"))).append(a()("<div/>").addClass("ui-form-preview"))}}),f=i(5),m=i(2),g=i.n(m),_=i(80),v="disabled",b="enabled",w="linked",y={data:[{src:"hda",icon:"fa-file-o",tooltip:g()("Single dataset"),library:!0,multiple:!1,batch:v},{src:"hda",icon:"fa-files-o",tooltip:g()("Multiple datasets"),multiple:!0,batch:w},{src:"hdca",icon:"fa-folder-o",tooltip:g()("Dataset collection"),multiple:!1,batch:w}],data_multiple:[{src:"hda",icon:"fa-files-o",tooltip:g()("Multiple datasets"),multiple:!0,batch:v},{src:"hdca",icon:"fa-folder-o",tooltip:g()("Dataset collections"),multiple:!0,batch:v}],data_collection:[{src:"hdca",icon:"fa-folder-o",tooltip:g()("Dataset collection"),multiple:!1,batch:v}],workflow_data:[{src:"hda",icon:"fa-file-o",tooltip:g()("Single dataset"),multiple:!1,batch:v}],workflow_data_multiple:[{src:"hda",icon:"fa-files-o",tooltip:g()("Multiple datasets"),multiple:!0,batch:v}],workflow_data_collection:[{src:"hdca",icon:"fa-folder-o",tooltip:g()("Dataset collection"),multiple:!1,batch:v}],module_data:[{src:"hda",icon:"fa-file-o",tooltip:g()("Single dataset"),multiple:!1,batch:v},{src:"hda",icon:"fa-files-o",tooltip:g()("Multiple datasets"),multiple:!0,batch:b}],module_data_collection:[{src:"hdca",icon:"fa-folder-o",tooltip:g()("Dataset collection"),multiple:!1,batch:v},{src:"hdca",icon:"fa-folder",tooltip:g()("Multiple collections"),multiple:!0,batch:b}]},x={View:l.a.View.extend({initialize:function(t){var e=this,i=this;this.model=t&&t.model||new l.a.Model({src_labels:{hda:"dataset",hdca:"dataset collection"},pagelimit:100,statustimer:1e3}).set(t),this.setElement(a()("<div/>").addClass("ui-select-content")),this.button_product=new d.a.RadioButton.View({value:"false",data:[{icon:"fa fa-chain",value:"false",tooltip:"Linked inputs will be run in matched order with other datasets e.g. use this for matching forward and reverse reads."},{icon:"fa fa-chain-broken",value:"true",tooltip:"Unlinked dataset inputs will be run against *all* other inputs."}]}),this.$batch={linked:a()(this._templateBatch()).clone(),enabled:a()(this._templateBatch()).clone().append(this.button_product.$el)};var n=this.$el.get(0);n.addEventListener("dragenter",function(t){e.lastenter=t.target,i.$el.addClass("ui-dragover")}),n.addEventListener("dragover",function(t){t.preventDefault()}),n.addEventListener("dragleave",function(t){e.lastenter===t.target&&i.$el.removeClass("ui-dragover")}),n.addEventListener("drop",function(t){t.preventDefault();try{var i=JSON.parse(t.dataTransfer.getData("text"))[0];e._handleDropValues(i)}catch(t){e._handleDropStatus("danger")}}),this.cache={},this.listenTo(this.model,"change:data",this._changeData,this),this.listenTo(this.model,"change:wait",this._changeWait,this),this.listenTo(this.model,"change:current",this._changeCurrent,this),this.listenTo(this.model,"change:value",this._changeValue,this),this.listenTo(this.model,"change:type change:optional change:multiple change:extensions",this._changeType,this),this.render(),this.on("change",function(){t.onchange&&t.onchange(i.value())})},render:function(){this._changeType(),this._changeValue(),this._changeWait()},wait:function(){this.model.set("wait",!0)},unwait:function(){this.model.set("wait",!1)},update:function(t){this.model.set("data",t.options)},value:function(t){var e=Object(f.a)();void 0!==t&&this.model.set("value",t);var i=this.model.get("current");if(this.config[i]){var n=this.fields[i].value();if(null!==n&&(n=a.a.isArray(n)?n:[n]).length>0){var o=this._batch({values:[]});for(var s in n){var r=this.cache["".concat(n[s],"_").concat(this.config[i].src)];if(!r)return e.emit.debug("ui-select-content::value()","Requested details not found for '".concat(n[s],"'.")),null;var l=this._unpatchValue(r);o.values.push(l)}return o.values.sort(function(t,e){return t.hid-e.hid}),o}}else e.emit.debug("ui-select-content::value()","Invalid value/source '".concat(t,"'."));return null},_changeCurrent:function(){var t=this;s.a.each(this.fields,function(e,i){var n=t.config[i];t.model.get("current")==i?(e.$el.show(),s.a.each(t.$batch,function(t,e){n.batch==e?t.show():t.hide()}),"hda"==n.src?t.button_dialog.show():t.button_dialog.hide(),t.button_type.value(i)):e.$el.hide()}),this.fields.length>1?this.button_type.show():this.button_type.hide()},_changeType:function(){var t=this,e=this,i=Object(f.a)(),n=(this.model.get("flavor")?"".concat(this.model.get("flavor"),"_"):"")+String(this.model.get("type"))+(this.model.get("multiple")?"_multiple":"");y[n]?this.config=y[n]:(this.config=y.data,i.emit.debug("ui-select-content::_changeType()","Invalid configuration/type id '".concat(n,"'.")));var o=e.model.get("data"),r=u.a.textify(this.model.get("extensions")),l=this.model.get("src_labels");this.fields=[],this.button_data=[],s.a.each(this.config,function(t,i){e.button_data.push({value:i,icon:t.icon,tooltip:t.tooltip}),e.fields.push(new _.a.View({optional:e.model.get("optional"),multiple:t.multiple,searchable:!t.multiple||o&&o[t.src]&&o[t.src].length>e.model.get("pagelimit"),individual:!0,error_text:"No ".concat(r?"".concat(r," "):"").concat(l[t.src]||"content"," available."),onchange:function(){e.trigger("change")}}))}),this.button_type=new d.a.RadioButton.View({value:this.model.get("current"),data:this.button_data,cls:"mr-2",onchange:function(t){e.model.set("current",t),e.trigger("change")}}),this.button_dialog=new d.a.Button({icon:"fa-folder-open-o",tooltip:"Browse Datasets",cls:"ml-2",onclick:function(){var e=t.model.get("current"),n=t.config[e];i.data.dialog(function(e){t._handleDropValues(e,!1)},{multiple:n.multiple,library:!!n.library,format:null})}});var c=a()("<div/>").addClass("w-100");this.$el.empty().addClass("d-flex flex-row").append(a()("<div/>").append(this.button_type.$el)).append(c).append(a()("<div/>").append(this.button_dialog.$el)),s.a.each(this.fields,function(t){c.append(t.$el)}),s.a.each(this.$batch,function(t,e){c.append(t)}),this.model.set("current",0),this._changeCurrent(),this._changeData()},_changeWait:function(){var t=this;s.a.each(this.fields,function(e){e[t.model.get("wait")?"wait":"unwait"]()})},_changeData:function(){var t=this.model.get("data"),e=this,i={};s.a.each(t,function(t,n){i[n]=[],s.a.each(t,function(t){i[n].push({hid:t.hid,keep:t.keep,label:"".concat(t.hid,": ").concat(t.name),value:t.id,origin:t.origin,tags:t.tags}),e.cache["".concat(t.id,"_").concat(n)]=t})}),s.a.each(this.config,function(t,n){i[t.src]&&e.fields[n].add(i[t.src],function(t,e){return e.hid-t.hid})})},_changeValue:function(){var t=this.model.get("value");if(t&&t.values&&t.values.length>0){var e=[];s.a.each(t.values,function(t){e.push(t.id)});for(var i=t.values[0].src,n=t.values.length>1,a=0;a<this.config.length;a++){var o=this.fields[a],r=this.config[a];if(r.src==i&&-1!==[n,!0].indexOf(r.multiple)){this.model.set("current",a),o.value(e);break}}}else s.a.each(this.fields,function(t){t.value(null)})},_getSource:function(t){return"dataset_collection"==t.history_content_type?"hdca":"hda"},_patchValue:function(t){"ldda"==t.src&&(t.src="hda",t.origin="ldda",t.id="".concat(t.origin).concat(t.id))},_unpatchValue:function(t){if(t.origin){var e=Object.assign({},t);return e.id=e.id.substr(e.origin.length),e.src=e.origin,e}return t},_handleDropValues:function(t){var e=this,i=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=this,o=this.model.get("data"),r=this.model.get("current"),l=this.config[r],c=this.fields[r];if(o){var d=a.a.isArray(t)?t:[t];if(d.length>0){var u=!1;s.a.each(d,function(t){n._patchValue(t);var i=t.id,a=t.src=e._getSource(t),r={id:i,src:a};s.a.findWhere(o[a],r)||(u=!0,o[a].push({id:i,src:a,hid:t.hid||"Selected",name:t.name?t.name:i,origin:t.origin,keep:!0,tags:[]}))}),u&&this._changeData();var h=d[0].id,p=d[0].src;if(l.src==p&&i){var f=c.value();f&&l.multiple?s.a.each(d,function(t){-1==f.indexOf(t.id)&&f.push(t.id)}):f=h,c.value(f)}else this.model.set("value",{values:d}),this.model.trigger("change:value");this.trigger("change")}}this._handleDropStatus("success")},_handleDropStatus:function(t){var e=this;this.$el.removeClass("ui-dragover").addClass("ui-dragover-".concat(t)),setTimeout(function(){e.$el.removeClass("ui-dragover-".concat(t))},this.model.get("statustimer"))},_batch:function(t){t.batch=!1;var e=this.model.get("current"),i=this.config[e];if("hdca"==i.src){var n=this.cache["".concat(this.fields[e].value(),"_hdca")];n&&n.map_over_type&&(t.batch=!0)}return i.batch!=w&&i.batch!=b||(t.batch=!0,i.batch==b&&"true"===this.button_product.value()&&(t.product=!0)),t},_templateBatch:function(){return'<div class="form-text text-muted" style="clear: both;">\n                    <i class="fa fa-sitemap"/>\n                    <span>\n                        This is a batch mode input field. Separate jobs will be triggered for each dataset selection.\n                    </span>\n                </div>'}})},k={View:l.a.View.extend({initialize:function(t){var e=this;this.options=t,this.name=t.name||"element",this.multiple=t.multiple||!1,this.message=new d.a.Message({cls:"col mb-0"}),this.selections=a()("<div/>"),this.select=new d.a.Select.View({optional:t.optional}),this.$button=a()('<button class="fa fa-sign-in"/>'),this.$button.on("click",function(){e.add({id:e.select.value(),name:e.select.text()})}),this.setElement(this._template(t)),this.$(".ui-list-message").append(this.message.$el),this.$(".ui-list-selections").append(this.selections),this.$(".ui-list-button").append(this.$button),this.$(".ui-list-select").append(this.select.$el)},value:function(t){if(void 0!==t){if(this.selections.empty(),a.a.isArray(t))for(var e in t){var i=t[e],n=null,o=null;"string"!=a.a.type(i)?(n=i.id,o=i.name):n=o=i,null!=n&&this.add({id:n,name:o})}this._refresh()}var s=[];return this.$(".ui-list-id").each(function(){s.push({id:a()(this).prop("id"),name:a()(this).find(".ui-list-name").html()})}),0==s.length?null:s},add:function(t){var e=this;if(0===this.$('[id="'.concat(t.id,'"]')).length)if(u.a.isEmpty(t.id))this.message.update({message:"Please select a valid ".concat(this.name,"."),status:"danger"});else{var i=a()(this._templateRow({id:t.id,name:t.name}));i.find("button").on("click",function(){i.remove(),e._refresh()}),this.selections.append(i),this._refresh()}else this.message.update({message:"This ".concat(this.name," is already in the list.")})},update:function(t){this.select.update(t)},_refresh:function(){this.$(".ui-list-id").length>0?!this.multiple&&this.$button.attr("disabled",!0):this.$button.attr("disabled",!1),this.options.onchange&&this.options.onchange()},_template:function(t){return'<div class="ui-list container">\n                    <div class="row">\n                        <div class="col-1 pl-0 mb-2">\n                            <div class="ui-list-button"/>\n                        </div>\n                        <div class="ui-list-select col pr-0"/>\n                    </div>\n                    <div class="ui-list-message mt-2 row"/>\n                    <div class="ui-list-selections mt-2"/>\n                </div>'},_templateRow:function(t){return'<div id="'.concat(t.id,'" class="ui-list-id row mt-2">\n                    <button class="ui-list-delete fa fa-trash mr-3"/>\n                    <div class="ui-list-name">').concat(t.name,"</span>\n                </div>")}})},C=i(4),S=l.a.Collection.extend({url:"".concat(Object(C.getAppRoot)(),"api/libraries?deleted=false")}),T=l.a.Collection.extend({initialize:function(){var t=this;this.config=new l.a.Model({library_id:null}),this.config.on("change",function(){t.fetch({reset:!0})})},url:function(){return"".concat(Object(C.getAppRoot)(),"api/libraries/").concat(this.config.get("library_id"),"/contents")}}),$={View:l.a.View.extend({initialize:function(t){var e=this;this.libraries=new S,this.datasets=new T,this.options=t,this.library_select=new d.a.Select.View({onchange:function(t){e.datasets.config.set("library_id",t)}}),this.dataset_list=new k.View({name:"dataset",optional:t.optional,multiple:t.multiple,onchange:function(){e.trigger("change")}}),this.libraries.on("reset",function(){var t=[];e.libraries.each(function(e){t.push({value:e.id,label:e.get("name")})}),e.library_select.update({data:t})}),this.datasets.on("reset",function(){var t=[];null!==e.library_select.text()&&e.datasets.each(function(e){"file"===e.get("type")&&t.push({value:e.id,label:e.get("name")})}),e.dataset_list.update({data:t})}),this.on("change",function(){t.onchange&&t.onchange(e.value())}),this.setElement(this._template()),this.$(".library-select").append(this.library_select.$el),this.$el.append(this.dataset_list.$el),this.libraries.fetch({reset:!0,success:function(){e.library_select.trigger("change"),void 0!==e.options.value&&e.value(e.options.value)}})},value:function(t){return this.dataset_list.value(t)},_template:function(){return'<div class="ui-select-library">\n                    <div class="library-select mb-2"/>\n                </div>'}})},O={View:l.a.View.extend({initialize:function(t){var e=this;this.ftpfile_list=new k.View({name:"file",optional:t.optional,multiple:t.multiple,onchange:function(){t.onchange&&t.onchange(e.value())}}),this.setElement(this.ftpfile_list.$el),u.a.get({url:"".concat(Object(C.getAppRoot)(),"api/remote_files"),success:function(t){var i=[];for(var n in t)i.push({value:t[n].path,label:t[n].path});e.ftpfile_list.update(i)}})},value:function(t){return this.ftpfile_list.value(t)}})},A=function(t){var e=Object(f.a)(),i=e.config.genomespace_ui_url,n="".concat(i,"upload/loadUrlToGenomespace.html?getLocation=true"),a=window.open(n,"GenomeSpace File Browser","height=360px,width=600px");window.addEventListener("message",function(e){t.successCallback&&e.data.destination&&t.successCallback(e.data)},!1),a.focus(),null!=t.errorCallback&&(a.setCallbackOnGSUploadError=e.config.errorCallback)},j={View:l.a.View.extend({initialize:function(t){var e=this;this.options=t,this.browse_button=new d.a.Button({title:g()("Browse"),icon:"fa fa-sign-in",cls:"btn btn-secondary float-left",tooltip:g()("Browse GenomeSpace"),onclick:function(){e.browseGenomeSpace(t)}}),this.filename_textbox=new d.a.Input,this.setElement(this._template(t)),this.$(".ui-browse-button").append(this.browse_button.$el),this.$(".ui-filename-textbox").append(this.filename_textbox.$el)},browseGenomeSpace:function(t){var e=this;A({successCallback:function(t){e.value(t.destination)}})},_template:function(t){return'<div class="row">\n                    <div class="ui-browse-button col-3" />\n                    <div class="ui-filename-textbox col"/>\n                </div>'},value:function(t){if(void 0===t)return this._getValue();this._setValue(t)},_getValue:function(){return this.filename_textbox.value()},_setValue:function(t){t&&this.filename_textbox.value(t),this.options.onchange&&this.options.onchange(t)}})},D=i(15),I=i.n(D),M=i(12),R=i(28),E=i(52),P={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("li",{staticClass:"rule"},[i("span",{staticClass:"rule-display"},[t._v(t._s(t.title)+"\n            ")]),t._v(" "),t.rule.warn?i("span",{staticClass:"rule-warning"},[t._v("\n                "+t._s(t.rule.warn)+"\n            ")]):t._e(),t._v(" "),t.rule.error?i("span",{staticClass:"rule-error"},[i("span",{staticClass:"alert-message"},[t._v(t._s(t.rule.error))])]):t._e()])},staticRenderFns:[],props:{rule:{required:!0,type:Object},colHeaders:{type:Array,required:!1}},computed:{title:function(){var t=this.rule.type;return E.a.RULES[t].display(this.rule,this.colHeaders)}},methods:{}},V={render:function(){var t=this.$createElement;return(this._self._c||t)("li",{staticClass:"rule",attrs:{title:this.help}},[this._v("\n        Set "+this._s(this.columnsLabel)+" as "+this._s(this.typeDisplay)+"\n      ")])},staticRenderFns:[],props:{type:{type:String,required:!0},columns:{required:!0},colHeaders:{type:Array,required:!0}},computed:{typeDisplay:function(){return E.a.MAPPING_TARGETS[this.type].label},help:function(){return E.a.MAPPING_TARGETS[this.type].help||""},columnsLabel:function(){return E.a.columnDisplay(this.columns,this.colHeaders)}}},L={data:function(){return{}},computed:{mapping:function(){return this.inputRules?this.inputRules.mapping:[]},rules:function(){return this.inputRules?this.inputRules.rules:[]},columnData:function(){var t=[];return{colHeadersPerRule:t,columns:E.a.applyRules([],[],[],this.rules,t).columns}},colHeaders:function(){var t=this.columnData.columns;return E.a.colHeadersFor([],t)}},props:{inputRules:{required:!1,type:Object}},components:{RuleDisplayPreview:P,IdentifierDisplayPreview:V}},z=i(13),N=Object(z.a)(L,function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",[i("ol",{staticClass:"rules"},[t._l(t.rules,function(e,n){return i("rule-display-preview",{key:n,attrs:{rule:e,index:n,"col-headers":t.columnData.colHeadersPerRule[n]}})}),t._v(" "),t._l(t.mapping,function(e,n){return i("identifier-display-preview",t._b({key:e.type,attrs:{index:n,"col-headers":t.colHeaders}},"identifier-display-preview",e,!1))})],2)])},[],!1,null,null,null).exports,F={View:l.a.View.extend({initialize:function(t){var e=this;this.model=new l.a.Model,this.target=t.target;var i=this;this.browse_button=new d.a.Button({title:g()("Edit"),icon:"fa fa-edit",tooltip:g()("Edit Rules"),onclick:function(){i.target?i._fetcCollectionAndEdit():i._showRuleEditor(null)}}),this.on("change",function(){t.onchange&&t.onchange(e.value())}),this.setElement(this._template(t)),this.$(".ui-rules-edit-button").append(this.browse_button.$el);var n=M.a.extend(N),a=document.createElement("div");this.$(".ui-rules-preview").append(a),this.instance=new n({propsData:{initialRules:{rules:[],mapping:[]}}}),this.instance.$mount(a),this.collapsible_disabled=!0},_fetcCollectionAndEdit:function(){var t=this,e="".concat(Object(C.getAppRoot)(),"api/dataset_collections/").concat(this.target.id,"?instance_type=history");I.a.get(e).then(function(e){return t._showCollection(e)}).catch(this._renderFetchError)},_showCollection:function(t){var e=t.data;this._showRuleEditor(e)},_showRuleEditor:function(t){var e=this,i={saveRulesFn:function(t){return e._handleRulesSave(t)},initialRules:this._value};R.a.ruleBasedCollectionCreatorModal(t,"collection_contents","collections",i).done(function(){})},_handleRulesSave:function(t){this._setValue(t)},_renderFetchError:function(t){console.log(t),console.log("problem fetching collection")},_template:function(t){return'\n            <div class="ui-rules-edit clearfix">\n                <span class="ui-rules-preview" />\n                <span class="ui-rules-edit-button float-left" />\n            </div>\n        '},value:function(t){if(void 0===t)return this._getValue();this._setValue(t)},update:function(t){this.target=t.target},_getValue:function(){return this._value},_setValue:function(t){t&&("string"==typeof t&&(t=JSON.parse(t)),this._value=t,this.model.trigger("error",null),this.trigger("change"),this.instance.inputRules=t)},validate:function(){var t=this._value,e=null;if(t&&0!==t.rules.length)if(0===t.mapping.length)e="No collection identifiers defined, specify at least one collection identifier.";else{var i=!0,n=!1,a=void 0;try{for(var o,s=t.rules[Symbol.iterator]();!(i=(o=s.next()).done);i=!0){if(o.value.error){e="One or more rules in error.";break}}}catch(t){n=!0,a=t}finally{try{i||null==s.return||s.return()}finally{if(n)throw a}}}else e="No rules defined, define at least one rule.";return e}})};function H(t){return"0".concat(parseInt(t).toString(16)).slice(-2)}var U=l.a.View.extend({colors:{standard:["c00000","ff0000","ffc000","ffff00","92d050","00b050","00b0f0","0070c0","002060","7030a0"],base:["ffffff","000000","eeece1","1f497d","4f81bd","c0504d","9bbb59","8064a2","4bacc6","f79646"],theme:[["f2f2f2","7f7f7f","ddd9c3","c6d9f0","dbe5f1","f2dcdb","ebf1dd","e5e0ec","dbeef3","fdeada"],["d8d8d8","595959","c4bd97","8db3e2","b8cce4","e5b9b7","d7e3bc","ccc1d9","b7dde8","fbd5b5"],["bfbfbf","3f3f3f","938953","548dd4","95b3d7","d99694","c3d69b","b2a2c7","92cddc","fac08f"],["a5a5a5","262626","494429","17365d","366092","953734","76923c","5f497a","31859b","e36c09"],["7f7f7e","0c0c0c","1d1b10","0f243e","244061","632423","4f6128","3f3151","205867","974806"]]},initialize:function(t){this.options=u.a.merge(t,{}),this.setElement(this._template()),this.$panel=this.$(".ui-color-picker-panel"),this.$view=this.$(".ui-color-picker-view"),this.$value=this.$(".ui-color-picker-value"),this.$header=this.$(".ui-color-picker-header"),this._build(),this.visible=!1,this.value(this.options.value),this.$boxes=this.$(".ui-color-picker-box");var e=this;this.$boxes.on("click",function(){e.value(a()(this).css("background-color")),e.$header.trigger("click")}),this.$header.on("click",function(){e.visible=!e.visible,e.visible?e.$view.fadeIn("fast"):e.$view.fadeOut("fast")})},value:function(t){return null!=t&&(this.$value.css("background-color",t),this.$(".ui-color-picker-box").empty(),this.$(this._getValue()).html(this._templateCheck()),this.options.onchange&&this.options.onchange(t)),this._getValue()},_getValue:function(){var t=this.$value.css("background-color");return(t=t.match(/^rgb\((\d+),\s*(\d+),\s*(\d+)\)$/))?"#".concat(H(t[1])).concat(H(t[2])).concat(H(t[3])):null},_build:function(){for(var t in this._content({colors:this.colors.base}),this.colors.theme){var e={};0==t?e.bottom=!0:t!=this.colors.theme.length-1?(e.top=!0,e.bottom=!0):e.top=!0,e.colors=this.colors.theme[t],this._content(e)}this._content({colors:this.colors.standard})},_content:function(t){var e=t.colors,i=a()(this._templateContent()),n=i.find(".line");for(var o in this.$panel.append(i),e){var s=a()(this._templateBox(e[o]));t.top&&(s.css("border-top","none"),s.css("border-top-left-radius","0px"),s.css("border-top-right-radius","0px")),t.bottom&&(s.css("border-bottom","none"),s.css("border-bottom-left-radius","0px"),s.css("border-bottom-right-radius","0px")),n.append(s)}return i},_templateCheck:function(){return'<div class="ui-color-picker-check fa fa-check"/>'},_templateContent:function(){return'<div class="ui-color-picker-content"><div class="line"/></div>'},_templateBox:function(t){return'<div id="'.concat(t,'" class="ui-color-picker-box" style="background-color: #').concat(t,';"/>')},_template:function(){return'\n            <div class="ui-color-picker">\n                <div class="ui-color-picker-header">\n                    <div class="ui-color-picker-value"/>\n                    <div class="ui-color-picker-label">Select a color</div>\n                </div>\n                <div class="ui-color-picker-view ui-input">\n                    <div class="ui-color-picker-panel"/>\n                </div>\n            </div>\n            '}}),B=l.a.Model.extend({types:{text:"_fieldText",password:"_fieldText",select:"_fieldSelect",data_column:"_fieldSelect",genomebuild:"_fieldSelect",data:"_fieldData",data_collection:"_fieldData",integer:"_fieldSlider",float:"_fieldSlider",boolean:"_fieldBoolean",drill_down:"_fieldDrilldown",color:"_fieldColor",group_tag:"_fieldSelect",hidden:"_fieldHidden",hidden_data:"_fieldHidden",baseurl:"_fieldHidden",library_data:"_fieldLibrary",ftpfile:"_fieldFtp",upload:"_fieldUpload",rules:"_fieldRulesEdit",genomespacefile:"_fieldGenomeSpace"},create:function(t){var e=Object(f.a)(),i=this.types[t.type],n="function"==typeof this[i]?this[i].call(this,t):null;return n||(n=t.options?this._fieldSelect(t):this._fieldText(t),e.emit.debug("form-parameters::_addRow()","Auto matched field type (".concat(t.type,")."))),void 0===t.value&&(t.value=null),n.value(t.value),n},_fieldData:function(t){return new x.View({id:"field-".concat(t.id),extensions:t.extensions,optional:t.optional,multiple:t.multiple,type:t.type,flavor:t.flavor,data:t.options,onchange:t.onchange})},_fieldSelect:function(t){if(t.is_workflow)return this._fieldText(t);"data_column"==t.type&&(t.error_text="Missing columns in referenced dataset.");var e={checkboxes:d.a.Checkbox,radio:d.a.Radio,radiobutton:d.a.RadioButton}[t.display]||d.a.Select;return new d.a.TextSelect({id:"field-".concat(t.id),data:t.data,options:t.options,display:t.display,error_text:t.error_text||"No options available",readonly:t.readonly,multiple:t.multiple,optional:t.optional,onchange:t.onchange,individual:t.individual,searchable:"workflow"!==t.flavor,textable:t.textable,SelectClass:e})},_fieldDrilldown:function(t){return t.is_workflow?this._fieldText(t):new d.a.Drilldown.View({id:"field-".concat(t.id),data:t.options,display:t.display,optional:t.optional,onchange:t.onchange})},_fieldText:function(t){if("SelectTagParameter"===t.model_class||t.options&&t.data)if(t.area=t.multiple,u.a.isEmpty(t.value))t.value=null;else if(a.a.isArray(t.value)){var e="";for(var i in t.value){if(e+=String(t.value[i]),!t.multiple)break;e+="\n"}t.value=e}return new d.a.Input({id:"field-".concat(t.id),type:t.type,area:t.area,readonly:t.readonly,placeholder:t.placeholder,datalist:t.datalist,onchange:t.onchange})},_fieldSlider:function(t){return new d.a.Slider.View({id:"field-".concat(t.id),precise:"float"==t.type,is_workflow:t.is_workflow,min:t.min,max:t.max,onchange:t.onchange})},_fieldHidden:function(t){return new d.a.Hidden({id:"field-".concat(t.id),info:t.info})},_fieldBoolean:function(t){return new d.a.RadioButton.View({id:"field-".concat(t.id),data:[{label:"Yes",value:"true"},{label:"No",value:"false"}],onchange:t.onchange})},_fieldColor:function(t){return new U({id:"field-".concat(t.id),onchange:t.onchange})},_fieldLibrary:function(t){return new $.View({id:"field-".concat(t.id),optional:t.optional,multiple:t.multiple,onchange:t.onchange})},_fieldFtp:function(t){return new O.View({id:"field-".concat(t.id),optional:t.optional,multiple:t.multiple,onchange:t.onchange})},_fieldGenomeSpace:function(t){return new j.View({id:"field-".concat(t.id),onchange:t.onchange})},_fieldRulesEdit:function(t){return new F.View({id:"field-".concat(t.id),onchange:t.onchange,target:t.target})},_fieldUpload:function(t){return new d.a.Upload({id:"field-".concat(t.id),onchange:t.onchange})}}),q=l.a.View.extend({initialize:function(t,e){this.app=t,this.inputs=e.inputs,this.parameters=new B,this.setElement(a()("<div/>")),this.render()},render:function(){var t=this;this.$el.empty(),s.a.each(this.inputs,function(e){t.add(e)})},add:function(t){var e=a.a.extend({},t);switch(e.id=u.a.uid(),this.app.input_list[e.id]=e,e.type){case"conditional":this._addConditional(e);break;case"repeat":this._addRepeat(e);break;case"section":this._addSection(e);break;default:this._addRow(e)}},_addConditional:function(t){var e=this;t.test_param.id=t.id,t.test_param.textable=!1,this.app.model.get("sustain_conditionals")&&(t.test_param.disabled=!0);var i=this._addRow(t.test_param);if(i.model){for(var n in t.cases){var a=new q(this.app,{inputs:t.cases[n].inputs});this._append(a.$el.addClass("ui-portlet-section pl-2"),"".concat(t.id,"-section-").concat(n))}i.model.set("onchange",function(i){var n=e.app.data.matchCase(t,i);for(var a in t.cases){var o=t.cases[a],s=e.$("#".concat(t.id,"-section-").concat(a)),r=!1;for(var l in o.inputs)if(!o.inputs[l].hidden){r=!0;break}a==n&&r?s.fadeIn("fast"):s.hide()}e.app.trigger("change")}),i.trigger("change")}},_addRepeat:function(t){var e=this,i=0,n=new h.a.View({title:t.title||"Repeat",min:t.min,max:t.max,onnew:function(){a(t.inputs),e.app.trigger("change")}});function a(a){var o="".concat(t.id,"-section-").concat(i++),s=new q(e.app,{inputs:a});n.add({id:o,$el:s.$el,ondel:function(){n.del(o),e.app.trigger("change")}})}for(var o=s.a.size(t.cache),r=0;r<Math.max(Math.max(o,t.min||0),t.default||0);r++)a(r<o?t.cache[r]:t.inputs);this.app.model.get("sustain_repeats")&&n.hideOptions();var l=new p(this.app,{label:t.title||t.name,help:t.help,field:n});this._append(l.$el,t.id)},_addSection:function(t){var e=new c.a.View({title:t.title||t.name,cls:"ui-portlet-section",collapsible:!0,collapsible_button:!0,collapsed:!t.expanded});e.append(new q(this.app,{inputs:t.inputs}).$el),e.append(a()("<div/>").addClass("form-text text-muted").html(t.help)),this.app.on("expand",function(t){e.$("#".concat(t)).length>0&&e.expand()}),this._append(e.$el,t.id)},_addRow:function(t){var e=this,i=t.id;t.onchange=t.onchange||function(){e.app.trigger("change",i)};var n=this.parameters.create(t);this.app.field_list[i]=n;var a=new p(this.app,{name:t.name,label:t.hide_label?"":t.label||t.name,value:t.value,text_value:t.text_value,collapsible_value:t.collapsible_value,collapsible_preview:t.collapsible_preview,connectable:t.connectable,help:t.help,argument:t.argument,disabled:t.disabled,color:t.color,style:t.style,backdrop:t.backdrop,hidden:t.hidden,fixed:t.fixed,field:n});return this.app.element_list[i]=a,this._append(a.$el,t.id),n},_append:function(t,e){this.$el.append(t.addClass("section-row").attr("id",e))}}),G={View:q},W=i(58);e.a=l.a.View.extend({initialize:function(t){this.model=new l.a.Model({initial_errors:!1,cls:"ui-portlet",icon:null,always_refresh:!0,status:"warning",hide_operations:!1,onchange:function(){}}).set(t),this.setElement("<div/>"),this.render()},update:function(t){var e=this;this.data.matchModel(t,function(t,i){var n=e.field_list[i];n.update&&(n.update(t),n.trigger("change"),Object(f.a)().emit.debug("form-view::update()","Updating input: ".concat(i)))})},wait:function(t){for(var e in this.input_list){var i=this.field_list[e];this.input_list[e].is_dynamic&&i.wait&&i.unwait&&i[t?"wait":"unwait"]()}},highlight:function(t,e,i){var n=this.element_list[t];if(n&&(n.error(e||"Please verify this parameter."),this.portlet.expand(),this.trigger("expand",t),!i)){var o=this.$el.parents().filter(function(){return-1!=["auto","scroll"].indexOf(a()(this).css("overflow"))}).first();o.animate({scrollTop:o.scrollTop()+n.$el.offset().top-o.position().top-120},500)}},errors:function(t){if(this.trigger("reset"),t&&t.errors){var e=this.data.matchResponse(t.errors);for(var i in this.element_list)e[i]&&this.highlight(i,e[i],!0)}},render:function(){var t=this;this.off("change"),this.off("reset"),this.field_list={},this.input_list={},this.element_list={},this.data=new W.a.Manager(this),this._renderForm(),this.data.create(),this.model.get("initial_errors")&&this.errors(this.model.attributes);var e=this.data.checksum();return this.on("change",function(i){var n=t.input_list[i];if(!n||n.refresh_on_change||t.model.get("always_refresh")){var a=t.data.checksum();a!=e&&(e=a,t.model.get("onchange")())}}),this.on("reset",function(){s.a.each(t.element_list,function(t){t.reset()})}),this},_renderForm:function(){a()(".tooltip").remove();var t=this.model.attributes;this.message=new d.a.UnescapedMessage,this.section=new G.View(this,{inputs:t.inputs}),this.portlet=new c.a.View({icon:t.icon,title:t.title,title_id:t.title_id,operations:!t.hide_operations&&t.operations,cls:t.cls,buttons:t.buttons,collapsible:t.collapsible,collapsed:t.collapsed,onchange_title:t.onchange_title}),this.portlet.append(this.message.$el),this.portlet.append(this.section.$el),this.$el.empty(),t.inputs&&this.$el.append(this.portlet.$el),t.message&&this.message.update({persistent:!0,status:t.status,message:t.message}),Object(f.a)().emit.debug("form-view::initialize()","Completed")}})},249:function(t,e,i){},25:function(t,e,i){"use strict";i.d(e,"b",function(){return u}),i.d(e,"a",function(){return p});var n=i(0),a=i.n(n),o=i(3),s=i.n(o),r=i(1),l=i.n(r),c=i(7),d=s.a.View.extend(c.a.LoggableMixin).extend({_logNamespace:"list",initialize:function(t){this.expanded=t.expanded||!1,this.log("\t expanded:",this.expanded),this.fxSpeed=void 0!==t.fxSpeed?t.fxSpeed:this.fxSpeed},fxSpeed:"fast",render:function(t){var e=this._buildNewRender();return this._setUpBehaviors(e),this._queueNewRender(e,t),this},_buildNewRender:function(){var t=a()(this.templates.el(this.model.toJSON(),this));return this.expanded&&this.$details(t).replaceWith(this._renderDetails().show()),t},_queueNewRender:function(t,e){e=void 0===e?this.fxSpeed:e;var i=this;0===e?(i._swapNewRender(t),i.trigger("rendered",i)):a()(i).queue("fx",[function(t){i.$el.fadeOut(e,t)},function(e){i._swapNewRender(t),e()},function(t){i.$el.fadeIn(e,t)},function(t){i.trigger("rendered",i),t()}])},_swapNewRender:function(t){return this.$el.empty().attr("class",l.a.isFunction(this.className)?this.className():this.className).append(t.children())},_setUpBehaviors:function(t){(t=t||this.$el).find("[title]").tooltip({placement:"bottom"})},$details:function(t){return(t=t||this.$el).find("> .details")},_renderDetails:function(){var t=a()(this.templates.details(this.model.toJSON(),this));return this._setUpBehaviors(t),t},toggleExpanded:function(t){return(t=void 0===t?!this.expanded:t)?this.expand():this.collapse(),this},expand:function(){var t=this;return t._fetchModelDetails().always(function(){t._expand()})},_fetchModelDetails:function(){return this.model.hasDetails()?a.a.when():this.model.fetch()},_expand:function(){var t=this,e=t._renderDetails();t.$details().replaceWith(e),t.expanded=!0,t.$details().slideDown(t.fxSpeed,function(){t.trigger("expanded",t)})},collapse:function(){this.debug("".concat(this,"(ExpandableView).collapse"));var t=this;t.expanded=!1,this.$details().slideUp(t.fxSpeed,function(){t.trigger("collapsed",t)})}}),u=d.extend(c.a.mixin(c.a.SelectableViewMixin,c.a.DraggableViewMixin,{tagName:"div",className:"list-item",initialize:function(t){d.prototype.initialize.call(this,t),c.a.SelectableViewMixin.initialize.call(this,t),c.a.DraggableViewMixin.initialize.call(this,t),this._setUpListeners()},_setUpListeners:function(){return this.on("selectable",function(t){t?this.$(".primary-actions").hide():this.$(".primary-actions").show()},this),this},_buildNewRender:function(){var t=d.prototype._buildNewRender.call(this);return t.children(".warnings").replaceWith(this._renderWarnings()),t.children(".title-bar").replaceWith(this._renderTitleBar()),t.children(".primary-actions").append(this._renderPrimaryActions()),t.find("> .title-bar .subtitle").replaceWith(this._renderSubtitle()),t},_swapNewRender:function(t){return d.prototype._swapNewRender.call(this,t),this.selectable&&this.showSelector(0),this.draggable&&this.draggableOn(),this.$el},_renderWarnings:function(){var t=this,e=a()('<div class="warnings"></div>'),i=t.model.toJSON();return l.a.each(t.templates.warnings,function(n){e.append(a()(n(i,t)))}),e},_renderTitleBar:function(){return a()(this.templates.titleBar(this.model.toJSON(),this))},_renderPrimaryActions:function(){return[]},_renderSubtitle:function(){return a()(this.templates.subtitle(this.model.toJSON(),this))},events:{"click .title-bar":"_clickTitleBar","keydown .title-bar":"_keyDownTitleBar","click .selector":"toggleSelect"},_clickTitleBar:function(t){t.stopPropagation(),t.altKey?(this.toggleSelect(t),this.selectable||this.showSelector()):this.toggleExpanded()},_keyDownTitleBar:function(t){return!t||"keydown"!==t.type||32!==t.keyCode&&13!==t.keyCode||(this.toggleExpanded(),t.stopPropagation(),!1)},toString:function(){var t=this.model?"".concat(this.model):"(no model)";return"ListItemView(".concat(t,")")}}));u.prototype.templates={el:c.a.wrapTemplate(['<div class="list-element">','<div class="warnings"></div>','<div class="selector">','<span class="fa fa-2x fa-square-o"></span>',"</div>",'<div class="primary-actions"></div>','<div class="title-bar"></div>','<div class="details"></div>',"</div>"]),warnings:{},titleBar:c.a.wrapTemplate(['<div class="title-bar clear" tabindex="0">','<span class="state-icon"></span>','<div class="title">','<span class="name"><%- element.name %></span>',"</div>",'<div class="subtitle"></div>',"</div>"],"element"),subtitle:c.a.wrapTemplate(['<div class="subtitle"></div>']),details:c.a.wrapTemplate(['<div class="details"></div>'])};var h,p=u.extend({foldoutStyle:"foldout",foldoutPanelClass:null,initialize:function(t){"drilldown"===this.foldoutStyle&&(this.expanded=!1),this.foldoutStyle=t.foldoutStyle||this.foldoutStyle,this.foldoutPanelClass=t.foldoutPanelClass||this.foldoutPanelClass,u.prototype.initialize.call(this,t),this.foldout=this._createFoldoutPanel()},_renderDetails:function(){if("drilldown"===this.foldoutStyle)return a()();var t=u.prototype._renderDetails.call(this);return this._attachFoldout(this.foldout,t)},_createFoldoutPanel:function(){var t=this.model,e=this._getFoldoutPanelClass(t),i=this._getFoldoutPanelOptions(t);return new e(l.a.extend(i,{model:t}))},_getFoldoutPanelClass:function(){return this.foldoutPanelClass},_getFoldoutPanelOptions:function(){return{foldoutStyle:this.foldoutStyle,fxSpeed:this.fxSpeed}},_attachFoldout:function(t,e){return e=e||this.$("> .details"),this.foldout=t.render(0),t.$("> .controls").hide(),e.append(t.$el)},expand:function(){var t=this;return t._fetchModelDetails().always(function(){"foldout"===t.foldoutStyle?t._expand():"drilldown"===t.foldoutStyle&&t._expandByDrilldown()})},_expandByDrilldown:function(){var t=this;t.listenTo(t.foldout,"close",function(){t.trigger("collapsed:drilldown",t,t.foldout)}),t.trigger("expanded:drilldown",t,t.foldout)}});p.prototype.templates=(h=c.a.wrapTemplate(['<div class="details">',"</div>"],"collection"),l.a.extend({},u.prototype.templates,{details:h})),e.c={ExpandableView:d,ListItemView:u,FoldoutListItemView:p}},250:function(t,e,i){},26:function(t,e,i){"use strict";var n=i(0),a=i.n(n),o=i(1),s=i.n(o),r=i(3),l=i.n(r),c=i(20),d=l.a.Model.extend({defaults:{title:"",icon_class:"",on_click:null,menu_options:null,is_menu_button:!0,id:null,href:null,target:null,enabled:!0,visible:!0,tooltip_config:{}}}),u=l.a.View.extend({initialize:function(){this.model.attributes.tooltip_config={placement:"bottom"},this.model.bind("change",this.render,this)},render:function(){this.$el.tooltip("hide");var t=this.template(this.model.toJSON());return t.tooltip(this.model.get("tooltip_config")),this.$el.replaceWith(t),this.setElement(t),this},events:{click:"click"},click:function(t){return!s.a.isFunction(this.model.get("on_click"))||(this.model.get("on_click")(t),!1)},template:function(t){var e='title="'.concat(t.title,'" class="icon-button');return t.is_menu_button&&(e+=" menu-button"),e+=" ".concat(t.icon_class),t.enabled||(e+="_disabled"),e+='"',t.id&&(e+=' id="'.concat(t.id,'"')),e+=' href="'.concat(t.href,'"'),t.target&&(e+=' target="'.concat(t.target,'"')),t.visible||(e+=' style="display: none;"'),e=t.enabled?"<a ".concat(e,"/>"):"<span ".concat(e,"/>"),a()(e)}}),h=l.a.Collection.extend({model:d}),p=l.a.View.extend({tagName:"div",initialize:function(){this.render()},render:function(){var t=this;return this.collection.each(function(e){var i=a()("<a/>").attr("href","javascript:void(0)").attr("title",e.attributes.title).addClass("icon-button menu-button").addClass(e.attributes.icon_class).appendTo(t.$el).click(e.attributes.on_click);e.attributes.tooltip_config&&i.tooltip(e.attributes.tooltip_config);var n=e.get("options");n&&Object(c.b)(i,n)}),this}});e.a={IconButton:d,IconButtonView:u,IconButtonCollection:h,IconButtonMenuView:p,create_icon_buttons_menu:function(t,e){e||(e={});var i=new h(s.a.map(t,function(t){return new d(s.a.extend(t,e))}));return new p({collection:i})}}},27:function(t,e,i){"use strict";var n=i(0),a=i.n(n),o=i(8),s=i(3),r=i.n(s),l=r.a.View.extend({initialize:function(t){this.model=t&&t.model||new r.a.Model({id:o.a.uid(),title:"",icon:"",cls:"btn btn-secondary",wait:!1,wait_text:"Sending...",wait_cls:"btn btn-info",disabled:!1,percentage:-1,visible:!0}).set(t),this.setElement(a()("<button/>").attr("type","button").append(this.$icon=a()("<i/>")).append(this.$title=a()("<span/>")).append(this.$progress=a()("<div/>").append(this.$progress_bar=a()("<div/>")))),this.listenTo(this.model,"change",this.render,this),this.render()},render:function(){var t=this,e=this.model.attributes;this.$el.removeClass().addClass("ui-button-default").addClass(e.disabled&&"disabled").attr("id",e.id).attr("disabled",e.disabled).css("display",e.visible?"inline-block":"none").off("click").on("click",function(){a()(".tooltip").hide(),e.onclick&&!t.disabled&&e.onclick()}).tooltip({title:e.tooltip||"",placement:"bottom"}),this.$progress.addClass("progress").css("display",-1!==e.percentage?"block":"none"),this.$progress_bar.addClass("progress-bar").css({width:"".concat(e.percentage,"%")}),this.$icon.removeClass().addClass("icon fa"),this.$title.removeClass().addClass("title"),e.wait?(this.$el.addClass(e.wait_cls).prop("disabled",!0),this.$icon.addClass("fa-spinner fa-spin mr-1"),this.$title.html(e.wait_text)):(this.$el.addClass(e.cls),this.$icon.addClass(e.icon),e.title&&(this.$title.html(e.title),e.icon&&this.$icon.addClass("mr-1")))},show:function(){this.model.set("visible",!0)},hide:function(){this.model.set("visible",!1)},disable:function(){this.model.set("disabled",!0)},enable:function(){this.model.set("disabled",!1)},wait:function(){this.model.set("wait",!0)},unwait:function(){this.model.set("wait",!1)},setIcon:function(t){this.model.set("icon",t)}}),c=l.extend({initialize:function(t){this.model=t&&t.model||new r.a.Model({id:o.a.uid(),visible:!0,title:"",icon:"",cls:""}).set(t),this.setElement(a()("<a/>").append(this.$icon=a()("<span/>"))),this.listenTo(this.model,"change",this.render,this),this.render()},render:function(){var t=this.model.attributes;this.$el.removeClass().addClass(t.cls).attr({id:t.id,href:t.href||"javascript:void(0)",title:t.title,target:t.target||"_top",disabled:t.disabled}).css("display",t.visible?"inline-block":"none").tooltip({placement:"bottom"}).off("click").on("click",function(){t.onclick&&!t.disabled&&t.onclick()}),this.$icon.removeClass().addClass(t.icon)}}),d=r.a.View.extend({initialize:function(t){this.model=t&&t.model||new r.a.Model({id:o.a.uid(),title:"Select/Unselect all",icons:["fa-square-o","fa-minus-square-o","fa-check-square-o"],value:0,visible:!0,onchange:function(){}}).set(t),this.setElement(a()("<div/>").addClass("mb-2").append(this.$icon=a()("<span/>")).append(this.$title=a()("<span/>"))),this.listenTo(this.model,"change",this.render,this),this.render()},render:function(t){var e=this;t=this.model.attributes,this.$el.addClass("ui-button-check").css("display",t.visible?"inline-block":"none").off("click").on("click",function(){e.model.set("value",0===e.model.get("value")?2:0),t.onclick&&t.onclick()}),this.$title.html(t.title),this.$icon.removeClass().addClass("icon fa mr-1").addClass(t.icons[t.value])},value:function(t,e){return void 0!==t&&(e&&0!==t&&(t=t!==e?1:2),this.model.set("value",t),this.model.get("onchange")(this.model.get("value"))),this.model.get("value")}}),u=r.a.View.extend({$menu:null,initialize:function(t){this.model=t&&t.model||new r.a.Model({id:"",title:"",pull:"right",icon:null,onclick:null,cls:"btn btn-secondary float-right",tooltip:"",target:"",href:"",onunload:null,visible:!0,tag:""}).set(t),this.collection=new r.a.Collection,this.setElement(a()("<div/>").append(this.$root=a()("<button/>").append(this.$icon=a()("<i/>")).append(this.$title=a()("<span/>")))),this.listenTo(this.model,"change",this.render,this),this.listenTo(this.collection,"change add remove reset",this.render,this),this.render()},render:function(){var t=this,e=this.model.attributes;this.$el.removeClass().addClass("dropdown").attr("id",e.id).css({display:e.visible&&this.collection.where({visible:!0}).length>0?"block":"none"}),this.$root.addClass(e.cls).attr("data-toggle","dropdown").tooltip({title:e.tooltip||"",placement:"bottom"}).off("click").on("click",function(t){a()(".tooltip").hide(),t.preventDefault(),e.onclick&&e.onclick()}),this.$icon.removeClass().addClass("icon fa").addClass(e.icon),e.title&&this.$title.removeClass().addClass("title ml-1").html(e.title),this.$menu&&this.$menu.remove(),this.collection.length>0&&(this.$menu=a()("<ul/>").addClass("menu dropdown-menu dropdown-menu-right").addClass("pull-".concat(this.model.get("pull"))).attr("role","menu"),this.$el.append(this.$menu)),this.collection.each(function(e){var i=e.attributes;if(i.visible){var n=a()("<a/>").addClass("dropdown-item").attr({href:i.href,target:i.target}).append(a()("<i/>").addClass("fa mr-2").addClass(i.icon).css("display",i.icon?"inline-block":"none")).append(i.title).on("click",function(t){i.onclick&&(t.preventDefault(),i.onclick())});t.$menu.append(a()("<li/>").append(n)),i.divider&&t.$menu.append(a()("<li/>").addClass("divider"))}})},addMenu:function(t){this.collection.add(o.a.merge(t,{title:"",target:"",href:"",onclick:null,divider:!1,visible:!0,icon:null,cls:"button-menu btn-group"}))}});e.a={Button:l,ButtonLink:c,ButtonCheck:d,ButtonMenu:u}},28:function(t,e,i){"use strict";var n=i(1),a=i.n(n),o=i(0),s=i.n(o),r=i(3),l=i.n(r),c=i(46),d=i(11),u=i(7),h=i(70),p=i(19),f=i(2),m=i.n(f),g=i(12),_=i(5),v=(i(138),s.a),b=l.a.View.extend(u.a.LoggableMixin).extend({_logNamespace:"collections",tagName:"li",className:"collection-element",initialize:function(t){this.element=t.element||{},this.selected=t.selected||!1},render:function(){this.dragStartHandler=a.a.bind(this._dragstart,this),this.dragEndHandler=a.a.bind(this._dragend,this);var t=this.$el.attr("data-element-id",this.element.id).attr("draggable",!0).html(this.template({element:this.element})).get(0);return t.addEventListener("dragstart",this.dragStartHandler,!1),t.addEventListener("dragend",this.dragEndHandler,!1),this.selected&&this.$el.addClass("selected"),this},template:a.a.template(['<a class="name" title="',m()("Click to rename"),'" href="javascript:void(0)">',"<%- element.name %>","</a>",'<button class="discard btn btn-sm" title="',m()("Remove this dataset from the list"),'">',m()("Discard"),"</button>"].join("")),select:function(t){this.$el.toggleClass("selected",t),this.trigger("select",{source:this,selected:this.$el.hasClass("selected")})},discard:function(){var t=this,e=this.$el.parent().width();this.$el.animate({"margin-right":e},"fast",function(){t.trigger("discard",{source:t}),t.destroy()})},destroy:function(){this.off(),this.$el.remove()},events:{click:"_click","click .name":"_clickName","click .discard":"_clickDiscard",dragover:"_sendToParent",drop:"_sendToParent"},_click:function(t){t.stopPropagation(),this.select(t)},_clickName:function(t){t.stopPropagation(),t.preventDefault();var e=prompt("".concat(m()("Enter a new name for the element"),":"),this.element.name);e&&(this.element.name=e,this.render())},_clickDiscard:function(t){t.stopPropagation(),this.discard()},_dragstart:function(t){t.originalEvent&&(t=t.originalEvent),t.dataTransfer.effectAllowed="move",t.dataTransfer.setData("text/plain",JSON.stringify(this.element)),this.$el.addClass("dragging"),this.$el.parent().trigger("collection-element.dragstart",[this])},_dragend:function(t){this.$el.removeClass("dragging"),this.$el.parent().trigger("collection-element.dragend",[this])},_sendToParent:function(t){this.$el.parent().trigger(t)},toString:function(){return"DatasetCollectionElementView()"}}),w=l.a.View.extend(u.a.LoggableMixin).extend(h.a.CollectionCreatorMixin).extend({_logNamespace:"collections",elementViewClass:b,collectionClass:c.a.HistoryDatasetCollection,className:"list-collection-creator collection-creator flex-row-container",minElements:1,defaultAttributes:{creationFn:function(){throw new TypeError("no creation fn for creator")},oncreate:function(){},oncancel:function(){},autoscrollDist:24,highlightClr:"rgba( 64, 255, 255, 1.0 )"},footerSettings:{".hide-originals":"hideOriginals"},initialize:function(t){this.metric("ListCollectionCreator.initialize",t);var e=this;a.a.each(this.defaultAttributes,function(i,n){i=t[n]||i,e[n]=i}),e.initialElements=t.elements||[],this._setUpCommonSettings(t),this._instanceSetUp(),this._elementsSetUp(),this._setUpBehaviors()},_instanceSetUp:function(){this.selectedIds={},this.$dragging=null,this.blocking=!1},_elementsSetUp:function(){this.invalidElements=[],this.workingElements=[],this.elementViews=[],this.workingElements=this.initialElements.slice(0),this._ensureElementIds(),this._validateElements(),this._mangleDuplicateNames(),this._sortElements()},_ensureElementIds:function(){return this.workingElements.forEach(function(t){t.hasOwnProperty("id")||(t.id=a.a.uniqueId())}),this.workingElements},_validateElements:function(){var t=this;return t.invalidElements=[],this.workingElements=this.workingElements.filter(function(e){var i=t._isElementInvalid(e);return i&&t.invalidElements.push({element:e,text:i}),!i}),this.workingElements},_isElementInvalid:function(t){return"dataset_collection"===t.history_content_type?m()("is a collection, this is not allowed"):t.state===d.a.OK||a.a.contains(d.a.NOT_READY_STATES,t.state)?t.deleted||t.purged?m()("has been deleted or purged"):null:m()("has errored, is paused, or is not accessible")},_mangleDuplicateNames:function(){var t=1,e={};this.workingElements.forEach(function(i){for(var n=i.name;e.hasOwnProperty(n);)if(n="".concat(i.name," (").concat(t,")"),(t+=1)>=900)throw new Error("Safety hit in while loop - thats impressive");i.name=n,e[i.name]=!0})},_sortElements:function(t){},render:function(t,e){return this.workingElements.length<this.minElements?this._renderInvalid(t,e):(this.$el.empty().html(this.templates.main()),this._renderHeader(t),this._renderMiddle(t),this._renderFooter(t),this._addPluginComponents(),this.$(".collection-name").focus(),this.trigger("rendered",this),this)},_renderInvalid:function(t,e){return this.$el.empty().html(this.templates.invalidInitial({problems:this.invalidElements,elements:this.workingElements})),"function"==typeof this.oncancel&&this.$(".cancel-create.btn").show(),this.trigger("rendered",this),this},_renderHeader:function(t,e){var i=this.$(".header").empty().html(this.templates.header()).find(".help-content").prepend(v(this.templates.helpContent()));return this.invalidElements.length&&this._invalidElementsAlert(),i},_renderMiddle:function(t,e){var i=this.$(".middle").empty().html(this.templates.middle());return this._renderList(t),i},_addPluginComponents:function(){this.$(".help-content i").hoverhighlight(".collection-creator",this.highlightClr)},_invalidElementsAlert:function(){this._showAlert(this.templates.invalidElements({problems:this.invalidElements}),"alert-warning")},_disableNameAndCreate:function(t){(t=!!a.a.isUndefined(t)||t)&&(this.$(".collection-name").prop("disabled",!0),this.$(".create-collection").toggleClass("disabled",!0))},$list:function(){return this.$(".collection-elements")},_renderClearSelected:function(){a.a.size(this.selectedIds)?this.$(".collection-elements-controls > .clear-selected").show():this.$(".collection-elements-controls > .clear-selected").hide()},_renderList:function(t,e){var i=this,n=s()("<div/>"),o=i.$list();a.a.each(this.elementViews,function(t){t.destroy(),i.removeElementView(t)}),i.workingElements.forEach(function(t){var e=i._createElementView(t);n.append(e.$el)}),i._renderClearSelected(),o.empty().append(n.children()),a.a.invoke(i.elementViews,"render"),o.height()>o.css("max-height")?o.css("border-width","1px 0px 1px 0px"):o.css("border-width","0px")},_createElementView:function(t){var e=new this.elementViewClass({element:t,selected:a.a.has(this.selectedIds,t.id)});return this.elementViews.push(e),this._listenToElementView(e),e},_listenToElementView:function(t){var e=this;e.listenTo(t,{select:function(t){var i=t.source.element;t.selected?e.selectedIds[i.id]=!0:delete e.selectedIds[i.id],e.trigger("elements:select",t)},discard:function(t){e.trigger("elements:discard",t)}})},addElementView:function(t){},removeElementView:function(t){delete this.selectedIds[t.element.id],this._renderClearSelected(),this.elementViews=a.a.without(this.elementViews,t),this.stopListening(t)},_renderNoElementsLeft:function(){this._disableNameAndCreate(!0),this.$(".collection-elements").append(this.templates.noElementsLeft())},_elementToJSON:function(t){return t},createList:function(t){if(!this.workingElements.length){var e="".concat(m()("No valid elements for final list"),". ");return e+='<a class="cancel-create" href="javascript:void(0);">'.concat(m()("Cancel"),"</a> "),e+=m()("or"),e+=' <a class="reset" href="javascript:void(0);">'.concat(m()("start over"),"</a>."),void this._showAlert(e)}var i=this,n=this.workingElements.map(function(t){return i._elementToJSON(t)});return i.blocking=!0,i.creationFn(n,t,i.hideOriginals).always(function(){i.blocking=!1}).fail(function(t,e,n){i.trigger("error",{xhr:t,status:e,message:m()("An error occurred while creating this collection")})}).done(function(t,e,n){i.trigger("collection:created",t,e,n),i.metric("collection:created",t),"function"==typeof i.oncreate&&i.oncreate.call(this,t,e,n)})},_setUpBehaviors:function(){return this.on("error",this._errorHandler),this.once("rendered",function(){this.trigger("rendered:initial",this)}),this.on("elements:select",function(t){this._renderClearSelected()}),this.on("elements:discard",function(t){var e=t.source.element;this.removeElementView(t.source),this.workingElements=a.a.without(this.workingElements,e),this.workingElements.length||this._renderNoElementsLeft()}),this},_errorHandler:function(t){this.error(t);var e=t.message||m()("An error occurred");if(t.xhr){var i=t.xhr,n=t.message;0===i.readyState&&0===i.status?e+=": ".concat(m()("Galaxy could not be reached and may be updating.")).concat(m()(" Try again in a few minutes.")):i.responseJSON?e+=":<br /><pre>".concat(JSON.stringify(i.responseJSON),"</pre>"):e+=": ".concat(n)}this._showAlert(e,"alert-danger")},events:{"click .more-help":"_clickMoreHelp","click .less-help":"_clickLessHelp","click .main-help":"_toggleHelp","click .header .alert button":"_hideAlert","click .reset":"reset","click .clear-selected":"clearSelectedElements","click .collection-elements":"clearSelectedElements","dragover .collection-elements":"_dragoverElements","drop .collection-elements":"_dropElements","collection-element.dragstart .collection-elements":"_elementDragstart","collection-element.dragend   .collection-elements":"_elementDragend","change .collection-name":"_changeName","keydown .collection-name":"_nameCheckForEnter","change .hide-originals":"_changeHideOriginals","click .cancel-create":"_cancelCreate","click .create-collection":"_clickCreate"},reset:function(){this._instanceSetUp(),this._elementsSetUp(),this.render()},clearSelectedElements:function(t){this.$(".collection-elements .collection-element").removeClass("selected"),this.$(".collection-elements-controls > .clear-selected").hide()},_dragoverElements:function(t){t.preventDefault();var e=this.$list();this._checkForAutoscroll(e,t.originalEvent.clientY);var i=this._getNearestElement(t.originalEvent.clientY);this.$(".element-drop-placeholder").remove();var n=v('<div class="element-drop-placeholder"></div>');i.length?i.before(n):e.append(n)},_checkForAutoscroll:function(t,e){var i=t.offset(),n=t.scrollTop(),a=e-i.top,o=i.top+t.outerHeight()-e;a>=0&&a<this.autoscrollDist?t.scrollTop(n-2):o>=0&&o<this.autoscrollDist&&t.scrollTop(n+2)},_getNearestElement:function(t){for(var e=this.$(".collection-elements li.collection-element").toArray(),i=0;i<e.length;i++){var n=v(e[i]),a=n.offset().top,o=Math.floor(n.outerHeight()/2)+4;if(a+o>t&&a-o<t)return n}return v()},_dropElements:function(t){t.originalEvent&&(t=t.originalEvent),t.preventDefault(),t.dataTransfer.dropEffect="move";var e=this._getNearestElement(t.clientY);return e.length?this.$dragging.insertBefore(e):this.$dragging.insertAfter(this.$(".collection-elements .collection-element").last()),this._syncOrderToDom(),!1},_syncOrderToDom:function(){var t=this,e=[];this.$(".collection-elements .collection-element").each(function(){var i=v(this).attr("data-element-id"),n=a.a.findWhere(t.workingElements,{id:i});n?e.push(n):console.error("missing element: ",i)}),this.workingElements=e,this._renderList()},_elementDragstart:function(t,e){e.select(!0),this.$dragging=this.$(".collection-elements .collection-element.selected")},_elementDragend:function(t,e){v(".element-drop-placeholder").remove(),this.$dragging=null},templates:a.a.extend({},h.a.CollectionCreatorMixin._creatorTemplates,{header:a.a.template(['<div class="main-help well clear">','<a class="more-help" href="javascript:void(0);">',m()("More help"),"</a>",'<div class="help-content">','<a class="less-help" href="javascript:void(0);">',m()("Less"),"</a>","</div>","</div>",'<div class="alert alert-dismissable">','<button type="button" class="close" data-dismiss="alert" ','title="',m()("Close and show more help"),'" aria-hidden="true">&times;</button>','<span class="alert-message"></span>',"</div>"].join("")),middle:a.a.template(['<div class="collection-elements-controls">','<a class="reset" href="javascript:void(0);" ','title="',m()("Undo all reordering and discards"),'">',m()("Start over"),"</a>",'<a class="clear-selected" href="javascript:void(0);" ','title="',m()("De-select all selected datasets"),'">',m()("Clear selected"),"</a>","</div>",'<div class="collection-elements scroll-container flex-row">',"</div>"].join("")),footer:a.a.template(['<div class="attributes clear">','<div class="clear">','<label class="setting-prompt float-right">',m()("Hide original elements"),"?",'<input class="hide-originals float-right" type="checkbox" />',"</label>","</div>",'<div class="clear">','<input class="collection-name form-control float-right" ','placeholder="',m()("Enter a name for your new collection"),'" />','<div class="collection-name-prompt float-right">',m()("Name"),":</div>","</div>","</div>",'<div class="actions clear vertically-spaced">','<div class="other-options float-left">','<button class="cancel-create btn" tabindex="-1">',m()("Cancel"),"</button>",'<div class="create-other btn-group dropup">','<button class="btn btn-secondary dropdown-toggle" data-toggle="dropdown">',m()("Create a different kind of collection"),' <span class="caret"></span>',"</button>",'<ul class="dropdown-menu" role="menu">','<li><a href="#">',m()("Create a <i>single</i> pair"),"</a></li>",'<li><a href="#">',m()("Create a list of <i>unpaired</i> datasets"),"</a></li>","</ul>","</div>","</div>",'<div class="main-options float-right">','<button class="create-collection btn btn-primary">',m()("Create list"),"</button>","</div>","</div>"].join("")),helpContent:a.a.template(["<p>",m()(["Collections of datasets are permanent, ordered lists of datasets that can be passed to tools and ","workflows in order to have analyses done on each member of the entire group. This interface allows ","you to create a collection and re-order the final collection."].join("")),"</p>","<ul>","<li>",m()(["Rename elements in the list by clicking on ",'<i data-target=".collection-element .name">the existing name</i>.'].join("")),"</li>","<li>",m()(["Discard elements from the final created list by clicking on the ",'<i data-target=".collection-element .discard">"Discard"</i> button.'].join("")),"</li>","<li>",m()(["Reorder the list by clicking and dragging elements. Select multiple elements by clicking on ",'<i data-target=".collection-element">them</i> and you can then move those selected by dragging the ',"entire group. Deselect them by clicking them again or by clicking the ",'the <i data-target=".clear-selected">"Clear selected"</i> link.'].join("")),"</li>","<li>",m()(['Click the <i data-target=".reset">"Start over"</i> link to begin again as if you had just opened ',"the interface."].join("")),"</li>","<li>",m()(['Click the <i data-target=".cancel-create">"Cancel"</i> button to exit the interface.'].join("")),"</li>","</ul><br />","<p>",m()(['Once your collection is complete, enter a <i data-target=".collection-name">name</i> and ','click <i data-target=".create-collection">"Create list"</i>.'].join("")),"</p>"].join("")),invalidElements:a.a.template([m()("The following selections could not be included due to problems:"),"<ul><% _.each( problems, function( problem ){ %>","<li><b><%- problem.element.name %></b>: <%- problem.text %></li>","<% }); %></ul>"].join("")),noElementsLeft:a.a.template(['<li class="no-elements-left-message">',m()("No elements left! "),m()("Would you like to "),'<a class="reset" href="javascript:void(0)">',m()("start over"),"</a>?","</li>"].join("")),invalidInitial:a.a.template(['<div class="header flex-row no-flex">','<div class="alert alert-warning" style="display: block">','<span class="alert-message">',"<% if( _.size( problems ) ){ %>",m()("The following selections could not be included due to problems"),":","<ul><% _.each( problems, function( problem ){ %>","<li><b><%- problem.element.name %></b>: <%- problem.text %></li>","<% }); %></ul>","<% } else if( _.size( elements ) < 1 ){ %>",m()("No datasets were selected"),".","<% } %>","<br />",m()("At least one element is needed for the collection"),". ",m()("You may need to "),'<a class="cancel-create" href="javascript:void(0)">',m()("cancel"),"</a> ",m()("and reselect new elements"),".","</span>","</div>","</div>",'<div class="footer flex-row no-flex">','<div class="actions clear vertically-spaced">','<div class="other-options float-left">','<button class="cancel-create btn" tabindex="-1">',m()("Cancel"),"</button>","</div>","</div>","</div>"].join(""))}),toString:function(){return"ListCollectionCreator"}}),y=function(t){var e=s.a.Deferred(),i=Object(_.a)().modal||new p.a.View,n=a.a.defaults(t||{},{oncancel:function(){i.hide(),e.reject("cancelled")},oncreate:function(t,n){i.hide(),e.resolve(n)}});return{deferred:e,creatorOptions:n,showEl:function(e){i.show({title:t.title||m()("Create a collection"),body:e,width:"85%",height:"100%",xlarge:!0,closing_events:!0})}}},x=function(t,e,i){e=a.a.defaults(e||{},{elements:t});var n=y(e),o=n.deferred,s=n.creatorOptions,r=n.showEl,l=new i(s);return r(l.$el),l.render(),o},k=function(t,e,n,o){var s;s="datasets"==n?m()("Build Rules for Uploading Datasets"):"collection_contents"==e?m()("Build Rules for Applying to Existing Collection"):"datasets"==e||"library_datasets"==e?m()("Build Rules for Creating Collection(s)"):m()("Build Rules for Uploading Collections"),o=a.a.defaults(o||{},{title:s});var r=y(o),l=r.deferred,c=(r.creatorOptions,r.showEl);return Promise.all([i.e(0),i.e(1),i.e(7),i.e(6)]).then(i.bind(null,270)).then(function(i){var a=g.a.extend(i.default),s=document.createElement("div");return c(s),new a({propsData:{initialElements:t,elementsType:e,importType:n,ftpUploadSite:o.ftpUploadSite,creationFn:o.creationFn,oncancel:o.oncancel,oncreate:o.oncreate,defaultHideSourceItems:o.defaultHideSourceItems,saveRulesFn:o.saveRulesFn,initialRules:o.initialRules}}).$mount(s),l})},C=function(t,e){return(e=e||{}).title=m()("Create a collection from a list of datasets"),x(t,e,w)};e.a={DatasetCollectionElementView:b,ListCollectionCreator:w,collectionCreatorModal:x,listCollectionCreatorModal:C,createListCollection:function(t,e){var i=t.toJSON(),n=!e;return C(i,{defaultHideSourceItems:e,creationFn:function(e,i,a){return e=e.map(function(t){return{id:t.id,name:t.name,src:"dataset"===t.history_content_type?"hda":"hdca"}}),t.createHDCA(e,"list",i,a,n)}})},createCollectionViaRules:function(t,e){var i,n,a,o=t.selectionType,s=!e;if(o)if(t.elements)n=t.selectionType,a=t.dataType||"collections",i=t.elements;else{var r=RegExp(/[^\s]/),l=t.content.split(/[\n\r]/).filter(function(t){return t.length>0&&r.exec(t)}),c=!1;l.length>0&&l[0].indexOf("\t")>=0&&(c=!0);var d=c?/\t/:/\s+/;i=l.map(function(t){return t.split(d)}),n=t.selectionType,a=t.dataType||"collections"}else i=t.toJSON(),n="datasets",a="collections";return k(i,n,a,{ftpUploadSite:t.ftpUploadSite,defaultHideSourceItems:e,creationFn:function(e,i,n,a){return t.createHDCA(e,i,n,a,s)}})},ruleBasedCollectionCreatorModal:k}},29:function(t,e,i){"use strict";var n=i(1),a=i.n(n);e.a={get:function(t,e){e=e||window.location.search.substr(1);var i=new RegExp("".concat(t,"=([^&#$]+)"),"g"),n=e.match(i);if(n&&n.length)return 1===(n=a.a.map(n,function(e){return decodeURIComponent(e.substr(t.length+1).replace(/\+/g," "))})).length?n[0]:n},parse:function(t){if(!t)return{};var e={};return t.split("&").forEach(function(t){var i=t.split("=");e[i[0]]=decodeURI(i[1])}),e}}},31:function(t,e,i){"use strict";i.d(e,"c",function(){return r}),i.d(e,"a",function(){return l}),i.d(e,"d",function(){return c}),i.d(e,"b",function(){return d});var n=i(268),a=i(269);function o(t){return function(t){if(Array.isArray(t)){for(var e=0,i=new Array(t.length);e<t.length;e++)i[e]=t[e];return i}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}var s=new n.a([]),r=s.pipe(Object(a.a)(function(t){return t.length>0})),l=function(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];var n=[].concat(o(s.getValue()),e);s.next(n)},c=function(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];var n=[].concat(e,o(s.getValue()));s.next(n)},d=function(){return s.next([])}},32:function(t,e,i){"use strict";var n=i(0),a=i.n(n),o=i(1),s=i.n(o),r=i(3),l=i.n(r),c=i(21),d=i(5),u=l.a.Model.extend({initialize:function(t){var e=this.get("key");this.set("id",e);var i=s.a.find([{key:"name",label:"Name",type:"text",default_value:""},{key:"color",label:"Color",type:"color",default_value:null},{key:"min_value",label:"Min Value",type:"float",default_value:null},{key:"max_value",label:"Max Value",type:"float",default_value:null},{key:"mode",type:"string",default_value:this.mode,hidden:!0},{key:"height",type:"int",default_value:32,hidden:!0},{key:"pos_color",label:"Positive Color",type:"color",default_value:"#FF8C00"},{key:"neg_color",label:"Negative Color",type:"color",default_value:"#4169E1"},{key:"block_color",label:"Block color",type:"color",default_value:null},{key:"label_color",label:"Label color",type:"color",default_value:"black"},{key:"show_insertions",label:"Show insertions",type:"bool",default_value:!1},{key:"show_counts",label:"Show summary counts",type:"bool",default_value:!0},{key:"reverse_strand_color",label:"Antisense strand color",type:"color",default_value:null},{key:"show_differences",label:"Show differences only",type:"bool",default_value:!0}],function(t){return t.key===e});i&&this.set(s.a.extend({},i,t)),void 0===this.get("value")&&void 0!==this.get("default_value")&&(this.set_value(this.get("default_value")),this.get("value")||"color"!==this.get("type")||this.set("value",c.a.get_random_color()))},set_value:function(t,e){var i=this.get("type");"float"===i?t=parseFloat(t):"int"===i&&(t=parseInt(t,10)),this.set({value:t},e)}}),h=l.a.Collection.extend({model:u,to_key_value_dict:function(){var t={};return this.each(function(e){t[e.get("key")]=e.get("value")}),t},get_value:function(t){var e=this.get(t);if(e)return e.get("value")},set_value:function(t,e,i){var n=this.get(t);if(n)return n.set_value(e,i)},set_default_value:function(t,e){var i=this.get(t);if(i)return i.set("default_value",e)}},{from_models_and_saved_values:function(t,e){return e&&(t=s.a.map(t,function(t){return s.a.extend({},t,{value:e[t.key]})})),new h(t)}}),p=l.a.View.extend({className:"config-settings-view",render:function(){var t=this.$el;return this.collection.each(function(e,i){if(!e.get("hidden")){var n,o="param_".concat(i),r=e.get("type"),l=e.get("value"),d=a()("<div class='form-row' />").appendTo(t);if(d.append(a()("<label />").attr("for",o).text("".concat(e.get("label"),":"))),"bool"===r)d.append(a()('<input type="checkbox" />').attr("id",o).attr("name",o).attr("checked",l));else if("text"===r)d.append(a()('<input type="text"/>').attr("id",o).val(l).click(function(){a()(this).select()}));else if("select"===r){var u=a()("<select />").attr("id",o);s.a.each(e.get("options"),function(t){a()("<option/>").text(t.label).attr("value",t.value).appendTo(u)}),u.val(l),d.append(u)}else if("color"===r){var h=a()("<div/>").appendTo(d),p=a()("<input />").attr("id",o).attr("name",o).val(l).css("float","left").appendTo(h).click(function(t){a()(".tooltip").removeClass("in");var e=a()(this).siblings(".tooltip").addClass("in");e.css({left:a()(this).position().left+a()(this).width()+5,top:a()(this).position().top-a()(e).height()/2+a()(this).height()/2}).show(),e.click(function(t){t.stopPropagation()}),a()(document).bind("click.color-picker",function(){e.hide(),a()(document).unbind("click.color-picker")}),t.stopPropagation()}),f=a()("<a href='javascript:void(0)'/>").addClass("icon-button arrow-circle").appendTo(h).attr("title","Set new random color").tooltip(),m=a()("<div class='tooltip right' style='position: absolute;' />").appendTo(h).hide(),g=a()("<div class='tooltip-inner' style='text-align: inherit'></div>").appendTo(m);a()("<div class='tooltip-arrow'></div>").appendTo(m);var _=a.a.farbtastic(g,{width:100,height:100,callback:p,color:l});h.append(a()("<div/>").css("clear","both")),n=_,f.click(function(){n.setColor(c.a.get_random_color())})}else d.append(a()("<input />").attr("id",o).attr("name",o).val(l));e.help&&d.append(a()("<div class='help'/>").text(e.help))}}),this},render_in_modal:function(t){var e=this,i=Object(d.a)(),n=function(){i.modal.hide(),a()(window).unbind("keypress.check_enter_esc")},o=function(){i.modal.hide(),a()(window).unbind("keypress.check_enter_esc"),e.update_from_form()};a()(window).bind("keypress.check_enter_esc",function(t){27===(t.keyCode||t.which)?n():13===(t.keyCode||t.which)&&o()}),0===this.$el.children().length&&this.render(),i.modal.show({title:t||"Configure",body:this.$el,buttons:{Cancel:n,OK:o}})},update_from_form:function(){var t=this;this.collection.each(function(e,i){if(!e.get("hidden")){var n="param_".concat(i),a=t.$el.find("#".concat(n)).val();"bool"===e.get("type")&&(a=t.$el.find("#".concat(n)).is(":checked")),e.set_value(a)}})}});e.a={ConfigSetting:u,ConfigSettingCollection:h,ConfigSettingCollectionView:p}},33:function(t,e,i){"use strict";var n=i(3),a=i.n(n),o=i(1),s=i.n(o),r=i(0),l=i.n(r),c=i(5),d=i(8),u=a.a.Model.extend({defaults:{url_base:"",title_id:void 0,async:!1,async_ops:[],categorical_filters:[],filters:{},sort_key:null,show_item_checkboxes:!1,advanced_search:!1,cur_page:1,num_pages:1,operation:void 0,item_ids:void 0},add_filter:function(t,e,i){if(i){var n,a=this.attributes.filters[t];if(null==a)n=e;else if("string"==typeof a)if("All"==a||a==e)n=e;else{var o=[];o[0]=a,o[1]=e,n=o}else-1===(n=a).indexOf(e)&&n.push(e);this.attributes.filters[t]=n}else this.attributes.filters[t]=e},remove_filter:function(t,e){var i=this.attributes.filters[t];if(null==i)return!1;if("string"==typeof i)this.attributes.filters[t]="";else{var n=s.a.indexOf(i,e);-1!==n&&(i[n]="")}},get_url_data:function(){var t={async:this.attributes.async,sort:this.attributes.sort_key,page:this.attributes.cur_page,show_item_checkboxes:this.attributes.show_item_checkboxes,advanced_search:this.attributes.advanced_search};this.attributes.operation&&(t.operation=this.attributes.operation),this.attributes.item_ids&&(t.id=this.attributes.item_ids);return s.a.each(s.a.pairs(this.attributes.filters),function(e){t["f-".concat(e[0])]=e[1]}),t},get_url:function(t){return"".concat(this.get("url_base"),"?").concat(l.a.param(this.get_url_data()),"&").concat(l.a.param(t))}}),h={grid:function(t){var e;return e=t.embedded?this.grid_header(t)+this.grid_table(t):'\n                <div class="loading-elt-overlay"></div>\n                <table class="grid-table">\n                    <tr>\n                        <td width="75%">'.concat(this.grid_header(t),'</td>\n                        <td></td>\n                        <td></td>\n                    </tr>\n                    <tr>\n                        <td width="100%" id="grid-message" valign="top"></td>\n                        <td></td>\n                        <td></td>\n                    </tr>\n                </table>\n                ').concat(this.grid_table(t),"\n            "),t.info_text&&(e+='<br><div class="toolParamHelp" style="clear: both;">'.concat(t.info_text,"</div>")),e},grid_table:function(){return'\n            <form method="post" onsubmit="return false;">\n                <table id="grid-table" class="grid">\n                    <thead id="grid-table-header"></thead>\n                    <tbody id="grid-table-body"></tbody>\n                    <tfoot id="grid-table-footer"></tfoot>\n                </table>\n            </form>'},grid_header:function(t){var e='<div class="grid-header">';if(!t.embedded){var i="";t.title_id&&(i+=' id="'.concat(t.title_id,'"')),e+="<h2".concat(i,">").concat(t.title,"</h2>")}if(t.global_actions){e+='<ul class="manage-table-actions">';var n=t.global_actions.length>=3;n&&(e+='<li><a class="action-button" id="popup-global-actions" class="menubutton">Actions</a></li><div popupmenu="popup-global-actions">');var a=!0,o=!1,s=void 0;try{for(var r,l=t.global_actions[Symbol.iterator]();!(a=(r=l.next()).done);a=!0){var c=r.value;e+='<li><a class="action-button use-target" target="'.concat(c.target,'" href="').concat(c.url_args,'" onclick="return false;" >').concat(c.label,"</a></li>")}}catch(t){o=!0,s=t}finally{try{a||null==l.return||l.return()}finally{if(o)throw s}}n&&(e+="</div>"),e+="</ul>"}return t.insert&&(e+=t.insert),e+=this.grid_filters(t),e+="</div>"},header:function(t){var e="<tr>";t.show_item_checkboxes&&(e+="<th>",t.items.length>0&&(e+='<input type="checkbox" id="check_all" name=select_all_checkbox value="true"><input type="hidden" name=select_all_checkbox value="true">'),e+="</th>");var i=!0,n=!1,a=void 0;try{for(var o,s=t.columns[Symbol.iterator]();!(i=(o=s.next()).done);i=!0){var r=o.value;r.visible&&(e+='<th id="'.concat(r.key,'-header">'),r.sortable?e+='<a href="javascript:void(0)" class="sort-link" sort_key="'.concat(r.key,'">').concat(r.label,"</a>"):e+=r.label,e+='<span class="sort-arrow">'.concat(r.extra,"</span></th>"))}}catch(t){n=!0,a=t}finally{try{i||null==s.return||s.return()}finally{if(n)throw a}}return e+="</tr>"},body:function(t){var e="";0===t.items.length&&(e+='<tr><td colspan="100"><em>No Items</em></td></tr>');var i=!0,n=!1,a=void 0;try{for(var o,s=t.items[Symbol.iterator]();!(i=(o=s.next()).done);i=!0){var r=o.value;e+="<tr ",t.current_item_id==r.id&&(e+='class="current"'),e+=">",t.show_item_checkboxes&&(e+='<td style="width: 1.5em;"><input type="checkbox" name="id" value="'.concat(r.encode_id,'" id="').concat(r.encode_id,'" class="grid-row-select-checkbox" /></td>'));var c=!0,d=!1,u=void 0;try{for(var h,p=t.columns[Symbol.iterator]();!(c=(h=p.next()).done);c=!0){var f=h.value;if(f.visible){var m="";f.nowrap&&(m='style="white-space:nowrap;"');var g=r.column_config[f.label],_=g.link,v=g.value,b=g.target;"string"===l.a.type(v)&&(v=v.replace(/\/\//g,"/"));var w="";f.attach_popup&&(w="grid-".concat(r.encode_id,"-popup")),e+="<td ".concat(m,">"),f.delayed?e+='<div class="delayed-value-'.concat(f.key,'" data-id="').concat(r.encode_id,'" data-value="').concat(v,'"><span class="fa fa-spinner fa-spin"></span></div>'):f.attach_popup&&_?e+='<div class="btn-group">\n                                    <button class="btn btn-secondary use-target" target="'.concat(b,'" href="').concat(_,'" onclick="return false;">').concat(v,'</button>\n                                    <button id="').concat(w,'" class="btn btn-secondary dropdown-toggle dropdown-toggle-split" data-toggle="dropdown"/>\n                                </div>'):f.attach_popup?e+='<button id="'.concat(w,'" class="btn dropdown-toggle" data-toggle="dropdown">').concat(v,"</button>"):e+=_?'<a class="use-target" target="'.concat(b,'" href="').concat(_,'" onclick="return false;">').concat(v,"</a>"):"<label>".concat(v||"","</label>"),e+="</td>"}}}catch(t){d=!0,u=t}finally{try{c||null==p.return||p.return()}finally{if(d)throw u}}e+="</tr>"}}catch(t){n=!0,a=t}finally{try{i||null==s.return||s.return()}finally{if(n)throw a}}return e},footer:function(t){var e="";if(t.use_paging&&t.num_pages>1){var i=t.num_page_links,n=t.cur_page_num,a=t.num_pages,o=i/2,s=n-o,r=0;s<=0&&(r=o-(n-(s=1)));var l,c=o+r,d=n+c;0!==(l=d<=a?0:c-((d=a)+1-n))&&(s-=l)<1&&(s=1),e+='<tr id="page-links-row">',t.show_item_checkboxes&&(e+="<td></td>"),e+='<td colspan="100"><span id="page-link-container">Page:',s>1&&(e+='<span class="page-link-grid" id="page-link-1"><a href="javascript:void(0);" page_num="1" onclick="return false;">1</a></span> ...');for(var u=s;u<d+1;u++)u==t.cur_page_num?e+='<span class="page-link-grid inactive-link" id="page-link-'.concat(u,'">').concat(u,"</span>"):e+='<span class="page-link-grid" id="page-link-'.concat(u,'"><a href="javascript:void(0);" onclick="return false;" page_num="').concat(u,'">').concat(u,"</a></span>");d<a&&(e+='...<span class="page-link-grid" id="page-link-'.concat(a,'"><a href="javascript:void(0);" onclick="return false;" page_num="').concat(a,'">').concat(a,"</a></span>")),e+="</span>",e+='\n                    <span class="page-link-grid" id="show-all-link-span"> | <a href="javascript:void(0);" onclick="return false;" page_num="all">Show All</a></span>\n                    </td>\n                </tr>'}if(t.show_item_checkboxes){e+='\n                <tr>\n                    <input type="hidden" id="operation" name="operation" value="">\n                    <td></td>\n                    <td colspan="100">\n                        For <span class="grid-selected-count"></span> selected items: \n            ';var h=!0,p=!1,f=void 0;try{for(var m,g=t.operations[Symbol.iterator]();!(h=(m=g.next()).done);h=!0){var _=m.value;_.allow_multiple&&(e+='<input type="button" value="'.concat(_.label,'" class="operation-button action-button">&nbsp;'))}}catch(t){p=!0,f=t}finally{try{h||null==g.return||g.return()}finally{if(p)throw f}}e+="</td></tr>"}var v=!1,b=!0,w=!1,y=void 0;try{for(var x,k=t.operations[Symbol.iterator]();!(b=(x=k.next()).done);b=!0){if(x.value.global_operation){v=!0;break}}}catch(t){w=!0,y=t}finally{try{b||null==k.return||k.return()}finally{if(w)throw y}}if(v){e+='<tr><td colspan="100">';var C=!0,S=!1,T=void 0;try{for(var $,O=t.operations[Symbol.iterator]();!(C=($=O.next()).done);C=!0){var A=$.value;A.global_operation&&(e+='<a class="action-button" href="'.concat(A.global_operation,'">').concat(A.label,"</a>"))}}catch(t){S=!0,T=t}finally{try{C||null==O.return||O.return()}finally{if(S)throw T}}e+="</td></tr>"}return t.legend&&(e+='<tr><td colspan="100">'.concat(t.legend,"</td></tr>")),e},message:function(t){var e=t.status;return-1!=["success","ok"].indexOf(e)&&(e="done"),'<p><div class="'.concat(e,'message transient-message">').concat(s.a.escape(t.message),'</div><div style="clear: both"></div></p>')},grid_filters:function(t){var e=t.default_filter_dict,i=t.filters,n="none";t.advanced_search&&(n="block");var a=!1,o=!0,s=!1,r=void 0;try{for(var l,c=t.columns[Symbol.iterator]();!(o=(l=c.next()).done);o=!0){var d=l.value;if("advanced"==d.filterable){var u=d.key,h=i[u],p=e[u];h&&p&&h!=p&&(n="block"),a=!0}}}catch(t){s=!0,r=t}finally{try{o||null==c.return||c.return()}finally{if(s)throw r}}var f="block";"block"==n&&(f="none");var m='<div id="standard-search" style="display: '.concat(f,';"><table><tr><td style="padding: 0;"><table>'),g=!0,_=!1,v=void 0;try{for(var b,w=t.columns[Symbol.iterator]();!(g=(b=w.next()).done);g=!0){var y=b.value;"standard"==y.filterable&&(m+=this.grid_column_filter(t,y))}}catch(t){_=!0,v=t}finally{try{g||null==w.return||w.return()}finally{if(_)throw v}}m+="</table></td></tr><tr><td>",a&&(m+='<a href="" class="advanced-search-toggle">Advanced Search</a>'),m+="</td></tr></table></div>",m+='<div id="advanced-search" style="display: '.concat(n,'; margin-top: 5px;"><table><tr><td style="text-align: left" colspan="100"><a href="" class="advanced-search-toggle">Close Advanced Search</a></td></tr>');var x=!0,k=!1,C=void 0;try{for(var S,T=t.columns[Symbol.iterator]();!(x=(S=T.next()).done);x=!0){var $=S.value;"advanced"==$.filterable&&(m+=this.grid_column_filter(t,$))}}catch(t){k=!0,C=t}finally{try{x||null==T.return||T.return()}finally{if(k)throw C}}return m+="</table></div>"},grid_column_filter:function(t,e){var i=t.filters,n=e.label,a=e.key;"advanced"==e.filterable&&(n=n.toLowerCase());var o="<tr>";if("advanced"==e.filterable&&(o+='<td align="left" style="padding-left: 10px">'.concat(n,":</td>")),o+='<td style="padding-bottom: 1px;">',e.is_text){o+='<form class="text-filter-form" column_key="'.concat(a,'" action="').concat(t.url,'" method="get" >');var s=!0,r=!1,c=void 0;try{for(var d,u=t.columns[Symbol.iterator]();!(s=(d=u.next()).done);s=!0){var h=d.value,p=i[h.key];p&&"All"!=p&&(h.is_text&&(p=JSON.stringify(p)),o+='<input type="hidden" id="'.concat(h.key,'" name="f-').concat(h.key,'" value="').concat(p,'"/>'))}}catch(t){r=!0,c=t}finally{try{s||null==u.return||u.return()}finally{if(r)throw c}}o+='<span id="'.concat(a,'-filtering-criteria">');var f=i[a];if(f){var m=l.a.type(f);if("string"==m&&"All"!=f&&(o+=this.filter_element(a,f)),"array"==m)for(var g in f){f.slice(g),o+=this.filter_element(a,f[g])}}o+="</span>";var _="",v=20;"standard"==e.filterable&&((_=e.label.toLowerCase()).length<20&&(v=_.length),v+=4),o+='\n                <span class="search-box">\n                    <input class="search-box-input" id="input-'.concat(a,'-filter" name="f-').concat(a,'" type="text" placeholder="').concat(_,'" size="').concat(v,'"/>\n                    <button type="submit" style="background: transparent; border: none; padding: 4px; margin: 0px;">\n                        <i class="fa fa-search"></i>\n                    </button>\n                </span>\n            </form>')}else{o+='<span id="'.concat(a,'-filtering-criteria">');var b=!1;for(var w in t.categorical_filters[a]){var y=t.categorical_filters[a][w],x="",k="";for(var C in y)x=C,k=y[C];b&&(o+=" | "),b=!0;var S=i[a];S&&y[a]&&S==k?o+='<span class="categorical-filter '.concat(a,'-filter current-filter">').concat(w,"</span>"):o+='<span class="categorical-filter '.concat(a,'-filter"><a href="javascript:void(0);" filter_key="').concat(x,'" filter_val="').concat(k,'">').concat(w,"</a></span>")}o+="</span>"}return o+="</td></tr>"},filter_element:function(t,e){return e=d.a.sanitize(e),'<span class="text-filter-val">'.concat(e,'<a href="javascript:void(0);" filter_key="').concat(t,'" filter_val="').concat(e,'"><i class="fa fa-times" style="padding-left: 5px; padding-bottom: 6px;"/></a></span>')}},p=i(89),f=i(77),m=i(69),g=i(84),_=i(171),v=i.n(_);l.a.ajaxSettings.traditional=!0;e.a=a.a.View.extend({grid:null,initialize:function(t){this.grid=new u,this.title=t.title,this.active_tab=t.active_tab;var e=this;if(g.a.watch(function(t){return t.gridSearch.searchTags},function(t){var i=Array.from(t);e.grid.add_filter("tags",i,!1),e.openAdvancedSearch(),e.render_filter_button("tags",i),e.go_page_one(),e.execute()}),t.url_base&&!t.items){f.a.markViewAsLoading(this);var i=t.url_data||{};s.a.each(t.filters,function(t,e){i["f-".concat(e)]=t}),l.a.ajax({url:"".concat(t.url_base,"?").concat(l.a.param(i)),success:function(i){i.embedded=t.embedded,i.filters=t.filters||{},e.init_grid(i)}})}else this.setElement("<div>"),this.init_grid(t);t.use_panels&&l()("#center").css({padding:"10px",overflow:"auto"})},openAdvancedSearch:function(){l()("#advanced-search").is(":visible")||(l()("#standard-search").slideToggle("fast"),l()("#advanced-search").slideToggle("fast"))},handle_refresh:function(t){if(t&&l.a.inArray("history",t)>-1){var e=Object(c.a)();e&&e.currHistoryPanel&&e.currHistoryPanel.loadCurrentHistory()}},init_grid:function(t){this.grid.set(t);var e=this.grid.attributes;this.allow_title_display&&e.title&&d.a.setWindowTitle(e.title),this.handle_refresh(e.refresh_frames);var i=this.grid.get("url_base");if(i=i.replace(/^.*\/\/[^\/]+/,""),this.grid.set("url_base",i),this.$el.html(h.grid(e)),this.$el.addClass(this.getRootClassName(t)),this.$el.find("#grid-table-header").html(h.header(e)),this.$el.find("#grid-table-body").html(h.body(e)),this.$el.find("#grid-table-footer").html(h.footer(e)),e.message){this.$el.find("#grid-message").html(h.message(e));var n=this;e.use_hide_message&&window.setTimeout(function(){n.$el.find("#grid-message").html("")},5e3)}this.init_grid_elements(),this.init_grid_controls(),Object(m.a)()},init_grid_controls:function(){var t=this;this.$el.find(".operation-button").each(function(){l()(this).off(),l()(this).click(function(){return t.submit_operation(this),!1})}),this.$el.find("input[type=text]").each(function(){l()(this).off(),l()(this).click(function(){l()(this).select()}).keyup(function(){l()(this).css("font-style","normal")})}),this.$el.find(".sort-link").each(function(){l()(this).off(),l()(this).click(function(){return t.set_sort_condition(l()(this).attr("sort_key")),!1})}),this.$el.find(".text-filter-form").each(function(){l()(this).off(),l()(this).submit(function(){var e=l()(this).attr("column_key"),i=l()("#input-".concat(e,"-filter")),n=i.val();return i.val(""),t.add_filter_condition(e,n),!1})}),this.$el.find(".text-filter-val > a").each(function(){l()(this).off(),l()(this).click(function(){return l()(this).parent().remove(),t.remove_filter_condition(l()(this).attr("filter_key"),l()(this).attr("filter_val")),!1})}),this.$el.find(".categorical-filter > a").each(function(){l()(this).off(),l()(this).click(function(){return t.set_categorical_filter(l()(this).attr("filter_key"),l()(this).attr("filter_val")),!1})}),this.$el.find(".advanced-search-toggle").each(function(){l()(this).off(),l()(this).click(function(){return t.$el.find("#standard-search").slideToggle("fast"),t.$el.find("#advanced-search").slideToggle("fast"),!1})}),this.$el.find("#check_all").off(),this.$el.find("#check_all").on("click",function(){t.check_all_items()})},init_grid_elements:function(){this.$el.find(".grid").each(function(){var t=l()(this).find("input.grid-row-select-checkbox"),e=l()(this).find("span.grid-selected-count"),i=function(){e.text(l()(t).filter(":checked").length)};l()(t).each(function(){l()(this).change(i)}),i()}),0!==this.$el.find(".community_rating_star").length&&this.$el.find(".community_rating_star").rating({});var t=this.grid.attributes,e=this;this.$el.find(".page-link-grid > a").each(function(){l()(this).click(function(){return e.set_page(l()(this).attr("page_num")),!1})}),this.$el.find(".use-target").each(function(){l()(this).click(function(){return e.execute({href:l()(this).attr("href"),target:l()(this).attr("target")}),!1})}),0!==t.items.length&&s.a.each(t.items,function(i,n){var a=e.$("#grid-".concat(i.encode_id,"-popup")).off(),o=new p.a(a);s.a.each(t.operations,function(t){e.add_operation(o,t,i)})})},add_operation:function(t,e,i){var n=this,a=i.operation_config[e.label];a.allowed&&e.allow_popup&&t.addItem({html:e.label,href:a.url_args,target:a.target,confirmation_text:e.confirm,func:function(t){t.preventDefault();var a=l()(t.target).html();e.onclick?e.onclick(i.encode_id):n.execute(this.findItemByHtml(a))}})},add_filter_condition:function(t,e){if(""===e)return!1;this.grid.add_filter(t,e,!0),this.render_filter_button(t,e),this.go_page_one(),this.execute()},render_filter_button:function(t,e){var i=l()(h.filter_element(t,e)),n=this;i.click(function(){l()(this).remove(),n.remove_filter_condition(t,e)}),this.$el.find("#".concat(t,"-filtering-criteria")).append(i)},remove_filter_condition:function(t,e){this.grid.remove_filter(t,e),"tags"==t&&g.a.dispatch("removeSearchTag",{text:e}),this.go_page_one(),this.execute()},set_sort_condition:function(t){var e=this.grid.get("sort_key"),i=t;-1!==e.indexOf(t)&&"-"!==e.substring(0,1)&&(i="-".concat(t)),this.$el.find(".sort-arrow").remove();var n="-"==i.substring(0,1)?"&uarr;":"&darr;",a=l()("<span>".concat(n,"</span>")).addClass("sort-arrow");this.$el.find("#".concat(t,"-header")).append(a),this.grid.set("sort_key",i),this.go_page_one(),this.execute()},set_categorical_filter:function(t,e){var i=this.grid.get("categorical_filters")[t],n=this.grid.get("filters")[t],a=this;this.$el.find(".".concat(t,"-filter")).each(function(){var o=l.a.trim(l()(this).text()),s=i[o][t];if(s==e)l()(this).empty(),l()(this).addClass("current-filter"),l()(this).append(o);else if(s==n){l()(this).empty();var r=l()('<a href="#">'.concat(o,"</a>"));r.click(function(){a.set_categorical_filter(t,s)}),l()(this).removeClass("current-filter"),l()(this).append(r)}}),this.grid.add_filter(t,e),this.go_page_one(),this.execute()},set_page:function(t){var e=this;this.$el.find(".page-link").each(function(){var i,n=l()(this).attr("id"),a=parseInt(n.split("-")[2],10),o=e.grid.get("cur_page");if(a===t)i=l()(this).children().text(),l()(this).empty(),l()(this).addClass("inactive-link"),l()(this).text(i);else if(a===o){i=l()(this).text(),l()(this).empty(),l()(this).removeClass("inactive-link");var s=l()('<a href="#">'.concat(i,"</a>"));s.click(function(){e.set_page(a)}),l()(this).append(s)}}),"all"===t?this.grid.set("cur_page",t):this.grid.set("cur_page",parseInt(t,10)),this.execute()},submit_operation:function(t,e){var i=l()(t).val();if(this.$el.find('input[name="id"]:checked').length<1)return!1;var n=s.a.findWhere(this.grid.attributes.operations,{label:i});n&&!e&&(e=n.confirm||"");var a=[];this.$el.find("input[name=id]:checked").each(function(){a.push(l()(this).val())});var o={operation:i,id:a,confirmation_text:e};return"top"!=n.target&&"center"!=n.target||(o=s.a.extend(o,{href:n.href,target:n.target})),this.execute(o),!0},check_all_items:function(){var t=this.$(".grid-row-select-checkbox"),e=this.$("#check_all").prop("checked");s.a.each(t,function(t){l()(t).prop("checked",e)}),this.init_grid_elements()},go_page_one:function(){var t=this.grid.get("cur_page");null!=t&&"all"!==t&&this.grid.set("cur_page",1)},execute:function(t){var e=null,i=null,n=null,a=null,o=null;if(t&&(i=t.href,n=t.operation,e=t.id,a=t.confirmation_text,o=t.target,void 0!==i&&-1!=i.indexOf("operation="))){var s=i.split("?");if(s.length>1)for(var r=s[1].split("&"),c=0;c<r.length;c++)-1!=r[c].indexOf("operation")?n=(n=r[c].split("=")[1]).replace(/\+/g," "):-1!=r[c].indexOf("id")&&(e=r[c].split("=")[1])}return n&&e?!(a&&""!==a&&"None"!=a&&"null"!=a&&!window.confirm(a))&&(n=n.toLowerCase(),this.grid.set({operation:n,item_ids:e}),"top"==o?window.top.location="".concat(i,"?").concat(l.a.param(this.grid.get_url_data())):"center"==o?l()("#galaxy_main").attr("src","".concat(i,"?").concat(l.a.param(this.grid.get_url_data()))):this.update_grid(),!1):i?(this.go_to(o,i),!1):(this.update_grid(),!1)},go_to:function(t,e){var i=this.$el.find("#advanced-search").is(":visible");switch(this.grid.set("advanced_search",i),e||(e="".concat(this.grid.get("url_base"),"?").concat(l.a.param(this.grid.get_url_data()))),this.grid.set({operation:void 0,item_ids:void 0}),t){case"center":l()("#galaxy_main").attr("src",e);break;case"top":window.top.location=e;break;default:window.location=e}},update_grid:function(){var t=this.grid.get("operation")?"POST":"GET";this.$el.find(".loading-elt-overlay").show();var e=this;l.a.ajax({type:t,url:e.grid.get("url_base"),data:e.grid.get_url_data(),error:function(){alert("Grid refresh failed")},success:function(t){var i=e.grid.get("embedded"),n=e.grid.get("insert"),a=e.$el.find("#advanced-search").is(":visible"),o=t;o.embedded=i,o.insert=n,o.advanced_search=a,e.init_grid(o),e.$el.find(".loading-elt-overlay").hide()},complete:function(){e.grid.set({operation:void 0,item_ids:void 0})}})},getRootClassName:function(t){var e=t.title,i=void 0===e?"grid":e;return v()(i).toLowerCase()}})},34:function(t,e,i){"use strict";var n=i(1),a=i.n(n),o=i(0),s=i.n(o),r=i(2),l=i.n(r),c=i(5),d=l()("Please contact a Galaxy administrator if the problem persists."),u=l()("An error occurred while updating information with the server."),h=l()("The following information can assist the developers in finding the source of the error:");function p(t,e,i){if(t){var n=Object(c.a)();if(t=l()(t),e=l()(e)||l()("Error:"),n&&n.modal)return function(t,e,i){var n=Object(c.a)();return n.modal.show({title:e,body:t,closing_events:!0,buttons:{Ok:function(){n.modal.hide()}}}),n.modal.$el.addClass("error-modal"),i&&(n.modal.$(".error-details").add(n.modal.$('button:contains("Details")')).remove(),s()("<div/>").addClass("error-details").hide().appendTo(n.modal.$(".modal-content")).append([s()("<p/>").text(h),s()("<pre/>").text(JSON.stringify(i,null,"  "))]),s()('<button id="button-1" class="float-left">'.concat(l()("Details"),"</button>")).appendTo(n.modal.$(".buttons")).click(function(){n.modal.$(".error-details").toggle()})),n.modal}(t,e,i);alert("".concat(e,"\n\n").concat(t)),console.log("error details:",JSON.stringify(i))}}e.a={errorModal:p,offlineErrorModal:function(){return p(l()("You appear to be offline. Please check your connection and try again."),l()("Offline?"))},badGatewayErrorModal:function(){return p("".concat(l()("Galaxy is currently unreachable. Please try again in a few minutes.")," ").concat(d),l()("Cannot connect to Galaxy"))},ajaxErrorModal:function(t,e,i,n,o){return n=n||u,p(n+=" ".concat(d),o=o||l()("An error occurred"),function(t,e,i){var n=Object(c.a)();return{raven:a.a.result(window.Raven,"lastEventId"),userAgent:navigator.userAgent,onLine:navigator.onLine,version:a.a.result(n.config,"version_major"),xhr:a.a.omit(e,a.a.functions(e)),options:a.a.omit(i,"xhr"),url:a.a.result(n.lastAjax,"url"),data:a.a.result(n.lastAjax,"data"),model:a.a.result(t,"toJSON","".concat(t)),user:a.a.omit(a.a.result(n.user,"toJSON"),"email")}}(t,e,i))}}},36:function(t,e,i){"use strict";function n(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:window.location.href;return new URL(t).pathname}i.d(e,"a",function(){return n})},37:function(t,e,i){"use strict";var n,a,o,s=i(1),r=i.n(s),l=i(0),c=i.n(l),d=i(25),u=i(42),h=i(7),p=i(2),f=i.n(p),m=d.a.extend({className:"".concat(d.a.prototype.className," dataset-collection"),id:function(){return["dataset_collection",this.model.get("id")].join("-")},initialize:function(t){this.linkTarget=t.linkTarget||"_blank",this.hasUser=t.hasUser,d.a.prototype.initialize.call(this,t)},_setUpListeners:function(){d.a.prototype._setUpListeners.call(this),this.listenTo(this.model,"change",function(t,e){r.a.has(t.changed,"deleted")?this.render():r.a.has(t.changed,"element_count")&&this.$("> .title-bar .subtitle").replaceWith(this._renderSubtitle())})},_renderSubtitle:function(){return c()(this.templates.subtitle(this.model.toJSON(),this))},_getFoldoutPanelOptions:function(){var t=d.a.prototype._getFoldoutPanelOptions.call(this);return r.a.extend(t,{linkTarget:this.linkTarget,hasUser:this.hasUser})},$selector:function(){return this.$("> .selector")},toString:function(){var t=this.model?"".concat(this.model):"(no model)";return"DCListItemView(".concat(t,")")}});m.prototype.templates=(n=r.a.extend({},d.a.prototype.templates.warnings,{error:h.a.wrapTemplate(["<% if( model.error ){ %>",'<div class="errormessagesmall">',f()("There was an error getting the data for this collection"),": <%- model.error %>","</div>","<% } %>"]),purged:h.a.wrapTemplate(["<% if( model.purged ){ %>",'<div class="purged-msg warningmessagesmall">',f()("This collection has been deleted and removed from disk"),"</div>","<% } %>"]),deleted:h.a.wrapTemplate(["<% if( model.deleted && !model.purged ){ %>",'<div class="deleted-msg warningmessagesmall">',f()("This collection has been deleted"),"</div>","<% } %>"])}),a=h.a.wrapTemplate(['<div class="title-bar clear" tabindex="0">','<div class="title">','<span class="name"><%- collection.element_identifier || collection.name %></span>',"</div>",'<div class="subtitle"></div>',"</div>"],"collection"),o=h.a.wrapTemplate(['<div class="subtitle">','<% var countText = collection.element_count? ( collection.element_count + " " ) : ""; %>','<%        if( collection.collection_type === "list" ){ %>',f()("a list of <%- countText %>datasets"),'<% } else if( collection.collection_type === "paired" ){ %>',f()("a pair of datasets"),'<% } else if( collection.collection_type === "list:paired" ){ %>',f()("a list of <%- countText %>dataset pairs"),'<% } else if( collection.collection_type === "list:list" ){ %>',f()("a list of <%- countText %>dataset lists"),"<% } %>","</div>"],"collection"),r.a.extend({},d.a.prototype.templates,{warnings:n,titleBar:a,subtitle:o}));var g=d.b.extend({className:"".concat(d.b.prototype.className," dataset-collection-element"),initialize:function(t){t.logger&&(this.logger=this.model.logger=t.logger),this.log("DCEListItemView.initialize:",t),d.b.prototype.initialize.call(this,t)},toString:function(){var t=this.model?"".concat(this.model):"(no model)";return"DCEListItemView(".concat(t,")")}});g.prototype.templates=function(){var t=h.a.wrapTemplate(['<div class="title-bar clear" tabindex="0">','<div class="title">','<span class="name"><%- element.element_identifier %></span>',"</div>",'<div class="subtitle"></div>',"</div>"],"element");return r.a.extend({},d.b.prototype.templates,{titleBar:t})}();var _=u.a.extend({className:"".concat(u.a.prototype.className," dataset-collection-element"),initialize:function(t){t.logger&&(this.logger=this.model.logger=t.logger),this.log("DatasetDCEListItemView.initialize:",t),u.a.prototype.initialize.call(this,t)},_fetchModelDetails:function(){return this.model.inReadyState()&&!this.model.hasDetails()?this.model.fetch({silent:!0}):c.a.when()},toString:function(){var t=this.model?"".concat(this.model):"(no model)";return"DatasetDCEListItemView(".concat(t,")")}});_.prototype.templates=function(){var t=h.a.wrapTemplate(['<div class="title-bar clear" tabindex="0">','<span class="state-icon"></span>','<div class="title">','<span class="name"><%- element.element_identifier %></span>',"</div>","</div>"],"element");return r.a.extend({},u.a.prototype.templates,{titleBar:t})}();var v=m.extend({className:"".concat(m.prototype.className," dataset-collection-element"),_swapNewRender:function(t){m.prototype._swapNewRender.call(this,t);var e=this.model.get("state")||"ok";return this.$el.addClass("state-".concat(e)),this.$el},toString:function(){var t=this.model?"".concat(this.model):"(no model)";return"NestedDCDCEListItemView(".concat(t,")")}});e.a={DCListItemView:m,DCEListItemView:g,DatasetDCEListItemView:_,NestedDCDCEListItemView:v}},39:function(t,e,i){"use strict";i.d(e,"a",function(){return _}),i.d(e,"b",function(){return b});var n=i(1),a=i.n(n),o=i(0),s=i.n(o),r=i(3),l=i.n(r),c=i(5),d=i(4),u=i(65),h=i(104),p=i(8),f=i(7),m=i(2),g=i.n(m),_=l.a.Model.extend(f.a.LoggableMixin).extend(f.a.mixin(f.a.SearchableModelMixin,{_logNamespace:"history",UPDATE_DELAY:4e3,defaults:{model_class:"History",id:null,name:"Unnamed History",state:"new",deleted:!1,contents_active:{},contents_states:{}},contentsClass:u.a,searchAttributes:["name","annotation","tags"],searchAliases:{title:"name",tag:"tags"},initialize:function(t,e){e=e||{},this.logger=e.logger||null,this.log("".concat(this,".initialize:"),t,e),this.urlRoot="".concat(Object(d.getAppRoot)(),"api/histories"),this.contents=new this.contentsClass([],{history:this,historyId:this.get("id"),order:e.order}),this._setUpListeners(),this._setUpCollectionListeners(),this.updateTimeoutId=null},_setUpListeners:function(){return this.on({error:function(t,e,i,n,a){this.clearUpdateTimeout()},"change:id":function(t,e){this.contents&&(this.contents.historyId=e)}})},_setUpCollectionListeners:function(){return this.contents?this.listenTo(this.contents,{error:function(){this.trigger.apply(this,s.a.makeArray(arguments))}}):this},contentsShown:function(){var t=this.get("contents_active"),e=t.active||0;return e+=this.contents.includeDeleted?t.deleted:0,e+=this.contents.includeHidden?t.hidden:0},nice_size:function(){var t=this.get("size");return t?p.a.bytesToString(t,!0,2):g()("(empty)")},toJSON:function(){return a.a.extend(l.a.Model.prototype.toJSON.call(this),{nice_size:this.nice_size()})},get:function(t){return"nice_size"===t?this.nice_size():l.a.Model.prototype.get.apply(this,arguments)},ownedByCurrUser:function(){var t=Object(c.a)();return!(!t||!t.user)&&(!t.user.isAnonymous()&&t.user.id===this.get("user_id"))},numOfUnfinishedJobs:function(){var t=this.get("non_ready_jobs");return t?t.length:0},numOfUnfinishedShownContents:function(){return this.contents.runningAndActive().length||0},_fetchContentRelatedAttributes:function(){return this.fetch({data:s.a.param({keys:["size","non_ready_jobs","contents_active","hid_counter"].join(",")})})},refresh:function(t){var e=this;t=t||{};var i=this.lastUpdateTime;return this.contents.allFetched=!1,(0!==this.contents.currentPage?function(){return e.contents.fetchPage(e.contents.currentPage)}:function(){return e.contents.fetchUpdated(i)})().done(function(i,n,a){var o;try{o=new Date(a.getResponseHeader("Date"))}catch(t){console.error(t)}e.lastUpdateTime=o||new Date,e.checkForUpdates(t)})},checkForUpdates:function(t){var e=this;t=t||{};var i=this.UPDATE_DELAY;if(this.id){var n=function(){e.clearUpdateTimeout(),e.updateTimeoutId=setTimeout(function(){e.refresh(t)},i)};this.numOfUnfinishedShownContents()>0?n():this._fetchContentRelatedAttributes().done(function(t){e.numOfUnfinishedJobs()>0?n():e.trigger("ready")})}},clearUpdateTimeout:function(){this.updateTimeoutId&&(clearTimeout(this.updateTimeoutId),this.updateTimeoutId=null)},stopPolling:function(){this.clearUpdateTimeout(),this.contents&&this.contents.stopPolling()},parse:function(t,e){var i=l.a.Model.prototype.parse.call(this,t,e);return i.create_time&&(i.create_time=new Date(i.create_time)),i.update_time&&(i.update_time=new Date(i.update_time)),i},fetchWithContents:function(t,e){var i=this;return(t=t||{}).view="dev-detailed",this.fetch(t).then(function(t){return i.contents.history=i,i.contents.setHistoryId(t.id),i.fetchContents(e)})},fetchContents:function(t){return t=t||{},this.lastUpdateTime=new Date,this.contents.fetchCurrentPage(t)},_delete:function(t){return this.get("deleted")?s.a.when():this.save({deleted:!0},t)},purge:function(t){return this.get("purged")?s.a.when():this.save({deleted:!0,purged:!0},t)},undelete:function(t){return this.get("deleted")?this.save({deleted:!1},t):s.a.when()},copy:function(t,e,i){if(t=void 0===t||t,!this.id)throw new Error("You must set the history ID before copying it.");var n={history_id:this.id};t&&(n.current=!0),e&&(n.name=e),i||(n.all_datasets=!1),n.view="dev-detailed";var a=this,o=s.a.post(this.urlRoot,n);return t?o.then(function(t){return new _(t).setAsCurrent().done(function(){a.trigger("copied",a,t)})}):o.done(function(t){a.trigger("copied",a,t)})},setAsCurrent:function(){var t=this,e=s.a.getJSON("".concat(Object(d.getAppRoot)(),"history/set_as_current?id=").concat(this.id));return e.done(function(){t.trigger("set-as-current",t)}),e},toString:function(){return"History(".concat(this.get("id"),",").concat(this.get("name"),")")}})),v=h.a.InfinitelyScrollingCollection,b=v.extend(f.a.LoggableMixin).extend({_logNamespace:"history",model:_,order:"update_time",limitOnFirstFetch:10,limitPerFetch:10,initialize:function(t,e){e=e||{},this.log("HistoryCollection.initialize",t,e),this.urlRoot="".concat(Object(d.getAppRoot)(),"api/histories"),v.prototype.initialize.call(this,t,e),this.includeDeleted=e.includeDeleted||!1,this.currentHistoryId=e.currentHistoryId,this.setUpListeners()},url:function(){return this.urlRoot},setUpListeners:function(){return this.on({"change:deleted":function(t){this.debug("change:deleted",this.includeDeleted,t.get("deleted")),!this.includeDeleted&&t.get("deleted")&&this.remove(t)},copied:function(t,e){this.setCurrent(new _(e,[]))},"set-as-current":function(t){var e=this.currentHistoryId;this.trigger("no-longer-current",e),this.currentHistoryId=t.id}})},_buildFetchData:function(t){return a.a.extend(v.prototype._buildFetchData.call(this,t),{view:"dev-detailed"})},_buildFetchFilters:function(t){var e=v.prototype._buildFetchFilters.call(this,t)||{},i={};return!0!==this.includeDeleted?(i.deleted=!1,i.purged=!1):i.deleted=null,a.a.defaults(e,i)},fetchFirst:function(t){var e=this,i=s.a.when();return this.currentHistoryId&&(i=v.prototype.fetchFirst.call(this,{silent:!0,limit:1,filters:{"encoded_id-in":this.currentHistoryId,deleted:null,purged:""}})),i.then(function(){return(t=t||{}).offset=0,e.fetchMore(t)})},comparators:a.a.extend(a.a.clone(v.prototype.comparators),{name:f.a.buildComparator("name",{ascending:!0}),"name-dsc":f.a.buildComparator("name",{ascending:!1}),size:f.a.buildComparator("size",{ascending:!1}),"size-asc":f.a.buildComparator("size",{ascending:!0})}),sort:function(t){var e=(t=t||{}).silent,i=this.remove(this.get(this.currentHistoryId));return v.prototype.sort.call(this,a.a.defaults({silent:!0},t)),this.unshift(i,{silent:!0}),e||this.trigger("sort",this,t),this},create:function(t,e,i,n){var a=this;return s.a.getJSON("".concat(Object(d.getAppRoot)(),"history/create_new_current")).done(function(t){a.setCurrent(new _(t,[],i||{}))})},setCurrent:function(t,e){return e=e||{},this.unshift(t,e),this.currentHistoryId=t.get("id"),e.silent||this.trigger("new-current",t,this),this},toString:function(){return"HistoryCollection(".concat(this.length,",current:").concat(this.currentHistoryId,")")}})},4:function(t,e,i){(function(e){t.exports=e.config=i(199)}).call(this,i(86))},41:function(t,e,i){"use strict";var n=i(1),a=i.n(n),o=i(0),s=i.n(o),r=i(9),l=i.n(r),c=i(3),d=i.n(c),u=i(4),h=i(5),p=i(21),f=i(22),m={hidden:!1,show:function(){this.set("hidden",!1)},hide:function(){this.set("hidden",!0)},toggle:function(){this.set("hidden",!this.get("hidden"))},is_visible:function(){return!this.attributes.hidden}},g=d.a.Model.extend({defaults:{name:null,label:null,type:null,value:null,html:null,num_samples:5},initialize:function(t){this.attributes.html=unescape(this.attributes.html)},copy:function(){return new g(this.toJSON())},set_value:function(t){this.set("value",t||"")}}),_=d.a.Collection.extend({model:g}),v=g.extend({}),b=g.extend({set_value:function(t){this.set("value",parseInt(t,10))},get_samples:function(){return l.a.scale.linear().domain([this.get("min"),this.get("max")]).ticks(this.get("num_samples"))}}),w=b.extend({set_value:function(t){this.set("value",parseFloat(t))}}),y=g.extend({get_samples:function(){return a.a.map(this.get("options"),function(t){return t[0]})}});g.subModelTypes={integer:b,float:w,data:v,select:y};var x=d.a.Model.extend({defaults:{id:null,name:null,description:null,target:null,inputs:[],outputs:[]},urlRoot:"".concat(Object(u.getAppRoot)(),"api/tools"),initialize:function(t){this.set("inputs",new _(a.a.map(t.inputs,function(t){return new(g.subModelTypes[t.type]||g)(t)})))},toJSON:function(){var t=d.a.Model.prototype.toJSON.call(this);return t.inputs=this.get("inputs").map(function(t){return t.toJSON()}),t},remove_inputs:function(t){var e=this.get("inputs").filter(function(e){return-1!==t.indexOf(e.get("type"))});this.get("inputs").remove(e)},copy:function(t){var e=new x(this.toJSON());if(t){var i=new d.a.Collection;e.get("inputs").each(function(t){t.get_samples()&&i.push(t)}),e.set("inputs",i)}return e},apply_search_results:function(t){return-1!==a.a.indexOf(t,this.attributes.id)?this.show():this.hide(),this.is_visible()},set_input_value:function(t,e){this.get("inputs").find(function(e){return e.get("name")===t}).set("value",e)},set_input_values:function(t){var e=this;a.a.each(a.a.keys(t),function(i){e.set_input_value(i,t[i])})},run:function(){return this._run()},rerun:function(t,e){return this._run({action:"rerun",target_dataset_id:t.id,regions:e})},get_inputs_dict:function(){var t={};return this.get("inputs").each(function(e){t[e.get("name")]=e.get("value")}),t},_run:function(t){var e=a.a.extend({tool_id:this.id,inputs:this.get_inputs_dict()},t),i=s.a.Deferred(),n=new p.a.ServerStateDeferred({ajax_settings:{url:this.urlRoot,data:JSON.stringify(e),dataType:"json",contentType:"application/json",type:"POST"},interval:2e3,success_fn:function(t){return"pending"!==t}});return s.a.when(n.go()).then(function(t){i.resolve(new f.b(t))}),i}});a.a.extend(x.prototype,m);var k=d.a.Collection.extend({model:x}),C=d.a.Model.extend(m),S=d.a.Model.extend({defaults:{elems:[],open:!1},clear_search_results:function(){a.a.each(this.attributes.elems,function(t){t.show()}),this.show(),this.set("open",!1)},apply_search_results:function(t){var e,i=!0;a.a.each(this.attributes.elems,function(n){n instanceof C?(e=n).hide():n instanceof x&&n.apply_search_results(t)&&(i=!1,e&&e.show())}),i?this.hide():(this.show(),this.set("open",!0))}});a.a.extend(S.prototype,m);var T=d.a.Model.extend({SEARCH_RESERVED_TERMS_FAVORITES:["#favs","#favorites","#favourites"],defaults:{search_hint_string:"search tools",min_chars_for_search:3,clear_btn_url:"",visible:!0,query:"",results:null,clear_key:27},urlRoot:"".concat(Object(u.getAppRoot)(),"api/tools"),initialize:function(){this.on("change:query",this.do_search)},do_search:function(){var t=Object(h.a)(),e=this.attributes.query;if(e.length<this.attributes.min_chars_for_search)this.set("results",null);else{var i=e;if(this.timer&&clearTimeout(this.timer),this.SEARCH_RESERVED_TERMS_FAVORITES.indexOf(i)>=0)this.set("results",t.user.getFavorites().tools);else{s()("#search-clear-btn").hide(),s()("#search-spinner").show();var n=this;this.timer=setTimeout(function(){"undefined"!=typeof ga&&ga("send","pageview","".concat(Object(u.getAppRoot)(),"?q=").concat(i)),s.a.get(n.urlRoot,{q:i},function(t){n.set("results",t),s()("#search-spinner").hide(),s()("#search-clear-btn").show()},"json")},400)}}},clear_search:function(){this.set("query",""),this.set("results",null)}});a.a.extend(T.prototype,m);var $=d.a.Model.extend({initialize:function(t){this.attributes.tool_search=t.tool_search,this.attributes.tool_search.on("change:results",this.apply_search_results,this),this.attributes.tools=t.tools,this.attributes.layout=new d.a.Collection(this.parse(t.layout))},parse:function(t){var e=this;return a.a.map(t,function t(i){var n=i.model_class;if(n.indexOf("Tool")===n.length-4){var o=e.attributes.tools.get(i.id);return"ExpressionTool"===n&&o.hide(),o}if("ToolSection"===n){var s=a.a.map(i.elems,t).filter(function(t){return t.is_visible()});i.elems=s;var r=new S(i);return 0==s.length&&r.hide(),r}if("ToolSectionLabel"===n)return new C(i)})},clear_search_results:function(){this.get("layout").each(function(t){t instanceof S?t.clear_search_results():t.show()})},apply_search_results:function(){var t=this.get("tool_search").get("results");if(null!==t){var e=null;this.get("layout").each(function(i){i instanceof C?(e=i).hide():i instanceof x?i.apply_search_results(t)&&e&&e.show():(e=null,i.apply_search_results(t))})}else this.clear_search_results()}}),O=d.a.View.extend({initialize:function(){this.model.on("change:hidden",this.update_visible,this),this.update_visible()},update_visible:function(){this.model.attributes.hidden?this.$el.hide():this.$el.show()}}),A=O.extend({tagName:"div",render:function(){var t=s()("<div/>");t.append(E.tool_link(this.model.toJSON()));var e=this.model.get("form_style",null);if("upload1"===this.model.id)t.find("a").on("click",function(t){t.preventDefault(),Object(h.a)().upload.show()});else if("regular"===e){var i=this;t.find("a").on("click",function(t){t.preventDefault(),Object(h.a)().router.push("/",{tool_id:i.model.id,version:i.model.get("version")})})}return this.$el.append(t),this}}),j=O.extend({tagName:"div",className:"toolPanelLabel",render:function(){return this.$el.append(s()("<span/>").text(this.model.attributes.text)),this}}),D=O.extend({tagName:"div",className:"toolSectionWrapper",initialize:function(){O.prototype.initialize.call(this),this.model.on("change:open",this.update_open,this)},render:function(){this.$el.append(E.panel_section(this.model.toJSON()));var t=this.$el.find(".toolSectionBody");return a.a.each(this.model.attributes.elems,function(e){if(e instanceof x){var i=new A({model:e,className:"toolTitle"});i.render(),t.append(i.$el)}else if(e instanceof C){var n=new j({model:e});n.render(),t.append(n.$el)}}),this},events:{"click .toolSectionTitle > a":"toggle"},toggle:function(){this.model.set("open",!this.model.attributes.open)},update_open:function(){this.model.attributes.open?this.$el.children(".toolSectionBody").slideDown("fast"):this.$el.children(".toolSectionBody").slideUp("fast")}}),I=d.a.View.extend({tagName:"div",id:"tool-search",className:"bar",events:{click:"focus_and_select","keyup :input":"query_changed","change :input":"query_changed","click #search-clear-btn":"clear"},render:function(){return this.$el.append(E.tool_search(this.model.toJSON())),this.model.is_visible()||this.$el.hide(),this.$el.find("[title]").tooltip(),this},focus_and_select:function(){this.$el.find(":input").focus().select()},clear:function(){return this.model.clear_search(),this.$el.find(":input").val(""),this.focus_and_select(),!1},query_changed:function(t){if(this.model.attributes.clear_key&&this.model.attributes.clear_key===t.which)return this.clear(),!1;this.model.set("query",this.$el.find(":input").val())}}),M=d.a.View.extend({tagName:"div",className:"toolMenu",initialize:function(){this.model.get("tool_search").on("change:results",this.handle_search_results,this)},render:function(){var t=this,e=new I({model:this.model.get("tool_search")});return e.render(),t.$el.closest(".unified-panel").find(".unified-panel-controls").append(e.$el),this.model.get("layout").each(function(e){if(e instanceof S){var i=new D({model:e});i.render(),t.$el.append(i.$el)}else if(e instanceof x){var n=new A({model:e,className:"toolTitleNoSection"});n.render(),t.$el.append(n.$el)}else if(e instanceof C){var a=new j({model:e});a.render(),t.$el.append(a.$el)}}),t.$el.find("a.tool-link").click(function(e){var i=s()(this).attr("class").split(/\s+/)[0],n=t.model.get("tools").get(i);t.trigger("tool_link_click",e,n)}),this},handle_search_results:function(){var t=this.model.get("tool_search").get("results");t&&0===t.length?s()("#search-no-results").show():s()("#search-no-results").hide()}}),R=d.a.View.extend({className:"toolForm",render:function(){this.$el.children().remove(),this.$el.append(E.tool_form(this.model.toJSON()))}}),E={tool_search:a.a.template('<input id="tool-search-query" class="search-query parent-width" name="query"\n                placeholder="<%- search_hint_string %>" autocomplete="off" type="text" />\n         <a id="search-clear-btn" title="clear search (esc)"> </a>\n         <span id="search-spinner" class="search-spinner fa fa-spinner fa-spin"></span>\n    '),panel_section:a.a.template(['<div class="toolSectionTitle" id="title_<%- id %>">','<a href="javascript:void(0)"><span><%- name %></span></a>',"</div>",'<div id="<%- id %>" class="toolSectionBody" style="display: none;">','<div class="toolSectionBg"></div>',"<div>"].join("")),tool_link:a.a.template(['<a class="<%- id %> tool-link" href="<%= link %>" target="<%- target %>" minsizehint="<%- min_width %>">','<span class="labels">',"<% _.each( labels, function( label ){ %>",'<span class="badge badge-primary badge-<%- label %>">',"<%- label %>","</span>","<% }); %>","</span>",'<span class="tool-old-link">',"<%- name %>","</span>"," <%- description %>","</a>"].join("")),tool_form:a.a.template(['<div class="toolFormTitle"><%- tool.name %> (version <%- tool.version %>)</div>','<div class="toolFormBody">',"<% _.each( tool.inputs, function( input ){ %>",'<div class="form-row">','<label for="<%- input.name %>"><%- input.label %>:</label>','<div class="form-row-input">',"<%= input.html %>","</div>",'<div class="toolParamHelp" style="clear: both;">',"<%- input.help %>","</div>",'<div style="clear: both;"></div>',"</div>","<% }); %>","</div>",'<div class="form-row form-actions">','<input type="submit" class="btn btn-primary" name="runtool_btn" value="Execute" />',"</div>",'<div class="toolHelp">','<div class="toolHelpBody"><% tool.help %></div>',"</div>"].join(""),{variable:"tool"})};e.a={ToolParameter:g,IntegerToolParameter:b,SelectToolParameter:y,Tool:x,ToolCollection:k,ToolSearch:T,ToolPanel:$,ToolPanelView:M,ToolFormView:R}},42:function(t,e,i){"use strict";i.d(e,"a",function(){return v});var n=i(1),a=i.n(n),o=i(0),s=i.n(o),r=i(3),l=i.n(r),c=i(5),d=i(25),u=i(11),h=i(23),p=i(7),f=i(2),m=i.n(f),g=i(109),_=d.c.ListItemView,v=_.extend({_logNamespace:"dataset",className:"".concat(_.prototype.className," dataset"),id:function(){return["dataset",this.model.get("id")].join("-")},initialize:function(t){t.logger&&(this.logger=this.model.logger=t.logger),this.log("".concat(this,".initialize:"),t),_.prototype.initialize.call(this,t),this.linkTarget=t.linkTarget||"_blank"},render:function(){var t=_.prototype.render.apply(this,arguments);return this._mountVueNametags(),t},_mountVueNametags:function(){var t=this.$(".nametags")[0],e=this.model.attributes,i=e.id,n=e.model_class,a=e.tags,o="".concat(n,"-").concat(i);Object(g.a)({storeKey:o,tags:a},t)},_setUpListeners:function(){_.prototype._setUpListeners.call(this);var t=this;return t.listenTo(t.model,{change:function(e){t.model.changedAttributes().state&&t.model.inReadyState()&&t.expanded&&!t.model.hasDetails()?t.model.fetch({silent:!0}).done(function(){t.render()}):a.a.has(t.model.changed,"tags")&&2===a.a.keys(t.model.changed).length?t._mountVueNametags():t.render()}})},_fetchModelDetails:function(){return this.model.inReadyState()&&!this.model.hasDetails()?this.model.fetch({silent:!0}):s.a.when()},remove:function(t,e){var i=this;t=t||this.fxSpeed,this.$el.fadeOut(t,function(){l.a.View.prototype.remove.call(i),e&&e.call(i)})},_swapNewRender:function(t){return _.prototype._swapNewRender.call(this,t),this.model.has("state")&&this.$el.addClass("state-".concat(this.model.get("state"))),this.$el},_renderPrimaryActions:function(){return[this._renderDisplayButton()]},_renderDisplayButton:function(){var t=this.model.get("state");if(t===u.a.NOT_VIEWABLE||t===u.a.DISCARDED||!this.model.get("accessible"))return null;var e={target:this.linkTarget,classes:"display-btn"};if(this.model.get("purged"))e.disabled=!0,e.title=m()("Cannot display datasets removed from disk");else if(t===u.a.UPLOAD)e.disabled=!0,e.title=m()("This dataset must finish uploading before it can be viewed");else if(t===u.a.NEW)e.disabled=!0,e.title=m()("This dataset is not yet viewable");else{e.title=m()("View data"),e.href=this.model.urls.display;var i=this;e.onclick=function(t){var e=Object(c.a)();e.frame&&e.frame.active&&(e.frame.addDataset(i.model.get("id")),t.preventDefault())}}return e.faIcon="fa-eye",Object(h.a)(e)},_renderDetails:function(){if(this.model.get("state")===u.a.NOT_VIEWABLE)return s()(this.templates.noAccess(this.model.toJSON(),this));var t=_.prototype._renderDetails.call(this);return t.find(".actions .left").empty().append(this._renderSecondaryActions()),t.find(".summary").html(this._renderSummary()).prepend(this._renderDetailMessages()),t.find(".display-applications").html(this._renderDisplayApplications()),this._setUpBehaviors(t),t},_renderSummary:function(){var t=this.model.toJSON(),e=this.templates.summaries[t.state];return(e=e||this.templates.summaries.unknown)(t,this)},_renderDetailMessages:function(){var t=this,e=s()('<div class="detail-messages"></div>'),i=t.model.toJSON();return a.a.each(t.templates.detailMessages,function(n){e.append(s()(n(i,t)))}),e},_renderDisplayApplications:function(){return this.model.isDeletedOrPurged()?"":[this.templates.displayApplications(this.model.get("display_apps"),this),this.templates.displayApplications(this.model.get("display_types"),this)].join("")},_renderSecondaryActions:function(){switch(this.debug("_renderSecondaryActions"),this.model.get("state")){case u.a.NOT_VIEWABLE:return[];case u.a.OK:case u.a.FAILED_METADATA:case u.a.ERROR:return[this._renderDownloadButton(),this._renderShowParamsButton()]}return[this._renderShowParamsButton()]},_renderShowParamsButton:function(){return Object(h.a)({title:m()("View details"),classes:"params-btn",href:this.model.urls.show_params,target:this.linkTarget,faIcon:"fa-info-circle",onclick:function(t){var e=Object(c.a)();e.frame&&e.frame.active&&(e.frame.add({title:m()("Dataset details"),url:this.href}),t.preventDefault(),t.stopPropagation())}})},_renderDownloadButton:function(){return this.model.get("purged")||!this.model.hasData()?null:a.a.isEmpty(this.model.get("meta_files"))?s()('\n                <a class="download-btn icon-btn" href="'.concat(this.model.urls.download,'" title="').concat(m()("Download"),'">\n                    <span class="fa fa-floppy-o"></span>\n                </a>')):this._renderMetaFileDownloadButton()},_renderMetaFileDownloadButton:function(){var t=this.model.urls;return s()('\n                <div class="metafile-dropdown dropdown">\n                    <a class="download-btn icon-btn" href="'.concat(t.download,'" data-toggle="dropdown" title="').concat(m()("Download"),'">\n                        <span class="fa fa-floppy-o"></span>\n                    </a>\n                    <ul class="dropdown-menu" role="menu">\n                        <li>\n                            <a href="').concat(t.download,'">\n                                ').concat(m()("Download dataset"),"\n                            </a>\n                        </li>\n                        ").concat(a.a.map(this.model.get("meta_files"),function(e){return'<li>\n                                    <a href="'.concat(t.meta_download+e.file_type,'">\n                                        ').concat(m()("Download")," ").concat(e.file_type,"\n                                    </a>\n                                </li>")}),"\n                    </ul>\n                </div>"))},events:a.a.extend(a.a.clone(_.prototype.events),{"click .display-btn":function(t){this.trigger("display",this,t)},"click .params-btn":function(t){this.trigger("params",this,t)},"click .download-btn":function(t){this.trigger("download",this,t)}}),toString:function(){var t=this.model?"".concat(this.model):"(no model)";return"DatasetListItemView(".concat(t,")")}});v.prototype.templates=function(){var t=a.a.extend({},_.prototype.templates.warnings,{failed_metadata:p.a.wrapTemplate(['<% if( model.state === "failed_metadata" ){ %>','<div class="warningmessagesmall">',m()("An error occurred setting the metadata for this dataset"),"</div>","<% } %>"]),error:p.a.wrapTemplate(["<% if( model.error ){ %>",'<div class="errormessagesmall">',m()("There was an error getting the data for this dataset"),": <%- model.error %>","</div>","<% } %>"]),purged:p.a.wrapTemplate(["<% if( model.purged ){ %>",'<div class="purged-msg warningmessagesmall">',m()("This dataset has been deleted and removed from disk"),"</div>","<% } %>"]),deleted:p.a.wrapTemplate(["<% if( model.deleted && !model.purged ){ %>",'<div class="deleted-msg warningmessagesmall">',m()("This dataset has been deleted"),"</div>","<% } %>"])}),e=p.a.wrapTemplate(['<div class="details">','<div class="summary"></div>','<div class="actions clear">','<div class="left"></div>','<div class="right"></div>',"</div>","<% if( !dataset.deleted && !dataset.purged ){ %>",'<div class="tags-display"></div>','<div class="annotation-display"></div>','<div class="display-applications"></div>',"<% if( dataset.peek ){ %>",'<pre class="dataset-peek"><%= dataset.peek %></pre>',"<% } %>","<% } %>","</div>"],"dataset"),i=p.a.wrapTemplate(['<div class="details">','<div class="summary">',m()("You do not have permission to view this dataset"),"</div>","</div>"],"dataset"),n={};n[u.a.OK]=n[u.a.FAILED_METADATA]=p.a.wrapTemplate(["<% if( dataset.misc_blurb ){ %>",'<div class="blurb">','<span class="value"><%- dataset.misc_blurb %></span>',"</div>","<% } %>","<% if( dataset.file_ext ){ %>",'<div class="datatype">','<label class="prompt">',m()("format"),"</label>",'<span class="value"><%- dataset.file_ext %></span>',"</div>","<% } %>","<% if( dataset.metadata_dbkey ){ %>",'<div class="dbkey">','<label class="prompt">',m()("database"),"</label>",'<span class="value">',"<%- dataset.metadata_dbkey %>","</span>","</div>","<% } %>","<% if( dataset.misc_info ){ %>",'<div class="info">','<span class="value"><%- dataset.misc_info %></span>',"</div>","<% } %>"],"dataset"),n[u.a.NEW]=p.a.wrapTemplate(["<div>",m()("This is a new dataset and not all of its data are available yet"),"</div>"],"dataset"),n[u.a.NOT_VIEWABLE]=p.a.wrapTemplate(["<div>",m()("You do not have permission to view this dataset"),"</div>"],"dataset"),n[u.a.DISCARDED]=p.a.wrapTemplate(["<div>",m()("The job creating this dataset was cancelled before completion"),"</div>"],"dataset"),n[u.a.QUEUED]=p.a.wrapTemplate(["<div>",m()("This job is waiting to run"),"</div>"],"dataset"),n[u.a.RUNNING]=p.a.wrapTemplate(["<div>",m()("This job is currently running"),"</div>"],"dataset"),n[u.a.UPLOAD]=p.a.wrapTemplate(["<div>",m()("This dataset is currently uploading"),"</div>"],"dataset"),n[u.a.SETTING_METADATA]=p.a.wrapTemplate(["<div>",m()("Metadata is being auto-detected"),"</div>"],"dataset"),n[u.a.PAUSED]=p.a.wrapTemplate(["<div>",m()('This job is paused. Use the "Resume Paused Jobs" in the history menu to resume'),"</div>",'<div class="info"><%- dataset.misc_info %></div>'],"dataset"),n[u.a.ERROR]=p.a.wrapTemplate(["<% if( !dataset.purged ){ %>","<div><%- dataset.misc_blurb %></div>","<% } %>",'<span class="help-text">',m()("An error occurred with this dataset"),":</span>",'<div class="job-error-text"><%- dataset.misc_info %></div>'],"dataset"),n[u.a.EMPTY]=p.a.wrapTemplate(["<div>",m()("No data"),": <i><%- dataset.misc_blurb %></i></div>"],"dataset"),n.unknown=p.a.wrapTemplate(['<div>Error: unknown dataset state: "<%- dataset.state %>"</div>'],"dataset");var o={resubmitted:p.a.wrapTemplate(["<% if( model.resubmitted ){ %>",'<div class="resubmitted-msg infomessagesmall">',m()("The job creating this dataset has been resubmitted"),"</div>","<% } %>"])},s=p.a.wrapTemplate(["<% _.each( apps, function( app ){ %>",'<div class="display-application">','<span class="display-application-location"><%- app.label %></span> ','<span class="display-application-links">',"<% _.each( app.links, function( link ){ %>",'<a target="<%- link.target %>" href="<%- link.href %>">',"<% print( _l( link.text ) ); %>","</a> ","<% }); %>","</span>","</div>","<% }); %>"],"apps");return a.a.extend({},_.prototype.templates,{warnings:t,details:e,noAccess:i,summaries:n,detailMessages:o,displayApplications:s})}(),e.b={DatasetListItemView:v}},43:function(t,e,i){"use strict";var n=i(1),a=i.n(n),o=i(0),s=i.n(o),r=i(3),l=i.n(r),c=i(4),d=i(5),u=i(2),h=i.n(u),p=i(14),f=i(20),m={TrackHeaderView:l.a.View.extend({className:"track-header",initialize:function(){this.model.config.get("name").on("change:value",this.update_name,this),this.render()},render:function(){this.$el.append(s()("<div/>").addClass(this.model.drag_handle_class)),this.$el.append(s()("<div/>").addClass("track-name").text(this.model.config.get_value("name"))),this.action_icons={},this.render_action_icons(),this.$el.dblclick(function(t){t.stopPropagation()}),this.$el.append(s()("<div style='clear: both'/>"))},update_name:function(){this.$el.find(".track-name").text(this.model.config.get_value("name"))},render_action_icons:function(){var t=this;this.icons_div=s()("<div/>").addClass("track-icons").hide().appendTo(this.$el),a.a.each(this.model.action_icons_def,function(e){t.add_action_icon(e.name,e.title,e.css_class,e.on_click_fn,e.prepend,e.hide)}),this.set_display_modes(this.model.display_modes)},add_action_icon:function(t,e,i,n,a,o){var r=this;this.action_icons[t]=s()("<a/>").attr("title",e).addClass("icon-button").addClass(i).tooltip().click(function(){n(r.model)}).appendTo(this.icons_div),o&&this.action_icons[t].hide()},set_display_modes:function(t,e){if(t){this.model.display_modes=t,this.model.mode=e||this.model.config.get_value("mode")||this.model.display_modes[0],this.action_icons.mode_icon.attr("title","Set display mode (now: ".concat(this.mode,")"));for(var i=this.model,n={},a=0,o=i.display_modes.length;a<o;a++){var s=i.display_modes[a];n[s]=function(t){return function(){i.change_mode(t)}}(s)}Object(f.b)(this.action_icons.mode_icon,n)}}})},g=i(21),_=i(18),v=i.n(_),b=v.a.extend,w=function(t,e){this.slot=t,this.feature=e},y=function(t,e,i,n){this.slots={},this.start_end_dct={},this.w_scale=t,this.mode=e,this.include_label="Pack"===e,this.max_rows=i,this.measureText=n};b(y.prototype,{_get_draw_coords:function(t){var e=Math.floor(t[1]*this.w_scale),i=Math.ceil(t[2]*this.w_scale),n=t[3];if(void 0!==n&&this.include_label){var a=this.measureText(n).width+7;e-a>=0?e-=a:i+=a}return[e,i]},_find_slot:function(t){for(var e=t[0],i=t[1],n=0;n<=this.max_rows;n++){var a=!1,o=this.start_end_dct[n];if(void 0!==o)for(var s=0,r=o.length;s<r;s++){var l=o[s];if(i>l[0]&&e<l[1]){a=!0;break}}if(!a)return n}return-1},slot_features:function(t){for(var e,i,n=this.start_end_dct,a=[],o=0,s=0,r=t.length;s<r;s++){i=(e=t[s])[0];var l=this.slots[i];if(l){if(e[1]<l.feature[1]||l.feature[2]<e[2])for(var c=this._get_draw_coords(l.feature),d=this._get_draw_coords(e),u=this.start_end_dct[l.slot],h=0;h<u.length;h++){var p=u[h];p[0]===c[0]&&p[1]===c[1]&&(u[h]=d)}o=Math.max(o,this.slots[i].slot)}else a.push(s)}for(var f=0,m=a.length;f<m;f++){i=(e=t[a[f]])[0];var g=this._get_draw_coords(e),_=this._find_slot(g);_>=0&&(void 0===n[_]&&(n[_]=[]),n[_].push(g),this.slots[i]=new w(_,e),o=Math.max(o,_))}return o+1}});var x=y;function k(t){return(k="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function C(t,e){return!e||"object"!==k(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function S(t){return(S=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function T(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&$(t,e)}function $(t,e){return($=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function O(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function A(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function j(t,e,i){return e&&A(t.prototype,e),i&&A(t,i),t}var D=1001,I=1002,M=1003,R=1004,E=1005,P=1006;function V(t,e){var i=t[0],n=t[1],a=e[0],o=e[1];return i<a?n<=a?D:n<=o?M:I:i>o?P:n<=o?E:R}function L(t,e){var i=V(t,e);return i!==D&&i!==P}function z(t,e,i,n){var a=e-n/2,o=e+n/2,s=i-Math.sqrt(3*n/2);t.beginPath(),t.moveTo(a,s),t.lineTo(o,s),t.lineTo(e,i),t.lineTo(a,s),t.strokeStyle=this.fillStyle,t.fill(),t.stroke(),t.closePath()}var N=function(){function t(e){O(this,t),this.default_val=e||1}return j(t,[{key:"gen_val",value:function(t){return this.default_val}}]),t}(),F=function t(e){O(this,t),this.incomplete_features=e.incomplete_features,this.feature_mapper=e.feature_mapper},H=function(){function t(e,i,n,a,o){O(this,t),this.data=e,this.default_prefs={},this.view_start=i,this.view_end=n,this.prefs=v.a.extend({},this.default_prefs,a),this.mode=o}return j(t,[{key:"draw",value:function(t,e,i,n){}},{key:"get_start_draw_pos",value:function(t,e){return this._chrom_pos_to_draw_pos(t,e,-.5)}},{key:"get_end_draw_pos",value:function(t,e){return this._chrom_pos_to_draw_pos(t,e,.5)}},{key:"get_draw_pos",value:function(t,e){return this._chrom_pos_to_draw_pos(t,e,0)}},{key:"_chrom_pos_to_draw_pos",value:function(t,e,i){return Math.floor(e*(Math.max(0,t-this.view_start)+i))}}],[{key:"default_prefs",get:function(){return{}}}]),t}(),U=function(t){function e(t,i,n,a,o){return O(this,e),C(this,S(e).call(this,t,i,n,a,o))}return T(e,H),j(e,[{key:"draw",value:function(t,e,i,n){var a=!1,o=this.prefs.min_value,s=this.prefs.max_value,r=s-o,l=i,c=this.view_start,d=this.mode,u=this.data;t.save();var h,p,f,m=Math.round(i+o/r*i);"Intensity"!==d&&(t.fillStyle="#aaa",t.fillRect(0,m,e,1)),t.beginPath(),f=u.length>1?v.a.map(u.slice(0,-1),function(t,e){return Math.ceil((u[e+1][0]-u[e][0])*n)}):[10];for(var g,_=this.prefs.block_color||this.prefs.color,b=parseInt(_.slice(1),16),w=(16711680&b)>>16,y=(65280&b)>>8,x=255&b,k=!1,C=!1,S=0,T=u.length;S<T;S++)if(t.fillStyle=t.strokeStyle=_,k=C=!1,g=f[S],h=Math.floor((u[S][0]-c-.5)*n),null!==(p=u[S][1])){if(p<o?(C=!0,p=o):p>s&&(k=!0,p=s),"Histogram"===d)p=Math.round(p/r*l),t.fillRect(h,m,g,-p);else if("Intensity"===d){var $=(p-o)/r,O=Math.round(w+(255-w)*(1-$)),A=Math.round(y+(255-y)*(1-$)),j=Math.round(x+(255-x)*(1-$));t.fillStyle="rgb(".concat(O,",").concat(A,",").concat(j,")"),t.fillRect(h,0,g,l)}else p=Math.round(l-(p-o)/r*l),a?t.lineTo(h,p):(a=!0,"Filled"===d?(t.moveTo(h,l),t.lineTo(h,p)):t.moveTo(h,p));var D;if(t.fillStyle=this.prefs.overflow_color,k||C)"Histogram"===d||"Intensity"===d?D=g:(h-=2,D=4),k&&t.fillRect(h,0,D,3),C&&t.fillRect(h,l-3,D,3);t.fillStyle=_}else a&&"Filled"===d&&t.lineTo(h,l),a=!1;"Filled"===d?(a&&(t.lineTo(h,m),t.lineTo(0,m)),t.fill()):t.stroke(),t.restore()}}],[{key:"default_prefs",get:function(){return{min_value:void 0,max_value:void 0,mode:"Histogram",color:"#000",overflow_color:"#F66"}}}]),e}(),B=function(){function t(e){O(this,t),this.feature_positions={},this.slot_height=e,this.translation=0,this.y_translation=0}return j(t,[{key:"map_feature_data",value:function(t,e,i,n){this.feature_positions[e]||(this.feature_positions[e]=[]),this.feature_positions[e].push({data:t,x_start:i,x_end:n})}},{key:"get_feature_data",value:function(t,e){var i,n=Math.floor((e-this.y_translation)/this.slot_height);if(!this.feature_positions[n])return null;t+=this.translation;for(var a=0;a<this.feature_positions[n].length;a++)if(t>=(i=this.feature_positions[n][a]).x_start&&t<=i.x_end)return i.data}}]),t}(),q=function(t){function e(t,i,n,a,o,s,r){var l;return O(this,e),(l=C(this,S(e).call(this,t,i,n,a,o))).alpha_scaler=s||new N,l.height_scaler=r||new N,l.max_label_length=200,l}return T(e,H),j(e,[{key:"get_required_height",value:function(t,e){var i=this.get_row_height(),n=i,a=this.mode;return"no_detail"!==a&&"Squish"!==a&&"Pack"!==a||(i=t*n),i+this.get_top_padding(e)}},{key:"get_top_padding",value:function(t){return 0}},{key:"draw",value:function(t,e,i,n,a){t.save(),t.fillStyle=this.prefs.block_color,t.textAlign="right";for(var o,s=this.get_row_height(),r=new B(s),l=[],c=0,d=this.data.length;c<d;c++){var u=this.data[c],h=u[0],p=u[1],f=u[2],m=a&&void 0!==a[h]?a[h].slot:null;("Dense"===this.mode||null!==m)&&p<this.view_end&&f>this.view_start&&(o=this.draw_element(t,this.mode,u,m,this.view_start,this.view_end,n,s,e),r.map_feature_data(u,m,o[0],o[1]),(p<this.view_start||f>this.view_end)&&l.push(u))}return t.restore(),r.y_translation=this.get_top_padding(e),new F({incomplete_features:l,feature_mapper:r})}},{key:"draw_element",value:function(t,e,i,n,a,o,s,r,l){return[0,0]}}],[{key:"default_prefs",get:function(){return{block_color:"#FFF",connector_color:"#FFF"}}}]),e}(),G=function(t){function e(t,i,n,a,o,s,r){var l;return O(this,e),(l=C(this,S(e).call(this,t,i,n,a,o,s,r))).draw_background_connector=!0,l.draw_individual_connectors=!1,l}return T(e,q),j(e,[{key:"get_row_height",value:function(){var t=this.mode;return"Dense"===t?10:"no_detail"===t?3:"Squish"===t?5:10}},{key:"draw_element",value:function(t,e,i,n,a,o,s,r,l){var c=i[1],d=i[2],u=i[3],h=i[4],p=Math.floor(Math.max(0,(c-a-.5)*s)),f=Math.ceil(Math.min(l,Math.max(0,(d-a-.5)*s))),m=p,g=f,_=("Dense"===e?0:0+n)*r+this.get_top_padding(l),v=null,b=null,w=h&&"+"!==h&&"."!==h?this.prefs.reverse_strand_color:this.prefs.block_color,y=this.prefs.label_color;if(t.globalAlpha=this.alpha_scaler.gen_val(i),"Dense"===e&&(n=1),"no_detail"===e)t.fillStyle=w,t.fillRect(p,_+5,f-p,1);else{var x,k,C=i[5],S=i[6],T=i[7],$=!0;if(C&&S&&(v=Math.floor(Math.max(0,(C-a)*s)),b=Math.ceil(Math.min(l,Math.max(0,(S-a)*s)))),"Squish"===e?(x=1,k=3,$=!1):(x=5,k=9),T){var O,A;"Squish"===e||"Dense"===e?(O=_+Math.floor(1.5)+1,A=1):h?(O=_,A=k):(O+=2.5,A=1),this.draw_background_connector&&("Squish"===e||"Dense"===e?t.fillStyle="#ccc":h?"+"===h?t.fillStyle=t.canvas.manager.get_pattern("right_strand"):"-"===h&&(t.fillStyle=t.canvas.manager.get_pattern("left_strand")):t.fillStyle="#ccc",t.fillRect(p,O,f-p,A));for(var j=0,D=T.length;j<D;j++){var I,M,R=T[j],E=Math.floor(Math.max(0,(R[0]-a-.5)*s)),P=Math.ceil(Math.min(l,Math.max((R[1]-a-.5)*s)));if(!(E>P)){if(t.fillStyle=w,t.fillRect(E,_+(k-x)/2+1,P-E,x),void 0!==v&&S>C&&!(E>b||P<v)){var V=Math.max(E,v),L=Math.min(P,b);t.fillRect(V,_+1,L-V,k),1===T.length&&"Pack"===e&&("+"===h?t.fillStyle=t.canvas.manager.get_pattern("right_strand_inv"):"-"===h&&(t.fillStyle=t.canvas.manager.get_pattern("left_strand_inv")),V+14<L&&(V+=2,L-=2),t.fillRect(V,_+1,L-V,k))}this.draw_individual_connectors&&I&&this.draw_connector(t,I,M,E,P,_),I=E,M=P}}if("Pack"===e){t.globalAlpha=1,t.fillStyle="white";var z=this.height_scaler.gen_val(i),N=Math.ceil(k*z),F=Math.round((k-N)/2);1!==z&&(t.fillRect(p,O+1,f-p,F),t.fillRect(p,O+k-F+1,f-p,F))}}else t.fillStyle=w,t.fillRect(p,_+1,f-p,k),h&&$&&("+"===h?t.fillStyle=t.canvas.manager.get_pattern("right_strand_inv"):"-"===h&&(t.fillStyle=t.canvas.manager.get_pattern("left_strand_inv")),t.fillRect(p,_+1,f-p,k));t.globalAlpha=1,u&&"Pack"===e&&c>a&&(t.fillStyle=y,0===a&&p-t.measureText(u).width<0?(t.textAlign="left",t.fillText(u,f+2,_+8,this.max_label_length),g+=t.measureText(u).width+2):(t.textAlign="right",t.fillText(u,p-2,_+8,this.max_label_length),m-=t.measureText(u).width+2))}return t.globalAlpha=1,[m,g]}}]),e}(),W=function(t){function e(t,i,n,a,o,s,r,l,c){var d;return O(this,e),(d=C(this,S(e).call(this,t,i,n,a,o,s,r))).ref_seq=l?l.data:null,d.base_color_fn=c,d}return T(e,q),j(e,[{key:"get_row_height",value:function(){var t,e=this.mode;return"Dense"===e?t=10:"Squish"===e?t=5:(t=10,this.prefs.show_insertions&&(t*=2)),t}},{key:"_parse_cigar",value:function(t){var e=[[0,0]],i=e[0],n=0,a=v.a.map(t.match(/[0-9]+[MIDNSHP=X]/g),function(t){var a=parseInt(t.slice(0,-1),10),o=t.slice(-1);return"N"===o?0!==i[1]&&(i=[n+a,n+a],e.push(i)):-1==="ISHP".indexOf(o)&&(i[1]+=a,n+=a),["MIDNSHP=X".indexOf(o),a]});return{blocks:e,cigar:a}}},{key:"draw_read",value:function(t,e,i,n,a,o,s,r,l,c){var d=function(t,e,i){return-1!=="M=NXD".indexOf(e)&&(t+=i),t},u=function(t,e,i){return-1!=="IX".indexOf(e)&&(t+=i),t},h=function(t){return Math.floor(Math.max(0,(t-a-.5)*i))};t.textAlign="center";var p,f,m,g,_,v,b=[a,o],w=0,y=0,x=Math.round(i/2),k=t.canvas.manager.char_width_px,C="+"===l?this.prefs.detail_block_color:this.prefs.reverse_strand_color,S="Pack"===e,T=S?9:3,$=n+1,O=new Z(t,T,i,e),A=[],j=this._parse_cigar(r);r=j.cigar,p=j.blocks;for(var D=0;D<p.length;D++){var P=p[D];L([s+P[0],s+P[1]],b)&&((f=h(s+P[0]))===(m=h(s+P[1]))&&(m+=1),t.fillStyle=C,t.fillRect(f,$,m-f,T))}for(var N=0,F=r.length;N<F;N++){var H=r[N],U="MIDNSHP=X"[H[0]],B=H[1],q=s+w;if(f=h(q),m=h(q+B),L([q,q+B],b))switch(f===m&&(m+=1),U){case"H":case"S":case"P":break;case"M":w+=B;break;case"=":case"X":var G="";"X"===U?G=c.slice(y,y+B):this.ref_seq&&(G=this.ref_seq.slice(Math.max(0,q-a),Math.min(q-a+B,o-a)));for(var W=Math.max(q,a),J=0;J<G.length;J++)if(G&&!this.prefs.show_differences||"X"===U){var Y=Math.floor(Math.max(0,(W+J-a)*i));t.fillStyle=this.base_color_fn(G[J]),S&&i>k?t.fillText(G[J],Y,n+9):i>.05&&t.fillRect(Y-x,$,Math.max(1,Math.round(i)),T)}"X"===U&&(y+=B),w+=B;break;case"N":t.fillStyle="#ccc",t.fillRect(f,$+(T-1)/2,m-f,1),w+=B;break;case"D":O.draw_deletion(f,$,B),w+=B;break;case"I":var K=f-x;if(L([q,q+B],b)){var Q=c.slice(y,y+B);if(this.prefs.show_insertions){var X=f-(m-f)/2;if(("Pack"===e||"Auto"===this.mode)&&void 0!==c&&i>k){switch(t.fillStyle="yellow",t.fillRect(X-x,n-9,m-f,9),A[A.length]={type:"triangle",data:[K,n+4,5]},t.fillStyle="#ccc",V([q,q+B],b)){case M:Q=Q.slice(a-q);break;case R:Q=Q.slice(0,q-o);break;case E:break;case I:Q=Q.slice(a-q,q-o)}for(var tt=0,et=Q.length;tt<et;tt++){var it=Math.floor(Math.max(0,(q+tt-a)*i));t.fillText(Q[tt],it-(m-f)/2,n)}}else t.fillStyle="yellow",t.fillRect(X,n+("Dense"!==this.mode?2:5),m-f,"Dense"!==e?3:9)}else("Pack"===e||"Auto"===this.mode)&&void 0!==c&&i>k&&A.push({type:"text",data:[Q.length,K,n+9]})}y+=B}else w=d(w,U,B),y=u(y,U,B)}t.fillStyle="yellow";for(var nt=0;nt<A.length;nt++)_=(g=A[nt]).type,v=g.data,"text"===_?(t.save(),t.font="bold ".concat(t.font),t.fillText(v[0],v[1],v[2]),t.restore()):"triangle"===_&&z(t,v[0],v[1],v[2])}},{key:"draw_element",value:function(t,e,i,n,a,o,s,r,l){var c=i[1],d=i[2],u=i[3],h=Math.floor(Math.max(-.5*s,(c-a-.5)*s)),p=Math.ceil(Math.min(l,Math.max(0,(d-a-.5)*s))),f=("Dense"===e?0:0+n)*r,m="Pack"===e?9:3;if(i[5]instanceof Array){var g=!0;i[4][1]>=a&&i[4][0]<=o&&i[4][2]?this.draw_read(t,e,s,f,a,o,i[4][0],i[4][2],i[4][3],i[4][4]):g=!1,i[5][1]>=a&&i[5][0]<=o&&i[5][2]?this.draw_read(t,e,s,f,a,o,i[5][0],i[5][2],i[5][3],i[5][4]):g=!1;var _=Math.ceil(Math.min(l,Math.max(-.5*s,(i[4][1]-a-.5)*s))),v=Math.floor(Math.max(-.5*s,(i[5][0]-a-.5)*s));if(g&&v>_){t.fillStyle="#ccc";var b=f+1+(m-1)/2;!function(t,e,i,n,a,o){void 0===o&&(o=4);var s,r=n-e,l=a-i,c=Math.floor(Math.sqrt(r*r+l*l)/o),d=r/c,u=l/c;for(s=0;s<c;s++,e+=d,i+=u)s%2==0&&t.fillRect(e,i,o,1)}(t,_,b,v,b)}}else this.draw_read(t,e,s,f,a,o,c,i[4],i[5],i[6]);return"Pack"===e&&c>=a&&"."!==u&&(t.fillStyle=this.prefs.label_color,0===a&&h-t.measureText(u).width<0?(t.textAlign="left",t.fillText(u,p+2,f+9,this.max_label_length)):(t.textAlign="right",t.fillText(u,h-2,f+9,this.max_label_length))),[0,0]}}]),e}(),J=function(t){function e(t,i,n,a,o,s,r){var l;return O(this,e),(l=C(this,S(e).call(this,t,i,n,a,o,s,r))).longest_feature_length=l.calculate_longest_feature_length(),l.draw_background_connector=!1,l.draw_individual_connectors=!0,l}return T(e,G),j(e,[{key:"calculate_longest_feature_length",value:function(){for(var t=0,e=0,i=this.data.length;e<i;e++){var n=this.data[e],a=n[1],o=n[2];t=Math.max(t,o-a)}return t}},{key:"get_top_padding",value:function(t){var e=t/(this.view_end-this.view_start);return Math.min(128,Math.ceil(this.longest_feature_length/2*e))}},{key:"draw_connector",value:function(t,e,i,n,a,o){var s=(i+n)/2;n-s>0&&(t.beginPath(),t.arc(s,o,n-s,Math.PI,0),t.stroke())}}]),e}(),Y=function(){function t(e,i){O(this,t),Array.isArray(e)?this.rgb=e:6==e.length?this.rgb=e.match(/.{2}/g).map(function(t){return parseInt(t,16)}):7==e.length?this.rgb=e.substring(1,7).match(/.{2}/g).map(function(t){return parseInt(t,16)}):this.rgb=e.split("").map(function(t){return parseInt(t+t,16)}),this.alpha="number"==typeof i?i:1}return j(t,[{key:"eval",value:function(){return this}},{key:"toCSS",value:function(){return this.alpha<1?"rgba(".concat(this.rgb.map(function(t){return Math.round(t)}).concat(this.alpha).join(", "),")"):"#".concat(this.rgb.map(function(t){return 1===(t=((t=Math.round(t))>255?255:t<0?0:t).toString(16)).length?"0".concat(t):t}).join(""))}},{key:"toHSL",value:function(){var t,e,i=this.rgb[0]/255,n=this.rgb[1]/255,a=this.rgb[2]/255,o=this.alpha,s=Math.max(i,n,a),r=Math.min(i,n,a),l=(s+r)/2,c=s-r;if(s===r)t=e=0;else{switch(e=l>.5?c/(2-s-r):c/(s+r),s){case i:t=(n-a)/c+(n<a?6:0);break;case n:t=(a-i)/c+2;break;case a:t=(i-n)/c+4}t/=6}return{h:360*t,s:e,l:l,a:o}}},{key:"toARGB",value:function(){var t=[Math.round(255*this.alpha)].concat(this.rgb);return"#".concat(t.map(function(t){return 1===(t=((t=Math.round(t))>255?255:t<0?0:t).toString(16)).length?"0".concat(t):t}).join(""))}},{key:"mix",value:function(e,i){var n=i,a=2*n-1,o=this.toHSL().a-e.toHSL().a,s=((a*o==-1?a:(a+o)/(1+a*o))+1)/2,r=1-s;return new t([this.rgb[0]*s+e.rgb[0]*r,this.rgb[1]*s+e.rgb[1]*r,this.rgb[2]*s+e.rgb[2]*r],this.alpha*n+e.alpha*(1-n))}}]),t}(),K=function(){function t(e,i,n,a){O(this,t),this.start_color=new Y(e),this.end_color=new Y(i),this.start_value=n,this.end_value=a,this.value_range=a-n}return j(t,[{key:"map_value",value:function(t){return t=Math.max(t,this.start_value),t=((t=Math.min(t,this.end_value))-this.start_value)/this.value_range,this.start_color.mix(this.end_color,1-t).toCSS()}}]),t}(),Q=function(){function t(e,i,n,a,o){O(this,t),this.positive_ramp=new K(i,n,0,o),this.negative_ramp=new K(i,e,0,-a),this.start_value=a,this.end_value=o}return j(t,[{key:"map_value",value:function(t){return t=Math.max(t,this.start_value),(t=Math.min(t,this.end_value))>=0?this.positive_ramp.map_value(t):this.negative_ramp.map_value(-t)}}]),t}(),X=function(t){function e(t,i,n,a,o){var s,r,l;if(O(this,e),void 0===(s=C(this,S(e).call(this,t,i,n,a,o))).prefs.min_value){var c=1/0;for(r=0,l=s.data.length;r<l;r++)c=Math.min(c,s.data[r][6]);s.prefs.min_value=c}if(void 0===s.prefs.max_value){var d=-1/0;for(r=0,l=s.data.length;r<l;r++)d=Math.max(d,s.data[r][6]);s.prefs.max_value=d}return s}return T(e,H),j(e,[{key:"draw",value:function(t,e,i,n){var a,o,s,r,l,c,d=this.prefs.min_value,u=this.prefs.max_value,h=this.view_start,p=1/Math.sqrt(2),f=new Q(this.prefs.neg_color,"#FFFFFF",this.prefs.pos_color,d,u),m=function(t){return(t-h)*n};t.save(),t.rotate(-45*Math.PI/180),t.scale(p,p);for(var g=0,_=this.data.length;g<_;g++)o=m((a=this.data[g])[1]),s=m(a[2]),r=m(a[4]),l=m(a[5]),c=a[6],t.fillStyle=f.map_value(c),t.fillRect(o,r,s-o,l-r);t.restore()}}],[{key:"default_prefs",get:function(){return{min_value:void 0,max_value:void 0,mode:"Heatmap",pos_color:"#FF8C00",neg_color:"#4169E1"}}}]),e}(),Z=function(){function t(e,i,n,a){O(this,t),this.ctx=e,this.row_height=i,this.px_per_base=n,this.draw_details=("Pack"===a||"Auto"===a)&&n>=e.canvas.manager.char_width_px,this.delete_details_thickness=.2}return j(t,[{key:"draw_deletion",value:function(t,e,i){this.ctx.fillStyle="black";var n=(this.draw_details?this.delete_details_thickness:1)*this.row_height;e+=.5*(this.row_height-n),this.ctx.fillRect(t,e,i*this.px_per_base,n)}}]),t}(),tt={Scaler:N,LinePainter:U,LinkedFeaturePainter:G,ReadPainter:W,ArcLinkedFeaturePainter:J,DiagonalHeatmapPainter:X,VariantPainter:function(t){function e(t,i,n,a,o,s){var r;return O(this,e),(r=C(this,S(e).call(this,t,i,n,a,o))).base_color_fn=s,r.divider_height=1,r}return T(e,H),j(e,[{key:"get_row_height",value:function(){var t=this.mode;return"Dense"===t?10:"Squish"===t?5:10}},{key:"get_required_height",value:function(t){var e=this.prefs.summary_height;return t>1&&this.prefs.show_sample_data&&(e+=this.divider_height+t*this.get_row_height()),e}},{key:"draw",value:function(t,e,i,n){t.save();var a,o,s,r,l,c,d,u,h,p,f,m=function(t,e){var i=t.length,n=e.length,a=0,o=1,s=null;return"-"===e?(s="deletion",o=t.length):0===t.indexOf(e)&&i>n?(s="deletion",o=i-n,a=n):0===e.indexOf(t)&&i<n&&(s="insertion",o=n-i,a=n),null!==s?{type:s,start:a,len:o}:{}},g=Math.max(1,Math.floor(n)),_=this.data.length?this.data[0][7].split(",").length:0,b="Squish"===this.mode?5:10,w=n<.1?b:"Squish"===this.mode?3:9,y=!0,x=new Z(t,b,n,this.mode);1===_&&(b=w=n<t.canvas.manager.char_width_px?this.prefs.summary_height:b,x.row_height=b,y=!1),this.prefs.show_sample_data&&y&&(t.fillStyle="#F3F3F3",t.globalAlpha=1,t.fillRect(0,this.prefs.summary_height-this.divider_height,e,this.divider_height)),t.textAlign="center";for(var k=0;k<this.data.length;k++)if(o=(a=this.data[k])[1],s=a[3],r=[a[4].split(",")],l=a[7].split(","),c=a.slice(8),r=v.a.map(v.a.flatten(r),function(t){var e={type:"snp",value:t,start:0},i=m(s,t);return v.a.extend(e,i)}),!(o<this.view_start||o>this.view_end)){if(y)for(t.fillStyle="#999999",t.globalAlpha=1,f=0;f<r.length;f++)for(u=this.get_start_draw_pos(o+r[f].start,n),t.fillRect(u,0,g,this.prefs.summary_height),h=this.prefs.summary_height,f=0;f<r.length;f++){t.fillStyle="deletion"===r[f].type?"black":this.base_color_fn(r[f].value);var C=c/l.length,S=Math.ceil(this.prefs.summary_height*C);t.fillRect(u,h-S,g,S),h-=S}if(this.prefs.show_sample_data)for(h=y?this.prefs.summary_height+this.divider_height:0,f=0;f<l.length;f++,h+=b)if(d=null,(p=l[f]?l[f].split(/\/|\|/):["0","0"])[0]===p[1]?"."===p[0]||"0"!==p[0]&&(d=r[parseInt(p[0],10)-1],t.globalAlpha=1):(d="0"!==p[0]?p[0]:p[1],d=r[parseInt(d,10)-1],t.globalAlpha=.5),d)if(u=this.get_start_draw_pos(o+d.start,n),"snp"===d.type){var T=d.value;t.fillStyle=this.base_color_fn(T),x.draw_details?t.fillText(T,this.get_draw_pos(o,n),h+b):t.fillRect(u,h+1,g,w)}else"deletion"===d.type&&x.draw_deletion(u,h+1,d.len)}t.restore()}}]),e}()},et=function(t){this.manager=null,this.name=t.name,this.index=t.index,this.tool_id=t.tool_id,this.tool_exp_name=t.tool_exp_name};v.a.extend(et.prototype,{to_dict:function(){return{name:this.name,index:this.index,tool_id:this.tool_id,tool_exp_name:this.tool_exp_name}}});var it=function(t,e,i){return s()("<a/>").attr("href","javascript:void(0);").attr("title",t).addClass("icon-button").addClass(e).tooltip().click(i)},nt=function(t){et.call(this,t),this.low="low"in t?t.low:-Number.MAX_VALUE,this.high="high"in t?t.high:Number.MAX_VALUE,this.min="min"in t?t.min:Number.MAX_VALUE,this.max="max"in t?t.max:-Number.MAX_VALUE,this.container=null,this.slider=null,this.slider_label=null;var e=this;e.parent_div=s()("<div/>").addClass("filter-row slider-row");var i=s()("<div/>").addClass("elt-label").appendTo(e.parent_div);s()("<span/>").addClass("slider-name").text("".concat(e.name,"  ")).appendTo(i);var n=s()("<span/>").text("".concat(this.low,"-").concat(this.high)),a=s()("<span/>").addClass("slider-value").appendTo(i).append("[").append(n).append("]");e.values_span=n;var o,r,l,c=s()("<div/>").addClass("slider").appendTo(e.parent_div);e.control_element=s()("<div/>").attr("id","".concat(e.name,"-filter-control")).appendTo(c),e.control_element.slider({range:!0,min:this.min,max:this.max,step:this.get_slider_step(this.min,this.max),values:[this.low,this.high],slide:function(t,i){e.slide(t,i)},change:function(t,i){e.control_element.slider("option","slide").call(e.control_element,t,i)}}),e.slider=e.control_element,e.slider_label=n,o=a,r=n,l=e.control_element,o.click(function(){var t=r.text(),e=parseFloat(l.slider("option","max")),i=e<=1?4:e<=1e6?e.toString().length:6,n=!1,a=s()(this).parents(".slider-row");a.addClass("input"),l.slider("option","values")&&(i=2*i+1,n=!0),r.text(""),s()("<input type='text'/>").attr("size",i).attr("maxlength",i).attr("value",t).appendTo(r).focus().select().click(function(t){t.stopPropagation()}).blur(function(){s()(this).remove(),r.text(t),a.removeClass("input")}).keyup(function(t){if(27===t.keyCode)s()(this).trigger("blur");else if(13===t.keyCode){var e=l.slider("option","min"),i=l.slider("option","max"),o=function(t){return isNaN(t)||t>i||t<e},r=s()(this).val();if(n){if(r=r.split("-"),o((r=[parseFloat(r[0]),parseFloat(r[1])])[0])||o(r[1]))return alert("Parameter value must be in the range [".concat(e,"-").concat(i,"]")),s()(this)}else if(o(r=parseFloat(r)))return alert("Parameter value must be in the range [".concat(e,"-").concat(i,"]")),s()(this);l.slider(n?"values":"value",r),a.removeClass("input")}})});var d=s()("<div/>").addClass("display-controls").appendTo(e.parent_div);this.transparency_icon=it("Use filter for data transparency","layer-transparent",function(){e.manager.alpha_filter!==e?(e.manager.alpha_filter=e,e.manager.parent_div.find(".layer-transparent").removeClass("active").hide(),e.transparency_icon.addClass("active").show()):(e.manager.alpha_filter=null,e.transparency_icon.removeClass("active")),e.manager.track.request_draw({force:!0,clear_after:!0})}).appendTo(d).hide(),this.height_icon=it("Use filter for data height","arrow-resize-090",function(){e.manager.height_filter!==e?(e.manager.height_filter=e,e.manager.parent_div.find(".arrow-resize-090").removeClass("active").hide(),e.height_icon.addClass("active").show()):(e.manager.height_filter=null,e.height_icon.removeClass("active")),e.manager.track.request_draw({force:!0,clear_after:!0})}).appendTo(d).hide(),e.parent_div.hover(function(){e.transparency_icon.show(),e.height_icon.show()},function(){e.manager.alpha_filter!==e&&e.transparency_icon.hide(),e.manager.height_filter!==e&&e.height_icon.hide()}),s()("<div style='clear: both;'/>").appendTo(e.parent_div)};v.a.extend(nt.prototype,{to_dict:function(){var t=et.prototype.to_dict.call(this);return v.a.extend(t,{type:"number",min:this.min,max:this.max,low:this.low,high:this.high})},copy:function(){return new nt({name:this.name,index:this.index,tool_id:this.tool_id,tool_exp_name:this.tool_exp_name})},get_slider_step:function(t,e){return e-t<=2?.01:1},slide:function(t,e){var i=e.values;this.values_span.text("".concat(i[0],"-").concat(i[1])),this.low=i[0],this.high=i[1];var n=this;setTimeout(function(){i[0]===n.low&&i[1]===n.high&&n.manager.track.request_draw({force:!0,clear_after:!0})},25)},applies_to:function(t){return t.length>this.index},_keep_val:function(t){return isNaN(t)||t>=this.low&&t<=this.high},keep:function(t){if(!this.applies_to(t))return!0;var e=t[this.index];if(e instanceof Array){for(var i=!0,n=0;n<e.length;n++)if(!this._keep_val(e[n])){i=!1;break}return i}return this._keep_val(t[this.index])},update_attrs:function(t){var e=!1;if(!this.applies_to(t))return e;var i=t[this.index];i instanceof Array||(i=[i]);for(var n=0;n<i.length;n++){var a=i[n];a<this.min&&(this.min=Math.floor(a),e=!0),a>this.max&&(this.max=Math.ceil(a),e=!0)}return e},update_ui_elt:function(){this.min<this.max?this.parent_div.show():this.parent_div.hide();var t=this.slider.slider("option","min"),e=this.slider.slider("option","max");(this.min<t||this.max>e)&&(this.slider.slider("option","min",this.min),this.slider.slider("option","max",this.max),this.slider.slider("option","step",this.get_slider_step(this.min,this.max)),this.slider.slider("option","values",[this.min,this.max]))}});var at=function(t,e){if(this.track=t,this.alpha_filter=null,this.height_filter=null,this.filters=[],this.parent_div=s()("<div/>").addClass("filters").hide(),this.parent_div.bind("drag",function(t){t.stopPropagation()}).click(function(t){t.stopPropagation()}).bind("dblclick",function(t){t.stopPropagation()}).bind("keydown",function(t){t.stopPropagation()}),e&&"filters"in e){for(var i,n=("alpha_filter"in e?e.alpha_filter:null),a=("height_filter"in e?e.height_filter:null),o=e.filters,r=0;r<o.length;r++)"number"===o[r].type?(i=new nt(o[r]),this.add_filter(i),i.name===n&&(this.alpha_filter=i,i.transparency_icon.addClass("active").show()),i.name===a&&(this.height_filter=i,i.height_icon.addClass("active").show())):console.log("ERROR: unsupported filter: ",o[r]);"visible"in e&&e.visible&&this.parent_div.show()}if(0!==this.filters.length){var l=s()("<div/>").addClass("param-row").appendTo(this.parent_div),c=s()("<input type='submit'/>").attr("value","Run on complete dataset").appendTo(l),d=this;c.click(function(){d.run_on_dataset()})}};v.a.extend(at.prototype,{show:function(){this.parent_div.show()},hide:function(){this.parent_div.hide()},toggle:function(){this.parent_div.toggle()},visible:function(){return this.parent_div.is(":visible")},to_dict:function(){for(var t,e={},i=[],n=0;n<this.filters.length;n++)t=this.filters[n],i.push(t.to_dict());return e.filters=i,e.alpha_filter=this.alpha_filter?this.alpha_filter.name:null,e.height_filter=this.height_filter?this.height_filter.name:null,e.visible=this.parent_div.is(":visible"),e},copy:function(t){for(var e=new at(t),i=0;i<this.filters.length;i++)e.add_filter(this.filters[i].copy());return e},add_filter:function(t){t.manager=this,this.parent_div.append(t.parent_div),this.filters.push(t)},remove_all:function(){this.filters=[],this.parent_div.children().remove()},init_filters:function(){for(var t=0;t<this.filters.length;t++){this.filters[t].update_ui_elt()}},clear_filters:function(){for(var t=0;t<this.filters.length;t++){var e=this.filters[t];e.slider.slider("option","values",[e.min,e.max])}this.alpha_filter=null,this.height_filter=null,this.parent_div.find(".icon-button").hide()},run_on_dataset:function(){for(var t,e,i=function(t,e,i){return e in t||(t[e]=i),t[e]},n={},a=0;a<this.filters.length;a++)(t=this.filters[a]).tool_id&&(t.min!==t.low&&((e=i(n,t.tool_id,[]))[e.length]="".concat(t.tool_exp_name," >= ").concat(t.low)),t.max!==t.high&&((e=i(n,t.tool_id,[]))[e.length]="".concat(t.tool_exp_name," <= ").concat(t.high)));var o=[];for(var r in n)o[o.length]=[r,n[r]];!function t(e,i){var n=i[0],a=n[0],o=n[1],r={cond:"(".concat(o.join(") and ("),")"),input:e,target_dataset_id:e,tool_id:a};i=i.slice(1),s.a.getJSON(run_tool_url,r,function(e){var n=Object(d.a)();e.error?n.modal.show({title:h()("Filter Dataset"),body:"Error running tool ".concat(a),buttons:{Close:n.modal.hide()}}):0===i.length?n.modal.show({title:h()("Filtering Dataset"),body:"Filter(s) are running on the complete dataset. Outputs are in dataset's history.",buttons:{Close:n.modal.hide()}}):t(e.dataset_id,i)})}(this.track.dataset_id,o)}});var ot=at,st=nt,rt=i(22),lt=i(41),ct=i(32),dt=i(172),ut={BBIDataManager:p.a.GenomeDataManager.extend({load_data:function(t,e,i,n){var a=s.a.Deferred();this.set_data(t,a);var o="".concat(Object(c.getAppRoot)(),"datasets/").concat(this.get("dataset").id,"/display"),r=this;return s.a.when(dt.makeBwg(o)).then(function(e,i){s.a.when(e.readWigData(t.get("chrom"),t.get("start"),t.get("end"))).then(function(e){var i=[],n={max:Number.MIN_VALUE};e.forEach(function(t){n.max!==t.min-1&&(i.push([n.max+1,0]),i.push([t.min-2,0])),i.push([t.min-1,t.score]),i.push([t.max,t.score]),n=t});var o={data:i,region:t,dataset_type:"bigwig"};r.set_data(t,o),a.resolve(o)})}),a}})},ht=(i(62),a.a.extend),pt={};function ft(t,e){pt[t.attr("id")]=e}function mt(t,e,i,n){pt[t.attr("id")]=n,t.bind("drag",{handle:".".concat(e),relative:!0},function(t,e){var i,n,a,o,r,l=s()(this).parent(),c=l.children(".track,.group"),d=pt[s()(this).attr("id")];if(0!==(n=s()(this).parents(".group")).length){o=(a=n.position().top)+n.outerHeight();var u=pt[n.attr("id")];if(e.offsetY<a)return s()(this).insertBefore(n),u.remove_drawable(d),void u.container.add_drawable_before(d,u);if(e.offsetY>o)return s()(this).insertAfter(n),u.remove_drawable(d),void u.container.add_drawable(d)}for(n=null,r=0;r<c.length;r++)if(o=(a=(i=s()(c.get(r))).position().top)+i.outerHeight(),i.is(".group")&&this!==i.get(0)&&e.offsetY>=a&&e.offsetY<=o)return e.offsetY-a<o-e.offsetY?i.find(".content-div").prepend(this):i.find(".content-div").append(this),d.container&&d.container.remove_drawable(d),void pt[i.attr("id")].add_drawable(d);for(r=0;r<c.length&&(i=s()(c.get(r)),!(e.offsetY<i.position().top)||i.hasClass("reference-track")||i.hasClass("intro"));r++);r===c.length?this!==c.get(r-1)&&(l.append(this),pt[l.attr("id")].move_drawable(d,r)):this!==c.get(r)&&(s()(this).insertBefore(c.get(r)),pt[l.attr("id")].move_drawable(d,e.deltaY>0?r-1:r))}).bind("dragstart",function(){s()(this).addClass("dragging")}).bind("dragend",function(){s()(this).removeClass("dragging")})}var gt="A converter for this dataset is not installed. Please check your datatypes_conf.xml file.",_t=["Histogram","Line","Filled","Intensity"];function vt(t,e){e||(e=0);var i=Math.pow(10,e);return Math.round(t*i)/i}var bt=function t(e,i,n){if(t.id_counter||(t.id_counter=0),this.id=t.id_counter++,this.view=e,this.container=i,this.drag_handle_class=n.drag_handle_class,this.is_overview=!1,this.action_icons={},this.config=ct.a.ConfigSettingCollection.from_models_and_saved_values(this.build_config_params(),n.prefs),this.config.get_value("name")||this.config.set_value("name",n.name),this.config_onchange&&this.config.on("change",this.config_onchange,this),this.container_div=this.build_container_div(),this.header_div=null,!1!==n.header){var a=new m.TrackHeaderView({model:this,id:this.id});this.header_div=a.$el,this.container_div.append(this.header_div);var o=a.icons_div;this.action_icons=a.action_icons,this.container_div.hover(function(){o.show()},function(){o.hide()})}};bt.prototype.action_icons_def=[{name:"toggle_icon",title:"Hide/show content",css_class:"toggle",on_click_fn:function(t){t.config.get_value("content_visible")?(t.action_icons.toggle_icon.addClass("toggle-expand").removeClass("toggle"),t.hide_contents(),t.config.set_value("content_visible",!1)):(t.action_icons.toggle_icon.addClass("toggle").removeClass("toggle-expand"),t.config.set_value("content_visible",!0),t.show_contents())}},{name:"settings_icon",title:h()("Edit settings"),css_class:"gear",on_click_fn:function(t){new ct.a.ConfigSettingCollectionView({collection:t.config}).render_in_modal("Configure Track")}},{name:"remove_icon",title:h()("Remove"),css_class:"remove-icon",on_click_fn:function(t){s()(".tooltip").remove(),t.remove()}}],ht(bt.prototype,{config_params:[{key:"name",label:"Name",type:"text",default_value:""},{key:"content_visible",type:"bool",default_value:!0,hidden:!0}],build_config_params:function(){return this.config_params},config_onchange:function(){},init:function(){},changed:function(){this.view.changed()},can_draw:function(){return!(!this.enabled||!this.config.get_value("content_visible"))},request_draw:function(){},_draw:function(t){},to_dict:function(){},set_name:function(t){this.old_name=this.config.get_value("name"),this.config.set_value("name",t)},revert_name:function(){this.old_name&&this.config.set_value("name",this.old_name)},remove:function(){this.changed(),this.container.remove_drawable(this);var t=this.view;this.container_div.hide(0,function(){s()(this).remove(),t.update_intro_div()})},build_container_div:function(){},update_icons:function(){},hide_contents:function(){},show_contents:function(){},get_drawables:function(){}});var wt=function(t,e,i){bt.call(this,t,e,i),this.obj_type=i.obj_type,this.drawables=[]};ht(wt.prototype,bt.prototype,{unpack_drawables:function(t){var e;this.drawables=[];for(var i=0;i<t.length;i++)e=Ft(t[i],this.view,this),this.add_drawable(e)},init:function(){for(var t=0;t<this.drawables.length;t++)this.drawables[t].init()},_draw:function(t){for(var e=0;e<this.drawables.length;e++)this.drawables[e]._draw(t)},to_dict:function(){for(var t=[],e=0;e<this.drawables.length;e++)t.push(this.drawables[e].to_dict());return{prefs:this.config.to_key_value_dict(),obj_type:this.obj_type,drawables:t}},add_drawable:function(t){this.drawables.push(t),t.container=this,this.changed()},add_drawable_before:function(t,e){this.changed();var i=this.drawables.indexOf(e);return-1!==i&&(this.drawables.splice(i,0,t),!0)},replace_drawable:function(t,e,i){var n=this.drawables.indexOf(t);return-1!==n&&(this.drawables[n]=e,i&&t.container_div.replaceWith(e.container_div),this.changed()),n},remove_drawable:function(t){var e=this.drawables.indexOf(t);return-1!==e&&(this.drawables.splice(e,1),t.container=null,this.changed(),!0)},move_drawable:function(t,e){var i=this.drawables.indexOf(t);return-1!==i&&(this.drawables.splice(i,1),this.drawables.splice(e,0,t),this.changed(),!0)},get_drawables:function(){return this.drawables},get_tracks:function(t){for(var e,i=this.drawables.slice(0),n=[];0!==i.length;)(e=i.shift())instanceof t?n.push(e):e.drawables&&(i=i.concat(e.drawables));return n}});var yt=function(t,e,i){if(ht(i,{obj_type:"DrawableGroup",drag_handle_class:"group-handle"}),wt.call(this,t,e,i),this.content_div=s()("<div/>").addClass("content-div").attr("id","group_".concat(this.id,"_content_div")).appendTo(this.container_div),ft(this.container_div,this),ft(this.content_div,this),mt(this.container_div,this.drag_handle_class,0,this),this.filters_manager=new ot(this),this.header_div.after(this.filters_manager.parent_div),this.filters_manager.parent_div.after(s()("<div style='clear: both'/>")),this.saved_filters_managers=[],"drawables"in i&&this.unpack_drawables(i.drawables),"filters"in i){var n=this.filters_manager;this.filters_manager=new ot(this,i.filters),n.parent_div.replaceWith(this.filters_manager.parent_div),i.filters.visible&&this.setup_multitrack_filtering()}};ht(yt.prototype,bt.prototype,wt.prototype,{action_icons_def:[bt.prototype.action_icons_def[0],bt.prototype.action_icons_def[1],{name:"composite_icon",title:h()("Show composite track"),css_class:"layers-stack",on_click_fn:function(t){s()(".tooltip").remove(),t.show_composite_track()}},{name:"filters_icon",title:h()("Filters"),css_class:"ui-slider-050",on_click_fn:function(t){t.filters_manager.visible()?(t.filters_manager.clear_filters(),t._restore_filter_managers()):(t.setup_multitrack_filtering(),t.request_draw({clear_tile_cache:!0})),t.filters_manager.toggle()}},bt.prototype.action_icons_def[2]],build_container_div:function(){var t=s()("<div/>").addClass("group").attr("id","group_".concat(this.id));return this.container&&this.container.content_div.append(t),t},hide_contents:function(){this.tiles_div.hide()},show_contents:function(){this.tiles_div.show(),this.request_draw()},update_icons:function(){var t=this.drawables.length;if(0===t)this.action_icons.composite_icon.hide(),this.action_icons.filters_icon.hide();else if(1===t)this.action_icons.composite_icon.toggle(this.drawables[0]instanceof Mt),this.action_icons.filters_icon.hide();else{var e,i,n,a=this.drawables[0].get_type(),o=0;for(e=0;e<t&&(n=this.drawables[e]).get_type()===a;e++)n instanceof Vt&&o++;if(this.drawables[0]instanceof Et?this.action_icons.composite_icon.show():(this.action_icons.composite_icon.hide(),s()(".tooltip").remove()),o>1&&o===this.drawables.length){var r,l={};for(n=this.drawables[0],i=0;i<n.filters_manager.filters.length;i++)l[(r=n.filters_manager.filters[i]).name]=[r];for(e=1;e<this.drawables.length;e++)for(n=this.drawables[e],i=0;i<n.filters_manager.filters.length;i++)(r=n.filters_manager.filters[i]).name in l&&l[r.name].push(r);for(var c in this.filters_manager.remove_all(),l){var d=l[c];if(d.length===o){var u=new st({name:d[0].name,index:d[0].index});this.filters_manager.add_filter(u)}}this.action_icons.filters_icon.toggle(this.filters_manager.filters.length>0)}else this.action_icons.filters_icon.hide()}},_restore_filter_managers:function(){for(var t=0;t<this.drawables.length;t++)this.drawables[t].filters_manager=this.saved_filters_managers[t];this.saved_filters_managers=[]},setup_multitrack_filtering:function(){if(this.filters_manager.filters.length>0){this.saved_filters_managers=[];for(var t=0;t<this.drawables.length;t++){var e=this.drawables[t];this.saved_filters_managers.push(e.filters_manager),e.filters_manager=this.filters_manager}}this.filters_manager.init_filters()},show_composite_track:function(){var t=new Mt(this.view,this.view,{name:this.config.get_value("name"),drawables:this.drawables});this.container.replace_drawable(this,t,!0),t.request_draw()},add_drawable:function(t){wt.prototype.add_drawable.call(this,t),this.update_icons()},remove_drawable:function(t){wt.prototype.remove_drawable.call(this,t),this.update_icons()},to_dict:function(){this.filters_manager.visible()&&this._restore_filter_managers();var t=ht(wt.prototype.to_dict.call(this),{filters:this.filters_manager.to_dict()});return this.filters_manager.visible()&&this.setup_multitrack_filtering(),t},request_draw:function(t){a.a.each(this.drawables,function(e){e.request_draw(t)})}});var xt=l.a.View.extend({initialize:function(t){ht(t,{obj_type:"View"}),wt.call(this,"View",t.container,t),this.chrom=null,this.vis_id=t.vis_id,this.dbkey=t.dbkey,this.stand_alone=void 0===t.stand_alone||t.stand_alone,this.label_tracks=[],this.tracks_to_be_redrawn=[],this.max_low=0,this.max_high=0,this.zoom_factor=3,this.min_separation=30,this.has_changes=!1,this.load_chroms_deferred=null,this.render(),this.canvas_manager=new p.a.CanvasManager(this.container.get(0).ownerDocument),this.reset(),this.config=ct.a.ConfigSettingCollection.from_models_and_saved_values([{key:"name",label:"Name",type:"text",default_value:""},{key:"a_color",label:"A Color",type:"color",default_value:"#FF0000"},{key:"c_color",label:"C Color",type:"color",default_value:"#00FF00"},{key:"g_color",label:"G Color",type:"color",default_value:"#0000FF"},{key:"t_color",label:"T Color",type:"color",default_value:"#FF00FF"},{key:"n_color",label:"N Color",type:"color",default_value:"#AAAAAA"}],{name:t.name})},render:function(){this.requested_redraw=!1;var t=this.container,e=this;this.top_container=s()("<div/>").addClass("top-container").appendTo(t),this.browser_content_div=s()("<div/>").addClass("content").appendTo(t),this.bottom_container=s()("<div/>").addClass("bottom-container").appendTo(t),this.top_labeltrack=s()("<div/>").addClass("top-labeltrack").appendTo(this.top_container),this.viewport_container=s()("<div/>").addClass("viewport-container").attr("id","viewport-container").appendTo(this.browser_content_div),this.content_div=this.viewport_container,ft(this.viewport_container,e),this.intro_div=s()("<div/>").addClass("intro").appendTo(this.viewport_container),s()("<div/>").text("Add Datasets to Visualization").addClass("action-button").appendTo(this.intro_div).click(function(){p.a.select_datasets({dbkey:e.dbkey},function(t){a.a.each(t,function(t){e.add_drawable(Ft(t,e,e))})})}),t.css("overflow","visible"),this.nav_container=s()("<div/>").addClass("trackster-nav-container").prependTo(this.top_container),this.nav=s()("<div/>").addClass("trackster-nav").appendTo(this.nav_container),this.stand_alone&&(this.nav_container.addClass("stand-alone"),this.nav.addClass("stand-alone")),this.overview=s()("<div/>").addClass("overview").appendTo(this.bottom_container),this.overview_viewport=s()("<div/>").addClass("overview-viewport").appendTo(this.overview),this.overview_close=s()("<a/>").attr("title","Close overview").addClass("icon-button overview-close tooltip").hide().appendTo(this.overview_viewport),this.overview_highlight=s()("<div/>").addClass("overview-highlight").hide().appendTo(this.overview_viewport),this.overview_box_background=s()("<div/>").addClass("overview-boxback").appendTo(this.overview_viewport),this.overview_box=s()("<div/>").addClass("overview-box").appendTo(this.overview_viewport),this.default_overview_height=this.overview_box.height(),this.nav_controls=s()("<div/>").addClass("nav-controls").appendTo(this.nav),this.chrom_select=s()("<select/>").attr({name:"chrom"}).addClass("chrom-nav").append("<option value=''>Loading</option>").appendTo(this.nav_controls);this.nav_input=s()("<input/>").addClass("nav-input").hide().bind("keyup focusout",function(t){"focusout"!==t.type&&13!==(t.keyCode||t.which)&&27!==(t.keyCode||t.which)||(27!==(t.keyCode||t.which)&&e.go_to(s()(this).val()),s()(this).hide(),s()(this).val(""),e.location_span.show(),e.chrom_select.show()),t.stopPropagation()}).appendTo(this.nav_controls),this.location_span=s()("<span/>").addClass("location").attr("title","Click to change location").tooltip({placement:"bottom"}).appendTo(this.nav_controls),this.location_span.click(function(){e.location_span.hide(),e.chrom_select.hide(),e.nav_input.val("".concat(e.chrom,":").concat(e.low,"-").concat(e.high)),e.nav_input.css("display","inline-block"),e.nav_input.select(),e.nav_input.focus(),e.nav_input.autocomplete({source:function(t,i){var n=[],a=s.a.map(e.get_tracks(Vt),function(e){return e.data_manager.search_features(t.term).success(function(t){n=n.concat(t)})});s.a.when.apply(s.a,a).done(function(){i(s.a.map(n,function(t){return{label:t[0],value:t[1]}}))})},minLength:2})}),void 0!==this.vis_id&&(this.hidden_input=s()("<input/>").attr("type","hidden").val(this.vis_id).appendTo(this.nav_controls)),this.zo_link=s()("<a/>").attr("id","zoom-out").attr("title","Zoom out").tooltip({placement:"bottom"}).click(function(){e.zoom_out()}).appendTo(this.nav_controls),this.zi_link=s()("<a/>").attr("id","zoom-in").attr("title","Zoom in").tooltip({placement:"bottom"}).click(function(){e.zoom_in()}).appendTo(this.nav_controls),this.load_chroms_deferred=this.load_chroms({low:0}),this.chrom_select.bind("change",function(){e.change_chrom(e.chrom_select.val())}),this.browser_content_div.click(function(t){s()(this).find("input").trigger("blur")}),this.browser_content_div.bind("dblclick",function(t){e.zoom_in(t.pageX,this.viewport_container)}),this.overview_box.bind("dragstart",function(t,e){this.current_x=e.offsetX}).bind("drag",function(t,i){var n=i.offsetX-this.current_x;this.current_x=i.offsetX;var a=Math.round(n/e.viewport_container.width()*(e.max_high-e.max_low));e.move_delta(-a)}),this.overview_close.click(function(){e.reset_overview()}),this.viewport_container.bind("draginit",function(t,i){if(t.clientX>e.viewport_container.width()-16)return!1}).bind("dragstart",function(t,i){i.original_low=e.low,i.current_height=t.clientY,i.current_x=i.offsetX}).bind("drag",function(t,i){var n=s()(this),a=i.offsetX-i.current_x,o=n.scrollTop()-(t.clientY-i.current_height);n.scrollTop(o),i.current_height=t.clientY,i.current_x=i.offsetX;var r=Math.round(a/e.viewport_container.width()*(e.high-e.low));e.move_delta(r)}),this.top_labeltrack.bind("dragstart",function(t,i){return s()("<div/>").addClass("zoom-area").css("height",e.browser_content_div.height()+e.top_labeltrack.height()+1).appendTo(s()(this))}).bind("drag",function(t,i){s()(i.proxy).css({left:Math.min(t.pageX,i.startX)-e.container.offset().left,width:Math.abs(t.pageX-i.startX)});var n=Math.min(t.pageX,i.startX)-e.container.offset().left,a=Math.max(t.pageX,i.startX)-e.container.offset().left,o=e.high-e.low,r=e.viewport_container.width();e.update_location(Math.round(n/r*o)+e.low,Math.round(a/r*o)+e.low)}).bind("dragend",function(t,i){var n=Math.min(t.pageX,i.startX),a=Math.max(t.pageX,i.startX),o=e.high-e.low,r=e.viewport_container.width(),l=e.low;e.low=Math.round(n/r*o)+l,e.high=Math.round(a/r*o)+l,s()(i.proxy).remove(),e.request_redraw()}),this.add_label_track(new It(this,{content_div:this.top_labeltrack})),s()(window).bind("resize",function(){this.resize_timer&&window.clearTimeout(this.resize_timer),this.resize_timer=window.setTimeout(function(){e.resize_window()},500)}),s()(document).bind("redraw",function(){e.redraw()}),this.reset(),s()(window).trigger("resize")},get_base_color:function(t){return this.config.get_value("".concat(t.toLowerCase(),"_color"))||this.config.get_value("n_color")}});ht(xt.prototype,wt.prototype,{changed:function(){this.has_changes=!0},update_intro_div:function(){this.intro_div.toggle(0===this.drawables.length)},trigger_navigate:function(t,e,i,n){var a=this;this.timer&&window.clearTimeout(this.timer),n?this.timer=window.setTimeout(function(){a.trigger("navigate","".concat(t,":").concat(e,"-").concat(i))},500):this.trigger("navigate","".concat(t,":").concat(e,"-").concat(i))},update_location:function(t,e){this.location_span.text("".concat(g.a.commatize(t)," - ").concat(g.a.commatize(e))),this.nav_input.val("".concat(this.chrom,":").concat(g.a.commatize(t),"-").concat(g.a.commatize(e)));var i=this.chrom_select.val();""!==i&&this.trigger_navigate(i,this.low,this.high,!0)},load_chroms:function(t){var e=this;t.num=100;var i=s.a.Deferred();return s.a.ajax({url:"".concat(Object(c.getAppRoot)(),"api/genomes/").concat(this.dbkey),data:t,dataType:"json",success:function(t){if(0!==t.chrom_info.length){if(t.reference){var n=new Rt(e);e.add_label_track(n),e.reference_track=n}e.chrom_data=t.chrom_info,e.chrom_select.html(""),e.chrom_select.append(s()('<option value="">Select Chrom/Contig</option>'));for(var a=0,o=e.chrom_data.length;a<o;a++){var r=e.chrom_data[a].chrom,l=s()("<option>");l.text(r),l.val(r),e.chrom_select.append(l)}t.prev_chroms&&e.chrom_select.append(s()('<option value="previous">Previous '.concat(100,"</option>"))),t.next_chroms&&e.chrom_select.append(s()('<option value="next">Next '.concat(100,"</option>"))),e.chrom_start_index=t.start_index,i.resolve(t.chrom_info)}},error:function(){alert("Could not load chroms for this dbkey: ".concat(this.dbkey))}}),i},change_chrom:function(t,e,i){var n=this;if(n.chrom_data){if(t&&"None"!==t)if("previous"!==t)if("next"!==t){var a=s.a.grep(n.chrom_data,function(e,i){return e.chrom===t})[0];if(void 0!==a){if(t!==n.chrom){n.chrom=t,n.chrom_select.val(n.chrom),n.max_high=a.len-1,n.reset();for(var o=0,r=n.drawables.length;o<r;o++){var l=n.drawables[o];l.init&&l.init()}n.reference_track&&n.reference_track.init()}void 0===e&&void 0===i?(n.low=0,n.high=n.max_high):(n.low=void 0!==e?Math.max(e,0):0,void 0===i?(n.low=Math.max(n.low-15,0),n.high=n.low+30):n.high=Math.min(i,n.max_high)),n.request_redraw()}else n.load_chroms({chrom:t},function(){n.change_chrom(t,e,i)})}else n.load_chroms({low:this.chrom_start_index+100});else n.load_chroms({low:this.chrom_start_index-100})}else n.load_chroms_deferred.then(function(){n.change_chrom(t,e,i)})},go_to:function(t){var e=(t=(t=t.replace(/,/g,"")).replace(/:|-/g," ")).split(/\s+/),i=e[0],n=e[1]?parseInt(e[1],10):void 0,a=e[2]?parseInt(e[2],10):void 0;this.change_chrom(i,n,a)},move_fraction:function(t){var e=this.high-this.low;this.move_delta(t*e)},move_delta:function(t){var e=this,i=e.high-e.low;e.low-t<e.max_low?(e.low=e.max_low,e.high=e.max_low+i):e.high-t>e.max_high?(e.high=e.max_high,e.low=e.max_high-i):(e.high-=t,e.low-=t),e.request_redraw({data_fetch:!1}),this.redraw_on_move_fn&&window.clearTimeout(this.redraw_on_move_fn),this.redraw_on_move_fn=window.setTimeout(function(){e.request_redraw()},200);var n=e.chrom_select.val();this.trigger_navigate(n,e.low,e.high,!0)},add_drawable:function(t){wt.prototype.add_drawable.call(this,t),t.init(),this.changed(),this.update_intro_div();var e=this;t.config.on("change",function(){e.changed()})},add_label_track:function(t){t.view=this,t.init(),this.label_tracks.push(t)},remove_drawable:function(t,e){if(wt.prototype.remove_drawable.call(this,t),e){var i=this;t.container_div.hide(0,function(){s()(this).remove(),i.update_intro_div()})}},reset:function(){this.low=this.max_low,this.high=this.max_high,this.viewport_container.find(".yaxislabel").remove()},request_redraw:function(t,e){var i=this,n=e?[e]:i.drawables;a.a.each(n,function(e){var n=a.a.find(i.tracks_to_be_redrawn,function(t){return t[0]===e});n?n[1]=t:i.tracks_to_be_redrawn.push([e,t])}),this.requested_redraw||(window.requestAnimationFrame(function(){i._redraw()}),this.requested_redraw=!0)},_redraw:function(){this.requested_redraw=!1;var t=this.low,e=this.high;t<this.max_low&&(t=this.max_low),e>this.max_high&&(e=this.max_high);var i=this.high-this.low;0!==this.high&&i<this.min_separation&&(e=t+this.min_separation),this.low=Math.floor(t),this.high=Math.ceil(e),this.update_location(this.low,this.high),this.resolution_px_b=this.viewport_container.width()/(this.high-this.low);var n=this.low/(this.max_high-this.max_low)*this.overview_viewport.width()||0,o=(this.high-this.low)/(this.max_high-this.max_low)*this.overview_viewport.width()||0;this.overview_box.css({left:n,width:Math.max(13,o)}).show(),o<13&&this.overview_box.css("left",n-(13-o)/2),this.overview_highlight&&this.overview_highlight.css({left:n,width:o}),a.a.each(this.tracks_to_be_redrawn,function(t){var e=t[0],i=t[1];e&&e._draw(i)}),this.tracks_to_be_redrawn=[],a.a.each(this.label_tracks,function(t){t._draw()})},zoom_in:function(t,e){if(!(0===this.max_high||this.high-this.low<=this.min_separation)){var i=this.high-this.low,n=i/2+this.low,a=i/this.zoom_factor/2;t&&(n=t/this.viewport_container.width()*(this.high-this.low)+this.low),this.low=Math.round(n-a),this.high=Math.round(n+a),this.changed(),this.request_redraw()}},zoom_out:function(){if(0!==this.max_high){var t=this.high-this.low,e=t/2+this.low,i=t*this.zoom_factor/2;this.low=Math.round(e-i),this.high=Math.round(e+i),this.changed(),this.request_redraw()}},resize_viewport:function(){this.viewport_container.height(this.container.height()-this.top_container.height()-this.bottom_container.height())},resize_window:function(){this.resize_viewport(),this.request_redraw()},set_overview:function(t){if(this.overview_drawable){if(this.overview_drawable.dataset.id===t.dataset.id)return;this.overview_viewport.find(".track").remove()}var e=t.copy({content_div:this.overview_viewport}),i=this;e.header_div.hide(),e.is_overview=!0,i.overview_drawable=e,this.overview_drawable.postdraw_actions=function(){i.overview_highlight.show().height(i.overview_drawable.content_div.height()),i.overview_viewport.height(i.overview_drawable.content_div.height()+i.overview_box.outerHeight()),i.overview_close.show(),i.resize_window()},i.overview_drawable.request_draw(),this.changed()},reset_overview:function(){s()(".tooltip").remove(),this.overview_viewport.find(".track-tile").remove(),this.overview_viewport.height(this.default_overview_height),this.overview_box.height(this.default_overview_height),this.overview_close.hide(),this.overview_highlight.hide(),this.resize_window(),this.overview_drawable=null}});var kt=lt.a.Tool.extend({defaults:{track:null},initialize:function(t){lt.a.Tool.prototype.initialize.call(this,t);var e=!0;void 0!==t.tool_state&&void 0!==t.tool_state.hidden&&(e=t.tool_state.hidden),this.set("hidden",e),this.remove_inputs(["data","hidden_data","conditional"])},state_dict:function(t){return a.a.extend(this.get_inputs_dict(),{hidden:!this.is_visible()})}}),Ct=l.a.View.extend({events:{"change :input":"update_value"},render:function(){var t=this.$el.addClass("param-row"),e=this.model;s()("<div>").addClass("param-label").text(e.get("label")).appendTo(t),s()("<div/>").addClass("param-input").html(e.get("html")).appendTo(t).find(":input").val(e.get("value")),s()("<div style='clear: both;'/>").appendTo(t)},update_value:function(t){this.model.set_value(s()(t.target).val())}}),St=l.a.View.extend({initialize:function(t){this.model.on("change:hidden",this.set_visible,this)},render:function(){var t=this,e=this.model,i=this.$el.addClass("dynamic-tool").hide();i.bind("drag",function(t){t.stopPropagation()}).click(function(t){t.stopPropagation()}).bind("dblclick",function(t){t.stopPropagation()}).keydown(function(t){t.stopPropagation()}),s()("<div class='tool-name'>").appendTo(i).text(e.get("name")),e.get("inputs").each(function(t){var e=new Ct({model:t});e.render(),i.append(e.$el)}),i.find("input").click(function(){s()(this).select()});var n=s()("<div>").addClass("param-row").appendTo(i),a=s()("<input type='submit'>").attr("value","Run on complete dataset").appendTo(n);s()("<input type='submit'>").attr("value","Run on visible region").appendTo(n).click(function(){t.run_on_region()}),a.click(function(){t.run_on_dataset()}),e.is_visible()&&this.$el.show()},set_visible:function(){this.$el.toggle(this.model.is_visible())},update_params:function(){for(var t=0;t<this.params.length;t++)this.params[t].update_value()},run_on_dataset:function(){var t=this.model,e=Object(d.a)();this.run({target_dataset_id:this.model.get("track").dataset.id,action:"rerun",tool_id:t.id},null,function(i){e.modal.show({title:"".concat(t.get("name")," is Running"),body:"".concat(t.get("name")," is running on the complete dataset. Tool outputs are in dataset's history."),buttons:{Close:function(){e.modal.hide()}}})})},run_on_region:function(){var t,e=this.model.get("track"),i=this.model,n=new p.a.GenomeRegion({chrom:e.view.chrom,start:e.view.low,end:e.view.high}),a={target_dataset_id:e.dataset.id,action:"rerun",tool_id:i.id,regions:[n.toJSON()]},o=i.get("name")+e.tool_region_and_parameters_str(n);if(e.container===e.view){var s=new yt(e.view,e.view,{name:e.config.get_value("name")}),r=e.container.replace_drawable(e,s,!1);s.container_div.insertBefore(e.view.content_div.children()[r]),s.add_drawable(e),e.container_div.appendTo(s.content_div),t=s}else t=e.container;var l=new e.constructor(e.view,t,{name:o,hda_ldda:"hda"});l.init_for_tool_data(),l.change_mode(e.mode),l.set_filters_manager(e.filters_manager.copy(l)),l.update_icons(),t.add_drawable(l),l.tiles_div.text("Starting job."),this.run(a,l,function(t){l.set_dataset(new rt.a(t)),l.tiles_div.text("Running job."),l.init()})},run:function(t,e,i){t.inputs=this.model.get_inputs_dict();var n=new g.a.ServerStateDeferred({ajax_settings:{url:"".concat(Object(c.getAppRoot)(),"api/tools"),data:JSON.stringify(t),dataType:"json",contentType:"application/json",type:"POST"},interval:2e3,success_fn:function(t){return"pending"!==t}});s.a.when(n.go()).then(function(t){"no converter"===t?(e.container_div.addClass("error"),e.content_div.text(gt)):t.error?(e.container_div.addClass("error"),e.content_div.text("Tool cannot be rerun: "+t.message)):i(t)})}}),Tt=function(t,e){tt.Scaler.call(this,e),this.filter=t};Tt.prototype.gen_val=function(t){return this.filter.high===Number.MAX_VALUE||this.filter.low===-Number.MAX_VALUE||this.filter.low===this.filter.high?this.default_val:(parseFloat(t[this.filter.index])-this.filter.low)/(this.filter.high-this.filter.low)};var $t=function(t,e,i,n,a){this.track=t,this.region=e,this.low=e.get("start"),this.high=e.get("end"),this.w_scale=i,this.canvas=n,this.html_elt=s()("<div class='track-tile'/>").append(n),this.data=a,this.stale=!1};$t.prototype.predisplay_actions=function(){};var Ot=function(t,e,i,n,a){$t.call(this,t,e,i,n,a)};Ot.prototype.predisplay_actions=function(){};var At=function(t,e,i,n,a,o,s,r,l,c,d){$t.call(this,t,e,i,n,a),this.mode=o,this.all_slotted=r,this.feature_mapper=l,this.has_icons=!1,this.incomplete_features=c,this.other_tiles_features_drawn={},this.seq_data=d};ht(At.prototype,$t.prototype),At.prototype.predisplay_actions=function(){};var jt=function(t,e,i){ht(i,{drag_handle_class:"draghandle"}),bt.call(this,t,e,i),this.dataset=null,i.dataset&&(this.dataset=i.dataset instanceof l.a.Model?i.dataset:new rt.a(i.dataset)),this.dataset_check_type="converted_datasets_state",this.data_url_extra_params={},this.data_query_wait="data_query_wait"in i?i.data_query_wait:5e3,this.data_manager="data_manager"in i?i.data_manager:new p.a.GenomeDataManager({dataset:this.dataset,genome:new p.a.Genome({key:t.dbkey,chroms_info:{chrom_info:t.chrom_data}}),data_mode_compatible:this.data_and_mode_compatible,can_subset:this.can_subset}),this.min_height_px=16,this.max_height_px=800,this.visible_height_px=this.config.get_value("height"),this.content_div=s()("<div class='track-content'>").appendTo(this.container_div),this.container&&(this.container.content_div.append(this.container_div),"resize"in i&&!i.resize||this.add_resize_handle())};ht(jt.prototype,bt.prototype,{action_icons_def:[{name:"mode_icon",title:h()("Set display mode"),css_class:"chevron-expand",on_click_fn:function(){}},bt.prototype.action_icons_def[0],{name:"overview_icon",title:h()("Set as overview"),css_class:"application-dock-270",on_click_fn:function(t){t.view.set_overview(t)}},bt.prototype.action_icons_def[1],{name:"filters_icon",title:h()("Filters"),css_class:"ui-slider-050",on_click_fn:function(t){t.filters_manager.visible()?t.filters_manager.clear_filters():t.filters_manager.init_filters(),t.filters_manager.toggle()}},{name:"tools_icon",title:h()("Tool"),css_class:"hammer",on_click_fn:function(t){t.tool.toggle(),t.tool.is_visible()?t.set_name(t.config.get_value("name")+t.tool_region_and_parameters_str()):t.revert_name(),s()(".tooltip").remove()}},{name:"param_space_viz_icon",title:h()("Tool parameter space visualization"),css_class:"arrow-split",on_click_fn:function(t){var e=Object(d.a)(),i="\n                    <strong>Tool</strong>:".concat(t.tool.get("name"),"<br/>\n                    <strong>Dataset</strong>:").concat(t.config.get_value("name"),'<br/>\n                    <strong>Region(s)</strong>:\n                        <select name="regions">\n                            <option value="cur">current viewing area</option>\n                            <option value="bookmarks">bookmarks</option>\n                            <option value="both">current viewing area and bookmarks</option>\n                        </select>\n                    ');e.modal.show({title:"Visualize tool parameter space and output from different parameter settings?",body:i,buttons:{No:function(){e.modal.hide(),s()(window).unbind("keypress.check_enter_esc")},Yes:function(){var i,n=s()('select[name="regions"] option:selected').val(),o=new p.a.GenomeRegion({chrom:(void 0).view.chrom,start:(void 0).view.low,end:(void 0).view.high}),r=a.a.map(s()(".bookmark"),function(t){return new p.a.GenomeRegion({from_str:s()(t).children(".position").text()})});i="cur"===n?[o]:"bookmarks"===n?r:[o].concat(r),e.modal.hide(),window.top.location.href="".concat(Object(c.getAppRoot)(),"visualization/sweepster?").concat(s.a.param({dataset_id:t.dataset.id,hda_ldda:t.dataset.get("hda_ldda"),regions:JSON.stringify(new l.a.Collection(i).toJSON())}))}}})}},bt.prototype.action_icons_def[2]],can_draw:function(){return this.dataset&&bt.prototype.can_draw.call(this)},build_container_div:function(){return s()("<div/>").addClass("track").attr("id","track_".concat(this.id))},set_dataset:function(t){this.dataset=t,this.data_manager.set("dataset",t)},on_resize:function(){this.request_draw({clear_tile_cache:!0})},add_resize_handle:function(){var t=this,e=!1,i=!1,n=s()("<div class='track-resize'>");s()(t.container_div).hover(function(){t.config.get_value("content_visible")&&(e=!0,n.show())},function(){e=!1,i||n.hide()}),n.hide().bind("dragstart",function(e,n){i=!0,n.original_height=s()(t.content_div).height()}).bind("drag",function(e,i){var n=Math.min(Math.max(i.original_height+i.deltaY,t.min_height_px),t.max_height_px);s()(t.tiles_div).css("height",n),t.visible_height_px=t.max_height_px===n?0:n,t.on_resize()}).bind("dragend",function(a,o){t.tile_cache.clear(),i=!1,e||n.hide(),t.config.set_value("height",t.visible_height_px),t.changed()}).appendTo(t.container_div)},hide_contents:function(){this.tiles_div.hide(),this.container_div.find(".yaxislabel, .track-resize").hide()},show_contents:function(){this.tiles_div.show(),this.container_div.find(".yaxislabel, .track-resize").show(),this.request_draw()},get_type:function(){return this instanceof It?"LabelTrack":this instanceof Rt?"ReferenceTrack":this instanceof Et?"LineTrack":this instanceof zt?"ReadTrack":this instanceof Lt?"VariantTrack":this instanceof Mt?"CompositeTrack":this instanceof Vt?"FeatureTrack":""},show_message:function(t){return this.tiles_div.remove(),s()("<span/>").addClass("message").html(t).appendTo(this.content_div)},init:function(t){var e=this;if(e.enabled=!1,e.tile_cache.clear(),e.data_manager.clear(),e.content_div.children().remove(),e.container_div.removeClass("nodata error pending"),e.tiles_div=s()("<div/>").addClass("tiles").appendTo(e.content_div),e.dataset.id){var i=s.a.Deferred(),n={hda_ldda:e.dataset.get("hda_ldda"),data_type:this.dataset_check_type,chrom:e.view.chrom,retry:t};return s.a.getJSON(this.dataset.url(),n,function(t){if(t&&"error"!==t&&"error"!==t.kind)"no converter"===t?(e.container_div.addClass("error"),e.show_message(gt)):"no data"===t||void 0!==t.data&&(null===t.data||0===t.data.length)?(e.container_div.addClass("nodata"),e.show_message("No data for this chrom/contig.")):"pending"===t?(e.container_div.addClass("pending"),e.show_message("Preparing data. This can take a while for a large dataset. If the visualization is saved and closed, preparation will continue in the background."),window.setTimeout(function(){e.init()},e.data_query_wait)):"data"!==t&&"data"!==t.status||(t.valid_chroms&&(e.valid_chroms=t.valid_chroms,e.update_icons()),e.tiles_div.text("Ready for display"),e.view.chrom?(e.tiles_div.text(""),e.tiles_div.css("height","".concat(e.visible_height_px,"px")),e.enabled=!0,s.a.when.apply(s.a,e.predraw_init()).done(function(){i.resolve(),e.container_div.removeClass("nodata error pending"),e.request_draw()})):i.resolve());else{e.container_div.addClass("error");var n=e.show_message("Cannot display dataset due to an error. ");t.message&&(n.append(s()("<a href='javascript:void(0);'></a>").text("View error").click(function(){var e=Object(d.a)();e.modal.show({title:h()("Trackster Error"),body:"<pre>".concat(t.message,"</pre>"),buttons:{Close:function(){e.modal.hide()}}})})),n.append(s()("<span/>").text(" ")),n.append(s()("<a href='javascript:void(0);'></a>").text("Try again").click(function(){e.init(!0)})))}}),this.update_icons(),i}},predraw_init:function(){var t=this;return s.a.getJSON(t.dataset.url(),{data_type:"data",stats:!0,chrom:t.view.chrom,low:0,high:t.view.max_high,hda_ldda:t.dataset.get("hda_ldda")},function(e){var i=e.data;if(i&&void 0!==i.min&&void 0!==i.max){var n=i.min,a=i.max;n=Math.floor(Math.min(0,Math.max(n,i.mean-2*i.sd))),a=Math.ceil(Math.max(0,Math.min(a,i.mean+2*i.sd))),t.config.set_default_value("min_value",n),t.config.set_default_value("max_value",a),t.config.set_value("min_value",n),t.config.set_value("max_value",a)}})},get_drawables:function(){return this}});var Dt=function(t,e,i){jt.call(this,t,e,i);if(mt(this.container_div,this.drag_handle_class,0,this),this.filters_manager=new ot(this,"filters"in i?i.filters:null),this.data_manager.set("filters_manager",this.filters_manager),this.filters_available=!1,this.tool=i.tool?new kt(a.a.extend(i.tool,{track:this,tool_state:i.tool_state})):null,this.tile_cache=new p.a.Cache(10),this.left_offset=0,this.header_div&&(this.set_filters_manager(this.filters_manager),this.tool)){var n=new St({model:this.tool});n.render(),this.dynamic_tool_div=n.$el,this.header_div.after(this.dynamic_tool_div)}this.tiles_div=s()("<div/>").addClass("tiles").appendTo(this.content_div),this.config.get_value("content_visible")||this.tiles_div.hide(),this.overlay_div=s()("<div/>").addClass("overlay").appendTo(this.content_div),i.mode&&this.change_mode(i.mode)};ht(Dt.prototype,bt.prototype,jt.prototype,{action_icons_def:jt.prototype.action_icons_def.concat([{name:"show_more_rows_icon",title:"To minimize track height, not all feature rows are displayed. Click to display more rows.",css_class:"exclamation",on_click_fn:function(t){s()(".tooltip").remove(),t.slotters[t.view.resolution_px_b].max_rows*=2,t.request_draw({clear_tile_cache:!0})},hide:!0}]),copy:function(t){var e=this.to_dict();ht(e,{data_manager:this.data_manager});var i=new this.constructor(this.view,t,e);return i.change_mode(this.mode),i.enabled=this.enabled,i},set_filters_manager:function(t){this.filters_manager=t,this.header_div.after(this.filters_manager.parent_div)},to_dict:function(){return{track_type:this.get_type(),dataset:{id:this.dataset.id,hda_ldda:this.dataset.get("hda_ldda")},prefs:this.config.to_key_value_dict(),mode:this.mode,filters:this.filters_manager.to_dict(),tool_state:this.tool?this.tool.state_dict():{}}},set_min_max:function(){var t=this;return s.a.getJSON(t.dataset.url(),{data_type:"data",stats:!0,chrom:t.view.chrom,low:0,high:t.view.max_high,hda_ldda:t.dataset.get("hda_ldda")},function(e){var i=e.data;if(isNaN(parseFloat(t.config.get_value("min_value")))||isNaN(parseFloat(t.config.get_value("max_value")))){var n=i.min,a=i.max;n=Math.floor(Math.min(0,Math.max(n,i.mean-2*i.sd))),a=Math.ceil(Math.max(0,Math.min(a,i.mean+2*i.sd))),t.config.set_value("min_value",n),t.config.set_value("max_value",a)}})},change_mode:function(t){return this.mode=t,this.config.set_value("mode",t),"Auto"===t&&this.data_manager.clear(),this.request_draw({clear_tile_cache:!0}),this.action_icons.mode_icon.attr("title","Set display mode (now: ".concat(this.mode,")")),this},update_icons:function(){this.action_icons.filters_icon.toggle(this.filters_available),this.action_icons.tools_icon.toggle(null!==this.tool),this.action_icons.param_space_viz_icon.toggle(null!==this.tool)},_gen_tile_cache_key:function(t,e){return"".concat(t,"_").concat(e)},request_draw:function(t){t&&t.clear_tile_cache&&this.tile_cache.clear(),this.view.request_redraw(t,this)},before_draw:function(){this.max_height_px=0},_draw:function(t){var e=this;if(this.can_draw()){var i=t&&t.clear_after,n=this.view.low,o=this.view.high,r=this.view.container.width(),l=this.view.resolution_px_b,c=1/l;this.is_overview&&(n=this.view.max_low,o=this.view.max_high,c=1/(l=r/(this.view.max_high-this.view.max_low))),this.before_draw(),this.tiles_div.children().addClass("remove");for(var d,u,h=Math.floor(400*c),f=Math.floor(n/h),m=[],g=[];f*h<o;)d=new p.a.GenomeRegion({chrom:this.view.chrom,start:f*h,end:Math.min((f+1)*h,this.view.max_high)}),u=this.draw_helper(d,l,t),m.push(u),s.a.when(u).then(function(t){g.push(t)}),f+=1;i||this.tiles_div.children(".remove").removeClass("remove").remove(),s.a.when.apply(s.a,m).then(function(){e.tiles_div.children(".remove").remove(),0!==(g=a.a.filter(g,function(t){return null!==t})).length&&e.postdraw_actions(g,r,l,i)})}},_add_yaxis_label:function(t,e){var i=this,n="max"===t?"top":"bottom",a="max"===t?"max":"min",o="max"===t?"max_value":"min_value",r=this.container_div.find(".yaxislabel.".concat(n)),l=vt(this.config.get_value(o),1);e=e||function(){i.request_draw({clear_tile_cache:!0})},0!==r.length?r.text(l):(r=s()("<div/>").text(l).make_text_editable({num_cols:12,on_finish:function(t){s()(".tooltip").remove(),this.config.set_value(o,vt(t,1)),e()},help_text:"Set ".concat(a," value")}).addClass("yaxislabel ".concat(n)).css("color",this.config.get_value("label_color")),this.container_div.prepend(r))},postdraw_actions:function(t,e,i,n){var o=this;a.a.filter(t,function(t){return t instanceof Ot}).length>0?(this.max_height_px=0,a.a.each(t,function(t){t instanceof Ot||(t.html_elt.remove(),o.draw_helper(t.region,i,{force:!0,mode:"Coverage"}))}),this._add_yaxis_label("max")):(this.container_div.find(".yaxislabel").remove(),a.a.find(t,function(t){return t.has_icons})&&a.a.each(t,function(t){t.has_icons||t.html_elt.css("padding-top",20)}))},get_mode:function(t){return this.mode},update_auto_mode:function(t){},_get_drawables:function(){return[this]},draw_helper:function(t,e,i){var n=this;i||(i={});var o,r=i.force,l=i.mode||this.mode,c=1/e,d=this._get_drawables(),u=this._gen_tile_cache_key(e,t),h=r?void 0:this.tile_cache.get_elt(u);if(h)return(o=h)&&"track"in o&&this.show_tile(h,e),h;if(!1===i.data_fetch)return null;var p=function(){var e=a.a.find(_t,function(t){return t===l})?"Coverage":l,i=a.a.map(d,function(i){return i.data_manager.get_data(t,e,c,n.data_url_extra_params)});return n.view.reference_track&&i.push(n.view.reference_track.data_manager.get_data(t,l,c,n.view.reference_track.data_url_extra_params)),i},f=s.a.Deferred();return this.tile_cache.set_elt(u,f),s.a.when.apply(s.a,p()).then(function(){var o,r=p(),l=r;if(a.a.find(r,function(t){return g.a.is_deferred(t)}))return n.tile_cache.set_elt(u,void 0),void s.a.when(n.draw_helper(t,e,i)).then(function(t){f.resolve(t)});n.view.reference_track&&(o=n.view.reference_track.data_manager.subset_entry(r.pop(),t));var c=[],h=[];a.a.each(d,function(t,i){var n=l[i];"Auto"===t.mode&&(t.mode=t.get_mode(n),t.update_auto_mode(t.mode)),c.push(t.mode),h.push(t.get_canvas_height(n,t.mode,e,w))});var m,_=n.view.canvas_manager.new_canvas(),v=t.get("start"),b=t.get("end"),w=Math.ceil((b-v)*e)+n.left_offset,y=a.a.max(h);_.width=w,_.height=i.height||y;var x=_.getContext("2d");x.translate(n.left_offset,0),d.length>1&&(x.globalAlpha=.5,x.globalCompositeOperation="source-over"),a.a.each(d,function(i,n){m=i.draw_tile(l[n],x,c[n],t,e,o)}),void 0!==m&&(n.tile_cache.set_elt(u,m),n.show_tile(m,e)),f.resolve(m)}),f},get_canvas_height:function(t,e,i,n){return this.visible_height_px},_draw_line_track_tile:function(t,e,i,n,o){-1!==[void 0,null].indexOf(this.config.get_value("min_value"))&&this.config.set_value("min_value",0),-1!==[void 0,null,0].indexOf(this.config.get_value("max_value"))&&this.config.set_value("max_value",a.a.max(a.a.map(t.data,function(t){return t[1]}))||0);var s=e.canvas;return new tt.LinePainter(t.data,n.get("start"),n.get("end"),this.config.to_key_value_dict(),i).draw(e,s.width,s.height,o),new Ot(this,n,o,s,t.data)},draw_tile:function(t,e,i,n,a,o){},show_tile:function(t,e){var i=t.html_elt;t.predisplay_actions();var n=Math.round((t.low-(this.is_overview?this.view.max_low:this.view.low))*e);this.left_offset&&(n-=this.left_offset),i.css("left",n),i.hasClass("remove")?i.removeClass("remove"):this.tiles_div.append(i),i.css("height","auto"),this.max_height_px=Math.max(this.max_height_px,i.height()-2),i.parent().children().css("height","".concat(this.max_height_px,"px"));var a=this.max_height_px;0!==this.visible_height_px&&(a=Math.min(this.max_height_px,this.visible_height_px)),this.tiles_div.css("height","".concat(a,"px"))},tool_region_and_parameters_str:function(t){var e=void 0!==t?t.toString():"all",i=a.a.values(this.tool.get_inputs_dict()).join(", ");return" - region=[".concat(e,"], parameters=[").concat(i,"]")},data_and_mode_compatible:function(t,e){return"Auto"===e||("Coverage"===e?"bigwig"===t.dataset_type:"bigwig"!==t.dataset_type&&"no_detail"!==t.extra_info)},can_subset:function(t){return!t.message&&"no_detail"!==t.extra_info&&("bigwig"!==t.dataset_type||t.data[1][0]-t.data[0][0]==1)},init_for_tool_data:function(){this.data_manager.set("data_type","raw_data"),this.data_query_wait=1e3,this.dataset_check_type="state"}});var It=function(t,e){jt.call(this,t,e,{resize:!1,header:!1}),this.container_div.addClass("label-track")};ht(It.prototype,jt.prototype,{init:function(){this.enabled=!0},predraw_init:function(){},_draw:function(t){for(var e=this.view,i=e.high-e.low,n=Math.floor(Math.pow(10,Math.floor(Math.log(i)/Math.log(10)))),a=Math.floor(e.low/n)*n,o=this.view.container.width(),r=s()("<div/>").addClass("label-container");a<e.high;){var l=Math.floor((a-e.low)/i*o);r.append(s()("<div/>").addClass("pos-label").text(g.a.commatize(a)).css({left:l})),a+=n}this.content_div.children(":first").remove(),this.content_div.append(r)}});var Mt=function(t,e,i){if(Dt.call(this,t,e,i),this.drawables=[],"drawables"in i){for(var n,o=0;o<i.drawables.length;o++)n=i.drawables[o],this.drawables[o]=Ft(n,t,null),n.left_offset>this.left_offset&&(this.left_offset=n.left_offset);this.enabled=!0}a.a.each(this.drawables,function(t){(t instanceof Vt||t instanceof zt)&&t.change_mode("Coverage")}),this.update_icons(),this.obj_type="CompositeTrack"};ht(Mt.prototype,Dt.prototype,{display_modes:_t,build_config_params:function(){return a.a.union(bt.prototype.config_params,[{key:"min_value",label:"Min Value",type:"float",default_value:void 0},{key:"max_value",label:"Max Value",type:"float",default_value:void 0},{key:"mode",type:"string",default_value:this.mode,hidden:!0},{key:"height",type:"int",default_value:30,hidden:!0}])},action_icons_def:[{name:"composite_icon",title:h()("Show individual tracks"),css_class:"layers-stack",on_click_fn:function(t){s()(".tooltip").remove(),t.show_group()}}].concat(Dt.prototype.action_icons_def),to_dict:wt.prototype.to_dict,add_drawable:wt.prototype.add_drawable,unpack_drawables:wt.prototype.unpack_drawables,config_onchange:function(){this.set_name(this.config.get_value("name")),this.request_draw({clear_tile_cache:!0})},on_resize:function(){var t=this.visible_height_px;a.a.each(this.drawables,function(e){e.visible_height_px=t}),jt.prototype.on_resize.call(this)},change_mode:function(t){Dt.prototype.change_mode.call(this,t);for(var e=0;e<this.drawables.length;e++)this.drawables[e].change_mode(t)},init:function(){for(var t=[],e=0;e<this.drawables.length;e++)t.push(this.drawables[e].init());var i=this;s.a.when.apply(s.a,t).then(function(){i.enabled=!0,i.request_draw()})},update_icons:function(){this.action_icons.filters_icon.hide(),this.action_icons.tools_icon.hide(),this.action_icons.param_space_viz_icon.hide()},can_draw:bt.prototype.can_draw,_get_drawables:function(){return this.drawables},show_group:function(){for(var t,e=new yt(this.view,this.container,{name:this.config.get_value("name")}),i=0;i<this.drawables.length;i++)(t=this.drawables[i]).update_icons(),e.add_drawable(t),t.container=e,e.content_div.append(t.container_div);this.container.replace_drawable(this,e,!0),e.request_draw({clear_tile_cache:!0})},before_draw:function(){var t=a.a.min(a.a.map(this.drawables,function(t){return t.config.get_value("min_value")})),e=a.a.max(a.a.map(this.drawables,function(t){return t.config.get_value("max_value")}));this.config.set_value("min_value",t),this.config.set_value("max_value",e),a.a.each(this.drawables,function(i){i.config.set_value("min_value",t),i.config.set_value("max_value",e)})},update_all_min_max:function(){var t=this.config.get_value("min_value"),e=this.config.get_value("max_value");a.a.each(this.drawables,function(i){i.config.set_value("min_value",t),i.config.set_value("max_value",e)}),this.request_draw({clear_tile_cache:!0})},postdraw_actions:function(t,e,i,n){var a,o=-1;for(a=0;a<t.length;a++){var s=t[a].html_elt.find("canvas").height();s>o&&(o=s)}for(a=0;a<t.length;a++){var r=t[a];r.html_elt.find("canvas").height()!==o&&(this.draw_helper(r.region,i,{force:!0,height:o}),r.html_elt.remove())}var l=this,c=function(){l.update_all_min_max()};this._add_yaxis_label("min",c),this._add_yaxis_label("max",c)}});var Rt=function(t){Dt.call(this,t,{content_div:t.top_labeltrack},{resize:!1,header:!1}),this.left_offset=t.canvas_manager.char_width_px,this.container_div.addClass("reference-track"),this.data_url="".concat(Object(c.getAppRoot)(),"api/genomes/").concat(this.view.dbkey),this.data_url_extra_params={reference:!0},this.data_manager=new p.a.GenomeReferenceDataManager({data_url:this.data_url,can_subset:this.can_subset}),this.hide_contents()};ht(Rt.prototype,bt.prototype,Dt.prototype,{build_config_params:function(){return a.a.union(bt.prototype.config_params,[{key:"height",type:"int",default_value:13,hidden:!0}])},init:function(){this.data_manager.clear(),this.enabled=!0},predraw_init:function(){},can_draw:bt.prototype.can_draw,draw_helper:function(t,e,i){var n,a=this.tiles_div.is(":visible"),o=null;return e>this.view.canvas_manager.char_width_px?(this.tiles_div.show(),n=!0,o=Dt.prototype.draw_helper.call(this,t,e,i)):(n=!1,this.tiles_div.hide()),a!==n&&this.view.resize_viewport(),o},can_subset:function(t){return!0},draw_tile:function(t,e,i,n,a){var o=this.data_manager.subset_entry(t,n),s=o.data,r=e.canvas;e.font=e.canvas.manager.default_font,e.textAlign="center";for(var l=0,c=s.length;l<c;l++)e.fillStyle=this.view.get_base_color(s[l]),e.fillText(s[l],Math.floor(l*a),10);return new $t(this,n,a,r,o)}});var Et=function(t,e,i){this.mode="Histogram",Dt.call(this,t,e,i),this.left_offset=30;var n,a,o=this;s.a.when((n="".concat(Object(c.getAppRoot)(),"datasets/").concat(this.dataset.id,"/display"),a=s.a.Deferred(),s.a.ajax({type:"HEAD",url:n,beforeSend:function(t){t.setRequestHeader("Range","bytes=0-10")},success:function(t,e,i){a.resolve(206===i.status)}}),a)).then(function(t){t&&(o.data_manager=new ut.BBIDataManager({dataset:o.dataset}))})};ht(Et.prototype,bt.prototype,Dt.prototype,{display_modes:_t,build_config_params:function(){return a.a.union(bt.prototype.config_params,[{key:"color",label:"Color",type:"color"},{key:"min_value",label:"Min Value",type:"float",default_value:void 0},{key:"max_value",label:"Max Value",type:"float",default_value:void 0},{key:"mode",type:"string",default_value:this.mode,hidden:!0},{key:"height",type:"int",default_value:30,hidden:!0}])},config_onchange:function(){this.set_name(this.config.get_value("name")),this.request_draw({clear_tile_cache:!0})},before_draw:function(){},draw_tile:function(t,e,i,n,a){return this._draw_line_track_tile(t,e,i,n,a)},can_subset:function(t){return t.data[1][0]-t.data[0][0]==1},postdraw_actions:function(t,e,i,n){this._add_yaxis_label("max"),this._add_yaxis_label("min")}});var Pt=function(t,e,i){this.mode="Heatmap",Dt.call(this,t,e,i)};ht(Pt.prototype,bt.prototype,Dt.prototype,{display_modes:["Heatmap"],build_config_params:function(){return a.a.union(bt.prototype.config_params,[{key:"pos_color",label:"Positive Color",type:"color",default_value:"#FF8C00"},{key:"neg_color",label:"Negative Color",type:"color",default_value:"#4169E1"},{key:"min_value",label:"Min Value",type:"int",default_value:void 0},{key:"max_value",label:"Max Value",type:"int",default_value:void 0},{key:"mode",type:"string",default_value:this.mode,hidden:!0},{key:"height",type:"int",default_value:500,hidden:!0}])},config_onchange:function(){this.set_name(this.config.get_value("name")),this.request_draw({clear_tile_cache:!0})},predraw_init:function(){return s.a.getJSON(this.dataset.url(),{data_type:"data",stats:!0,chrom:this.view.chrom,low:0,high:this.view.max_high,hda_ldda:this.dataset.get("hda_ldda")},function(t){})},draw_tile:function(t,e,i,n,a){var o=e.canvas;return new tt.DiagonalHeatmapPainter(t.data,n.get("start"),n.get("end"),this.config.to_key_value_dict(),i).draw(e,o.width,o.height,a),new $t(this,n,a,o,t.data)}});var Vt=function(t,e,i){Dt.call(this,t,e,i),this.container_div.addClass("feature-track"),this.summary_draw_height=30,this.slotters={},this.start_end_dct={},this.left_offset=200,this.set_painter_from_config()};ht(Vt.prototype,bt.prototype,Dt.prototype,{display_modes:["Auto","Coverage","Dense","Squish","Pack"],build_config_params:function(){return a.a.union(bt.prototype.config_params,[{key:"block_color",label:"Block color",type:"color"},{key:"reverse_strand_color",label:"Antisense strand color",type:"color"},{key:"label_color",label:"Label color",type:"color",default_value:"black"},{key:"show_counts",label:"Show summary counts",type:"bool",default_value:!0,help:"Show the number of items in each bin when drawing summary histogram"},{key:"min_value",label:"Histogram minimum",type:"float",default_value:void 0,help:"clear value to set automatically"},{key:"max_value",label:"Histogram maximum",type:"float",default_value:void 0,help:"clear value to set automatically"},{key:"connector_style",label:"Connector style",type:"select",default_value:"fishbones",options:[{label:"Line with arrows",value:"fishbone"},{label:"Arcs",value:"arcs"}]},{key:"mode",type:"string",default_value:this.mode,hidden:!0},{key:"height",type:"int",default_value:0,hidden:!0}])},config_onchange:function(){this.set_name(this.config.get_value("name")),this.set_painter_from_config(),this.request_draw({clear_tile_cache:!0})},set_painter_from_config:function(){"arcs"===this.config.get_value("connector_style")?this.painter=tt.ArcLinkedFeaturePainter:this.painter=tt.LinkedFeaturePainter},postdraw_actions:function(t,e,i,n){var o=this;if(Dt.prototype.postdraw_actions.call(this,t,e,i,n),0===a.a.filter(t,function(t){return t instanceof Ot}).length){var r={};a.a.each(a.a.pluck(t,"incomplete_features"),function(t){a.a.each(t,function(t){r[t[0]]=t})}),a.a.each(t,function(t){var e=a.a.omit(r,a.a.map(t.incomplete_features,function(t){return t[0]}));if(e=a.a.omit(e,a.a.keys(t.other_tiles_features_drawn)),0!==a.a.size(e)){var i={data:a.a.values(e)},n=o.view.canvas_manager.new_canvas(),l=n.getContext("2d");n.height=Math.max(t.canvas.height,o.get_canvas_height(i,t.mode,t.w_scale,100)),n.width=t.canvas.width,l.drawImage(t.canvas,0,0),l.translate(o.left_offset,0);var c=o.draw_tile(i,l,t.mode,t.region,t.w_scale,t.seq_data);s()(t.canvas).replaceWith(s()(c.canvas)),t.canvas=n,a.a.extend(t.other_tiles_features_drawn,r)}})}if(this.filters_manager){var l,c=this.filters_manager.filters;for(l=0;l<c.length;l++)c[l].update_ui_elt();for(var d,u,h=!1,p=0;p<t.length;p++)if(t[p].data.length)for(d=t[p].data[0],l=0;l<c.length;l++)if((u=c[l]).applies_to(d)&&u.min!==u.max){h=!0;break}this.filters_available!==h&&(this.filters_available=h,this.filters_available||this.filters_manager.hide(),this.update_icons())}if(t[0]instanceof At){for(var f=!0,m=0;m<t.length;m++)if(!t[m].all_slotted){f=!1;break}this.action_icons.show_more_rows_icon.toggle(!f)}else this.action_icons.show_more_rows_icon.hide()},update_auto_mode:function(t){"Auto"===this.mode&&("no_detail"===t&&(t="feature spans"),this.action_icons.mode_icon.attr("title","Set display mode (now: Auto/".concat(t,")")))},incremental_slots:function(t,e,i){var n=this.view.canvas_manager.dummy_context,a=this.slotters[t];return a&&a.mode===i||(a=new x(t,i,100,function(t){return n.measureText(t)}),this.slotters[t]=a),a.slot_features(e)},get_mode:function(t){return"no_detail"===t.extra_info||this.is_overview?"no_detail":this.view.high-this.view.low>12e3?"Squish":"Pack"},get_canvas_height:function(t,e,i,n){if("Coverage"===e||"bigwig"===t.dataset_type)return this.summary_draw_height;var a=this.incremental_slots(i,t.data,e),o=new this.painter(null,null,null,this.config.to_key_value_dict(),e);return Math.max(this.min_height_px,o.get_required_height(a,n))},draw_tile:function(t,e,i,n,a,o,s){var r=this,l=e.canvas,c=n.get("start"),d=n.get("end"),u=this.left_offset;if("bigwig"===t.dataset_type)return this._draw_line_track_tile(t,e,i,n,a);var h=[],p=this.slotters[a].slots,f=!0;if(t.data)for(var m=this.filters_manager.filters,g=0,_=t.data.length;g<_;g++){for(var v,b=t.data[g],w=!1,y=0,x=m.length;y<x;y++)if((v=m[y]).update_attrs(b),!v.keep(b)){w=!0;break}w||(h.push(b),b[0]in p||(f=!1))}var k=this.filters_manager.alpha_filter?new Tt(this.filters_manager.alpha_filter):null,C=this.filters_manager.height_filter?new Tt(this.filters_manager.height_filter):null,S=new this.painter(h,c,d,this.config.to_key_value_dict(),i,k,C,o,function(t){return r.view.get_base_color(t)}),T=null,$=null;if(e.fillStyle=this.config.get_value("block_color"),e.font=e.canvas.manager.default_font,e.textAlign="right",t.data){var O=S.draw(e,l.width,l.height,a,p);T=O.feature_mapper,$=O.incomplete_features,T.translation=-u}return s?void 0:new At(r,n,a,l,t.data,i,t.message,f,T,$,o)}});var Lt=function(t,e,i){Dt.call(this,t,e,i),this.painter=tt.VariantPainter,this.summary_draw_height=30,this.left_offset=30};ht(Lt.prototype,bt.prototype,Dt.prototype,{display_modes:["Auto","Coverage","Dense","Squish","Pack"],build_config_params:function(){return a.a.union(bt.prototype.config_params,[{key:"color",label:"Histogram color",type:"color"},{key:"show_sample_data",label:"Show sample data",type:"bool",default_value:!0},{key:"show_labels",label:"Show summary and sample labels",type:"bool",default_value:!0},{key:"summary_height",label:"Locus summary height",type:"float",default_value:20},{key:"mode",type:"string",default_value:this.mode,hidden:!0},{key:"height",type:"int",default_value:0,hidden:!0}])},config_onchange:function(){this.set_name(this.config.get_value("name")),this.request_draw({clear_tile_cache:!0})},draw_tile:function(t,e,i,n,a){if("bigwig"===t.dataset_type)return this._draw_line_track_tile(t,e,"Histogram",n,a);var o=this.view;return new this.painter(t.data,n.get("start"),n.get("end"),this.config.to_key_value_dict(),i,function(t){return o.get_base_color(t)}).draw(e,e.canvas.width,e.canvas.height,a),new $t(this,n,a,e.canvas,t.data)},get_canvas_height:function(t,e,i,n){if("bigwig"===t.dataset_type)return this.summary_draw_height;var a=this.dataset.get_metadata("sample_names")?this.dataset.get_metadata("sample_names").length:0;return 0===a&&0!==t.data.length&&(a=null===(a=t.data[0][7].match(/,/g))?1:a.length+1),new this.painter(null,null,null,this.config.to_key_value_dict(),e).get_required_height(a)},predraw_init:function(){var t=[jt.prototype.predraw_init.call(this)];return this.dataset.get_metadata("sample_names")||t.push(this.dataset.fetch()),t},postdraw_actions:function(t,e,i,n){Dt.prototype.postdraw_actions.call(this,t,e,i,n);var o=a.a.filter(t,function(t){return t instanceof Ot}),r=this.dataset.get_metadata("sample_names");if(0===o.length&&this.config.get_value("show_labels")&&r&&r.length>1){var l;if(0===this.container_div.find(".yaxislabel.variant").length&&(l=this.config.get_value("summary_height")/2,this.tiles_div.prepend(s()("<div/>").text("Summary").addClass("yaxislabel variant top").css({"font-size":"".concat(l,"px"),top:"".concat((this.config.get_value("summary_height")-l)/2,"px")})),this.config.get_value("show_sample_data"))){var c=r.join("<br/>");this.tiles_div.prepend(s()("<div/>").html(c).addClass("yaxislabel variant top sample").css({top:this.config.get_value("summary_height")}))}l="".concat("Squish"===this.mode?5:10,"px"),s()(this.tiles_div).find(".sample").css({"font-size":l,"line-height":l}),s()(this.tiles_div).find(".yaxislabel").css("color",this.config.get_value("label_color"))}else this.container_div.find(".yaxislabel.variant").remove()}});var zt=function(t,e,i){Vt.call(this,t,e,i),this.painter=tt.ReadPainter,this.update_icons()};ht(zt.prototype,bt.prototype,Dt.prototype,Vt.prototype,{build_config_params:function(){return a.a.union(bt.prototype.config_params,[{key:"block_color",label:"Histogram color",type:"color"},{key:"detail_block_color",label:"Sense strand block color",type:"color",default_value:"#AAAAAA"},{key:"reverse_strand_color",label:"Antisense strand block color",type:"color",default_value:"#DDDDDD"},{key:"label_color",label:"Label color",type:"color",default_value:"black"},{key:"show_insertions",label:"Show insertions",type:"bool",default_value:!1},{key:"show_differences",label:"Show differences only",type:"bool",default_value:!0},{key:"show_counts",label:"Show summary counts",type:"bool",default_value:!0},{key:"mode",type:"string",default_value:this.mode,hidden:!0},{key:"min_value",label:"Histogram minimum",type:"float",default_value:void 0,help:"clear value to set automatically"},{key:"max_value",label:"Histogram maximum",type:"float",default_value:void 0,help:"clear value to set automatically"},{key:"height",type:"int",default_value:0,hidden:!0}])},config_onchange:function(){this.set_name(this.config.get_value("name")),this.request_draw({clear_tile_cache:!0})}});var Nt={CompositeTrack:Mt,DrawableGroup:yt,DiagonalHeatmapTrack:Pt,FeatureTrack:Vt,LineTrack:Et,ReadTrack:zt,VariantTrack:Lt,VcfTrack:Lt},Ft=function(t,e,i){if("copy"in t)return t.copy(i);var n=t.obj_type;return n||(n=t.track_type),new Nt[n](e,i,t)};e.a={TracksterView:xt,DrawableGroup:yt,LineTrack:Et,FeatureTrack:Vt,DiagonalHeatmapTrack:Pt,ReadTrack:zt,VariantTrack:Lt,CompositeTrack:Mt,object_from_template:Ft}},44:function(t,e,i){"use strict";var n=i(173),a=i.n(n),o=i(68);function s(t){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function r(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.text="",t.text&&t.text.startsWith("#")&&(t.text=t.text.replace("#","name:")),Object.assign(this,t),Object.defineProperty(this,"style",{enumerable:!0,get:function(){if(this.text.startsWith("name:")){var t=Object(o.a)(this.text),e={"background-color":t.primary,color:t.contrasting,"border-color":t.darker};return Object.keys(e).map(function(t){return"".concat(t,": ").concat(e[t])}).join(";")}return""}}),Object.defineProperty(this,"label",{enumerable:!0,get:function(){return this.text.startsWith("name:")?this.text.replace("name:","#"):this.text}}),Object.defineProperty(this,"valid",{enumerable:!1,get:function(){return!!this.text.length&&"name:"!=this.text}})}function l(t){var e={};switch(s(t)){case"string":e={text:t};break;case"object":e=Object.assign({},t)}return new r(e)}r.prototype.equals=function(t){return this.text==t.text},r.prototype.toString=function(){return this.text};var c={components:{VueTagsInput:a.a},props:{value:{type:Array,required:!1,default:function(){return[]}},autocompleteItems:{type:Array,required:!1,default:function(){return[]}},maxVisibleTags:{type:Number,required:!1,default:5},useToggleLink:{type:Boolean,required:!1,default:!0},disabled:{type:Boolean,required:!1,default:!1}},data:function(){return{tagText:"",tagToggle:!(this.useToggleLink&&this.value.length>this.maxVisibleTags),triggerKeys:[13," "]}},computed:{tagContainerClasses:function(){return{disabled:this.disabled}},tagModels:function(){return this.value.map(l)},autocompleteTags:function(){return this.autocompleteItems.map(l)},linkText:function(){return"".concat(this.tagModels.length," Tags")},linkVisible:function(){return this.useToggleLink&&this.tagModels.length>this.maxVisibleTags},tagsVisible:function(){return!this.useToggleLink||this.tagToggle}},watch:{tagText:function(t){this.$emit("tag-input-changed",t)}},methods:{tagsChanged:function(t){this.$emit("input",this.pluckLabels(t))},pluckLabels:function(t){return t.map(function(t){return l(t).toString()})},toggleTagDisplay:function(){this.tagToggle=!this.tagToggle,this.$emit("show",this.tagToggle)},beforeAddingTag:function(t){if(!this.emitHookEvent("before-adding-tag",t)){var e=t.tag;(0,t.addTag)(e)}},beforeDeletingTag:function(t){if(!this.emitHookEvent("before-deleting-tag",t)){var e=t.tag;(0,t.deleteTag)(e)}},emitHookEvent:function(t,e){return!!this.hasHandler(t)&&(this.$emit(t,e),!0)},hasHandler:function(t){return Object.keys(this.$listeners).includes(t)}}},d=(i(195),i(13)),u=Object(d.a)(c,function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"tags-display",class:t.tagContainerClasses},[t.linkVisible?i("a",{staticClass:"toggle-link",attrs:{href:"#"},on:{click:function(e){return e.preventDefault(),t.toggleTagDisplay(e)}}},[t._v("\n        "+t._s(t._f("localize")(t.linkText))+"\n    ")]):t._e(),t._v(" "),t.tagsVisible?i("vue-tags-input",{staticClass:"tags-input tag-area",attrs:{tags:t.tagModels,"autocomplete-items":t.autocompleteTags,disabled:t.disabled,placeholder:t._f("localize")("Add Tags"),"add-on-key":t.triggerKeys},on:{"before-adding-tag":t.beforeAddingTag,"before-deleting-tag":t.beforeDeletingTag,"tags-changed":t.tagsChanged},scopedSlots:t._u([{key:"tag-center",fn:function(e){return[i("div",{staticClass:"tag-name",on:{click:function(i){return t.$emit("tag-click",e.tag)}}},[t._v(t._s(e.tag.label))])]}}],null,!1,4090180873),model:{value:t.tagText,callback:function(e){t.tagText=e},expression:"tagText"}}):t._e()],1)},[],!1,null,null,null).exports,h=i(12),p=i(175),f=i(60),m=i(256),g=i(15),_=i.n(g),v=i(209),b=i(269),w=i(884),y=i(882),x=i(883);function k(t,e,i,n,a,o,s){try{var r=t[o](s),l=r.value}catch(t){return void i(t)}r.done?e(l):Promise.resolve(l).then(n,a)}function C(t){return function(){var e=this,i=arguments;return new Promise(function(n,a){var o=t.apply(e,i);function s(t){k(o,n,a,s,r,"next",t)}function r(t){k(o,n,a,s,r,"throw",t)}s(void 0)})}}function S(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var T=function(){function t(e){var i=e.id,n=e.itemClass,a=e.context,o=e.debounceInterval,s=void 0===o?150:o;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.id=i,this.itemClass=n,this.context=a,this.debounceInterval=s,this._searchText=new v.a}var e,i,n,a,o,s;return e=t,(i=[{key:"save",value:(s=C(regeneratorRuntime.mark(function t(e){var i,n,a,o,s;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(i=this.id,n=this.itemClass,a=this.context,(o=l(e)).valid){t.next=4;break}throw new Error("Invalid tag");case 4:return s="/tag/add_tag_async?item_id=".concat(i,"&item_class=").concat(n,"&context=").concat(a,"&new_tag=").concat(o.text),t.next=7,_.a.get(s);case 7:if(200===t.sent.status){t.next=10;break}throw new Error("Unable to save tag: ".concat(o));case 10:return t.abrupt("return",l(o));case 11:case"end":return t.stop()}},t,this)})),function(t){return s.apply(this,arguments)})},{key:"delete",value:(o=C(regeneratorRuntime.mark(function t(e){var i,n,a,o,s;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return i=this.id,n=this.itemClass,a=this.context,o=l(e),s="/tag/remove_tag_async?item_id=".concat(i,"&item_class=").concat(n,"&context=").concat(a,"&tag_name=").concat(o.text),t.next=5,_.a.get(s);case 5:if(200===t.sent.status){t.next=8;break}throw new Error("Unable to delete tag: ".concat(o));case 8:return t.abrupt("return",o);case 9:case"end":return t.stop()}},t,this)})),function(t){return o.apply(this,arguments)})},{key:"autocomplete",value:(a=C(regeneratorRuntime.mark(function t(e){var i,n,a,o;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return i=this.id,n=this.itemClass,a="/tag/tag_autocomplete_data?item_id=".concat(i,"&item_class=").concat(n,"&q=").concat(e),t.next=4,_.a.get(a);case 4:if(200===(o=t.sent).status){t.next=7;break}throw new Error("Unable to retrieve autocomplete tags for search string: ".concat(e));case 7:return t.abrupt("return",(s=o.data,s.split("\n").filter(function(t){return t.includes("|")}).map(function(t){return t.split("|")[0]}).filter(function(t){return t.length}).filter(function(t){return"#Header"!==t})).map(l));case 8:case"end":return t.stop()}var s},t,this)})),function(t){return a.apply(this,arguments)})},{key:"autocompleteOptions",get:function(){var t=this;return this._searchText.pipe(Object(m.a)(function(t){return t.replace("name:","")}),Object(b.a)(function(t){return t.length}),Object(w.a)(this.debounceInterval),Object(y.a)(),Object(x.a)(function(e){return t.autocomplete(e)}))}},{key:"autocompleteSearchText",set:function(t){this._searchText.next(t)}}])&&S(e.prototype,i),n&&S(e,n),t}();function $(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}h.a.use(p.a);var O={components:{StatelessTags:u},props:{tags:{type:Array,required:!1,default:function(){return[]}},tagService:{type:T,required:!0},storeKey:{type:String,required:!0},disabled:{type:Boolean,required:!1,default:!1}},computed:{observedTags:{get:function(){return this.$store.getters.getTagsById(this.storeKey)},set:function(t){this.updateTags({key:this.storeKey,tags:t})}}},subscriptions:function(){var t=this;return{autocompleteItems:this.tagService.autocompleteOptions.pipe(Object(m.a)(function(e){return i=e,n=t.tags,a=i.map(l),o=n.map(l),a.filter(function(t){return!o.some(function(e){return e.equals(t)})});var i,n,a,o}))}},methods:function(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{},n=Object.keys(i);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(i).filter(function(t){return Object.getOwnPropertyDescriptor(i,t).enumerable}))),n.forEach(function(e){$(t,e,i[e])})}return t}({onClick:function(t){this.$emit("tag-click",t)},beforeAddingTag:function(t){var e=t.tag,i=t.addTag;this.tagService.save(e).then(function(){return i(e)}).catch(function(t){return console.warn("Unable to save tag",t)})},beforeDeletingTag:function(t){var e=t.tag,i=t.deleteTag;this.tagService.delete(e).then(function(){return i(e)}).catch(function(t){return console.warn("Unable to delete tag",t)})},updateTagSearch:function(t){this.tagService.autocompleteSearchText=t}},Object(f.b)(["updateTags","initializeTags"])),mounted:function(){this.initializeTags({key:this.storeKey,tags:this.tags})}},A=Object(d.a)(O,function(){var t=this,e=t.$createElement;return(t._self._c||e)("stateless-tags",{attrs:{disabled:t.disabled,"autocomplete-items":t.autocompleteItems},on:{"tag-click":t.onClick,"tag-input-changed":t.updateTagSearch,"before-adding-tag":t.beforeAddingTag,"before-deleting-tag":t.beforeDeletingTag},model:{value:t.observedTags,callback:function(e){t.observedTags=e},expression:"observedTags"}})},[],!1,null,null,null).exports,j=i(83);function D(t){return(D="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function I(t,e,i,n,a,o,s){try{var r=t[o](s),l=r.value}catch(t){return void i(t)}r.done?e(l):Promise.resolve(l).then(n,a)}function M(t){return function(){var e=this,i=arguments;return new Promise(function(n,a){var o=t.apply(e,i);function s(t){I(o,n,a,s,r,"next",t)}function r(t){I(o,n,a,s,r,"throw",t)}s(void 0)})}}function R(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function E(t,e){return!e||"object"!==D(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function P(t){return(P=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function V(t,e){return(V=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var L=function(t){function e(t){var i;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(i=E(this,P(e).call(this,t))).model=t.model,i}var i,n,a,o,s;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&V(t,e)}(e,T),i=e,(n=[{key:"save",value:(s=M(regeneratorRuntime.mark(function t(e){var i,n;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if((i=l(e)).valid){t.next=3;break}throw new Error("Invalid tag");case 3:return(n=new Set(this.model.attributes.tags)).add(i.text),n=Array.from(n),t.next=8,this.model.save({tags:n});case 8:return t.abrupt("return",i);case 9:case"end":return t.stop()}},t,this)})),function(t){return s.apply(this,arguments)})},{key:"delete",value:(o=M(regeneratorRuntime.mark(function t(e){var i,n;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return i=l(e),(n=new Set(this.model.attributes.tags)).delete(i.text),n=Array.from(n),t.next=6,this.model.save({tags:n});case 6:return t.abrupt("return",i);case 7:case"end":return t.stop()}},t,this)})),function(t){return o.apply(this,arguments)})}])&&R(i.prototype,n),a&&R(i,a),e}(),z=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=arguments.length>1?arguments[1]:void 0,i=t.id,n=t.itemClass,a=t.tags,o=void 0===a?[]:a,s=t.disabled,r=void 0!==s&&s,l=t.context,c=void 0===l?"unspecified":l,d={storeKey:"".concat(n,"-").concat(i),tagService:new T({id:i,itemClass:n,context:c}),tags:o,disabled:r},u=Object(j.a)(A)(d,e);return u.$on("tag-click",N(t,u)),u},N=function(t,e){return function(i){if(i){var n,a=t.tagClickFn,o=void 0===a?"none":a,s=t.clickUrl;switch(o){case"community_tag_click":if(void 0!==s){var r=i.value?":".concat(i.value):"",l="".concat(s,"?f-tags=").concat(i.text).concat(r);n=l,window.location=n}break;case"add_tag_to_grid_filter":e.$store.dispatch("toggleSearchTag",i)}}}},F=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=arguments.length>1?arguments[1]:void 0,i=t.model,n=t.disabled,a=void 0!==n&&n,o=t.context,s=void 0===o?"unspecified":o;if(i){var r=i.attributes,l=r.id,c=r.model_class,d=r.tags,u=void 0===d?[]:d,h={storeKey:"".concat(c,"-").concat(l),tagService:new L({id:l,itemClass:c,context:s,model:i}),tags:u,disabled:a};return Object(j.a)(A)(h,e)}console.warn("Missing model in mountModelTags")};i.d(e,"a",function(){return z}),i.d(e,"b",function(){return F})},45:function(t,e,i){"use strict";i(160),i(247),i(197);var n=i(885),a=i(256),o=i(36),s=i(5),r=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"Galaxy";return Object(s.b)(function(i){var n=new i(t.options,t.bootstrapped);return n.debug("".concat(e," app")),n})},l=i(31),c=function(){return null},d=function(t){return Object.keys(t).filter(function(e){return"function"==typeof t[e]}).reduce(function(t,e){return t[e]=c,t},{})};function u(t){"Galaxy"!=t&&function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n="window.".concat(t),a=(o=t,1==f()[o]?console:d(console));var o;Object.defineProperty(window,t,{enumerable:!0,configurable:!1,get:function(){var i=void 0;a.groupCollapsed("".concat(n," read")),a.trace();try{i=e?e():window._monitorStorage[t],a.log(i)}catch(t){a.warn("Unable to retrieve"),a.warn(t)}return a.groupEnd(),i},set:function(e){a.groupCollapsed("".concat(n," write..."),String(e)),a.trace();try{i?i(e):window._monitorStorage[t]=e}catch(t){a.log("Unable to set value on window facade"),a.warn(t)}a.groupEnd()}})}(t)}function h(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=f();return e?i[t]=!0:t in i&&delete i[t],function(t){sessionStorage.setItem("global_monitors",JSON.stringify(t))}(i),i}function p(){var t=f();console.log(t)}function f(){var t=sessionStorage.getItem("global_monitors");return t?JSON.parse(t):{}}function m(){var t=Object.keys(f());console.groupCollapsed("monitor init"),console.log("The following global properties are monitored because they were setup in the javascript source manually:",t),console.log("To toggle messages on/off, type toggleGlobalMonitor('Galaxy', true|false) into the console"),console.log("You can set up any other variable by typing installMonitor('a window variable name')"),console.groupEnd(),t.forEach(u),window.installMonitor=u,window.showMonitorToggles=p,window.toggleGlobalMonitor=h}window._monitorStorage=window._monitorStorage||{};var g=i(136),_=i.n(g),v=function(t,e){if(console.log("initSentry"),e.sentry){var i=e.sentry,n=i.sentry_dsn_public,a=i.email;_.a.config(n).install(),a&&_.a.setUser({email:a})}},b=i(0),w=i.n(b);function y(){console.log("initTooltips"),w.a.fn.tooltip&&(w()(".unified-panel-header [title]").tooltip({placement:"bottom"}),w()("[title]").tooltip())}function x(){console.log("adjustIframeLinks"),w()("a").click(function(){var t=w()(this),e=window.parent.frames&&window.parent.frames.galaxy_main;if("galaxy_main"==t.attr("target")&&!e){var i=t.attr("href");-1==i.indexOf("?")?i+="?":i+="&",i+="use_panels=True",t.attr("href",i),t.attr("target","_self")}return t})}function k(){console.log("addIframeClass"),window.self!==window.top&&(console.log(">>> We are in an iframe"),document.body.classList.add("framed"))}var C=i(69),S=i(48),T=i(8);function $(t){console.log("onloadWebhooks"),t.config.enable_webhooks&&S.a.load({type:"onload",callback:function(t){t.each(function(t){var e=t.toJSON();e.activate&&e.script&&T.a.appendScriptStyle(e)})}})}function O(t,e,i){console.log("replace_big_select_inputs"),w.a.fn.select2?(void 0===t&&(t=20),void 0===e&&(e=3e3),(i=i||w()("select")).each(function(){var i,n,a=w()(this).not("[multiple]"),o=a.find("option").length;o<t||o>e||(a.hasClass("no-autocomplete")||(i=a,n={placeholder:"Click to select",closeOnSelect:!w()(i).is("[MULTIPLE]"),dropdownAutoWidth:!0,containerCssClass:"select2-minwidth"},i.select2(n)))})):console.warn("No select 2")}var A=i(20),j=i(111);function D(t){console.log("initTours"),j.a.activeGalaxyTourRunner(),t.giveTourWithData=j.a.giveTourWithData}var I=i(19);function M(t){console.log("initModals"),t.modal||(t.modal=new I.a.View)}var R=i(4);function E(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var i=[],n=!0,a=!1,o=void 0;try{for(var s,r=t[Symbol.iterator]();!(n=(s=r.next()).done)&&(i.push(s.value),!e||i.length!==e);n=!0);}catch(t){a=!0,o=t}finally{try{n||null==r.return||r.return()}finally{if(a)throw o}}return i}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function P(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Galaxy",e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:r;Object(l.d)(m,v,k,x,M,y,C.a,function(){return O(20,1500)},A.a,D,$);var i=R.config$.pipe(Object(a.a)(function(i){return e(i,t)}));Object(n.a)(R.config$,i,l.c).subscribe(function(e){var i=E(e,3),n=i[0],a=i[1],s=i[2];console.groupCollapsed("runInitializations",t,Object(o.a)()),s.forEach(function(t){return t(a,n)}),Object(l.b)(),console.groupEnd()})}i(63);i.d(e,"c",function(){return P}),i.d(e,"a",function(){return l.a}),i.d(e,"b",function(){return R.getAppRoot})},46:function(t,e,i){"use strict";var n=i(1),a=i.n(n),o=i(0),s=i.n(o),r=i(3),l=i.n(r),c=i(4),d=i(82),u=i(7),h=i(8),p={defaults:{model_class:"DatasetCollectionElement",element_identifier:null,element_index:null,element_type:null},_mergeObject:function(t){var e=t.object,i=this.elementId;return e&&(i=t.object.id,delete t.object.id),a.a.extend(t,t.object,{element_id:i}),delete t.object,t},constructor:function(t,e){t=this._mergeObject(t),this.idAttribute="element_id",l.a.Model.apply(this,arguments)},parse:function(t,e){var i=t;return i=this._mergeObject(i)}},f=l.a.Model.extend(u.a.LoggableMixin).extend(p).extend({_logNamespace:"collections"}),m=l.a.Collection.extend(u.a.LoggableMixin).extend({_logNamespace:"collections",model:f,toString:function(){return["DatasetCollectionElementCollection(",this.length,")"].join("")}}),g=d.a.DatasetAssociation.extend(u.a.mixin(p,{url:function(){if(!this.has("history_id"))return console.warn("no endpoint for non-hdas within a collection yet"),"".concat(Object(c.getAppRoot)(),"api/datasets");var t=this._getDatasetId(),e="".concat(Object(c.getAppRoot)(),"api/histories/").concat(this.get("history_id"),"/contents/").concat(t);return e},_getDatasetId:function(){return this.get("element_id")},defaults:a.a.extend({},d.a.DatasetAssociation.prototype.defaults,p.defaults),_downloadQueryParameters:function(){var t=this.get("file_ext")||"data",e=this.get("element_identifier"),i=this.get("parent_hdca_id");return"?to_ext=".concat(t,"&hdca_id=").concat(i,"&element_identifier=").concat(e)},constructor:function(t,e){this.debug("\t DatasetDCE.constructor:",t,e),p.constructor.call(this,t,e)},hasDetails:function(){return this.elements&&this.elements.length},toString:function(){var t=this.get("element_identifier");return"DatasetDCE(".concat(t,")")}})),_=m.extend({model:g,toString:function(){return["DatasetDCECollection(",this.length,")"].join("")}}),v=l.a.Model.extend(u.a.LoggableMixin).extend(u.a.SearchableModelMixin).extend({_logNamespace:"collections",defaults:{collection_type:null,deleted:!1},collectionClass:function(){return this.attributes.collection_type.indexOf(":")>0?w:_},initialize:function(t,e){this.debug("".concat(this,"(DatasetCollection).initialize:"),t,e,this),this.elements=this._createElementsModel(),this.on("change:elements",function(){this.log("change:elements"),this.elements=this._createElementsModel()})},_createElementsModel:function(){var t=this.collectionClass();this.debug("".concat(this,"._createElementsModel"),t,this.get("elements"),this.elements);var e=this.get("elements")||[];this.unset("elements",{silent:!0});var i=this.get("parent_hdca_id")||this.get("id");return a.a.each(e,function(t,e){a.a.extend(t,{parent_hdca_id:i})}),this.elements=new t(e),this.elements},toJSON:function(){var t=l.a.Model.prototype.toJSON.call(this);return this.elements&&(t.elements=this.elements.toJSON()),t},inReadyState:function(){var t=this.get("populated");return this.isDeletedOrPurged()||t},hasDetails:function(){return 0!==this.elements.length},getVisibleContents:function(t){return this.elements},parse:function(t,e){var i=l.a.Model.prototype.parse.call(this,t,e);return i.create_time&&(i.create_time=new Date(i.create_time)),i.update_time&&(i.update_time=new Date(i.update_time)),i},delete:function(t,e,i){return t=t||!1,e=e||!1,this.get("deleted")?s.a.when():(i=h.a.merge(i,{method:"delete"}),this.save({deleted:!0,recursive:t,purge:e},i))},undelete:function(t){return this.get("deleted")?this.save({deleted:!1},t):s.a.when()},isDeletedOrPurged:function(){return this.get("deleted")||this.get("purged")},searchAttributes:["name","tags"],toString:function(){var t=[this.get("id"),this.get("name")||this.get("element_identifier")];return"DatasetCollection(".concat(t.join(","),")")}}),b=v.extend(u.a.mixin(p,{constructor:function(t,e){this.debug("\t NestedDCDCE.constructor:",t,e),p.constructor.call(this,t,e)},toString:function(){return["NestedDCDCE(",this.object?"".concat(this.object):this.get("element_identifier"),")"].join("")}})),w=m.extend({model:b,toString:function(){return["NestedDCDCECollection(",this.length,")"].join("")}}),y={DatasetCollection:v},x=i(102).a.HistoryContentMixin,k=y.DatasetCollection,C=k.extend(x).extend({defaults:a.a.extend(a.a.clone(k.prototype.defaults),{history_content_type:"dataset_collection",model_class:"HistoryDatasetCollectionAssociation"}),save:function(t,e){return this.isNew()&&((e=e||{}).url="".concat(this.urlRoot+this.get("history_id"),"/contents"),(t=t||{}).type="dataset_collection"),k.prototype.save.call(this,t,e)},toString:function(){return"History".concat(k.prototype.toString.call(this))}});e.a={HistoryDatasetCollection:C}},47:function(t,e,i){"use strict";var n=i(1),a=i.n(n),o=i(82),s=i(102),r=i(7),l=o.a.DatasetAssociation,c=s.a.HistoryContentMixin,d=l.extend(r.a.mixin(c,{defaults:a.a.extend({},l.prototype.defaults,c.defaults,{history_content_type:"dataset",model_class:"HistoryDatasetAssociation"})}));e.a={HistoryDatasetAssociation:d}},48:function(t,e,i){"use strict";var n=i(3),a=i.n(n),o=i(4),s=i(8);function r(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var i=[],n=!0,a=!1,o=void 0;try{for(var s,r=t[Symbol.iterator]();!(n=(s=r.next()).done)&&(i.push(s.value),!e||i.length!==e);n=!0);}catch(t){a=!0,o=t}finally{try{n||null==r.return||r.return()}finally{if(a)throw o}}return i}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}var l=a.a.Collection.extend({url:function(){return"".concat(Object(o.getAppRoot)(),"api/webhooks")}}),c=a.a.View.extend({el:"#webhook-view",initialize:function(t){var e=this,i=t.toolId||"",n=t.toolVersion||"";this.$el.attr("tool_id",i),this.$el.attr("tool_version",n),(new l).fetch({success:function(i){t.type&&i.reset(d(i,t.type)),i.length>0&&e.render(function(t){var e=t.pluck("weight"),i=e.reduce(function(t,e){return t+e}),n=new Map;e.forEach(function(t,e){n.set(e,parseFloat((t/i).toFixed(2)))});var a=[],o=!0,s=!1,l=void 0;try{for(var c,d=n[Symbol.iterator]();!(o=(c=d.next()).done);o=!0)for(var u=r(c.value,2),h=u[0],p=u[1],f=0;f<100*p;f++)a.push(h)}catch(t){s=!0,l=t}finally{try{o||null==d.return||d.return()}finally{if(s)throw l}}return t.at(a[Math.floor(Math.random()*a.length)])}(i))}})},render:function(t){var e=t.toJSON();return this.$el.html('<div id="'.concat(e.id,'"></div>')),s.a.appendScriptStyle(e),this}});function d(t,e){return t.models.filter(function(t){var i=t.get("type");return!!i&&-1!==i.indexOf(e)})}e.a={WebhookView:c,load:function(t){(new l).fetch({async:void 0===t.async||t.async,success:function(e){t.type&&e.reset(d(e,t.type)),t.callback(e)}})}}},49:function(t,e,i){"use strict";var n=i(0),a=i.n(n);function o(t){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function s(t,e){return!e||"object"!==o(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function r(t,e,i){return(r="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,i){var n=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=l(t)););return t}(t,e);if(n){var a=Object.getOwnPropertyDescriptor(n,e);return a.get?a.get.call(i):a.value}})(t,e,i||t)}function l(t){return(l=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function c(t,e){return(c=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function d(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function u(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function h(t,e,i){return e&&u(t.prototype,e),i&&u(t,i),t}var p=function(){function t(e){d(this,t),this.deferred=a.a.Deferred(),this.queue=[],this.responses=[],this.numToProcess=0,this.running=!1,this.init(e||[]),this.start()}return h(t,[{key:"init",value:function(t){var e=this;t.forEach(function(t){e.add(t)})}},{key:"add",value:function(t){var e=this,i=this.queue.length;return this.numToProcess+=1,this.queue.push(function(){var n=i,a=t();a.done(function(t){e.deferred.notify({curr:n,total:e.numToProcess,response:t})}),a.always(function(t){e.responses.push(t),e.queue.length?e.queue.shift()():e.stop()})}),this}},{key:"start",value:function(){return this.queue.length&&(this.running=!0,this.queue.shift()()),this}},{key:"stop",value:function(t,e){return this.running=!1,this.queue=[],t?this.deferred.reject(e):this.deferred.resolve(this.responses),this.numToProcess=0,this.deferred=a.a.Deferred(),this}},{key:"done",value:function(t){return this.deferred.done(t)}},{key:"fail",value:function(t){return this.deferred.fail(t)}},{key:"always",value:function(t){return this.deferred.always(t)}},{key:"progress",value:function(t){return this.deferred.progress(t)}}],[{key:"create",value:function(e){return new t(e).deferred}}]),t}(),f=function(t){function e(t){var i;return d(this,e),(i=s(this,l(e).call(this,t))).names={},i}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&c(t,e)}(e,p),h(e,[{key:"add",value:function(t){if(!t.hasOwnProperty("name")||!t.hasOwnProperty("fn"))throw new Error('NamedAjaxQueue.add requires an object with both "name" and "fn": '.concat(JSON.stringify(t)));if(!this.names.hasOwnProperty(t.name))return this.names[t.name]=!0,r(l(e.prototype),"add",this).call(this,t.fn)}},{key:"clear",value:function(){return this.names={},this}}],[{key:"create",value:function(t){return new e(t).deferred}}]),e}();e.a={AjaxQueue:p,NamedAjaxQueue:f}},5:function(t,e,i){"use strict";var n=i(66),a=i(0),o=i.n(a),s=i(1),r=i.n(s),l=i(3),c=i.n(l),d=i(7),u=i(4),h=i(2),p=i.n(h),f=c.a.Model.extend(d.a.LoggableMixin).extend({_logNamespace:"user",urlRoot:function(){return"".concat(Object(u.getAppRoot)(),"api/users")},defaults:{id:null,username:"(".concat(p()("anonymous user"),")"),email:"",total_disk_usage:0,nice_total_disk_usage:"",quota_percent:null,is_admin:!1,preferences:{}},initialize:function(t){this.log("User.initialize:",t),this.on("loaded",function(t,e){this.log("".concat(this," has loaded:"),t,e)}),this.on("change",function(t,e){this.log("".concat(this," has changed:"),t,e.changes)})},isAnonymous:function(){return!this.get("email")},isAdmin:function(){return this.get("is_admin")},updatePreferences:function(t,e){var i=this.get("preferences");i[t]=JSON.stringify(e),this.preferences=i},getFavorites:function(){var t=this.get("preferences");return t&&t.favorites?JSON.parse(t.favorites):{tools:[]}},updateFavorites:function(t,e){var i=this.getFavorites();i[t]=e[t],this.updatePreferences("favorites",i)},loadFromApi:function(t,e){t=t||f.CURRENT_ID_STR;var i=this,n=(e=e||{}).success;return e.success=function(t,e){i.trigger("loaded",t,e),n&&n(t,e)},t===f.CURRENT_ID_STR&&(e.url="".concat(this.urlRoot,"/").concat(f.CURRENT_ID_STR)),c.a.Model.prototype.fetch.call(this,e)},clearSessionStorage:function(){for(var t in sessionStorage)0===t.indexOf("history:")?sessionStorage.removeItem(t):"history-panel"===t&&sessionStorage.removeItem(t)},toString:function(){var t=[this.get("username")];return this.get("id")&&(t.unshift(this.get("id")),t.push(this.get("email"))),"User(".concat(t.join(":"),")")}});f.CURRENT_ID_STR="current",f.getCurrentUserFromApi=function(t){var e=new f;return e.loadFromApi(f.CURRENT_ID_STR,t),e};var m={User:f},g=i(122);function _(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this._init(t,e)}Object(n.a)(_,"GalaxyApp");var v="".concat("galaxy:debug",":namespaces"),b="".concat("galaxy:debug",":flatten"),w=!1;try{w="true"==localStorage.getItem("galaxy:debug")}catch(t){console.log(p()("localStorage not available for debug flag retrieval"))}_.prototype._init=function(t,e){r.a.extend(this,c.a.Events),w&&(this.logger=console,console.debug("debugging galaxy:","options:",t,"bootstrapped:",e)),this._processOptions(t),this._initConfig(t.config||{});var i=k();return i&&this._patchGalaxy(i),this.root=t.root||"/",this.params=t.params||{},this.session_csrf_token=t.session_csrf_token||null,this._initLogger(this.options.loggerOptions||{}),this.debug("GalaxyApp.options: ",this.options),this.debug("GalaxyApp.config: ",this.config),this.debug("GalaxyApp.logger: ",this.logger),this._initLocale(),this.debug("GalaxyApp.localize: ",this.localize),this.config=t.config||{},this.debug("GalaxyApp.config: ",this.config),this._initUser(t.user||{}),this.debug("GalaxyApp.user: ",this.user),this._initUserLocale(),this.debug("currentLocale: ",sessionStorage.getItem("currentLocale")),this._setUpListeners(),this.trigger("ready",this),this},_.prototype.defaultOptions={patchExisting:!0,root:"/",session_csrf_token:null},_.prototype._processOptions=function(t){var e=this.defaultOptions;for(var i in this.options={},e)e.hasOwnProperty(i)&&(this.options[i]=t.hasOwnProperty(i)?t[i]:e[i]);return this},_.prototype._initConfig=function(t){return this.config=t,this.config.debug=w||this.config.debug,this},_.prototype._patchGalaxy=function(t){if(this.options.patchExisting&&t)for(var e in t)t.hasOwnProperty(e)&&(this[e]=t[e])},_.prototype._initLogger=function(t){var e=this;if(e.config.debug){t.consoleLogger=t.consoleLogger||console,t.consoleLevel=t.consoleLevel||g.a.MetricsLogger.ALL;try{t.consoleNamespaceWhitelist=localStorage.getItem(v).split(",")}catch(t){console.debug(t)}try{t.consoleFlattenMessages="true"==localStorage.getItem(b)}catch(t){console.debug(t)}console.log(t.consoleFlattenMessages)}return e.logger=new g.a.MetricsLogger(t),e.emit={},["log","debug","info","warn","error","metric"].map(function(t){e.emit[t]=function(i){e.logger.emit(t,arguments[0],Array.prototype.slice.call(arguments,1))}}),e.config.debug&&(d.a.LoggableMixin.logger=e.logger),e},_.prototype._initLocale=function(t){return this.debug("_initLocale:",t),this.localize=p.a,window._l=this.localize,this},_.prototype._initUserLocale=function(t){var e=!!this.config.default_locale&&this.config.default_locale.toLowerCase(),i={};this.user&&this.user.attributes.preferences&&"extra_user_preferences"in this.user.attributes.preferences&&(i=JSON.parse(this.user.attributes.preferences.extra_user_preferences));var n="localization|locale"in i&&i["localization|locale"].toLowerCase();"auto"==n&&(n=!1);var a="undefined"==typeof navigator?"__root":(navigator.language||navigator.userLanguage||"__root").toLowerCase(),o=n||e||a;sessionStorage.setItem("currentLocale",o)},_.prototype._initUser=function(t){return this.debug("_initUser:",t),this.user=new m.User(t),this.user.logger=this.logger,this},_.prototype._setUpListeners=function(){var t=this;return t.lastAjax={},o()(document).bind("ajaxSend",function(e,i,n){var a=n.data;try{a=JSON.parse(a)}catch(t){}t.lastAjax={url:location.href.slice(0,-1)+n.url,data:a}}),t},_.prototype.debugging=function(t){try{if(void 0===t)return"true"===localStorage.getItem("galaxy:debug");if(t)return localStorage.setItem("galaxy:debug",!0),!0;localStorage.removeItem("galaxy:debug"),this.debuggingNamespaces(null)}catch(t){console.log(p()("localStorage not available for debug flag retrieval"))}return!1},_.prototype.debuggingNamespaces=function(t){try{if(void 0===t){var e=localStorage.getItem(v);return"string"==typeof e?e.split(","):[]}null===t?localStorage.removeItem(v):localStorage.setItem(v,t);var i=this.debuggingNamespaces();return this.logger&&(this.logger.options.consoleNamespaceWhitelist=i),i}catch(t){console.log(p()("localStorage not available for debug namespace retrieval"))}},_.prototype.toString=function(){var t=this.user?this.user.get("email")||"(anonymous)":"uninitialized";return"GalaxyApp(".concat(t,")")};var y=i(36);function x(t){console.warn("setGalaxyInstance",Object(y.a)());var e=C(),i=t(_);return i instanceof _||(i=new _(i)),void 0===i.debug&&Object(n.a)(i,"GalaxyApp"),e._galaxyInstance=i,e._galaxyInstance}function k(){return C()._galaxyInstance}function C(){return window}var S={root:Object(u.getAppRoot)(),config:{}};window.Galaxy?console.error("Detected redefinition of window.Galaxy -- skipping, but this should be investigated.",Object(y.a)()):Object.defineProperty(window,"Galaxy",{enumerable:!0,get:function(){return console.warn("accessing (get) window.Galaxy",Object(y.a)()),k()||S},set:function(t){console.warn("accessing (set) window.Galaxy",Object(y.a)()),x(t)}});window.Galaxy;i.d(e,"b",function(){return x}),i.d(e,"a",function(){return k})},51:function(t,e,i){"use strict";var n=i(19),a=i(34),o=i(2),s=i.n(o),r=i(1),l=i.n(r),c=i(0),d=i.n(c),u=i(5),h=d.a,p={defaultName:l.a.template("Copy of '<%- name %>'"),title:l.a.template("".concat(s()("Copying history"),' "<%- name %>"')),submitLabel:s()("Copy"),errorMessage:s()("History could not be copied."),progressive:s()("Copying history"),activeLabel:s()("Copy only the active, non-deleted datasets"),allLabel:s()("Copy all datasets including deleted ones"),anonWarning:s()("As an anonymous user, unless you login or register, you will lose your current history ")+s()("after copying this history. "),_template:l.a.template(["<% if( isAnon ){ %>",'<div class="warningmessage">',"<%- anonWarning %>",s()("You can"),' <a href="/user/login">',s()("login here"),"</a> ",s()("or")," ",' <a href="/user/create">',s()("register here"),"</a>.","</div>","<% } %>","<form>",'<label for="copy-modal-title">',s()("Enter a title for the new history"),":","</label><br />",'<input id="copy-modal-title" class="form-control" style="width: 100%" value="<%= name %>" />','<p class="invalid-title bg-danger" style="color: red; margin: 8px 0px 8px 0px; display: none">',s()("Please enter a valid history title"),"</p>","<% if( allowAll ){ %>","<br />","<p>",s()("Choose which datasets from the original history to include:"),"</p>",'<input name="copy-what" type="radio" id="copy-non-deleted" value="copy-non-deleted" ','<% if( copyWhat === "copy-non-deleted" ){ print( "checked" ); } %>/>','<label for="copy-non-deleted"> <%- activeLabel %></label>',"<br />",'<input name="copy-what" type="radio" id="copy-all" value="copy-all" ','<% if( copyWhat === "copy-all" ){ print( "checked" ); } %>/>','<label for="copy-all"> <%- allLabel %></label>',"<% } %>","</form>"].join("")),_showAjaxIndicator:function(){var t='<p><span class="fa fa-spinner fa-spin"></span> '.concat(this.progressive,"...</p>");this.modal.$(".modal-body").empty().append(t).css({"margin-top":"8px"})},dialog:function(t,e,i){i=i||{};var n=this,o=d.a.Deferred(),r=(i.nameFn||this.defaultName)({name:e.get("name")}),c=i.allDatasets?"copy-all":"copy-non-deleted",p=!!l.a.isUndefined(i.allowAll)||i.allowAll,f=!!l.a.isUndefined(i.autoClose)||i.autoClose;function m(){var i=t.$("#copy-modal-title").val();if(i){var s="copy-all"===t.$('input[name="copy-what"]:checked').val();t.$("button").prop("disabled",!0),n._showAjaxIndicator(),e.copy(!0,i,s).done(function(t){o.resolve(t)}).fail(function(t,r,l){var c={name:i,copyAllDatasets:s};a.a.ajaxErrorModal(e,t,c,n.errorMessage),o.rejectWith(o,arguments)}).done(function(){f&&t.hide()})}else t.$(".invalid-title").show()}this.modal=t;var g=i.closing_callback,_=Object(u.a)();return t.show(l.a.extend(i,{title:this.title({name:e.get("name")}),body:h(n._template({name:r,isAnon:_.user.isAnonymous(),allowAll:p,copyWhat:c,activeLabel:this.activeLabel,allLabel:this.allLabel,anonWarning:this.anonWarning})),buttons:l.a.object([[s()("Cancel"),function(){t.hide()}],[this.submitLabel,m]]),height:"auto",closing_events:!0,closing_callback:function(t){t&&o.reject({cancelled:!0}),g&&g(t)}})),t.$("#copy-modal-title").focus().select(),t.$("#copy-modal-title").on("keydown",function(t){13===t.keyCode&&(t.preventDefault(),m())}),o}},f=l.a.extend({},p,{defaultName:l.a.template("imported: <%- name %>"),title:l.a.template("".concat(s()("Importing history"),' "<%- name %>"')),submitLabel:s()("Import"),errorMessage:s()("History could not be imported."),progressive:s()("Importing history"),activeLabel:s()("Import only the active, non-deleted datasets"),allLabel:s()("Import all datasets including deleted ones"),anonWarning:s()("As an anonymous user, unless you login or register, you will lose your current history ")+s()("after importing this history. ")});e.a=function(t,e){e=e||{};var i=Object(u.a)().modal||new n.a.View({});return e.useImport?f.dialog(i,t,e):p.dialog(i,t,e)}},52:function(t,e,i){"use strict";var n=i(1),a=i.n(n),o=i(2),s=i.n(o),r=i(135),l=i.n(r);function c(t){return(c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}var d=function(t,e){if(0==t.length)return"no columns";if(1==t.length)return"column ".concat(e[t[0]]);var i=t.map(function(t){return e[t]});return"columns ".concat([i.slice(0,-1).join(", "),i.slice(-1)[0]].join(" and "))},u=function(t,e){var i=[];for(var n in t)-1===e.indexOf(n)&&i.push(t[n]);return i},h=function(t,e,i,n,a){var o;try{o=l()(String(t))}catch(t){return{error:"Invalid regular expression specified."}}var s=0;return i=i.map(function(t){var i=t[e],r=o.exec(i);return r?n?t.concat([o.pyreReplace(r[0],n)]):(a=a&&parseInt(a))?r.length!=a+1?(s++,null):t.concat(r.splice(1,r.length)):t.concat([r[0]]):(s++,null)}),s>0?{error:"".concat(s," row(s) failed to match specified regular expression.")}:{data:i}},p=function(t,e){return e.reduce(function(e,i){return e.concat(t(i))},[])},f={add_column_basename:{title:s()("Basename of Path of URL"),display:function(t,e){return"Add column using basename of column ".concat(e[t.target_column])},init:function(t,e){t.addColumnBasenameTarget=e?e.target_column:0},save:function(t,e){e.target_column=t.addColumnBasenameTarget},apply:function(t,e,i,n){var a=t.target_column,o=h("[^/]*$",a,e);return n.push("new"),o.columns=n,o}},add_column_rownum:{title:s()("Row Number"),display:function(t,e){return"Add column for the current row number."},init:function(t,e){t.addColumnRownumStart=e?e.start:1},save:function(t,e){e.start=parseInt(t.addColumnRownumStart)},apply:function(t,e,i,n){var a=t.start;return e=e.map(function(t){var e=t.slice();return e.push(String(a)),a+=1,e}),n.push("new"),{data:e,columns:n}}},add_column_value:{title:s()("Fixed Value"),display:function(t,e){return"Add column for the constant value of ".concat(t.value,".")},init:function(t,e){t.addColumnValue=e?e.value:""},save:function(t,e){e.value=t.addColumnValue},apply:function(t,e,i,n){var a=t.value;return e=e.map(function(t){var e=t.slice();return e.push(a),e}),n.push("new"),{data:e,columns:n}}},add_column_metadata:{title:s()("Add Column from Metadata"),display:function(t,e){return"Add column for ".concat(t.value,".")},init:function(t,e){t.addColumnMetadataValue=e?e.value:null},save:function(t,e){e.value=t.addColumnMetadataValue},apply:function(t,e,i,n){var a,o=t.value;if(0==o.indexOf("identifier")){var s=parseInt(o.substring("identifier".length));a=function(t,e){var n=t.slice();return n.push(i[e].identifiers[s]),n}}else if("tags"==o)a=function(t,e){var n=t.slice(),a=i[e].tags;return a.sort(),n.push(a.join(",")),n};else{if("hid"!=o&&"name"!=o&&"path"!=o)return{error:"Unknown metadata type [".concat(o,"}]")};a=function(t,e){var n=t.slice();return n.push(i[e][o]),n}}return e=e.map(a),n.push("new"),{data:e,columns:n}}},add_column_group_tag_value:{title:s()("Add Column from Group Tag Value"),display:function(t,e){return"Add column for value of group tag ".concat(t.value,".")},init:function(t,e){e?(t.addColumnGroupTagValueValue=e.value,t.addColumnGroupTagValueDefault=e.default_value):(t.addColumnGroupTagValueValue=null,t.addColumnGroupTagValueDefault="")},save:function(t,e){e.value=t.addColumnGroupTagValueValue,e.default_value=t.addColumnGroupTagValueDefault},apply:function(t,e,i,n){var a=t.value,o="group:".concat(a,":");return e=e.map(function(e,n){var a=e.slice(),s=i[n].tags;s.sort();var r=t.default_value;for(var l in s){var c=s[l];if(0==c.indexOf(o)){r=c.substr(o.length);break}}return a.push(r),a}),n.push("new"),{data:e,columns:n}}},add_column_regex:{title:s()("Using a Regular Expression"),display:function(t,e){return"Add new column using ".concat(t.expression," applied to column ").concat(e[t.target_column])},init:function(t,e){e?(t.addColumnRegexTarget=e.target_column,t.addColumnRegexExpression=e.expression,t.addColumnRegexReplacement=e.replacement,t.addColumnRegexGroupCount=e.group_count):(t.addColumnRegexTarget=0,t.addColumnRegexExpression="",t.addColumnRegexReplacement=null,t.addColumnRegexGroupCount=null);var i="global";t.addColumnRegexGroupCount?i="groups":t.addColumnRegexReplacement&&(i="replacement"),t.addColumnRegexType=i},save:function(t,e){e.target_column=t.addColumnRegexTarget,e.expression=t.addColumnRegexExpression,t.addColumnRegexReplacement&&(e.replacement=t.addColumnRegexReplacement),t.addColumnRegexGroupCount&&(e.group_count=t.addColumnRegexGroupCount)},apply:function(t,e,i,n){var a=t.target_column,o=h(t.expression,a,e,t.replacement,t.group_count);return n.push("new"),o.columns=n,o}},add_column_concatenate:{title:s()("Concatenate Columns"),display:function(t,e){return"Concatenate column ".concat(e[t.target_column_0]," and column ").concat(e[t.target_column_1])},init:function(t,e){e?(t.addColumnConcatenateTarget0=e.target_column_0,t.addColumnConcatenateTarget1=e.target_column_1):(t.addColumnConcatenateTarget0=0,t.addColumnConcatenateTarget1=0)},save:function(t,e){e.target_column_0=t.addColumnConcatenateTarget0,e.target_column_1=t.addColumnConcatenateTarget1},apply:function(t,e,i,n){var a=t.target_column_0,o=t.target_column_1;return e=e.map(function(t){var e=t.slice();return e.push(t[a]+t[o]),e}),n.push("new"),{data:e,columns:n}}},add_column_substr:{title:s()("Keep or Trim Prefix or Suffix"),display:function(t,e){var i,n=t.substr_type;return i="keep_prefix"==n?"Keep only ".concat(t.length," characters from the start of column ").concat(e[t.target_column]):"drop_prefix"==n?"Remove ".concat(t.length," characters from the start of column ").concat(e[t.target_column]):"keep_suffix"==n?"Keep only ".concat(t.length," characters from the end of column ").concat(e[t.target_column]):"Remove ".concat(t.length," characters from the end of column ").concat(e[t.target_column]),i},init:function(t,e){e?(t.addColumnSubstrTarget=e.target_column,t.addColumnSubstrLength=e.length,t.addColumnSubstrType=e.substr_type):(t.addColumnSubstrTarget=0,t.addColumnSubstrType="keep_prefix",t.addColumnSubstrLength=1)},save:function(t,e){e.target_column=t.addColumnSubstrTarget,e.length=parseInt(t.addColumnSubstrLength),e.substr_type=t.addColumnSubstrType},apply:function(t,e,i,n){var a=t.target_column,o=t.length,s=t.substr_type;return e=e.map(function(t){var e=t.slice(),i=t[a],n=0,r=i.length;return"keep_prefix"==s?r=o:"drop_prefix"==s?n=o:"keep_suffix"==s?(n=r-o)<0&&(n=0):(r-=o)<0&&(r=0),e.push(i.substr(n,r)),e}),n.push("new"),{data:e}}},remove_columns:{title:s()("Remove Column(s)"),display:function(t,e){var i=t.target_columns;return"Remove ".concat(d(i,e))},init:function(t,e){t.removeColumnTargets=e?e.target_columns:[]},save:function(t,e){e.target_columns=t.removeColumnTargets},apply:function(t,e,i,n){var a=t.target_columns;return{data:e=e.map(function(t){var e=[];for(var i in t)-1==a.indexOf(parseInt(i))&&e.push(t[i]);return e}),columns:n=u(n,a)}}},add_filter_regex:{title:s()("Using a Regular Expression"),display:function(t,e){return"Filter rows using regular expression ".concat(t.expression," on column ").concat(e[t.target_column])},init:function(t,e){e?(t.addFilterRegexTarget=e.target_column,t.addFilterRegexExpression=e.expression,t.addFilterRegexInvert=e.invert):(t.addFilterRegexTarget=0,t.addFilterRegexExpression="",t.addFilterRegexInvert=!1)},save:function(t,e){e.target_column=t.addFilterRegexTarget,e.expression=t.addFilterRegexExpression,e.invert=t.addFilterRegexInvert},apply:function(t,e,i,n){var a,o=String(t.expression);try{a=l()(o)}catch(t){return{error:"Invalid regular expression specified."}}var s=t.target_column,r=t.invert,c=function(t,i){var n=e[parseInt(i)];return a.exec(n[s])?!r:r};return i=i.filter(c),{data:e=e.filter(c),sources:i}}},add_filter_count:{title:s()("First or Last N Rows"),display:function(t,e){var i=t.which,n=t.invert;return"first"!=i||n?"first"==i&&n?"Keep only first ".concat(t.count," row(s)."):"last"!=i||n?"Keep only last ".concat(t.count," row(s)."):"Filter out last ".concat(t.count," row(s)."):"Filter out first ".concat(t.count," row(s).")},init:function(t,e){e?(t.addFilterCountN=parseInt(e.count),t.addFilterCountWhich=e.which,t.addFilterCountInvert=e.inverse):(t.addFilterCountN=0,t.addFilterCountWhich="first",t.addFilterCountInvert=!1)},save:function(t,e){e.count=parseInt(t.addFilterCountN),e.which=t.addFilterCountWhich,e.invert=t.addFilterCountInvert},apply:function(t,e,i,n){var a=t.count,o=t.invert,s=t.which,r=e.length,l=function(t,e){return("first"==s?e>=a:e<r-a)?!o:o};return i=i.filter(l),{data:e=e.filter(l),sources:i}}},add_filter_empty:{title:s()("On Emptiness"),display:function(t,e){return"Filter rows if no value for column ".concat(e[t.target_column])},init:function(t,e){e?(t.addFilterEmptyTarget=e.target_column,t.addFilterEmptyInvert=e.invert):(t.addFilterEmptyTarget=0,t.addFilterEmptyInvert=!1)},save:function(t,e){e.target_column=t.addFilterEmptyTarget,e.invert=t.addFilterEmptyInvert},apply:function(t,e,i,n){var a=t.target_column,o=t.invert,s=function(t,i){return e[parseInt(i)][a].length?!o:o};return i=i.filter(s),{data:e=e.filter(s),sources:i}}},add_filter_matches:{title:s()("Matching a Supplied Value"),display:function(t,e){return"Filter rows with value ".concat(t.value," for column ").concat(e[t.target_column])},init:function(t,e){e?(t.addFilterMatchesTarget=e.target_column,t.addFilterMatchesValue=e.value,t.addFilterMatchesInvert=e.invert):(t.addFilterMatchesTarget=0,t.addFilterMatchesValue="",t.addFilterMatchesInvert=!1)},save:function(t,e){e.target_column=t.addFilterMatchesTarget,e.value=t.addFilterMatchesValue,e.invert=t.addFilterMatchesInvert},apply:function(t,e,i,n){var a=t.target_column,o=t.invert,s=t.value,r=function(t,i){return e[parseInt(i)][a]==s?!o:o};return i=i.filter(r),{data:e=e.filter(r),sources:i}}},add_filter_compare:{title:s()("By Comparing to a Numeric Value"),display:function(t,e){return"Filter rows with value ".concat(t.compare_type," ").concat(t.value," for column ").concat(e[t.target_column])},init:function(t,e){e?(t.addFilterCompareTarget=e.target_column,t.addFilterCompareValue=e.value,t.addFilterCompareType=e.compare_type):(t.addFilterCompareTarget=0,t.addFilterCompareValue=0,t.addFilterCompareType="less_than")},save:function(t,e){e.target_column=t.addFilterCompareTarget,e.value=t.addFilterCompareValue,e.compare_type=t.addFilterCompareType},apply:function(t,e,i,n){var a=t.target_column,o=t.compare_type,s=t.value,r=function(t,i){var n,r=e[parseInt(i)],l=parseFloat(r[a]);return"less_than"==o?n=l<s:"less_than_equal"==o?n=l<=s:"greater_than"==o?n=l>s:"greater_than_equal"==o&&(n=l>=s),n};return i=i.filter(r),{data:e=e.filter(r),sources:i}}},sort:{title:s()("Sort"),display:function(t,e){return"Sort on column ".concat(e[t.target_column])},init:function(t,e){e?(t.addSortingTarget=e.target_column,t.addSortingNumeric=e.numeric):(t.addSortingTarget=0,t.addSortingNumeric=!1)},save:function(t,e){e.target_column=t.addSortingTarget,e.numeric=t.addSortingNumeric},apply:function(t,e,i,n){var o=t.target_column,s=t.numeric,r=a.a.zip(e,i);r.sort(function(t,e){var i=t[0][o],n=e[0][o];return s&&(i=parseFloat(i),n=parseFloat(n)),i<n?-1:n<i?1:0});var l=[],c=[];return r.map(function(t){l.push(t[0]),c.push(t[1])}),{data:l,sources:c}}},swap_columns:{title:s()("Swap Column(s)"),display:function(t,e){return"Swap ".concat(d([t.target_column_0,t.target_column_1],e))},init:function(t,e){e?(t.swapColumnsTarget0=e.target_column_0,t.swapColumnsTarget1=e.target_column_1):(t.swapColumnsTarget0=0,t.swapColumnsTarget1=0)},save:function(t,e){e.target_column_0=t.swapColumnsTarget0,e.target_column_1=t.swapColumnsTarget1},apply:function(t,e,i,n){var a=t.target_column_0,o=t.target_column_1;e=e.map(function(t){var e=t.slice();return e[a]=t[o],e[o]=t[a],e});var s=n[a];return n[a]=n[o],n[o]=s,{data:e,columns:n}}},split_columns:{title:s()("Split Column(s)"),display:function(t,e){return"Duplicate each row and split up columns"},init:function(t,e){e?(t.splitColumnsTargets0=e.target_columns_0,t.splitColumnsTargets1=e.target_columns_1):(t.splitColumnsTargets0=[],t.splitColumnsTargets1=[])},save:function(t,e){e.target_columns_0=t.splitColumnsTargets0,e.target_columns_1=t.splitColumnsTargets1},apply:function(t,e,i,n){var a=t.target_columns_0,o=t.target_columns_1;return{data:e=p(function(t){var e=[],i=[];for(var n in t)n=parseInt(n),a.indexOf(n)>-1?e.push(t[n]):o.indexOf(n)>-1?i.push(t[n]):(e.push(t[n]),i.push(t[n]));return[e,i]},e),sources:i=p(function(t){return[t,t]},i),columns:n=u(n,a)}}}},m={list_identifiers:{multiple:!0,label:s()("List Identifier(s)"),columnHeader:s()("List Identifier"),help:s()("This should be a short description of the replicate, sample name, condition, etc... that describes each level of the list structure."),importType:"collections"},paired_identifier:{label:s()("Paired-end Indicator"),columnHeader:s()("Paired Indicator"),help:s()("This should be set to '1', 'R1', 'forward', 'f', or 'F' to indicate forward reads, and '2', 'r', 'reverse', 'R2', 'R', or 'R2' to indicate reverse reads."),importType:"collections"},collection_name:{label:s()("Collection Name"),help:s()("If this is set, all rows with the same collection name will be joined into a collection and it is possible to create multiple collections at once."),modes:["raw","ftp","datasets","library_datasets"],importType:"collections"},name_tag:{label:s()("Name Tag"),help:s()("Add a name tag or hash tag based on the specified column value for imported datasets."),importType:"datasets",modes:["raw","ftp"]},tags:{multiple:!0,label:s()("General Purpose Tag(s)"),help:s()("Add a general purpose tag based on the specified column value, use : to separate key-value pairs if desired. These tags are not propagated to derived datasets the way name and group tags are."),modes:["raw","ftp","datasets","library_datasets"]},group_tags:{multiple:!0,label:s()("Group Tag(s)"),help:s()("Add a group tag based on the specified column value, use : to separate key-value pairs. These tags are propagated to derived datasets and may be useful for factorial experiments."),modes:["raw","ftp","datasets","library_datasets"]},name:{label:s()("Name"),importType:"datasets"},dbkey:{label:s()("Genome"),modes:["raw","ftp"]},file_type:{label:s()("Type"),modes:["raw","ftp"],help:s()("This should be the Galaxy file type corresponding to this file.")},url:{label:s()("URL"),modes:["raw"],help:s()("This should be a URL the file can be downloaded from.")},info:{label:s()("Info"),help:s()("Unstructured text associated with the dataset that shows up in the history panel, this is optional and can be whatever you would like."),modes:["raw","ftp"]},ftp_path:{label:s()("FTP Path"),modes:["raw","ftp"],help:s()("This should be the path to the target file to include relative to your FTP directory on the Galaxy server"),requiresFtp:!0}},g=function(t,e){return 0==t.length?e?e.map(function(t,e){return String.fromCharCode(65+e)}):[]:t[0].map(function(t,e){return String.fromCharCode(65+e)})};e.a={applyRules:function(t,e,i,n){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[],o=Array.from(a),r=!1;for(var l in n){var c=g(t,i);o[l]=c;var d=n[l];if(d.error=null,d.warn=null,r)d.warn=s()("Skipped due to previous errors.");else{var u=d.type,h=f[u].apply(d,t,e,i);h.error?(r=!0,d.error=h.error):(h.warn&&(d.warn=h.warn),t=h.data||t,e=h.sources||e,i=h.columns||i)}}return{data:t,sources:e,columns:i,colHeadersPerRule:o}},columnDisplay:function(t,e){var i;return 2==(i="object"==c(t)?t.map(function(t){return e[t]}):[e[t]]).length?"columns "+i[0]+" and "+i[1]:i.length>2?"columns "+i.slice(0,-1).join(", ")+", and "+i[i.length-1]:"column "+i[0]},colHeadersFor:g,RULES:f,MAPPING_TARGETS:m}},53:function(t,e,i){"use strict";(function(t,n){var a=i(8);e.a={grid:function(t){var e="";return e=t.embedded?this.grid_header(t)+this.grid_table(t):'<div class="loading-elt-overlay"></div><table><tr><td width="75%">'.concat(this.grid_header(t),'</td><td></td><td></td></tr><tr><td width="100%" id="grid-message" valign="top"></td><td></td><td></td></tr></table>').concat(this.grid_table(t)),t.info_text&&(e+='<br><div class="toolParamHelp" style="clear: both;">'.concat(t.info_text,"</div>")),e},grid_table:function(){return'\n            <form method="post" onsubmit="return false;">\n                <table id="grid-table" class="grid">\n                    <thead id="grid-table-header"></thead>\n                    <tbody id="grid-table-body"></tbody>\n                    <tfoot id="grid-table-footer"></tfoot>\n                </table>\n            </form>'},grid_header:function(t){var e='<div class="grid-header">';if(t.embedded||(e+="<h2>".concat(t.title,"</h2>")),t.global_actions){e+='<ul class="manage-table-actions">';var i=t.global_actions.length>=3;i&&(e+='<li><a class="action-button" id="popup-global-actions" class="menubutton">Actions</a></li><div popupmenu="popup-global-actions">');var n=!0,a=!1,o=void 0;try{for(var s,r=t.global_actions[Symbol.iterator]();!(n=(s=r.next()).done);n=!0){var l=s.value;e+='<li><a class="action-button use-target" target="'.concat(l.target,'" href="').concat(l.url_args,'" onclick="return false;" >').concat(l.label,"</a></li>")}}catch(t){a=!0,o=t}finally{try{n||null==r.return||r.return()}finally{if(a)throw o}}i&&(e+="</div>"),e+="</ul>"}return t.insert&&(e+=t.insert),e+=this.grid_filters(t),e+="</div>"},header:function(t){var e="<tr>";t.show_item_checkboxes&&(e+="<th>",t.items.length>0&&(e+='<input type="checkbox" id="check_all" name=select_all_checkbox value="true"><input type="hidden" name=select_all_checkbox value="true">'),e+="</th>");var i=!0,n=!1,a=void 0;try{for(var o,s=t.columns[Symbol.iterator]();!(i=(o=s.next()).done);i=!0){var r=o.value;r.visible&&(e+='<th id="'.concat(r.key,'-header">'),r.href?e+='<a href="'.concat(r.href,'" class="sort-link" sort_key="').concat(r.key,'">').concat(r.label,"</a>"):e+=r.label,e+='<span class="sort-arrow">'.concat(r.extra,"</span></th>"))}}catch(t){n=!0,a=t}finally{try{i||null==s.return||s.return()}finally{if(n)throw a}}return e+="</tr>"},body:function(e){var i="";0===e.items.length&&(i+='<tr><td colspan="100"><em>No Items</em></td></tr>');var n=!0,a=!1,o=void 0;try{for(var s,r=e.items[Symbol.iterator]();!(n=(s=r.next()).done);n=!0){var l=s.value;i+="<tr ",e.current_item_id==l.id&&(i+='class="current"'),i+=">",e.show_item_checkboxes&&(i+='<td style="width: 1.5em;"><input type="checkbox" name="id" value="'.concat(l.encode_id,'" id="').concat(l.encode_id,'" class="grid-row-select-checkbox" /></td>'));var c=!0,d=!1,u=void 0;try{for(var h,p=e.columns[Symbol.iterator]();!(c=(h=p.next()).done);c=!0){var f=h.value;if(f.visible){var m="";f.nowrap&&(m='style="white-space:nowrap;"');var g=l.column_config[f.label],_=g.link,v=g.value,b=g.target;"string"===t.type(v)&&(v=v.replace(/\/\//g,"/"));var w="",y="";f.attach_popup&&(w="grid-".concat(l.encode_id,"-popup"),y="menubutton",""!==_&&(y+=" split"),y+=" popup"),i+="<td ".concat(m,">"),_?(0!==e.operations.length&&(i+='<div id="'.concat(w,'" class="').concat(y,'" style="float: left;">')),i+='<a class="menubutton-label use-target" target="'.concat(b,'" href="').concat(_,'" onclick="return false;">').concat(v,"</a>"),0!==e.operations.length&&(i+="</div>")):i+='<div id="'.concat(w,'" class="').concat(y,'"><label id="').concat(f.label_id_prefix).concat(l.encode_id,'" for="').concat(l.encode_id,'">').concat(v||"","</label></div>"),i+="</td>"}}}catch(t){d=!0,u=t}finally{try{c||null==p.return||p.return()}finally{if(d)throw u}}i+="</tr>"}}catch(t){a=!0,o=t}finally{try{n||null==r.return||r.return()}finally{if(a)throw o}}return i},footer:function(t){var e="";if(t.use_paging&&t.num_pages>1){var i=t.num_page_links,n=t.cur_page_num,a=t.num_pages,o=i/2,s=n-o,r=0;s<=0&&(r=o-(n-(s=1)));var l,c=o+r,d=n+c;0!==(l=d<=a?0:c-((d=a)+1-n))&&(s-=l)<1&&(s=1),e+='<tr id="page-links-row">',t.show_item_checkboxes&&(e+="<td></td>"),e+='<td colspan="100"><span id="page-link-container">Page:',s>1&&(e+='<span class="page-link" id="page-link-1"><a href="javascript:void(0);" page_num="1" onclick="return false;">1</a></span> ...');for(var u=s;u<d+1;u++)u==t.cur_page_num?e+='<span class="page-link inactive-link" id="page-link-'.concat(u,'">').concat(u,"</span>"):e+='<span class="page-link" id="page-link-'.concat(u,'"><a href="javascript:void(0);" onclick="return false;" page_num="').concat(u,'">').concat(u,"</a></span>");d<a&&(e+='...<span class="page-link" id="page-link-'.concat(a,'"><a href="javascript:void(0);" onclick="return false;" page_num="').concat(a,'">').concat(a,"</a></span>")),e+="</span>",e+='\n                    <span class="page-link" id="show-all-link-span"> | <a href="javascript:void(0);" onclick="return false;" page_num="all">Show All</a></span>\n                    </td>\n                </tr>'}if(t.show_item_checkboxes){e+='\n                <tr>\n                    <input type="hidden" id="operation" name="operation" value="">\n                    <td></td>\n                    <td colspan="100">\n                        For <span class="grid-selected-count"></span> selected items: \n            ';var h=!0,p=!1,f=void 0;try{for(var m,g=t.operations[Symbol.iterator]();!(h=(m=g.next()).done);h=!0){var _=m.value;_.allow_multiple&&(e+='<input type="button" value="'.concat(_.label,'" class="operation-button action-button">&nbsp;'))}}catch(t){p=!0,f=t}finally{try{h||null==g.return||g.return()}finally{if(p)throw f}}e+="</td></tr>"}var v=!1,b=!0,w=!1,y=void 0;try{for(var x,k=t.operations[Symbol.iterator]();!(b=(x=k.next()).done);b=!0){if(x.value.global_operation){v=!0;break}}}catch(t){w=!0,y=t}finally{try{b||null==k.return||k.return()}finally{if(w)throw y}}if(v){e+='<tr><td colspan="100">';var C=!0,S=!1,T=void 0;try{for(var $,O=t.operations[Symbol.iterator]();!(C=($=O.next()).done);C=!0){var A=$.value;A.global_operation&&(e+='<a class="action-button" href="'.concat(A.global_operation,'">').concat(A.label,"</a>"))}}catch(t){S=!0,T=t}finally{try{C||null==O.return||O.return()}finally{if(S)throw T}}e+="</td></tr>"}return t.legend&&(e+='<tr><td colspan="100">'.concat(t.legend,"</td></tr>")),e},message:function(t){var e=t.status;return-1!=["success","ok"].indexOf(e)&&(e="done"),'<p><div class="'.concat(e,'message transient-message">').concat(n.escape(t.message),'</div><div style="clear: both"></div></p>')},grid_filters:function(t){var e=t.default_filter_dict,i=t.filters,n="none";t.advanced_search&&(n="block");var a=!1,o=!0,s=!1,r=void 0;try{for(var l,c=t.columns[Symbol.iterator]();!(o=(l=c.next()).done);o=!0){var d=l.value;if("advanced"==d.filterable){var u=d.key,h=i[u],p=e[u];h&&p&&h!=p&&(n="block"),a=!0}}}catch(t){s=!0,r=t}finally{try{o||null==c.return||c.return()}finally{if(s)throw r}}var f="block";"block"==n&&(f="none");var m='<div id="standard-search" style="display: '.concat(f,';"><table><tr><td style="padding: 0;"><table>'),g=!0,_=!1,v=void 0;try{for(var b,w=t.columns[Symbol.iterator]();!(g=(b=w.next()).done);g=!0){var y=b.value;"standard"==y.filterable&&(m+=this.grid_column_filter(t,y))}}catch(t){_=!0,v=t}finally{try{g||null==w.return||w.return()}finally{if(_)throw v}}m+="</table></td></tr><tr><td>",a&&(m+='<a href="" class="advanced-search-toggle">Advanced Search</a>'),m+="</td></tr></table></div>",m+='<div id="advanced-search" style="display: '.concat(n,'; margin-top: 5px; border: 1px solid #ccc;"><table><tr><td style="text-align: left" colspan="100"><a href="" class="advanced-search-toggle">Close Advanced Search</a></td></tr>');var x=!0,k=!1,C=void 0;try{for(var S,T=t.columns[Symbol.iterator]();!(x=(S=T.next()).done);x=!0){var $=S.value;"advanced"==$.filterable&&(m+=this.grid_column_filter(t,$))}}catch(t){k=!0,C=t}finally{try{x||null==T.return||T.return()}finally{if(k)throw C}}return m+="</table></div>"},grid_column_filter:function(e,i){var n=e.filters,a=i.label,o=i.key;"advanced"==i.filterable&&(a=a.toLowerCase());var s="<tr>";if("advanced"==i.filterable&&(s+='<td align="left" style="padding-left: 10px">'.concat(a,":</td>")),s+='<td style="padding-bottom: 1px;">',i.is_text){s+='<form class="text-filter-form" column_key="'.concat(o,'" action="').concat(e.url,'" method="get" >');var r=!0,l=!1,c=void 0;try{for(var d,u=e.columns[Symbol.iterator]();!(r=(d=u.next()).done);r=!0){var h=d.value,p=n[h.key];p&&"All"!=p&&(h.is_text&&(p=JSON.stringify(p)),s+='<input type="hidden" id="'.concat(h.key,'" name="f-').concat(h.key,'" value="').concat(p,'"/>'))}}catch(t){l=!0,c=t}finally{try{r||null==u.return||u.return()}finally{if(l)throw c}}s+='<span id="'.concat(o,'-filtering-criteria">');var f=n[o];if(f){var m=t.type(f);if("string"==m&&"All"!=f&&(s+=this.filter_element(o,f)),"array"==m)for(var g in f){f.slice(g),s+=this.filter_element(o,f[g])}}s+="</span>";var _="",v=20;"standard"==i.filterable&&((_=i.label.toLowerCase()).length<20&&(v=_.length),v+=4),s+='\n                <span class="search-box">\n                    <input class="search-box-input" id="input-'.concat(o,'-filter" name="f-').concat(o,'" type="text" placeholder="').concat(_,'" size="').concat(v,'"/>\n                    <button type="submit" style="background: transparent; border: none; padding: 4px; margin: 0px;">\n                        <i class="fa fa-search"></i>\n                    </button>\n                </span>\n            </form>')}else{s+='<span id="'.concat(o,'-filtering-criteria">');var b=!1;for(var w in e.categorical_filters[o]){var y=e.categorical_filters[o][w],x="",k="";for(var C in y)x=C,k=y[C];b&&(s+=" | "),b=!0;var S=n[o];S&&y[o]&&S==k?s+='<span class="categorical-filter '.concat(o,'-filter current-filter">').concat(w,"</span>"):s+='<span class="categorical-filter '.concat(o,'-filter"><a href="javascript:void(0);" filter_key="').concat(x,'" filter_val="').concat(k,'">').concat(w,"</a></span>")}s+="</span>"}return s+="</td></tr>"},filter_element:function(t,e){return e=a.a.sanitize(e),'<span class="text-filter-val">'.concat(e,'<a href="javascript:void(0);" filter_key="').concat(t,'" filter_val="').concat(e,'"><i class="fa fa-times" style="padding-left: 5px; padding-bottom: 6px;"/></a></span>')}}}).call(this,i(0),i(1))},58:function(t,e,i){"use strict";var n=i(1),a=i.n(n),o=i(0),s=i.n(o),r=i(3),l=i.n(r),c=i(5),d=l.a.Model.extend({initialize:function(t){this.app=t},checksum:function(){var t="",e=this;return this.app.section.$el.find(".section-row").each(function(){var i=s()(this).attr("id"),n=e.app.field_list[i];n&&(t+="".concat(i,":").concat(JSON.stringify(n.value&&n.value()),":").concat(n.collapsed,":").concat(n.connected,";"))}),t},create:function(){var t=this,e={};this._iterate(this.app.section.$el,e);var i={};function n(e,n,a){t.flat_dict[e]=n,i[e]=a,t.app.element_list[n]&&t.app.element_list[n].$el.attr("tour_id",e)}return this.flat_dict={},function e(i,a){for(var o in a){var s=a[o];if(s.input){var r=s.input,l=i;switch(""!==i&&(l+="|"),l+=r.name,r.type){case"repeat":var c=[],d=null;for(var h in s){var p=h.indexOf("section-");-1!=p&&(p+="section-".length,c.push(parseInt(h.substr(p))),d||(d=h.substr(0,p)))}for(var f in c.sort(function(t,e){return t-e}),o=0,c)e("".concat(l,"_").concat(o++),s[d+c[f]]);break;case"conditional":var m=t.app.field_list[r.id].value();n("".concat(l,"|").concat(r.test_param.name),r.id,m);var g=u(r,m);-1!=g&&e(l,a["".concat(r.id,"-section-").concat(g)]);break;case"section":e(!r.flat&&l||"",s);break;default:var _=t.app.field_list[r.id];if(_&&_.value&&(m=_.value(),(void 0===r.ignore||r.ignore!=m)&&(_.connected?m={__class__:"ConnectedValue"}:_.collapsed&&r.collapsible_value&&(m=r.collapsible_value),n(l,r.id,m),r.payload)))for(var v in r.payload)n(v,r.id,r.payload[v])}}}}("",e),i},match:function(t){return this.flat_dict&&this.flat_dict[t]},matchCase:function(t,e){return u(t,e)},matchModel:function(t,e){var i=this;h(t.inputs,function(t,n){i.flat_dict[n]&&e(t,i.flat_dict[n])})},matchResponse:function(t){var e={},i=this;return function t(n,a){if("string"==typeof a){var o=i.flat_dict[n];o&&(e[o]=a)}else for(var s in a){var r=s;if(""!==n){var l="|";a instanceof Array&&(l="_"),r=n+l+r}t(r,a[s])}}("",t),e},_iterate:function(t,e){var i=this;s()(t).children().each(function(){var t=s()(this).attr("id");if(s()(this).hasClass("section-row")){var n=i.app.input_list[t];e[t]=n&&{input:n}||{},i._iterate(this,e[t])}else i._iterate(this,e)})}}),u=function(t,e){for(var i in"boolean"==t.test_param.type&&(e="true"==e?t.test_param.truevalue||"true":t.test_param.falsevalue||"false"),t.cases)if(t.cases[i].value==e)return i;return-1},h=function t(e,i,n,o){for(var r in o=s.a.extend({},o),a.a.each(e,function(t){t&&t.type&&t.name&&(o[t.name]=t)}),e){var l=Object(c.a)(),d=e[r];d.name=d.name||r;var h=n?"".concat(n,"|").concat(d.name):d.name;switch(d.type){case"repeat":a.a.each(d.cache,function(e,n){t(e,i,"".concat(h,"_").concat(n),o)});break;case"conditional":if(d.test_param){i(d.test_param,"".concat(h,"|").concat(d.test_param.name),o);var p=u(d,d.test_param.value);-1!=p?t(d.cases[p].inputs,i,h,o):l.emit.debug("form-data::visitInputs() - Invalid case for ".concat(h,"."))}else l.emit.debug("form-data::visitInputs() - Conditional test parameter missing for ".concat(h,"."));break;case"section":t(d.inputs,i,h,o);break;default:i(d,h,o)}}};e.a={Manager:d,visitInputs:h}},59:function(t,e,i){"use strict";var n=i(1),a=i.n(n),o=i(0),s=i.n(o),r=i(4),l=i(5),c=i(2),d=i.n(c),u=i(105),h=i(39),p=i(65),f=i(106),m=i(107),g=i(34),_=i(23),v=i(7),b=i(78),w=i(51),y=(i(120),s.a);function x(t,e){return this.currModeIndex=0,this._init(t,e)}x.prototype.DATA_KEY="mode-button",x.prototype.defaults={switchModesOnClick:!0},x.prototype._init=function(t,e){if(e=e||{},this.$element=y(t),this.options=y.extend(!0,{},this.defaults,e),!e.modes)throw new Error('ModeButton requires a "modes" array');var i=this;return this.$element.click(function(t){i.callModeFn(),i.options.switchModesOnClick&&i._incModeIndex(),y(this).html(i.options.modes[i.currModeIndex].html)}),this.reset()},x.prototype._incModeIndex=function(){return this.currModeIndex+=1,this.currModeIndex>=this.options.modes.length&&(this.currModeIndex=0),this},x.prototype._getModeIndex=function(t){for(var e=0;e<this.options.modes.length;e+=1)if(this.options.modes[e].mode===t)return e;throw new Error("mode not found: ".concat(t))},x.prototype._setModeByIndex=function(t){var e=this.options.modes[t];if(!e)throw new Error("mode index not found: ".concat(t));return this.currModeIndex=t,e.html&&this.$element.html(e.html),this},x.prototype.currentMode=function(){return this.options.modes[this.currModeIndex]},x.prototype.current=function(){return this.currentMode().mode},x.prototype.getMode=function(t){return t?this.options.modes[this._getModeIndex(t)]:this.currentMode()},x.prototype.hasMode=function(t){try{return!!this.getMode(t)}catch(t){console.debug(t)}return!1},x.prototype.setMode=function(t){return this._setModeByIndex(this._getModeIndex(t))},x.prototype.reset=function(){return this.currModeIndex=0,this.options.initialMode&&(this.currModeIndex=this._getModeIndex(this.options.initialMode)),this._setModeByIndex(this.currModeIndex)},x.prototype.callModeFn=function(t){var e=this.getMode(t).onclick;if(e&&y.type("function"===e))return e.call(this.$element.get(0))},y.fn.modeButton=function(t){if(!this.length)return this;if("object"===y.type(t))return this.map(function(){var e=y(this);return e.data("mode-button",new x(e,t)),this});var e=y(this[0]).data("mode-button");if(!e)throw new Error("modeButton needs an options object or string name of a function");if(e&&"string"===y.type(t)){var i=t;if(e&&"function"===y.type(e[i]))return e[i].apply(e,y.makeArray(arguments).slice(1))}return e},i.d(e,"b",function(){return $});var k,C,S=u.a.ModelListPanel,T=S.extend({_logNamespace:"history",HDAViewClass:f.a.HDAListItemView,HDCAViewClass:m.a.HDCAListItemView,collectionClass:p.a,modelCollectionKey:"contents",tagName:"div",className:"".concat(S.prototype.className," history-panel"),emptyMsg:d()("This history is empty"),noneFoundMsg:d()("No matching datasets found"),searchPlaceholder:d()("search datasets"),initialize:function(t){S.prototype.initialize.call(this,t),this.linkTarget=t.linkTarget||"_blank"},_createDefaultCollection:function(){return new this.collectionClass([],{history:this.model})},freeModel:function(){return S.prototype.freeModel.call(this),this.model&&this.model.stopPolling(),this},_setUpListeners:function(){S.prototype._setUpListeners.call(this),this.on({error:function(t,e,i,n,a){this.errorHandler(t,e,i,n,a)},"views:ready view:attached view:removed":function(t){this._renderSelectButton()},"view:attached":function(t){this.scrollTo(0)}})},loadHistory:function(t,e,i){var n=this;return i=a.a.extend(i||{silent:!0}),this.info("loadHistory:",t,e,i),this.setModel(new h.a({id:t})),i.silent=!0,this.trigger("loading"),this.model.fetchWithContents(e,i).always(function(){n.render(),n.trigger("loading-done")})},refreshContents:function(t){return this.model?this.model.refresh(t):s.a.when()},_setUpCollectionListeners:function(){return S.prototype._setUpCollectionListeners.call(this),this.listenTo(this.collection,{"fetching-more":function(){this._toggleContentsLoadingIndicator(!0),this.$emptyMessage().hide()},"fetching-more-done":function(){this._toggleContentsLoadingIndicator(!1)}})},_showLoadingIndicator:function(t,e,i){var n=s()('<div class="loading-indicator"/>');this.$el.html(n.text(t).slideDown(a.a.isUndefined(e)?this.fxSpeed:e))},_hideLoadingIndicator:function(t){this.$(".loading-indicator").slideUp(a.a.isUndefined(t)?this.fxSpeed+200:t,function(){s()(this).remove()})},_buildNewRender:function(){var t=S.prototype._buildNewRender.call(this);return this._renderSelectButton(t),t},_renderSelectButton:function(t){if(t=t||this.$el,!this.multiselectActions().length)return null;if(!this.views.length)return this.hideSelectors(),t.find(".controls .actions .show-selectors-btn").remove(),null;var e=t.find(".controls .actions .show-selectors-btn");return e.length?e:Object(_.a)({title:d()("Operations on multiple datasets"),classes:"show-selectors-btn",faIcon:"fa-check-square-o",tooltipConfig:{placement:"top"}}).prependTo(t.find(".controls .actions"))},_renderEmptyMessage:function(t){var e=this.$emptyMessage(t);return this.model.get("contents_active").active<=0?e.empty().append(this.emptyMsg).show():this.searchFor&&this.model.contents.haveSearchDetails()&&!this.views.length?e.empty().append(this.noneFoundMsg).show():(e.hide(),s()())},$scrollContainer:function(t){return this.$list(t)},_toggleContentsLoadingIndicator:function(t){t?this.$list().html('<div class="contents-loading-indicator"><span class="fa fa-2x fa-spinner fa-spin"/></div>'):this.$list().find(".contents-loading-indicator").remove()},renderItems:function(t){t=t||this.$el;var e=this.$list(t);s()(".tooltip").remove(),e.empty(),this.views=[];var i=this._filterCollection();return i.length?(this._renderPagination(t),this.views=this._renderSomeItems(i,e)):t.find("> .controls .list-pagination").empty(),this._renderEmptyMessage(t).toggle(!i.length),this.trigger("views:ready",this.views),this.views},_renderPagination:function(t){var e=t.find("> .controls .list-pagination");return this.searchFor||!this.model.contents.shouldPaginate()?e.empty():(e.html(this.templates.pagination({current:this.model.contents.currentPage+1,last:this.model.contents.getLastPage()+1},this)),e.find("select.pages").tooltip(),e)},_renderSomeItems:function(t,e){var i=this,n=[];return e.append(t.map(function(t){var e=i._createItemView(t);return n.push(e),i._renderItemView$el(e)})),n},_filterItem:function(t){var e=this.model.contents;return(e.includeHidden||!t.hidden())&&(e.includeDeleted||!t.isDeletedOrPurged())&&S.prototype._filterItem.call(this,t)},_getItemViewClass:function(t){var e=t.get("history_content_type");switch(e){case"dataset":return this.HDAViewClass;case"dataset_collection":return this.HDCAViewClass}throw new TypeError("Unknown history_content_type: ".concat(e))},_getItemViewOptions:function(t){var e=S.prototype._getItemViewOptions.call(this,t);return a.a.extend(e,{linkTarget:this.linkTarget,expanded:this.model.contents.storage.isExpanded(t.id),hasUser:this.model.ownedByCurrUser()})},_setUpItemViewListeners:function(t){var e=this;return S.prototype._setUpItemViewListeners.call(e,t),e.listenTo(t,{expanded:function(t){e.model.contents.storage.addExpanded(t.model)},collapsed:function(t){e.model.contents.storage.removeExpanded(t.model)}})},collapseAll:function(){this.model.contents.storage.clearExpanded(),S.prototype.collapseAll.call(this)},getSelectedModels:function(){var t=S.prototype.getSelectedModels.call(this);return t.historyId=this.collection.historyId,t},events:a.a.extend(a.a.clone(S.prototype.events),{"click .show-selectors-btn":"toggleSelectors","click > .controls .prev":"_clickPrevPage","click > .controls .next":"_clickNextPage","change > .controls .pages":"_changePageSelect","click .messages [class$=message]":"clearMessages"}),_clickPrevPage:function(t){this.model.stopPolling(),this.model.contents.fetchPrevPage()},_clickNextPage:function(t){this.model.stopPolling(),this.model.contents.fetchNextPage()},_changePageSelect:function(t){this.model.stopPolling();var e=s()(t.currentTarget).val();this.model.contents.fetchPage(e)},toggleShowDeleted:function(t,e){t=void 0!==t?t:!this.model.contents.includeDeleted;var i=this.model.contents;return i.setIncludeDeleted(t,e),this.trigger("show-deleted",t),i.fetchCurrentPage({renderAll:!0}),t},toggleShowHidden:function(t,e,i){t=void 0!==t?t:!this.model.contents.includeHidden;var n=this.model.contents;return n.setIncludeHidden(t,i),this.trigger("show-hidden",t),n.fetchCurrentPage({renderAll:!0}),t},_firstSearch:function(t){var e=this;this.log("onFirstSearch",t),this.model.contents.haveSearchDetails()?this.searchItems(t):(this.$("> .controls .search-input").searchInput("toggle-loading"),this.searchFor=t,this.model.contents.progressivelyFetchDetails({silent:!0}).progress(function(t,i,n){e.renderItems(),e.trigger("search:loading-progress",i,n)}).always(function(){e.$el.find("> .controls .search-input").searchInput("toggle-loading")}).done(function(){e.searchItems(t,"force")}))},clearSearch:function(t){var e=this;return this.searchFor?(this.searchFor="",this.trigger("search:clear",this),this.$("> .controls .search-query").val(""),this.model.contents.fetchCurrentPage({silent:!0}).done(function(){e.renderItems()}),this):this},errorHandler:function(t,e,i){if(!e||0!==e.status||0!==e.readyState){if(this.error(t,e,i),a.a.isString(t)&&a.a.isString(e)){var n=t,o=e;return g.a.errorModal(n,o,i)}return e&&502===e.status?g.a.badGatewayErrorModal():g.a.ajaxErrorModal(t,e,i)}},clearMessages:function(t){return(a.a.isUndefined(t)?this.$messages().children('[class$="message"]'):s()(t.currentTarget)).fadeOut(this.fxSpeed,function(){s()(this).remove()}),this},scrollToHid:function(t){return this.scrollToItem(a.a.first(this.viewsWhereModel({hid:t})))},ordinalIndicator:function(t){var e="".concat(t);switch(e.charAt(e.length-1)){case"1":return"".concat(e,"st");case"2":return"".concat(e,"nd");case"3":return"".concat(e,"rd");default:return"".concat(e,"th")}},toString:function(){return"HistoryView(".concat(this.model?this.model.get("name"):"",")")}});function $(t){s()("#toggle-deleted").modeButton({initialMode:t.initialModeDeleted,modes:[{mode:"showing_deleted",html:d()("Exclude deleted")},{mode:"not_showing_deleted",html:d()("Include deleted")}]}),s()("#toggle-hidden").modeButton({initialMode:t.initialModeHidden,modes:[{mode:"showing_hidden",html:d()("Exclude hidden")},{mode:"not_showing_hidden",html:d()("Include hidden")}]}),s()("#switch").click(function(){var t=Object(l.a)(),e=t.currHistoryPanel?t.currHistoryPanel:null;e?e.switchToHistory("${ history[ 'id' ] }"):window.location="${ switch_to_url }"}),t.hasMasthead&&s()("#center").addClass("flex-vertical-container");var e=t.userIsOwner?b.a.HistoryViewEdit:T.HistoryView,i=new h.a(t.historyJSON);s()("#import").click(function(){var t=Object(l.a)();Object(w.a)(i,{useImport:!0,allDatasets:"showing_deleted"===s()("#toggle-deleted").modeButton("getMode").mode}).done(function(){window===window.parent?window.location=Object(r.getAppRoot)():t.currHistoryPanel&&t.currHistoryPanel.loadCurrentHistory()})});var n=new e({el:s()("#history-"+t.historyJSON.id),className:e.prototype.className+" wide",$scrollContainer:t.hasMasthead?function(){return this.$el.parent()}:void 0,model:i,show_deleted:t.showDeletedJson,show_hidden:t.showHiddenJson,purgeAllowed:t.allow_user_dataset_purge});n.trigger("loading"),i.fetchContents({silent:!0}).fail(function(){alert("Galaxy history failed to load")}).done(function(){n.trigger("loading-done"),n.render()}),s()("#toggle-deleted").on("click",function(){n.toggleShowDeleted()}),s()("#toggle-hidden").on("click",function(){n.toggleShowHidden()})}T.prototype.templates=(k=v.a.wrapTemplate(['<div class="controls">','<div class="title">','<div class="name"><%- history.name %></div>',"</div>",'<div class="subtitle"></div>','<div class="history-size"><%- history.nice_size %></div>','<div class="actions"></div>','<div class="messages">',"<% if( history.deleted && history.purged ){ %>",'<div class="deleted-msg warningmessagesmall">',d()("This history has been purged and deleted"),"</div>","<% } else if( history.deleted ){ %>",'<div class="deleted-msg warningmessagesmall">',d()("This history has been deleted"),"</div>","<% } else if( history.purged ){ %>",'<div class="deleted-msg warningmessagesmall">',d()("This history has been purged"),"</div>","<% } %>","<% if( history.message ){ %>",'<div class="<%= history.message.level || "info" %>messagesmall">',"<%= history.message.text %>","</div>","<% } %>","</div>",'<div class="tags-display"></div>','<div class="annotation-display"></div>','<div class="search">','<div class="search-input"></div>',"</div>",'<div class="list-actions">','<div class="btn-group">','<button class="select-all btn btn-secondary"','data-mode="select">',d()("All"),"</button>",'<button class="deselect-all btn btn-secondary"','data-mode="select">',d()("None"),"</button>","</div>",'<div class="list-action-menu btn-group">',"</div>","</div>",'<div class="list-pagination form-inline"></div>',"</div>"],"history"),C=v.a.wrapTemplate(['<button class="prev" <%- pages.current === 1 ? "disabled" : "" %>>previous</button>','<select class="pages form-control" ','title="',d()("Click to open and select a page. Begin typing a page number to select it"),'">',"<% _.range( 1, pages.last + 1 ).forEach( function( i ){ %>",'<option value="<%- i - 1 %>" <%- i === pages.current ? "selected" : "" %>>',"<%- view.ordinalIndicator( i ) %> of <%- pages.last %> pages","</option>","<% }); %>","</select>",'<button class="next" <%- pages.current === pages.last ? "disabled" : "" %>>next</button>'],"pages"),a.a.extend(a.a.clone(S.prototype.templates),{el:function(){return'<div>\n            <div class="controls"></div>\n            <ul class="list-items"></ul>\n            <div class="empty-message infomessagesmall"></div>\',\n        </div>'},controls:k,pagination:C}));e.a={HistoryView:T,historyEntry:$}},6:function(t,e,i){"use strict";i.d(e,"a",function(){return a});var n=i(168),a=i.n(n).a},62:function(t,e,i){"use strict";var n=i(0),a=i.n(n).a;a.fn.make_text_editable=function(t){var e="num_cols"in t?t.num_cols:30,i="num_rows"in t?t.num_rows:4,n="use_textarea"in t&&t.use_textarea,o="on_finish"in t?t.on_finish:null,s="help_text"in t?t.help_text:null,r=a(this);return r.addClass("editable-text").click(function(s){if(!(a(this).children(":input").length>0)){r.removeClass("editable-text");var l,c,d=function(t){r.find(":input").remove(),""!==t?r.text(t):r.html("<br>"),r.addClass("editable-text"),o&&o(t)},u="cur_text"in t?t.cur_text:r.text();n?(l=a("<textarea/>").attr({rows:i,cols:e}).text(a.trim(u)).keyup(function(t){27===t.keyCode&&d(u)}),c=a("<button/>").addClass("btn-sm float-right").text("Done").click(function(){return d(l.val()),!1})):l=a("<input type='text'/>").attr({value:a.trim(u),size:e}).blur(function(){d(u)}).keyup(function(t){27===t.keyCode?a(this).trigger("blur"):13===t.keyCode&&d(a(this).val()),t.stopPropagation()}),r.text(""),r.append(l),c&&r.append(c),l.focus(),l.select(),s.stopPropagation()}}),s&&r.attr("title",s).tooltip(),r}},63:function(t,e,i){"use strict";i.d(e,"a",function(){return a});var n=i(36);function a(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"/",e=document.getElementsByTagName("link"),i=Array.from(e).find(function(t){return"index"==t.rel});return i&&i.href?Object(n.a)(i.href):t}},64:function(t,e,i){"use strict";i.d(e,"a",function(){return T}),i.d(e,"b",function(){return $});var n=i(1),a=i.n(n),o=i(0),s=i.n(o),r=i(3),l=i.n(r),c=i(4),d=i(5),u=i(2),h=i.n(u),p=i(43),f=i(14),m=i(26),g=i(29),_=i(33);i(240),i(241),i(242),i(134),i(243),i(164),i(244),i(245),i(62);function v(t){return(v="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function b(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function w(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function y(t,e,i){return e&&w(t.prototype,e),i&&w(t,i),t}function x(t,e){return!e||"object"!==v(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function k(t){return(k=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function C(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&S(t,e)}function S(t,e){return(S=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var T=function(t){function e(t){return b(this,e),x(this,k(e).call(this,t))}return C(e,l.a.Model),y(e,[{key:"initialize",value:function(t){this.baseURL=t}},{key:"save_viz",value:function(){var t=this,e=Object(d.a)();e.modal.show({title:"Saving...",body:"progress"});var i=[];s()(".bookmark").each(function(){i.push({position:s()(t).children(".position").text(),annotation:s()(t).children(".annotation").text()})});var n=this.view.overview_drawable?this.view.overview_drawable.config.get_value("name"):null,a={view:this.view.to_dict(),viewport:{chrom:this.view.chrom,start:this.view.low,end:this.view.high,overview:n},bookmarks:i};return s.a.ajax({url:"".concat(Object(c.getAppRoot)(),"visualization/save"),type:"POST",dataType:"json",data:{id:this.view.vis_id,title:this.view.config.get_value("name"),dbkey:this.view.dbkey,type:"trackster",vis_json:JSON.stringify(a)}}).success(function(i){e.modal.hide(),t.view.vis_id=i.vis_id,t.view.has_changes=!1,window.history.pushState({},"",i.url+window.top.location.hash)}).error(function(){e.modal.show({title:h()("Could Not Save"),body:"Could not save visualization. Please try again later.",buttons:{Cancel:function(){e.modal.hide()}}})})}},{key:"createButtonMenu",value:function(){var t=this,e=m.a.create_icon_buttons_menu([{icon_class:"plus-button",title:h()("Add tracks"),on_click:function(){f.a.select_datasets({dbkey:t.view.dbkey},function(e){a.a.each(e,function(e){t.view.add_drawable(p.a.object_from_template(e,t.view,t.view))})})}},{icon_class:"block--plus",title:h()("Add group"),on_click:function(){t.view.add_drawable(new p.a.DrawableGroup(t.view,t.view,{name:"New Group"}))}},{icon_class:"bookmarks",title:h()("Bookmarks"),on_click:function(){window.force_right_panel("0px"==s()("div#right").css("right")?"hide":"show")}},{icon_class:"globe",title:h()("Circster"),on_click:function(){window.top.location="".concat(t.baseURL,"visualization/circster?id=").concat(t.view.vis_id)}},{icon_class:"disk--arrow",title:h()("Save"),on_click:function(){t.save_viz()}},{icon_class:"cross-circle",title:h()("Close"),on_click:function(){t.handle_unsaved_changes(t.view)}}],{tooltip_config:{placement:"bottom"}});return this.buttonMenu=e,e}},{key:"add_bookmark",value:function(t,e,i){var n=this,a=s()("#right .unified-panel-body"),o=s()("<div/>").addClass("bookmark").appendTo(a),r=s()("<div/>").addClass("position").appendTo(o);s()("<a href=''/>").text(t).appendTo(r).click(function(){return n.view.go_to(t),!1});var l=s()("<div/>").text(e).appendTo(o);if(i){var c=s()("<div/>").addClass("delete-icon-container").prependTo(o).click(function(){return o.slideUp("fast"),o.remove(),n.view.has_changes=!0,!1});s()("<a href=''/>").addClass("icon-button delete").appendTo(c),l.make_text_editable({num_rows:3,use_textarea:!0,help_text:"Edit bookmark note"}).addClass("annotation")}return this.view.has_changes=!0,o}},{key:"create_visualization",value:function(t,e,i,n,o){var r=this;return this.view=new p.a.TracksterView(a.a.extend(t,{header:!1})),this.view.editor=!0,s.a.when(this.view.load_chroms_deferred).then(function(t){var a=null;if(e){var s=e.chrom,l=e.start,c=e.end;a=e.overview,s&&void 0!==l&&c?r.view.change_chrom(s,l,c):r.view.change_chrom(t[0].chrom)}else r.view.change_chrom(t[0].chrom);if(i)for(var d=0;d<i.length;d++)r.view.add_drawable(p.a.object_from_template(i[d],r.view,r.view));for(var u=0;u<r.view.drawables.length;u++)if(r.view.drawables[u].config.get_value("name")===a){r.view.set_overview(r.view.drawables[u]);break}if(n)for(var h,f=0;f<n.length;f++)h=n[f],r.add_bookmark(h.position,h.annotation,o);r.view.has_changes=!1}),this.set_up_router({view:this.view}),this.view}},{key:"set_up_router",value:function(t){new f.a.TrackBrowserRouter(t),l.a.history.start()}},{key:"init_keyboard_nav",value:function(t){s()(document).keyup(function(e){if(!s()(e.srcElement).is(":input"))switch(e.which){case 37:t.move_fraction(.25);break;case 38:t.viewport_container.scrollTop(t.viewport_container.scrollTop()-20);break;case 39:t.move_fraction(-.25);break;case 40:t.viewport_container.scrollTop(t.viewport_container.scrollTop()+20)}})}},{key:"handle_unsaved_changes",value:function(t){var e=this,i=Object(d.a)();t.has_changes?i.modal.show({title:h()("Close visualization"),body:"There are unsaved changes to your visualization which will be lost if you do not save them.",buttons:{Cancel:function(){i.modal.hide()},"Leave without Saving":function(){s()(window).off("beforeunload"),window.top.location="".concat(Object(c.getAppRoot)(),"visualizations/list")},Save:function(){s.a.when(e.save_viz()).then(function(){window.top.location="".concat(Object(c.getAppRoot)(),"visualizations/list")})}}}):window.top.location="".concat(Object(c.getAppRoot)(),"visualizations/list")}}]),e}(),$=function(t){function e(t){return b(this,e),x(this,k(e).call(this,t))}return C(e,l.a.View),y(e,[{key:"initialize",value:function(){var t=this;this.ui=new T(Object(c.getAppRoot)()),this.ui.createButtonMenu(),this.ui.buttonMenu.$el.attr("style","float: right"),s()("#center .unified-panel-header-inner").append(this.ui.buttonMenu.$el),s()("#right .unified-panel-title").append("Bookmarks"),s()("#right .unified-panel-icons").append("<a id='add-bookmark-button' class='icon-button menu-button plus-button' href='javascript:void(0);' title='Add bookmark'></a>"),s()("#right-border").click(function(){t.ui.view.resize_window()}),window.force_right_panel("hide"),window.galaxy_config.app.id?this.view_existing():g.a.get("dataset_id")?this.choose_existing_or_new():this.view_new()}},{key:"choose_existing_or_new",value:function(){var t=this,e=Object(d.a)(),i=g.a.get("dbkey"),n={dbkey:i,dataset_id:g.a.get("dataset_id"),hda_ldda:g.a.get("hda_ldda"),gene_region:g.a.get("gene_region")};e.modal.show({title:"View Data in a New or Saved Visualization?",body:"<p><ul style='list-style: disc inside none'>You can add this dataset as:<li>a new track to one of your existing, saved Trackster sessions if they share the genome build: <b>".concat(i||"Not available.","</b></li><li>or create a new session with this dataset as the only track</li></ul></p>"),buttons:{Cancel:function(){window.top.location="".concat(Object(c.getAppRoot)(),"visualizations/list")},"View in saved visualization":function(){t.view_in_saved(n)},"View in new visualization":function(){t.view_new()}}})}},{key:"view_in_saved",value:function(t){var e=this,i=Object(d.a)(),n=new _.a({url_base:"".concat(Object(c.getAppRoot)(),"visualization/list_tracks"),embedded:!0});i.modal.show({title:h()("Add Data to Saved Visualization"),body:n.$el,buttons:{Cancel:function(){window.top.location="".concat(Object(c.getAppRoot)(),"visualizations/list")},"Add to visualization":function(){s()(window.parent.document).find("input[name=id]:checked").each(function(){t.id=s()(e).val(),window.top.location="".concat(Object(c.getAppRoot)(),"visualization/trackster?").concat(s.a.param(t))})}}})}},{key:"view_existing",value:function(){var t=window.galaxy_config.app.viz_config;this.ui.create_visualization({container:s()("#center .unified-panel-body"),name:t.title,vis_id:t.vis_id,dbkey:t.dbkey},t.viewport,t.tracks,t.bookmarks,!0),this.init_editor()}},{key:"view_new",value:function(){var t=this,e=Object(d.a)();s.a.ajax({url:"".concat(Object(c.getAppRoot)(),"api/genomes?chrom_info=True"),data:{},error:function(){alert("Couldn't create new browser.")},success:function(i){e.modal.show({title:h()("New Visualization"),body:t.template_view_new(i),buttons:{Cancel:function(){window.top.location="".concat(Object(c.getAppRoot)(),"visualizations/list")},Create:function(){t.create_browser(s()("#new-title").val(),s()("#new-dbkey").val()),e.modal.hide()}}});var n=i.map(function(t){return t[1]});window.galaxy_config.app.default_dbkey&&a.a.contains(n,window.galaxy_config.app.default_dbkey)&&s()("#new-dbkey").val(window.galaxy_config.app.default_dbkey),s()("#new-title").focus(),s()("select[name='dbkey']").select2(),s()("#overlay").css("overflow","auto")}})}},{key:"template_view_new",value:function(t){for(var e='<form id="new-browser-form" action="javascript:void(0);" method="post" onsubmit="return false;"><div class="form-row"><label for="new-title">Browser name:</label><div class="form-row-input"><input type="text" name="title" id="new-title" value="Unnamed"></input></div><div style="clear: both;"></div></div><div class="form-row"><label for="new-dbkey">Reference genome build (dbkey): </label><div class="form-row-input"><select name="dbkey" id="new-dbkey">',i=0;i<t.length;i++)e+='<option value="'.concat(t[i][1],'">').concat(t[i][0],"</option>");return e+='</select></div><div style="clear: both;"></div></div><div class="form-row">Is the build not listed here? <a href="'.concat(Object(c.getAppRoot)(),'custom_builds" target="_top">Add a Custom Build</a></div></form>')}},{key:"init_editor",value:function(){var t=this;s()("#center .unified-panel-title").text("".concat(this.ui.view.config.get_value("name")," (").concat(this.ui.view.dbkey,")")),window.galaxy_config.app.add_dataset&&s.a.ajax({url:"".concat(Object(c.getAppRoot)(),"api/datasets/").concat(window.galaxy_config.app.add_dataset),data:{hda_ldda:"hda",data_type:"track_config"},dataType:"json",success:function(e){t.ui.view.add_drawable(p.a.object_from_template(e,t.ui.view,t.ui.view))}}),s()("#add-bookmark-button").click(function(){var e="".concat(t.ui.view.chrom,":").concat(t.ui.view.low,"-").concat(t.ui.view.high);return t.ui.add_bookmark(e,"Bookmark description",!0)}),this.ui.init_keyboard_nav(this.ui.view),s()(window).on("beforeunload",function(){if(t.ui.view.has_changes)return"There are unsaved changes to your visualization that will be lost if you leave this page."})}},{key:"create_browser",value:function(t,e){s()(document).trigger("convert_to_values"),this.ui.create_visualization({container:s()("#center .unified-panel-body"),name:t,dbkey:e},window.galaxy_config.app.gene_region),this.init_editor(),this.ui.view.editor=!0}}]),e}()},65:function(t,e,i){"use strict";var n=i(1),a=i.n(n),o=i(0),s=i.n(o),r=i(3),l=i.n(r),c=i(4),d=i(104),u=i(47),h=i(46),p=i(7),f=p.a.SessionStorageModel.extend({defaults:{expandedIds:{},show_deleted:!1,show_hidden:!1},addExpanded:function(t){var e=this.get("expandedIds");e[t.id]=t.get("id"),this.save("expandedIds",e)},removeExpanded:function(t){var e=this.get("expandedIds");delete e[t.id],this.save("expandedIds",e)},isExpanded:function(t){return a.a.result(this.get("expandedIds"),t,!1)},allExpanded:function(){return a.a.values(this.get("expandedIds"))},clearExpanded:function(){this.set("expandedIds",{})},includeDeleted:function(t){return a.a.isUndefined(t)||this.set("show_deleted",t),this.get("show_deleted")},includeHidden:function(t){return a.a.isUndefined(t)||this.set("show_hidden",t),this.get("show_hidden")},toString:function(){return"HistoryPrefs(".concat(this.id,")")}},{storageKeyPrefix:"history:",historyStorageKey:function(t){if(!t)throw new Error("HistoryPrefs.historyStorageKey needs valid id: ".concat(t));return f.storageKeyPrefix+t},get:function(t){return new f({id:f.historyStorageKey(t)})},clearAll:function(t){for(var e in sessionStorage)0===e.indexOf(f.storageKeyPrefix)&&sessionStorage.removeItem(e)}}),m={HistoryPrefs:f},g=i(100),_=i(49);i.d(e,"a",function(){return w});var v=window.localStorage.getItem("historyContentsLimitPerPageDefault")||500,b=d.a.PaginatedCollection,w=b.extend(p.a.LoggableMixin).extend({_logNamespace:"history",limitPerPage:v,limitPerProgressiveFetch:v,order:"hid",url:function(){return"".concat(this.urlRoot,"/").concat(this.historyId,"/contents")},initialize:function(t,e){this.on({"sync add":this.trackJobStates}),e=e||{},this.urlRoot="".concat(Object(c.getAppRoot)(),"api/histories"),b.prototype.initialize.call(this,t,e),this.history=e.history||null,this.setHistoryId(e.historyId||null),this.includeDeleted=e.includeDeleted||this.includeDeleted,this.includeHidden=e.includeHidden||this.includeHidden,this.model.prototype.idAttribute="type_id"},trackJobStates:function(){var t=this;this.each(function(e){if(!e.has("job_states_summary")&&"dataset_collection"===e.attributes.history_content_type){var i=e.attributes.job_source_type,n=e.attributes.job_source_id;if(i&&t.jobStateSummariesCollection){t.jobStateSummariesCollection.add({id:n,model:i,history_id:t.history_id,collection_id:e.attributes.id});var a=t.jobStateSummariesCollection.get(n);e.jobStatesSummary=a}}})},model:function(t,e){return"dataset"===t.history_content_type?new u.a.HistoryDatasetAssociation(t,e):"dataset_collection"===t.history_content_type?new h.a.HistoryDatasetCollection(t,e):{validationError:"Unknown history_content_type: ".concat(t.history_content_type)}},stopPolling:function(){this.jobStateSummariesCollection&&(this.jobStateSummariesCollection.active=!1,this.jobStateSummariesCollection.clearUpdateTimeout())},setHistoryId:function(t){this.stopPolling(),this.historyId=t,t&&(this._setUpWebStorage(),this.jobStateSummariesCollection=new g.a.JobStatesSummaryCollection,this.jobStateSummariesCollection.historyId=t,this.jobStateSummariesCollection.monitor())},_setUpWebStorage:function(t){return this.storage=new m.HistoryPrefs({id:m.HistoryPrefs.historyStorageKey(this.historyId)}),this.trigger("new-storage",this.storage,this),this.on({"include-deleted":function(t){this.storage.includeDeleted(t)},"include-hidden":function(t){this.storage.includeHidden(t)}}),this.includeDeleted=this.storage.includeDeleted()||!1,this.includeHidden=this.storage.includeHidden()||!1,this},comparators:a.a.extend(a.a.clone(b.prototype.comparators),{name:p.a.buildComparator("name",{ascending:!0}),"name-dsc":p.a.buildComparator("name",{ascending:!1}),hid:p.a.buildComparator("hid",{ascending:!1}),"hid-asc":p.a.buildComparator("hid",{ascending:!0})}),running:function(){return this.filter(function(t){return!t.inReadyState()})},runningAndActive:function(){return this.filter(function(t){return!t.inReadyState()&&t.get("visible")&&!t.get("deleted")})},getByHid:function(t){return this.findWhere({hid:t})},haveDetails:function(){return this.all(function(t){return t.hasDetails()})},hidden:function(){return this.filter(function(t){return t.hidden()})},deleted:function(){return this.filter(function(t){return t.get("deleted")})},visibleAndUndeleted:function(){return this.filter(function(t){return t.get("visible")&&!t.get("deleted")})},setIncludeDeleted:function(t,e){if(a.a.isBoolean(t)&&t!==this.includeDeleted){if(this.includeDeleted=t,a.a.result(e,"silent"))return;this.trigger("include-deleted",t,this)}},setIncludeHidden:function(t,e){if(a.a.isBoolean(t)&&t!==this.includeHidden){if(this.includeHidden=t,e=e||{},a.a.result(e,"silent"))return;this.trigger("include-hidden",t,this)}},fetch:function(t){if(t=t||{},this.historyId&&!t.details){var e=m.HistoryPrefs.get(this.historyId).toJSON();a.a.isEmpty(e.expandedIds)||(t.details=a.a.values(e.expandedIds).join(","))}return b.prototype.fetch.call(this,t)},_buildFetchData:function(t){return a.a.extend(b.prototype._buildFetchData.call(this,t),{v:"dev"})},_fetchParams:b.prototype._fetchParams.concat(["v","details"]),_buildFetchFilters:function(t){var e=b.prototype._buildFetchFilters.call(this,t)||{},i={};return this.includeDeleted||(i.deleted=!1,i.purged=!1),this.includeHidden||(i.visible=!0),a.a.defaults(e,i)},getTotalItemCount:function(){return this.history.contentsShown()},fetchUpdated:function(t,e){return t&&((e=e||{filters:{}}).remove=!1,e.filters={"update_time-ge":t.toISOString(),visible:""}),this.fetch(e)},fetchDeleted:function(t){var e=this;return(t=t||{}).filters=a.a.extend(t.filters,{deleted:!0,purged:void 0}),t.remove=!1,this.trigger("fetching-deleted",this),this.fetch(t).always(function(){e.trigger("fetching-deleted-done",e)})},fetchHidden:function(t){var e=this;return(t=t||{}).filters=a.a.extend(t.filters,{visible:!1}),t.remove=!1,this.trigger("fetching-hidden",this),this.fetch(t).always(function(){e.trigger("fetching-hidden-done",e)})},fetchAllDetails:function(t){return(t=t||{}).data=a.a.extend(t.data||{},{details:"all"}),this.fetch(t)},_filterAndUpdate:function(t,e){var i=this,n=this.model.prototype.idAttribute,a=[e];return this.fetch({filters:t,remove:!1}).then(function(t){return t=t.reduce(function(t,e,a){var o=i.get(e[n]);return o?t.concat(o):t},[]),i.ajaxQueue("save",a,t)})},ajaxQueue:function(t,e,i){return i=i||this.models,new _.a.AjaxQueue(i.slice().reverse().map(function(i,n){var o=a.a.isString(t)?i[t]:t;return function(){return o.apply(i,e)}})).deferred},_recursivelyFetch:function(t,e,i,n,o){var s=this;o=o||0;var r=a.a.extend(a.a.clone(t),{view:"summary",keys:e,limit:n,offset:o,reset:0===o,remove:!1});a.a.defer(function(){s.fetch.call(s,r).fail(i.reject).done(function(a){i.notify(a,n,o),a.length!==n?(s.allFetched=!0,i.resolve(a,n,o)):s._recursivelyFetch(t,e,i,n,o+n)})})},progressivelyFetchDetails:function(t){t=t||{};var e=s.a.Deferred();return this._recursivelyFetch(t,u.a.HistoryDatasetAssociation.prototype.searchAttributes.join(","),e,t.limitPerCall||this.limitPerProgressiveFetch),e},isCopyable:function(t){return a.a.isObject(t)&&t.id&&a.a.contains(["HistoryDatasetAssociation","HistoryDatasetCollectionAssociation"],t.model_class)},copy:function(t){var e,i,n;a.a.isString(t)?(e=t,n="hda",i="dataset"):(e=t.id,n={HistoryDatasetAssociation:"hda",LibraryDatasetDatasetAssociation:"ldda",HistoryDatasetCollectionAssociation:"hdca"}[t.model_class]||"hda",i="hdca"===n?"dataset_collection":"dataset");var o=this,r=s.a.ajax(this.url(),{method:"POST",contentType:"application/json",data:JSON.stringify({content:e,source:n,type:i,copy_elements:!0})}).done(function(t){o.add([t],{parse:!0})}).fail(function(t,a,s){o.trigger("error",o,r,{},"Error copying contents",{type:i,id:e,source:n})});return r},createHDCA:function(t,e,i,n,a,o){return void 0===a&&(a=!0),this.model({history_content_type:"dataset_collection",collection_type:e,history_id:this.historyId,name:i,hide_source_items:n||!1,copy_elements:a,element_identifiers:t}).save(o)},haveSearchDetails:function(){return this.allFetched&&this.all(function(t){return a.a.has(t.attributes,"annotation")})},matches:function(t){return this.filter(function(e){return e.matches(t)})},clone:function(){var t=l.a.Collection.prototype.clone.call(this);return t.historyId=this.historyId,t},toString:function(){return["HistoryContents(",[this.historyId,this.length].join(),")"].join("")}})},66:function(t,e,i){"use strict";var n=["log","debug","info","warn","error","metric"];e.a=function(t,e){var i=void 0!==t.prototype?t.prototype:t;return void 0!==e&&(i._logNamespace=e),n.forEach(function(t){i[t]=function(){if(this.logger)return this.logger.emit?this.logger.emit(t,this._logNamespace,arguments):this.logger[t]?this.logger[t].apply(this.logger,arguments):void 0}}),t}},67:function(t,e,i){"use strict";var n=i(0),a=i.n(n),o=i(3),s=i.n(o),r=i(8),l=i(10),c=s.a.View.extend({visible:!1,initialize:function(t){var e=this;this.model=t&&t.model||new s.a.Model({id:r.a.uid(),cls:"ui-portlet",title:"",icon:"",buttons:null,body:null,scrollable:!0,operations:null,collapsible:!1,collapsible_button:!0,collapsed:!1,onchange_title:null}).set(t),this.setElement(this._template()),this.$body=this.$(".portlet-body"),this.$title=this.$(".portlet-title"),this.$title_text=this.$(".portlet-title-text"),this.$title_icon=this.$(".portlet-title-icon"),this.$header=this.$(".portlet-header"),this.$content=this.$(".portlet-content"),this.$backdrop=this.$(".portlet-backdrop"),this.$buttons=this.$(".portlet-buttons"),this.$operations=this.$(".portlet-operations"),this.model.get("body")&&this.append(this.model.get("body")),this.collapsible_button=new l.a.Button({icon:"fa-eye",tooltip:"Collapse/Expand",cls:"ui-button-icon-plain",onclick:function(){e[e.collapsed?"expand":"collapse"]()}}),this.render()},render:function(){var t=this,e=this.model.attributes;return this.$el.removeClass().addClass(e.cls).attr("id",e.id),this.$header[e.title?"show":"hide"](),this.$title_text.html(e.title),e.title_id&&this.$title.attr("id",e.title_id),e.icon?this.$title_icon.removeClass().addClass("portlet-title-icon fa mr-1").addClass(e.icon).show():this.$title_icon.hide(),this.$title_text[e.collapsible?"addClass":"removeClass"]("no-highlight collapsible").off(),e.collapsible&&(this.$title_text.on("click",function(){t[t.collapsed?"expand":"collapse"]()}),e.collapsed?this.collapse():this.expand()),this.$title_text.prop("disabled",!e.onchange_title),e.onchange_title&&this.$title_text.make_text_editable({on_finish:function(t){e.onchange_title(t)}}),e.buttons?(this.$buttons.empty().show(),a.a.each(this.model.get("buttons"),function(e,i){i.$el.prop("id",e),t.$buttons.append(i.$el)})):this.$buttons.hide(),this.$operations.empty,e.collapsible&&e.collapsible_button&&this.$operations.append(this.collapsible_button.$el),e.operations&&a.a.each(e.operations,function(e,i){i.$el.prop("id",e),t.$operations.append(i.$el)}),this},append:function(t){this.$body.append(t)},empty:function(){this.$body.empty()},header:function(){return this.$header},body:function(){return this.$body},show:function(){this.visible=!0,this.$el.fadeIn("fast")},hide:function(){this.visible=!1,this.$el.hide()},enableButton:function(t){this.$buttons.find("#".concat(t)).prop("disabled",!1)},disableButton:function(t){this.$buttons.find("#".concat(t)).prop("disabled",!0)},hideOperation:function(t){this.$operations.find("#".concat(t)).hide()},showOperation:function(t){this.$operations.find("#".concat(t)).show()},setOperation:function(t,e){this.$operations.find("#".concat(t)).off("click").on("click",e)},title:function(t){return t&&this.$title_text.html(t),this.$title_text.html()},collapse:function(){this.collapsed=!0,this.$content.hide(),this.collapsible_button.setIcon("fa-eye-slash")},expand:function(){this.collapsed=!1,this.$content.show(),this.collapsible_button.setIcon("fa-eye")},disable:function(){this.$backdrop.show()},enable:function(){this.$backdrop.hide()},_template:function(){return a()("<div/>").append(a()("<div/>").addClass("portlet-header").append(a()("<div/>").addClass("portlet-operations")).append(a()("<div/>").addClass("portlet-title").append(a()("<i/>").addClass("portlet-title-icon")).append(a()("<span/>").addClass("portlet-title-text")))).append(a()("<div/>").addClass("portlet-content").append(a()("<div/>").addClass("portlet-body")).append(a()("<div/>").addClass("portlet-buttons mt-3 mb-3"))).append(a()("<div/>").addClass("portlet-backdrop"))}});e.a={View:c}},68:function(t,e,i){"use strict";i.d(e,"a",function(){return o});var n=i(8);function a(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var i=[],n=!0,a=!1,o=void 0;try{for(var s,r=t[Symbol.iterator]();!(n=(s=r.next()).done)&&(i.push(s.value),!e||i.length!==e);n=!0);}catch(t){a=!0,o=t}finally{try{n||null==r.return||r.return()}finally{if(a)throw o}}return i}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function o(t){var e=Object(n.b)(t),i=Math.abs((e>>4)%360),o=75+(15&e),s="hsl(".concat(i,", 100%, ").concat(o,"%)"),r="hsl(".concat(i,", 100%, ").concat(o-40,"%)"),l=a(function(t,e,i){var n,a,o;if(0==e)n=a=o=i;else{var s=function(t,e,i){return i<0&&(i+=1),i>1&&(i-=1),i<1/6?t+6*(e-t)*i:i<.5?e:i<2/3?t+(e-t)*(2/3-i)*6:t},r=i<.5?i*(1+e):i+e-i*e,l=2*i-r;n=s(l,r,t+1/3),a=s(l,r,t),o=s(l,r,t-1/3)}return[n,a,o]}(i,1,o/100),3);return{primary:s,darker:r,contrasting:function(t,e,i){return(255*t*299+255*e*587+255*i*114)/1e3>125?"black":"white"}(l[0],l[1],l[2])}}},69:function(t,e,i){"use strict";i.d(e,"a",function(){return o});var n=i(0),a=i.n(n);function o(){console.log("init_refresh_on_change"),a()("select[refresh_on_change='true']").off("change").change(function(){var t=a()(this),e=t.val(),i=t.attr("refresh_on_change_values");if(i){i=i.split(",");var n=t.attr("last_selected_value");if(-1===a.a.inArray(e,i)&&-1===a.a.inArray(n,i))return}a()(window).trigger("refresh_on_change"),a()(document).trigger("convert_to_values"),t.get(0).form.submit()}),a()(":checkbox[refresh_on_change='true']").off("click").click(function(){var t=a()(this),e=t.val(),i=t.attr("refresh_on_change_values");if(i){i=i.split(",");var n=t.attr("last_selected_value");if(-1===a.a.inArray(e,i)&&-1===a.a.inArray(n,i))return}a()(window).trigger("refresh_on_change"),t.get(0).form.submit()}),a()("a[confirm]").off("click").click(function(){return confirm(a()(this).attr("confirm"))})}},7:function(t,e,i){"use strict";var n=i(0),a=i.n(n),o=i(1),s=i.n(o),r=i(3),l=i.n(r),c=i(66),d=i(2),u=i.n(d),h={logger:null,_logNamespace:"."};Object(c.a)(h);var p=l.a.Model.extend({initialize:function(t){if(this._checkEnabledSessionStorage(),!t.id)throw new Error("SessionStorageModel requires an id in the initial attributes");this.id=t.id;var e=this.isNew()?{}:this._read(this);this.clear({silent:!0}),this.save(s.a.extend({},this.defaults,e,t),{silent:!0}),this.on("change",function(){this.save()})},_checkEnabledSessionStorage:function(){try{return window.sessionStorage.length>=0}catch(t){return alert("Please enable cookies in your browser for this Galaxy site"),!1}},sync:function(t,e,i){i.silent||e.trigger("request",e,{},i);var n={};switch(t){case"create":n=this._create(e);break;case"read":n=this._read(e);break;case"update":n=this._update(e);break;case"delete":n=this._delete(e)}return void 0!==n||null!==n?i.success&&i.success():i.error&&i.error(),n},_create:function(t){try{var e=t.toJSON(),i=sessionStorage.setItem(t.id,JSON.stringify(e));return null===i?i:e}catch(t){if(!(t instanceof DOMException&&navigator.userAgent.indexOf("Safari")>-1))throw t}return null},_read:function(t){return JSON.parse(sessionStorage.getItem(t.id))},_update:function(t){return t._create(t)},_delete:function(t){return sessionStorage.removeItem(t.id)},isNew:function(){return!sessionStorage.hasOwnProperty(this.id)},_log:function(){return JSON.stringify(this.toJSON(),null,"  ")},toString:function(){return"SessionStorageModel(".concat(this.id,")")}});p.prototype=s.a.omit(p.prototype,"url","urlRoot");var f={searchAttributes:[],searchAliases:{},searchAttribute:function(t,e){var i=this.get(t);return!(!e||null==i)&&(s.a.isArray(i)?this._searchArrayAttribute(i,e):-1!==i.toString().toLowerCase().indexOf(e.toLowerCase()))},_searchArrayAttribute:function(t,e){return e=e.toLowerCase(),s.a.any(t,function(t){return-1!==t.toString().toLowerCase().indexOf(e.toLowerCase())})},search:function(t){var e=this;return s.a.filter(this.searchAttributes,function(i){return e.searchAttribute(i,t)})},matches:function(t){var e=t.split("=");if(e.length>=2){var i=e[0];return i=this.searchAliases[i]||i,this.searchAttribute(i,e[1])}return!!this.search(t).length},matchesAll:function(t){var e=this;return t=t.match(/(".*"|\w*=".*"|\S*)/g).filter(function(t){return!!t}),s.a.all(t,function(t){return t=t.replace(/"/g,""),e.matches(t)})}},m={hiddenUntilActivated:function(t,e){if(e=e||{},this.HUAVOptions={$elementShown:this.$el,showFn:a.a.prototype.toggle,showSpeed:"fast"},s.a.extend(this.HUAVOptions,e||{}),this.HUAVOptions.hasBeenShown=this.HUAVOptions.$elementShown.is(":visible"),this.hidden=this.isHidden(),t){var i=this;t.on("click",function(t){i.toggle(i.HUAVOptions.showSpeed)})}},isHidden:function(){return this.HUAVOptions.$elementShown.is(":hidden")},toggle:function(){return this.hidden?(this.HUAVOptions.hasBeenShown||s.a.isFunction(this.HUAVOptions.onshowFirstTime)&&(this.HUAVOptions.hasBeenShown=!0,this.HUAVOptions.onshowFirstTime.call(this)),s.a.isFunction(this.HUAVOptions.onshow)&&(this.HUAVOptions.onshow.call(this),this.trigger("hiddenUntilActivated:shown",this)),this.hidden=!1):(s.a.isFunction(this.HUAVOptions.onhide)&&(this.HUAVOptions.onhide.call(this),this.trigger("hiddenUntilActivated:hidden",this)),this.hidden=!0),this.HUAVOptions.showFn.apply(this.HUAVOptions.$elementShown,arguments)}},g={initialize:function(t){this.draggable=t.draggable||!1},$dragHandle:function(){return this.$(".title-bar")},toggleDraggable:function(){this.draggable?this.draggableOff():this.draggableOn()},draggableOn:function(){this.draggable=!0,this.dragStartHandler=s.a.bind(this._dragStartHandler,this),this.dragEndHandler=s.a.bind(this._dragEndHandler,this);var t=this.$dragHandle().attr("draggable",!0).get(0);t.addEventListener("dragstart",this.dragStartHandler,!1),t.addEventListener("dragend",this.dragEndHandler,!1)},draggableOff:function(){this.draggable=!1;var t=this.$dragHandle().attr("draggable",!1).get(0);t.removeEventListener("dragstart",this.dragStartHandler,!1),t.removeEventListener("dragend",this.dragEndHandler,!1)},_dragStartHandler:function(t){return t.dataTransfer.effectAllowed="move",t.dataTransfer.setData("text",JSON.stringify(this.model.toJSON())),this.trigger("draggable:dragstart",t,this),!1},_dragEndHandler:function(t){return this.trigger("draggable:dragend",t,this),!1}},_={initialize:function(t){this.selectable=t.selectable||!1,this.selected=t.selected||!1},$selector:function(){return this.$(".selector")},_renderSelected:function(){this.$selector().find("span").toggleClass("fa-check-square-o",this.selected).toggleClass("fa-square-o",!this.selected)},toggleSelector:function(){this.$selector().is(":visible")?this.hideSelector():this.showSelector()},showSelector:function(t){t=void 0!==t?t:this.fxSpeed,this.selectable=!0,this.trigger("selectable",!0,this),this._renderSelected(),t?this.$selector().show(t):this.$selector().show()},hideSelector:function(t){t=void 0!==t?t:this.fxSpeed,this.selectable=!1,this.trigger("selectable",!1,this),t?this.$selector().hide(t):this.$selector().hide()},toggleSelect:function(t){this.selected?this.deselect(t):this.select(t)},select:function(t){return this.selected||(this.trigger("selected",this,t),this.selected=!0,this._renderSelected()),!1},deselect:function(t){return this.selected&&(this.trigger("de-selected",this,t),this.selected=!1,this._renderSelected()),!1}};e.a={LoggableMixin:h,SessionStorageModel:p,mixin:function(t,e){var i=Array.prototype.slice.call(arguments,0),n=i.pop();return i.unshift(n),s.a.defaults.apply(s.a,i)},SearchableModelMixin:f,HiddenUntilActivatedViewMixin:m,DraggableViewMixin:g,SelectableViewMixin:_,wrapTemplate:function(t,e){e=e||"model";var i=s.a.template(t.join(""));return function(t,n){var a={view:n||{},_l:u.a};return a[e]=t||{},i(a)}},buildComparator:function(t,e){var i=(e=e||{}).ascending?1:-1;return function(e,n){return((e=e.get(t))<(n=n.get(t))?-1:e>n?1:0)*i}}}},70:function(t,e,i){"use strict";var n=i(1),a=i.n(n),o={_validationWarning:function(t,e){"name"===t&&(t=this.$(".collection-name").add(this.$(".collection-name-prompt")),this.$(".collection-name").focus().select()),e?(t=t||this.$(".".concat("validation-warning"))).removeClass("validation-warning"):t.addClass("validation-warning")},_changeHideOriginals:function(t){this.hideOriginals=this.$(".hide-originals").prop("checked")},_changeName:function(t){this._validationWarning("name",!!this._getName())},_nameCheckForEnter:function(t){13!==t.keyCode||this.blocking||this._clickCreate()},_getName:function(){return a.a.escape(this.$(".collection-name").val())},_clickMoreHelp:function(t){t.stopPropagation(),this.$(".main-help").addClass("expanded"),this.$(".more-help").hide()},_clickLessHelp:function(t){t.stopPropagation(),this.$(".main-help").removeClass("expanded"),this.$(".more-help").show()},_toggleHelp:function(t){t.stopPropagation(),this.$(".main-help").toggleClass("expanded"),this.$(".more-help").toggle()},_showAlert:function(t,e){e=e||"alert-danger",this.$(".main-help").hide(),this.$(".header .alert").attr("class","alert alert-dismissable").addClass(e).show().find(".alert-message").html(t)},_hideAlert:function(t){this.$(".main-help").show(),this.$(".header .alert").hide()},_cancelCreate:function(t){"function"==typeof this.oncancel&&this.oncancel.call(this)},_clickCreate:function(t){var e=this._getName();e?this.blocking||this.createList(e):this._validationWarning("name")},_setUpCommonSettings:function(t){this.hideOriginals=t.defaultHideSourceItems||!1},_renderFooter:function(t,e){var i=this,n=this.$(".footer").empty().html(this.templates.footer());return a.a.each(this.footerSettings,function(t,e){i.$(e).prop("checked",i[t])}),"function"==typeof this.oncancel&&this.$(".cancel-create.btn").show(),n},_creatorTemplates:{main:a.a.template(['<div class="header flex-row no-flex"></div>','<div class="middle flex-row flex-row-container"></div>','<div class="footer flex-row no-flex"></div>'].join(""))}};e.a={CollectionCreatorMixin:o}},71:function(t,e,i){"use strict";var n=i(1),a=i.n(n),o=i(4),s=i(105),r=i(37),l=i(2),c=i.n(l),d=s.a.ModelListPanel,u=d.extend({_logNamespace:"collections",className:"".concat(d.prototype.className," dataset-collection-panel"),DatasetDCEViewClass:r.a.DatasetDCEListItemView,modelCollectionKey:"elements",initialize:function(t){d.prototype.initialize.call(this,t),this.linkTarget=t.linkTarget||"_blank",this.dragItems=!0,this.hasUser=t.hasUser,this.panelStack=[],this.parentName=t.parentName,this.foldoutStyle=t.foldoutStyle||"foldout",this.downloadUrl="".concat(Object(o.getAppRoot)(),"api/dataset_collections/").concat(this.model.attributes.id,"/download")},getNestedDCDCEViewClass:function(){return r.a.NestedDCDCEListItemView.extend({foldoutPanelClass:u})},_queueNewRender:function(t,e){e=void 0===e?this.fxSpeed:e;this.handleWarning(t),this.log("_queueNewRender:",t,e),this._swapNewRender(t),this.trigger("rendered",this)},handleWarning:function(t){var e=this.views.length,i=this.model.get("element_count");if(i&&i!==e){var n=c()("displaying only ".concat(e," of ").concat(i," items"));t.find(".elements-warning").html('<div class="warningmessagesmall">'.concat(n,"</div>"))}},_filterCollection:function(){return this.model.getVisibleContents()},_getItemViewClass:function(t){switch(t.get("element_type")){case"hda":return this.DatasetDCEViewClass;case"dataset_collection":return this.getNestedDCDCEViewClass()}throw new TypeError("Unknown element type:",t.get("element_type"))},_getItemViewOptions:function(t){var e=d.prototype._getItemViewOptions.call(this,t);return a.a.extend(e,{linkTarget:this.linkTarget,hasUser:this.hasUser,foldoutStyle:this.foldoutStyle})},_setUpItemViewListeners:function(t){return d.prototype._setUpItemViewListeners.call(this,t),this.listenTo(t,{"expanded:drilldown":function(t,e){this._expandDrilldownPanel(e)},"collapsed:drilldown":function(t,e){this._collapseDrilldownPanel(e)}}),this},_expandDrilldownPanel:function(t){this.panelStack.push(t),this.$("> .controls").add(this.$list()).hide(),t.parentName=this.model.get("name"),this.$el.append(t.render().$el)},_collapseDrilldownPanel:function(t){this.panelStack.pop(),this.render()},events:{"click .navigation .back":"close"},close:function(t){this.remove(),this.trigger("close")},toString:function(){return"CollectionView(".concat(this.model?this.model.get("name"):"",")")}});function h(t){var e=t.get("collection_type");return"list"==e?c()("list"):"paired"==e?c()("dataset pair"):"list:paired"==e?c()("list of pairs"):c()("nested list")}function p(t){var e,i=t.get("element_count"),n="a ".concat(h(t));i&&(1==i?e="with 1 item":i&&(e="with ".concat(i," items")),n="".concat(n," ").concat(c()(e)));return n}u.prototype.templates=a.a.extend(a.a.clone(d.prototype.templates),{controls:function(t,e){var i=p(e.model);return'\n        <div class="controls">\n            <div class="navigation">\n            <a class="back" href="javascript:void(0)">\n                <span class="fa fa-icon fa-angle-left"></span>\n                '.concat(c()("Back to "),"\n                ").concat(a.a.escape(e.parentName),'\n            </a>\n            </div>\n            <div class="title">\n                <div class="name">').concat(a.a.escape(t.name)||a.a.escape(t.element_identifier),'</div>\n                <div class="subtitle">\n                    ').concat(i,'\n                </div>\n            </div>\n            <div class="elements-warning">\n            </div>\n            <div class="tags-display"></div>\n            <div class="actions">\n                <a class="download-btn icon-btn" href="').concat(e.downloadUrl,'"\n                   title="" download="" data-original-title="Download Collection">\n                   <span class="fa fa-floppy-o"></span>\n                </a>\n            </div>\n        </div>')}}),e.a={collectionTypeDescription:h,collectionDescription:p,CollectionView:u}},72:function(t,e,i){"use strict";var n,a,o=i(1),s=i.n(o),r=i(0),l=i.n(r),c=i(4),d=i(5),u=i(11),h=i(42),p=i(44),f=i(108),m=i(23),g=i(7),_=i(2),v=i.n(_),b=h.b.DatasetListItemView,w=b.extend({initialize:function(t){b.prototype.initialize.call(this,t),this.hasUser=t.hasUser,this.purgeAllowed=t.purgeAllowed||!1,this.tagsEditorShown=t.tagsEditorShown||!1,this.annotationEditorShown=t.annotationEditorShown||!1},_renderPrimaryActions:function(){var t=b.prototype._renderPrimaryActions.call(this);return this.model.get("state")===u.a.NOT_VIEWABLE?t:b.prototype._renderPrimaryActions.call(this).concat([this._renderEditButton(),this._renderDeleteButton()])},_renderEditButton:function(){var t=this;if(this.model.get("state")===u.a.DISCARDED||!this.model.get("accessible"))return null;var e=this.model.get("purged"),i=this.model.get("deleted"),n={title:v()("Edit attributes"),href:"".concat(Object(c.getAppRoot)(),"datasets/edit?dataset_id=").concat(this.model.attributes.id),faIcon:"fa-pencil",classes:"edit-btn",onclick:function(e){var i=Object(d.a)();i.router&&(e.preventDefault(),i.router.push("datasets/edit",{dataset_id:t.model.attributes.id}))}};return i||e?(n.disabled=!0,e?n.title=v()("Cannot edit attributes of datasets removed from disk"):i&&(n.title=v()("Undelete dataset to edit attributes"))):[u.a.UPLOAD,u.a.NEW].includes(this.model.get("state"))&&(n.disabled=!0,n.title=v()("This dataset is not yet editable")),Object(m.a)(n)},_renderDeleteButton:function(){if(!this.model.get("accessible"))return null;var t=this,e=this.model.isDeletedOrPurged();return Object(m.a)({title:e?v()("Dataset is already deleted"):v()("Delete"),disabled:e,faIcon:"fa-times",classes:"delete-btn",onclick:function(){t.$el.find(".icon-btn.delete-btn").tooltip("dispose"),t.model.delete()}})},_renderDetails:function(){var t=b.prototype._renderDetails.call(this),e=this.model.get("state");return this.model.isDeletedOrPurged()||(this._renderTags(t),this._renderAnnotation(t),[u.a.OK,u.a.FAILED_METADATA].includes(e)&&this._makeDbkeyEditLink(t)),this._setUpBehaviors(t),t},_renderToolHelpButton:function(){var t=this.model.attributes.dataset_id,e=this.model.attributes.creating_job,i=this,n=function(e){var n='<div id="thdiv-'.concat(t,'" class="toolhelp">');e.name&&e.help?(n+="<strong>Tool help for ".concat(e.name,"</strong><hr/>"),n+=e.help):n+="<strong>Tool help is unavailable for this dataset.</strong><hr/>",n+="</div>",i.$el.find(".details").append(l.a.parseHTML(n))};return null===Object(d.a)().user.id?null:Object(m.a)({title:v()("Tool Help"),classes:"icon-btn",href:"#",faIcon:"fa-question",onclick:function(){i.$el.find(".toolhelp").length>0?i.$el.find(".toolhelp").toggle():l.a.ajax({url:"".concat(Object(c.getAppRoot)(),"api/jobs/").concat(e)}).done(function(t){!function(t){l.a.ajax({url:"".concat(Object(c.getAppRoot)(),"api/tools/").concat(t.tool_id,"/build")}).done(function(t){n(t)}).fail(function(){n({})})}(t)}).fail(function(){console.log('Failed at recovering job information from the  Galaxy API for job id "'.concat(e,'".'))})}})},_renderSecondaryActions:function(){var t=b.prototype._renderSecondaryActions.call(this);switch(this.model.get("state")){case u.a.UPLOAD:case u.a.NOT_VIEWABLE:return t;case u.a.ERROR:return t.unshift(this._renderErrButton()),t.concat([this._renderRerunButton(),this._renderToolHelpButton()]);case u.a.OK:case u.a.FAILED_METADATA:return t.concat([this._renderRerunButton(),this._renderVisualizationsButton(),this._renderToolHelpButton()])}return t.concat([this._renderRerunButton(),this._renderToolHelpButton()])},_renderErrButton:function(){var t=this;return Object(m.a)({title:v()("View or report this error"),href:"".concat(Object(c.getAppRoot)(),"datasets/error?dataset_id=").concat(this.model.attributes.id),classes:"report-error-btn",faIcon:"fa-bug",onclick:function(e){var i=Object(d.a)();i.router&&(e.preventDefault(),i.router.push("datasets/error",{dataset_id:t.model.attributes.id}))}})},_renderRerunButton:function(){var t=this.model.get("creating_job");if(this.model.get("rerunnable"))return Object(m.a)({title:v()("Run this job again"),href:this.model.urls.rerun,classes:"rerun-btn",target:this.linkTarget,faIcon:"fa-refresh",onclick:function(e){var i=Object(d.a)();i.router&&(e.preventDefault(),i.router.push("/",{job_id:t}))}})},_renderVisualizationsButton:function(){var t=this.model.get("visualizations");if(this.model.isDeletedOrPurged()||!this.hasUser||!this.model.hasData()||s.a.isEmpty(t))return null;if(!s.a.isObject(t[0]))return this.warn("Visualizations have been switched off"),null;if(t.length>=1){var e=this.model.get("id"),i=Object(c.getAppRoot)()+"visualizations?dataset_id="+e;return Object(m.a)({title:v()("Visualize this data"),href:i,classes:"visualization-link",faIcon:"fa-bar-chart-o",onclick:function(t){var n=Object(d.a)();n.frame&&n.frame.active?(t.preventDefault(),n.frame.add({url:i,title:"Visualization"})):n.router&&(t.preventDefault(),n.router.push("visualizations",{dataset_id:e}),n.trigger("activate-hda",e))}})}},_renderTags:function(t){var e=this;if(this.hasUser){var i=t.find(".tags-display")[0],n={model:this.model,disabled:!1,context:"dataset-li-edit"},a=Object(p.b)(n,i),o=function(){l()(a.$el).toggleClass("active"),e.tagsEditorShown=l()(a.$el).hasClass("active")};if(Object(m.a)({title:v()("Edit dataset tags"),classes:"tag-btn",faIcon:"fa-tags"}).appendTo(t.find(".actions .right")).on("click",o),this.tagsEditorShown)l()(a.$el).hasClass("active")||o();return a}},_renderAnnotation:function(t){if(this.hasUser){var e=this;this.annotationEditor=new f.a.AnnotationEditor({model:this.model,el:t.find(".annotation-display"),onshowFirstTime:function(){this.render()},onshow:function(){e.annotationEditorShown=!0},onhide:function(){e.annotationEditorShown=!1},$activator:Object(m.a)({title:v()("Edit dataset annotation"),classes:"annotate-btn",faIcon:"fa-comment"}).appendTo(t.find(".actions .right"))}),this.annotationEditorShown&&this.annotationEditor.toggle(!0)}},_makeDbkeyEditLink:function(t){if("?"===this.model.get("metadata_dbkey")&&!this.model.isDeletedOrPurged()){var e=l()('<a class="value">?</a>').attr("href",this.model.urls.edit).attr("target","_top");t.find(".dbkey .value").replaceWith(e)}},events:s.a.extend(s.a.clone(b.prototype.events),{"click .undelete-link":"_clickUndeleteLink","click .purge-link":"_clickPurgeLink","click .edit-btn":function(t){this.trigger("edit",this,t)},"click .delete-btn":function(t){this.trigger("delete",this,t)},"click .rerun-btn":function(t){this.trigger("rerun",this,t)},"click .report-err-btn":function(t){this.trigger("report-err",this,t)},"click .visualization-btn":function(t){this.trigger("visualize",this,t)},"click .dbkey a":function(t){this.trigger("edit",this,t)}}),_clickUndeleteLink:function(t){return this.model.undelete(),!1},_clickPurgeLink:function(t){return window.confirm(v()("This will permanently remove the data in your dataset. Are you sure?"))&&this.model.purge(),!1},toString:function(){var t=this.model?"".concat(this.model):"(no model)";return"HDAEditView(".concat(t,")")}});w.prototype.templates=(n=s.a.extend({},b.prototype.templates.warnings,{failed_metadata:g.a.wrapTemplate(['<% if( dataset.state === "failed_metadata" ){ %>','<div class="failed_metadata-warning warningmessagesmall">',v()("An error occurred setting the metadata for this dataset"),'<br /><a href="<%- dataset.urls.edit %>" target="_top">',v()("Set it manually or retry auto-detection"),"</a>","</div>","<% } %>"],"dataset"),deleted:g.a.wrapTemplate(["<% if( dataset.deleted && !dataset.purged ){ %>",'<div class="deleted-msg warningmessagesmall">',v()("This dataset has been deleted"),'<br /><a class="undelete-link" href="javascript:void(0);">',v()("Undelete it"),"</a>","<% if( view.purgeAllowed ){ %>",'<br /><a class="purge-link" href="javascript:void(0);">',v()("Permanently remove it from disk"),"</a>","<% } %>","</div>","<% } %>"],"dataset")}),a=g.a.wrapTemplate(["<% if( visualizations.length === 1 ){ %>",'<a class="visualization-link icon-btn" href="<%- visualizations[0].href %>"',' target="<%- visualizations[0].target %>" title="',v()("Visualize in"),' <%- visualizations[0].html %>">','<span class="fa fa-bar-chart-o"></span>',"</a>","<% } else { %>",'<div class="visualizations-dropdown dropdown icon-btn">','<a data-toggle="dropdown" title="',v()("Visualize"),'">','<span class="fa fa-bar-chart-o"></span>',"</a>",'<ul class="dropdown-menu" role="menu">',"<% _.each( visualizations, function( visualization ){ %>",'<li><a class="visualization-link" href="<%- visualization.href %>"',' target="<%- visualization.target %>">',"<%- visualization.html %>","</a></li>","<% }); %>","</ul>","</div>","<% } %>"],"visualizations"),s.a.extend({},b.prototype.templates,{warnings:n,visualizations:a})),e.a={DatasetListItemEdit:w}},76:function(t,e,i){"use strict";var n=i(0),a=i.n(n).a;e.a=function(t,e,i,n,o,s,r,l,c){void 0===o&&(o=30),void 0===r&&(r=4),a("#".concat(t)).off().click(function(){if(!(a("#renaming-active").length>0)){var t,d=a("#".concat(e)),u=d.text();(t=s?a("<textarea></textarea>").attr({rows:r,cols:o}).text(a.trim(u)):a("<input type='text'></input>").attr({value:a.trim(u),size:o})).attr("id","renaming-active"),t.blur(function(){a(this).remove(),d.show(),c&&c(t)}),t.keyup(function(o){if(27===o.keyCode)a(this).trigger("blur");else if(13===o.keyCode){var s={};s[n]=a(this).val(),a(this).trigger("blur"),a.ajax({url:i,data:s,error:function(){alert("Text editing for elt ".concat(e," failed"))},success:function(e){""!==e?d.text(e):d.html("<em>None</em>"),c&&c(t)}})}}),l&&l(t),d.hide(),t.insertAfter(d),t.focus(),t.select()}})}},77:function(t,e,i){"use strict";var n=i(0),a=i.n(n),o=a.a;function s(t,e){var i=this;return e=a.a.extend({cover:!1},e||{}),i.show=function(n,a,s){var r,l;return n=n||"loading...",a=a||"fast",t.parent().find(".loading-indicator").remove(),i.$indicator=(r=['<div class="loading-indicator">','<div class="loading-indicator-text">','<span class="fa fa-spinner fa-spin fa-lg"></span>','<span class="loading-indicator-message">loading...</span>',"</div>","</div>"].join("\n"),l=o(r).hide().css(e.css||{position:"fixed"}),l.children(".loading-indicator-text"),e.cover?(l.css({"z-index":2,top:t.css("top"),bottom:t.css("bottom"),left:t.css("left"),right:t.css("right"),opacity:.5,"background-color":"white","text-align":"center"}),l.children(".loading-indicator-text").css({"margin-top":"20px"})):l.children(".loading-indicator-text").css({margin:"12px 0px 0px 10px",opacity:"0.85",color:"grey"}).children(".loading-indicator-message").css({margin:"0px 8px 0px 0px","font-style":"italic"}),l).insertBefore(t),i.message(n),i.$indicator.fadeIn(a,s),i},i.message=function(t){i.$indicator.find("i").text(t)},i.hide=function(t,e){return t=t||"fast",i.$indicator&&i.$indicator.length?i.$indicator.fadeOut(t,function(){i.$indicator.remove(),e&&e()}):e&&e(),i},i}e.a={LoadingIndicator:s,markViewAsLoading:function(t){t.setElement(o('<div><div class="loading"></div></div>')),new s(t.$(".loading")).show()}}},78:function(t,e,i){"use strict";var n=i(1),a=i.n(n),o=i(0),s=i.n(o),r=i(5),l=i(59),c=i(47),d=i(87),u=i(107),h=i(71),p=i(37),f=i(72),m=p.a.DCListItemView,g=m.extend({initialize:function(t){m.prototype.initialize.call(this,t)},toString:function(){var t=this.model?"".concat(this.model):"(no model)";return"DCListItemEdit(".concat(t,")")}}),_=p.a.DCEListItemView,v=_.extend({initialize:function(t){_.prototype.initialize.call(this,t)},toString:function(){var t=this.model?"".concat(this.model):"(no model)";return"DCEListItemEdit(".concat(t,")")}}),b=f.a.DatasetListItemEdit.extend({initialize:function(t){f.a.DatasetListItemEdit.prototype.initialize.call(this,t)},_fetchModelDetails:function(){return this.model.inReadyState()&&!this.model.hasDetails()?this.model.fetch({silent:!0}):s.a.when()},_renderDeleteButton:function(){return null},toString:function(){var t=this.model?"".concat(this.model):"(no model)";return"DatasetDCEListItemEdit(".concat(t,")")}});b.prototype.templates=a.a.extend({},f.a.DatasetListItemEdit.prototype.templates,{titleBar:p.a.DatasetDCEListItemView.prototype.templates.titleBar});var w,y,x={DCListItemEdit:g,DCEListItemEdit:v,DatasetDCEListItemEdit:b,NestedDCDCEListItemEdit:p.a.NestedDCDCEListItemView.extend({toString:function(){var t=this.model?"".concat(this.model):"(no model)";return"NestedDCDCEListItemEdit(".concat(t,")")}})},k=i(44),C=i(2),S=i.n(C),T=(i(62),h.a.CollectionView),$=T.extend({DatasetDCEViewClass:x.DatasetDCEListItemEdit,NestedDCDCEViewClass:x.NestedDCDCEListItemEdit,getNestedDCDCEViewClass:function(){return x.NestedDCDCEListItemEdit.extend({foldoutPanelClass:$})},initialize:function(t){T.prototype.initialize.call(this,t)},_setUpBehaviors:function(t){var e=this;if(t=t||this.$el,T.prototype._setUpBehaviors.call(this,t),this.model){var i=Object(r.a)();if(i.user&&!i.user.isAnonymous()){this.tagsEditorShown=!0;var n=this;t.find("> .controls .name").attr("title",S()("Click to rename collection")).tooltip({placement:"bottom"}).make_text_editable({on_finish:function(t){var e=n.model.get("name");t&&t!==e?(n.$el.find("> .controls .name").text(t),n.model.save({name:t}).fail(function(){n.$el.find("> .controls .name").text(n.model.previous("name"))})):n.$el.find("> .controls .name").text(e)}});var a=t.find(".tags-display")[0],o={model:this.model,disabled:!1,context:"collection-view-edit"},l=Object(k.b)(o,a);if(this.tagsEditorShown)s()(l.$el).hasClass("active")||(s()(l.$el).toggleClass("active"),e.tagsEditorShown=s()(l.$el).hasClass("active"))}}},toString:function(){return"CollectionViewEdit(".concat(this.model?this.model.get("name"):"",")")}}),O={CollectionViewEdit:$},A=u.a.HDCAListItemView,j={HDCAListItemEdit:A.extend({initialize:function(t){A.prototype.initialize.call(this,t),this.purgeAllowed=t.purgeAllowed||!1},_getFoldoutPanelClass:function(){return O.CollectionViewEdit},_renderPrimaryActions:function(){return this.log("".concat(this,"._renderPrimaryActions")),A.prototype._renderPrimaryActions.call(this).concat([this._renderDeleteButton()])},_renderDeleteButton:function(){return s()('\n                <div class="dropdown">\n                    <a class="delete-btn icon-btn" title="'.concat(S()("Delete"),'" data-toggle="dropdown">\n                        <span class="fa fa-times"></span>\n                    </a>\n                    <div class="dropdown-menu" role="menu">\n                            <a href="#" class="dropdown-item delete-collection">\n                                ').concat(S()("Collection Only"),'\n                            </a>\n                            <a href="#" class="dropdown-item delete-collection-and-datasets">\n                                ').concat(S()("Delete Datasets"),'\n                            </a>\n                            <a href="#" style="display: ').concat(this.purgeAllowed?"inherit":"none",'" class="dropdown-item delete-collection-and-purge-datasets">\n                                ').concat(S()("Permanently Delete Datasets"),"\n                            </a>\n                    </div>\n                </div>"))},events:a.a.extend(a.a.clone(A.prototype.events),{"click .delete-collection":function(t){this.model.delete()},"click .delete-collection-and-datasets":function(t){this.model.delete(!0)},"click .delete-collection-and-purge-datasets":function(t){this.model.delete(!0,!0)}}),toString:function(){var t=this.model?"".concat(this.model):"(no model)";return"HDCAListItemEdit(".concat(t,")")}})},D=i(108),I=i(28),M=i(103),R=i(110),E=i(23),P=i(7),V=s.a,L=l.a.HistoryView,z=L.extend({HDAViewClass:d.a.HDAListItemEdit,HDCAViewClass:j.HDCAListItemEdit,initialize:function(t){t=t||{},L.prototype.initialize.call(this,t),this.tagsEditor=null,this.dragItems=!0,this.annotationEditor=null,this.purgeAllowed=t.purgeAllowed||!1,this.annotationEditorShown=t.annotationEditorShown||!1,this.tagsEditorShown=t.tagsEditorShown||!1},_setUpListeners:function(){return L.prototype._setUpListeners.call(this),this.on({"droptarget:drop":function(t,e){this.dataDropped(e),this.dropTargetOff()},"view:attached view:removed":function(){this._renderCounts()},"search:loading-progress":this._renderSearchProgress,"search:searching":this._renderSearchFindings})},_setUpModelListeners:function(){return L.prototype._setUpModelListeners.call(this),this.listenTo(this.model,"change:size",this.updateHistoryDiskSize),this},_setUpCollectionListeners:function(){return L.prototype._setUpCollectionListeners.call(this),this.listenTo(this.collection,{"change:deleted":this._handleItemDeletedChange,"change:visible":this._handleItemVisibleChange,"change:purged":function(t){this.model.fetch()},"fetching-deleted":function(t){this.$("> .controls .deleted-count").html("<i>".concat(S()("loading..."),"</i>"))},"fetching-hidden":function(t){this.$("> .controls .hidden-count").html("<i>".concat(S()("loading..."),"</i>"))},"fetching-deleted-done fetching-hidden-done":this._renderCounts}),this},_buildNewRender:function(){var t=Object(r.a)(),e=L.prototype._buildNewRender.call(this);return this.model?(t&&t.user&&t.user.id&&t.user.id===this.model.get("user_id")&&(this._renderTags(e),this._renderAnnotation(e)),e):e},updateHistoryDiskSize:function(){this.$(".history-size").text(this.model.get("nice_size"))},renderItems:function(t){var e=L.prototype.renderItems.call(this,t);return this.searchFor?this._renderSearchFindings(t):this._renderCounts(t),e},_renderCounts:function(t){t=t instanceof s.a?t:this.$el;var e=this.templates.counts(this.model.toJSON(),this);return t.find("> .controls .subtitle").html(e)},_renderTags:function(t){var e=t.find(".controls .tags-display")[0],i={model:this.model,disabled:!1,context:"history-view-edit"},n=Object(k.b)(i,e);return Object(E.a)({title:S()("Edit history tags"),classes:"history-tag-btn",faIcon:"fa-tags",tooltipConfig:{placement:"top"}}).appendTo(t.find(".controls .actions")).on("click",function(){V(n.$el).toggleClass("active")}),n},_renderAnnotation:function(t){var e=this;this.annotationEditor=new D.a.AnnotationEditor({model:this.model,el:t.find(".controls .annotation-display"),onshowFirstTime:function(){this.render()},onshow:function(){e.toggleHDAAnnotationEditors(!0,e.fxSpeed)},onhide:function(){e.toggleHDAAnnotationEditors(!1,e.fxSpeed)},$activator:Object(E.a)({title:S()("Edit history annotation"),classes:"history-annotate-btn",faIcon:"fa-comment",tooltipConfig:{placement:"top"}}).appendTo(t.find(".controls .actions"))})},_setUpBehaviors:function(t){var e=Object(r.a)();if(t=t||this.$el,L.prototype._setUpBehaviors.call(this,t),this.model&&e.user&&!e.user.isAnonymous()&&e.user.id===this.model.get("user_id")){var i=this;t.find("> .controls .name").attr("title",S()("Click to rename history")).tooltip({placement:"bottom"}).make_text_editable({on_finish:function(t){var e=i.model.get("name");t&&t!==e?(i.$el.find("> .controls .name").text(t),i.model.save({name:t}).fail(function(){i.$el.find("> .controls .name").text(i.model.previous("name"))})):i.$el.find("> .controls .name").text(e)}})}},multiselectActions:function(){var t=this,e=Object(r.a)(),i=this,n=function(n,a){var o={},r=i.getSelectedModels().filter(function(t){return console.log(t.attributes[n]),t.attributes[n]!=a}).map(function(t){var e={history_content_type:t.attributes.history_content_type,id:t.attributes.id};return o[t.id]=t,e});if(0!=r.length){var l={};l.url="".concat(e.root,"api/histories/").concat(t.model.id,"/contents"),l.type="PUT";var c={items:r};c[n]=a,l.data=JSON.stringify(c),l.contentType="application/json";var d=s.a.ajax(l);return d.done(function(t,e,i){var n=!0,a=!1,s=void 0;try{for(var r,l=t[Symbol.iterator]();!(n=(r=l.next()).done);n=!0){var c=r.value,d=c.history_content_type+"-"+c.id;o[d].set(c)}}catch(t){a=!0,s=t}finally{try{n||null==l.return||l.return()}finally{if(a)throw s}}}),d.fail(function(t,e,i){console.error(i)}),d}},a=[{html:S()("Hide datasets"),func:function(){n("visible",!1)}},{html:S()("Unhide datasets"),func:function(){n("visible",!0)}},{html:S()("Delete datasets"),func:function(){n("deleted",!0)}},{html:S()("Undelete datasets"),func:function(){n("deleted",!1)}}];return i.purgeAllowed&&a.push({html:S()("Permanently delete datasets"),func:function(){if(window.confirm(S()("This will permanently remove the data in your datasets. Are you sure?"))){var t=c.a.HistoryDatasetAssociation.prototype.purge,e=i.getSelectedModels(),n=e.filter(function(t){return"dataset"==t.get("history_content_type")});e.ajaxQueue(t,{},n)}}}),a=a.concat(i._collectionActions())},_collectionActions:function(){var t=this;return[{html:S()("Build Dataset List"),func:function(){return t.buildCollection("list")}},{html:S()("Build Dataset Pair"),func:function(){return t.buildCollection("paired")}},{html:S()("Build List of Dataset Pairs"),func:function(){return t.buildCollection("list:paired")}},{html:S()("Build Collection from Rules"),func:function(){return t.buildCollection("rules")}}]},buildCollection:function(t,e,i){var n,a=this;e=e||a.getSelectedModels(),i=i||!1,"list"==t?n=I.a.createListCollection:"paired"==t?n=M.a.createPairCollection:"list:paired"==t?n=R.a.createListOfPairsCollection:t.startsWith("rules")?n=I.a.createCollectionViaRules:console.warn("Unknown collectionType encountered ".concat(t)),n(e,i).then(function(){a.model.refresh()})},_getItemViewOptions:function(t){var e=L.prototype._getItemViewOptions.call(this,t);return a.a.extend(e,{purgeAllowed:this.purgeAllowed,tagsEditorShown:this.tagsEditor&&!this.tagsEditor.hidden,annotationEditorShown:this.annotationEditor&&!this.annotationEditor.hidden}),e},_handleItemDeletedChange:function(t){t.get("deleted")?this._handleItemDeletion(t):this._handleItemUndeletion(t),this._renderCounts()},_handleItemDeletion:function(t){var e=this.model.get("contents_active");e.deleted+=1,e.active-=1,this.model.contents.includeDeleted||this.removeItemView(t),this.model.set("contents_active",e)},_handleItemUndeletion:function(t){var e=this.model.get("contents_active");e.deleted-=1,this.model.contents.includeDeleted||(e.active-=1),this.model.set("contents_active",e)},_handleItemVisibleChange:function(t){t.hidden()?this._handleItemHidden(t):this._handleItemUnhidden(t),this._renderCounts()},_handleItemHidden:function(t){var e=this.model.get("contents_active");e.hidden+=1,e.active-=1,this.model.contents.includeHidden||this.removeItemView(t),this.model.set("contents_active",e)},_handleItemUnhidden:function(t){var e=this.model.get("contents_active");e.hidden-=1,this.model.contents.includeHidden||(e.active-=1),this.model.set("contents_active",e)},toggleHDAAnnotationEditors:function(t,e){a.a.each(this.views,function(i){i.annotationEditor&&i.annotationEditor.toggle(t,e)})},events:a.a.extend(a.a.clone(L.prototype.events),{"click .show-selectors-btn":"toggleSelectors","click .toggle-deleted-link":function(t){this.toggleShowDeleted()},"click .toggle-hidden-link":function(t){this.toggleShowHidden()}}),_renderSearchProgress:function(t,e){var i=t+e;return this.$("> .controls .subtitle").html(["<i>",S()("Searching "),i,"/",this.model.contentsShown(),"</i>"].join(""))},_renderSearchFindings:function(t){t=t instanceof s.a?t:this.$el;var e=this.templates.found(this.model.toJSON(),this);return t.find("> .controls .subtitle").html(e),this},dropTargetOn:function(){if(this.dropTarget)return this;this.dropTarget=!0;var t={dragenter:a.a.bind(this.dragenter,this),dragover:a.a.bind(this.dragover,this),dragleave:a.a.bind(this.dragleave,this),drop:a.a.bind(this.drop,this)},e=this._renderDropTarget();for(var i in this.$list().before([this._renderDropTargetHelp(),e]),t)t.hasOwnProperty(i)&&e.get(0).addEventListener(i,t[i]);return this},_renderDropTarget:function(){return this.$(".history-drop-target").remove(),V("<div/>").addClass("history-drop-target")},_renderDropTargetHelp:function(){return this.$(".history-drop-target-help").remove(),V("<div/>").addClass("history-drop-target-help").text(S()("Drag datasets here to copy them to the current history"))},dropTargetOff:function(){if(!this.dropTarget)return this;this.dropTarget=!1;var t=this.$(".history-drop-target").get(0);for(var e in this._dropHandlers)this._dropHandlers.hasOwnProperty(e)&&t.off(e,this._dropHandlers[e]);return this.$(".history-drop-target").remove(),this.$(".history-drop-target-help").remove(),this},dropTargetToggle:function(){return this.dropTarget?this.dropTargetOff():this.dropTargetOn(),this},dragenter:function(t){t.preventDefault(),t.stopPropagation(),this.$(".history-drop-target").css("border","2px solid black")},dragover:function(t){t.preventDefault(),t.stopPropagation()},dragleave:function(t){t.preventDefault(),t.stopPropagation(),this.$(".history-drop-target").css("border","1px dashed black")},drop:function(t){t.preventDefault();var e=t.dataTransfer,i=e.getData("text");e.dropEffect="move";try{i=JSON.parse(i)}catch(t){this.warn("error parsing JSON from drop:",i)}return this.trigger("droptarget:drop",t,i,this),!1},dataDropped:function(t){var e=this;return a.a.isObject(t)&&"HistoryDatasetAssociation"===t.model_class&&t.id?0!==this.contents.currentPage?this.contents.fetchPage(0).then(function(){return e.model.contents.copy(t.id)}):this.model.contents.copy(t.id):s.a.when()},toString:function(){return"HistoryViewEdit(".concat(this.model?this.model.get("name"):"",")")}});z.prototype.templates=(w=P.a.wrapTemplate(["<% var shown = Math.max( view.views.length, history.contents_active.active ) %>","<% if( shown ){ %>",'<span class="shown-count">',"<%- shown %> ",S()("shown"),"</span>","<% } %>","<% if( history.contents_active.deleted ){ %>",'<span class="deleted-count">',"<% if( view.model.contents.includeDeleted ){ %>",'<a class="toggle-deleted-link" href="javascript:void(0);">',S()("hide deleted"),"</a>","<% } else { %>","<%- history.contents_active.deleted %> ",'<a class="toggle-deleted-link" href="javascript:void(0);">',S()("deleted"),"</a>","<% } %>","</span>","<% } %>","<% if( history.contents_active.hidden ){ %>",'<span class="hidden-count">',"<% if( view.model.contents.includeHidden ){ %>",'<a class="toggle-hidden-link" href="javascript:void(0);">',S()("hide hidden"),"</a>","<% } else { %>","<%- history.contents_active.hidden %> ",'<a class="toggle-hidden-link" href="javascript:void(0);">',S()("hidden"),"</a>","<% } %>","</span>","<% } %>"],"history"),y=P.a.wrapTemplate([S()("Found")," <%- view.views.length %>, ","<% if( history.contents_active.deleted ){ %>","<% if( view.model.contents.includeDeleted ){ %>",'<a class="toggle-deleted-link" href="javascript:void(0);">',S()("hide deleted"),"</a>, ","<% } else { %>",'<a class="toggle-deleted-link" href="javascript:void(0);">',S()("show deleted"),"</a>, ","<% } %>","<% } %>","<% if( history.contents_active.hidden ){ %>","<% if( view.model.contents.includeHidden ){ %>",'<a class="toggle-hidden-link" href="javascript:void(0);">',S()("hide hidden"),"</a>","<% } else { %>",'<a class="toggle-hidden-link" href="javascript:void(0);">',S()("show hidden"),"</a>","<% } %>","<% } %>"],"history"),a.a.extend(a.a.clone(L.prototype.templates),{counts:w,found:y}));e.a={HistoryViewEdit:z}},8:function(t,e,i){"use strict";i.d(e,"b",function(){return g});var n=i(1),a=i.n(n),o=i(0),s=i.n(o),r=i(4),l=i(5),c=i(2),d=i.n(c);function u(t){var e={contentType:"application/json",type:t.type||"GET",data:t.data||{},url:t.url};"GET"==e.type||"DELETE"==e.type?(s.a.isEmptyObject(e.data)||(e.url+=-1==e.url.indexOf("?")?"?":"&",e.url+=s.a.param(e.data,!0)),e.data=null):(e.dataType="json",e.data=JSON.stringify(e.data)),s.a.ajax(e).done(function(e){if("string"==typeof e)try{e=e.replace("Infinity,",'"Infinity",'),e=s.a.parseJSON(e)}catch(t){console.debug(t)}t.success&&t.success(e)}).fail(function(e){var i=null;try{i=s.a.parseJSON(e.responseText)}catch(t){i=e.responseText}t.error&&t.error(i,e.status)}).always(function(){t.complete&&t.complete()})}var h=1024,p=h*h,f=p*h,m=f*h;function g(t){var e,i,n=2166136261;for(e=0,i=t.length;e<i;e++)n^=t.charCodeAt(e),n+=(n<<1)+(n<<4)+(n<<7)+(n<<8)+(n<<24);return n>>>0}e.a={cssLoadFile:function(t){s()('link[href^="'.concat(t,'"]')).length||s()('<link href="'.concat(Object(r.getAppRoot)()).concat(t,'" rel="stylesheet">')).appendTo("head")},cssGetAttribute:function(t,e){var i=s()('<div class="'.concat(t,'"></div>'));i.appendTo(":eq(0)");var n=i.css(e);return i.remove(),n},get:function(t){top.__utils__get__=top.__utils__get__||{};var e=JSON.stringify(t);t.cache&&top.__utils__get__[e]?(t.success&&t.success(top.__utils__get__[e]),window.console.debug("utils.js::get() - Fetching from cache [".concat(t.url,"]."))):u({url:t.url,data:t.data,success:function(i){top.__utils__get__[e]=i,t.success&&t.success(i)},error:function(e,i){t.error&&t.error(e,i)}})},merge:function(t,e){return t?a.a.defaults(t,e):e},iframe:function(t){return'<iframe src="'.concat(t,'" frameborder="0" style="width: 100%; height: 100%;"/>')},bytesToString:function(t,e,i){i=void 0!==i?i:1;var n="";if(t>=m)t/=m,n="TB";else if(t>=f)t/=f,n="GB";else if(t>=p)t/=p,n="MB";else if(t>=h)t/=h,n="KB";else{if(!(t>0))return e?"0 b":"<strong>-</strong>";n="b"}var a="b"==n?t:function(t,e){for(var i=1,n=0;n<e;n++)i*=10;return Math.round(t*i)/i}(t,i);return e?"".concat(a," ").concat(n):"<strong>".concat(a,"</strong> ").concat(n)},uid:function(){return top.__utils__uid__=top.__utils__uid__||0,"uid-".concat(top.__utils__uid__++)},time:function(){var t=new Date,e=(t.getHours()<10?"0":"")+t.getHours(),i=(t.getMinutes()<10?"0":"")+t.getMinutes();return"".concat(t.getDate(),"/").concat(t.getMonth()+1,"/").concat(t.getFullYear(),", ").concat(e,":").concat(i)},request:u,sanitize:function(t){return s()("<div/>").text(t).html()},textify:function(t){if(s.a.isArray(t)){var e=(t=t.toString().replace(/,/g,", ")).lastIndexOf(", ");return-1!=e&&(t="".concat(t.substr(0,e)," or ").concat(t.substr(e+2))),t}return""},isEmpty:function(t){if(t instanceof Array||(t=[t]),0===t.length)return!0;for(var e in t)if(["__null__","__undefined__",null,void 0].indexOf(t[e])>-1)return!0;return!1},deepeach:function t(e,i){for(var n in e){var o=e[n];if(a.a.isObject(o)){var s=i(o);s&&(e[n]=s),t(o,i)}}},isJSON:function(t){return/^[\],:{}\s]*$/.test(t.replace(/\\["\\\/bfnrtu]/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))},clone:function(t){return JSON.parse(JSON.stringify(t)||null)},linkify:function(t){var e,i,n;return e=/(\b(https?|ftp):\/\/[-A-Z0-9+&@#\/%?=~_|!:,.;]*[-A-Z0-9+&@#\/%=~_|])/gim,i=/(^|[^\/])(www\.[\S]+(\b|$))/gim,n=/(([a-zA-Z0-9\-_.])+@[a-zA-Z_]+?(\.[a-zA-Z]{2,6})+)/gim,t.replace(e,'<a href="$1" target="_blank">$1</a>').replace(i,'$1<a href="http://$2" target="_blank">$2</a>').replace(n,'<a href="mailto:$1">$1</a>')},appendScriptStyle:function(t){t.script&&""!==t.script&&s()("<script/>",{type:"text/javascript"}).text(t.script).appendTo("head"),t.styles&&""!==t.styles&&s()("<style/>",{type:"text/css"}).text(t.styles).appendTo("head")},getQueryString:function(t){return decodeURIComponent(window.location.search.replace(new RegExp("^(?:.*[&\\?]".concat(encodeURIComponent(t).replace(/[.+*]/g,"\\$&"),"(?:\\=([^&]*))?)?.*$"),"i"),"$1"))},setWindowTitle:function(t){var e=Object(l.a)();window.document.title=t?"Galaxy ".concat(e.config.brand?" | ".concat(e.config.brand):""," | ").concat(d()(t)):"Galaxy ".concat(e.config.brand?" | ".concat(e.config.brand):"")}}},80:function(t,e,i){"use strict";var n=i(0),a=i.n(n),o=i(1),s=i.n(o),r=i(3),l=i.n(r),c=i(8),d=i(68),u=i(27),h=l.a.View.extend({initialize:function(t){var e=this;this.data=[],this.data2=[],this.model=t&&t.model||new l.a.Model({id:c.a.uid(),cls:"ui-select",error_text:"No options available",empty_text:"Nothing selected",visible:!0,wait:!1,multiple:!1,searchable:!0,optional:!1,disabled:!1,readonly:!1,onchange:function(){},value:null,individual:!1,pagesize:20}).set(t),this.on("change",function(){e.model.get("onchange")&&e.model.get("onchange")(e.value())}),this.listenTo(this.model,"change:data",this._changeData,this),this.listenTo(this.model,"change:disabled",this._changeDisabled,this),this.listenTo(this.model,"change:wait",this._changeWait,this),this.listenTo(this.model,"change:visible",this._changeVisible,this),this.listenTo(this.model,"change:value",this._changeValue,this),this.listenTo(this.model,"change:multiple change:searchable change:cls change:id",this.render,this),this.render()},render:function(){var t=this;this.model.get("searchable")?this._renderSearchable():this._renderClassic(),this.$el.addClass(this.model.get("cls")).attr("id",this.model.get("id")),this.$select.empty().addClass("select").attr("id","".concat(this.model.get("id"),"_select")).prop("multiple",this.model.get("multiple")).on("change",function(){t.value(t._getValue()),t.trigger("change")}),this._changeData(),this._changeWait(),this._changeVisible(),this._changeDisabled()},_renderClassic:function(){var t=this;this.$el.addClass(this.model.get("multiple")?"ui-select-multiple":"ui-select").append(this.$select=a()("<select/>")).append(this.$dropdown=a()("<div/>")).append(this.$resize=a()("<div/>").append(this.$resize_icon=a()("<i/>"))),this.model.get("multiple")?(this.$dropdown.hide(),this.$resize_icon.addClass("fa fa-angle-double-right fa-rotate-45").show(),this.$resize.removeClass().addClass("icon-resize").show().off("mousedown").on("mousedown",function(e){var i=e.pageY,n=t.$select.height();t.minHeight=t.minHeight||n,a()("#dd-helper").show().on("mousemove",function(e){t.$select.height(Math.max(n+(e.pageY-i),t.minHeight))}).on("mouseup mouseleave",function(){a()("#dd-helper").hide().off()})})):(this.$dropdown.show(),this.$resize.hide(),this.$resize_icon.hide())},_renderSearchable:function(){var t=this;this.$el.append(this.$select=a()("<div/>")).append(this.$dropdown=a()("<div/>")),this.$dropdown.hide(),this.model.get("multiple")||this.$dropdown.show().on("click",function(){t.$select.select2&&t.$select.select2("open")}),this.all_button=null,!this.model.get("multiple")||this.model.get("individual")||this.model.get("readonly")||(this.all_button=new u.a.ButtonCheck({onclick:function(){var e=[];0!==t.all_button.value()&&s.a.each(t.model.get("data"),function(t){e.push(t.value)}),t.value(e),t.trigger("change")}}),this.$el.prepend(this.all_button.$el))},_match:function(t,e){return!t||""===t||String(e).toUpperCase().indexOf(t.toUpperCase())>=0},_changeData:function(){var t=this;this.data=[],!this.model.get("multiple")&&this.model.get("optional")&&this.data.push({value:"__null__",label:this.model.get("empty_text")}),s.a.each(this.model.get("data"),function(e){t.data.push(e)}),0===this.length()&&this.data.push({value:"__null__",label:this.model.get("error_text")}),this.model.get("searchable")?(this.data2=[],this.data2index={},s.a.each(this.data,function(e,i){var n={order:i,id:e.value,text:e.label,tags:e.tags};t.data2.push(n),t.data2index[n.id]=n}),this.$select.data("select2")&&this.$select.select2("destroy"),this.matched_tags={},this.$select.select2({data:this.data2,closeOnSelect:!this.model.get("multiple"),multiple:this.model.get("multiple"),query:function(e){t.matched_tags={};var i=t.model.get("pagesize"),n=s.a.filter(t.data2,function(i){var n=!1;return s.a.each(i.tags,function(i){t._match(e.term,i)&&(n=t.matched_tags[i]=!0)}),n||t._match(e.term,i.text)});e.callback({results:n.slice((e.page-1)*i,e.page*i),more:n.length>=e.page*i})},formatResult:function(e){var i="",n=s.a.filter(e.tags,function(e){return t.matched_tags.hasOwnProperty(e)});return n.length>5&&(i='&nbsp;<div class="label label-warning">'.concat(n.length-5," more tags</div>")),"\n                    ".concat(s.a.escape(e.text),"\n                    <div>\n                        ").concat(s.a.reduce(n.slice(0,5),function(t,e){var i=Object(d.a)(e.slice(5));return"".concat(t,'&nbsp;<div style="background-color: ').concat(i.primary,"; color: ").concat(i.contrasting,"; border: 1px solid ").concat(i.darker,'" class="badge badge-primary badge-tags">').concat(s.a.escape(e),"</div>")},""),"\n                        ").concat(i,"\n                   </div>")}}),this.$(".select2-container .select2-search input").off("blur")):(this.$select.find("option").remove(),s.a.each(this.data,function(e){t.$select.append(a()("<option/>").attr("value",e.value).html(s.a.escape(e.label)))})),this.model.set("disabled",this.model.get("readonly")||0===this.length()),this._changeValue()},_changeDisabled:function(){this.model.get("searchable")?this.$select.select2(this.model.get("disabled")?"disable":"enable"):this.$select.prop("disabled",this.model.get("disabled"))},_changeWait:function(){this.$dropdown.removeClass().addClass("icon-dropdown fa").addClass(this.model.get("wait")?"fa-spinner fa-spin":"fa-caret-down")},_changeVisible:function(){this.$el[this.model.get("visible")?"show":"hide"](),this.$select[this.model.get("visible")?"show":"hide"]()},_changeValue:function(){if(this._setValue(this.model.get("value")),this.model.get("multiple")){if(this.all_button){var t=this._getValue();this.all_button.value(a.a.isArray(t)?t.length:0,this.length())}}else null!==this._getValue()||this.model.get("optional")||this._setValue(this.first())},value:function(t){return void 0!==t&&this.model.set("value",t),this._getValue()},first:function(){return this.data.length>0?this.data[0].value:null},exists:function(t){return s.a.findWhere(this.data,{value:t})},text:function(){var t=this._getValue(),e=this.exists(a.a.isArray(t)?t[0]:t);return e?e.label:""},show:function(){this.model.set("visible",!0)},hide:function(){this.model.set("visible",!1)},wait:function(){this.model.set("wait",!0)},unwait:function(){this.model.set("wait",!1)},disabled:function(){return this.model.get("disabled")},enable:function(){this.model.set("disabled",!1)},disable:function(){this.model.set("disabled",!0)},add:function(t,e){s.a.each(this.model.get("data"),function(e){e.keep&&!s.a.findWhere(t,{value:e.value})&&t.push(e)}),e&&t&&t.sort(e),this.model.set("data",t)},update:function(t){this.model.set("data",t.data)},setOnChange:function(t){this.model.set("onchange",t)},length:function(){return a.a.isArray(this.model.get("data"))?this.model.get("data").length:0},_setValue:function(t){var e=this;if(null==t&&(t="__null__"),this.model.get("multiple")?t=a.a.isArray(t)?t:[t]:a.a.isArray(t)&&(t=t.length>0?t[0]:"__null__"),this.model.get("searchable")){if(a.a.isArray(t)){var i=[];s.a.each(t,function(t){var n=e.data2index[t];n&&i.push(n)}),t=i}else t=this.data2index[t];this.$select.select2("data",t)}else this.$select.val(t)},_getValue:function(){var t=null;if(this.model.get("searchable")){var e=this.$select.select2("data");e&&(a.a.isArray(e)?(t=[],e.sort(function(t,e){return t.order-e.order}),s.a.each(e,function(e){t.push(e.id)})):t=e.id)}else t=this.$select.val();return c.a.isEmpty(t)?null:t}});e.a={View:h}},805:function(t,e,i){i(177),i(188),t.exports=i(876)},806:function(t,e,i){"use strict";var n=i(249);i.n(n).a},807:function(t,e,i){"use strict";var n=i(250);i.n(n).a},81:function(t,e,i){"use strict";var n=i(0),a=i.n(n),o=i(3),s=i.n(o),r=s.a.View.extend({initialize:function(t){this.collection=new s.a.Collection,this.model=t&&t.model||new s.a.Model({onchange:null,visible:!0}).set(t),this.setElement(a()(this._template())),this.$nav=this.$(".tab-navigation"),this.$content=this.$(".tab-content"),this.$el.on("click",function(){a()(".tooltip").hide()}),this.render(),this.listenTo(this.model,"change",this.render,this),this.listenTo(this.collection,"add",this._add,this),this.listenTo(this.collection,"remove",this._remove,this),this.listenTo(this.collection,"change",this._change,this),this.listenTo(this.collection,"reset",this._reset,this),this.listenTo(this.collection,"add remove reset",this.render,this)},render:function(){var t=this.model.get("current");(t=this.$("#".concat(t)).length>0?t:this.first())&&(this.$nav.find(".nav-link.active").removeClass("active"),this.$content.children().removeClass("active"),this.$("#tab-".concat(t," .nav-link")).addClass("active"),this.$("#".concat(t)).addClass("active")),this.$el[this.model.get("visible")?"fadeIn":"fadeOut"]("fast"),this.$nav[this.size()>1?"show":"hide"]()},current:function(){return this.model.get("current")},show:function(t){t&&(this.model.set({current:t,visible:!0}),this.model.get("onchange")&&this.model.get("onchange")(t))},hide:function(){this.model.set("visible",!1)},first:function(){var t=this.collection.first();return t&&t.id},size:function(){return this.collection.length},add:function(t){this.collection.add(t)},del:function(t){this.collection.remove(t)},delAll:function(){this.collection.reset()},showTab:function(t){this.collection.get(t).set("hidden",!1)},hideTab:function(t){this.collection.get(t).set("hidden",!0)},_add:function(t){var e=this,i=t.attributes;this.$content.append(a()("<div/>").attr("id",i.id).addClass("tab-pane").append(i.$el)),this.$nav.append(a()(this._template_tab(i)).show().tooltip({title:i.tooltip||"",placement:"bottom",container:e.$el}).on("click",function(t){t.preventDefault(),e.show(i.id)})),1==this.size()&&this.show(i.id)},_remove:function(t){this.$("#tab-".concat(t.id)).remove(),this.$("#".concat(t.id)).remove()},_reset:function(){this.$nav.empty(),this.$content.empty()},_change:function(t){this.$("#tab-".concat(t.id))[t.get("hidden")?"hide":"show"]()},_template:function(){return a()("<div/>").addClass("tabbable tabs-left").append(a()("<ul/>").attr("style","display: flex").addClass("tab-navigation nav nav-tabs")).append(a()("<div/>").addClass("tab-content"))},_template_tab:function(t){var e=a()("<li/>").addClass("nav-item").attr("id","tab-".concat(t.id)).append(a()("<a/>").addClass("nav-link").attr("id","tab-title-link-".concat(t.id)).attr("href","javascript:void(0);")),i=e.find("a");return t.icon&&i.append(a()("<i/>").addClass("fa").addClass(t.icon)),t.title&&i.append(a()("<span/>").attr("id","tab-title-text-".concat(t.id)).addClass("tab-title-text ml-1").append(t.title)),e}});e.a={View:r}},82:function(t,e,i){"use strict";var n=i(1),a=i.n(n),o=i(0),s=i.n(o),r=i(3),l=i.n(r),c=i(4),d=i(11),u=i(7),h=i(2),p=i.n(h),f=u.a.SearchableModelMixin,m=l.a.Model.extend(u.a.LoggableMixin).extend(u.a.mixin(f,{_logNamespace:"dataset",defaults:{state:d.a.NEW,deleted:!1,purged:!1,name:"(unnamed dataset)",accessible:!0,data_type:"",file_ext:"",file_size:0,meta_files:[],misc_blurb:"",misc_info:"",tags:[]},initialize:function(t,e){this.debug("".concat(this,"(Dataset).initialize"),t,e),//!! this state is not in trans.app.model.Dataset.states - set it here -
this.get("accessible")||this.set("state",d.a.NOT_VIEWABLE),this.urls=this._generateUrls(),this._setUpListeners()},_getDatasetId:function(){return this.get("id")},_generateUrls:function(){var t=this._getDatasetId();if(!t)return{};var e={purge:"datasets/".concat(t,"/purge_async"),display:"datasets/".concat(t,"/display/?preview=True"),edit:"datasets/edit?dataset_id=".concat(t),download:"datasets/".concat(t,"/display").concat(this._downloadQueryParameters()),report_error:"dataset/errors?id=".concat(t),rerun:"tool_runner/rerun?id=".concat(t),show_params:"datasets/".concat(t,"/show_params"),visualization:"visualization",meta_download:"dataset/get_metadata_file?hda_id=".concat(t,"&metadata_name=")};return a.a.each(e,function(t,i){e[i]=Object(c.getAppRoot)()+t}),this.urls=e,e},_downloadQueryParameters:function(){return"?to_ext=".concat(this.get("file_ext"))},_setUpListeners:function(){this.on("change:state",function(t,e){this.log("".concat(this," has changed state:"),t,e),this.inReadyState()&&this.trigger("state:ready",t,e,this.previous("state"))}),this.on("change:id change:file_ext",function(t){this._generateUrls()})},toJSON:function(){var t=l.a.Model.prototype.toJSON.call(this);return a.a.extend(t,{urls:this.urls})},isDeletedOrPurged:function(){return this.get("deleted")||this.get("purged")},inReadyState:function(){var t=a.a.contains(d.a.READY_STATES,this.get("state"));return this.isDeletedOrPurged()||t},hasDetails:function(){return!this.get("accessible")||this.has("annotation")},hasData:function(){return this.get("file_size")>0},fetch:function(t){var e=this;return l.a.Model.prototype.fetch.call(this,t).always(function(){e._generateUrls()})},parse:function(t,e){var i=l.a.Model.prototype.parse.call(this,t,e);return i.create_time&&(i.create_time=new Date(i.create_time)),i.update_time&&(i.update_time=new Date(i.update_time)),i},save:function(t,e){return(e=e||{}).wait=!!a.a.isUndefined(e.wait)||e.wait,l.a.Model.prototype.save.call(this,t,e)},delete:function(t){return this.get("deleted")?s.a.when():this.save({deleted:!0},t)},undelete:function(t){return!this.get("deleted")||this.get("purged")?s.a.when():this.save({deleted:!1},t)},purge:function(t){if(this.get("purged"))return s.a.when();(t=t||{}).url=this.urls.purge;var e=this,i=s.a.ajax(t);return i.done(function(t,i,n){e.set({deleted:!0,purged:!0})}),i.fail(function(i,n,a){var o=p()("Unable to purge dataset");i.responseJSON&&i.responseJSON.error?o=i.responseJSON.error:-1!==i.responseText.indexOf("Removal of datasets by users is not allowed in this Galaxy instance")&&(o="Removal of datasets by users is not allowed in this Galaxy instance"),i.responseText=o,e.trigger("error",e,i,t,p()(o),{error:o})}),i},searchAttributes:["name","file_ext","genome_build","misc_blurb","misc_info","annotation","tags"],searchAliases:{title:"name",format:"file_ext",database:"genome_build",blurb:"misc_blurb",description:"misc_blurb",info:"misc_info",tag:"tags"},toString:function(){var t=this.get("id")||"";return this.get("name")&&(t='"'.concat(this.get("name"),'",').concat(t)),"Dataset(".concat(t,")")}})),g=l.a.Collection.extend(u.a.LoggableMixin).extend({_logNamespace:"dataset",model:m,urlRoot:"".concat(Object(c.getAppRoot)(),"api/datasets"),url:function(){return this.urlRoot},ids:function(){return this.map(function(t){return t.get("id")})},notReady:function(){return this.filter(function(t){return!t.inReadyState()})},haveDetails:function(){return this.all(function(t){return t.hasDetails()})},ajaxQueue:function(t,e){var i=s.a.Deferred(),n=this.length,a=[];if(!n)return i.resolve([]),i;var o=this.chain().reverse().map(function(s,r){return function(){var l=t.call(s,e);l.done(function(t){i.notify({curr:r,total:n,response:t,model:s})}),l.always(function(t){a.push(t),o.length?o.shift()():i.resolve(a)})}}).value();return o.shift()(),i},matches:function(t){return this.filter(function(e){return e.matches(t)})},toString:function(){return["DatasetAssociationCollection(",this.length,")"].join("")}});e.a={DatasetAssociation:m,DatasetAssociationCollection:g}},83:function(t,e,i){"use strict";i.d(e,"a",function(){return r});var n=i(12),a=i(84),o=i(2),s=i.n(o);n.a.filter("localize",function(t){return s()(t)});var r=function(t){return function(e,i){return new(n.a.extend(t))({store:a.a,propsData:e,el:i})}}},84:function(t,e,i){"use strict";var n=i(12),a=i(60),o={state:{searchTags:new Set},mutations:{setSearchTags:function(t,e){t.searchTags=new Set(e)}},actions:{toggleSearchTag:function(t,e){var i=t.state,n=t.commit,a=e.text,o=new Set(i.searchTags);o.has(a)?o.delete(a):o.add(a),n("setSearchTags",o)},removeSearchTag:function(t,e){var i=t.state,n=t.commit,a=e.text,o=new Set(i.searchTags);o.delete(a),n("setSearchTags",o)},clearSearchTags:function(t){t.state;(0,t.commit)("setSearchTags",new Set)}}},s={getTagsById:function(t){return function(e){if(t.modelTagCache.has(e)){var i=t.modelTagCache.get(e);return Array.from(i)}return[]}}},r={setTags:function(t,e){var i=e.key,n=e.tags;t.modelTagCache=new Map(t.modelTagCache),t.modelTagCache.set(i,new Set(n))},reset:function(t){t.userTagList=[],t.modelTagCache=new Map}},l={state:{userTagList:[],modelTagCache:new Map},getters:s,actions:{updateTags:function(t,e){(0,t.commit)("setTags",{key:e.key,tags:e.tags})},initializeTags:function(t,e){var i=t.dispatch,n=t.state,a=e.key,o=e.tags;n.modelTagCache.has(a)||i("updateTags",{key:a,tags:o})}},mutations:r};n.a.use(a.a);e.a=new a.a.Store({modules:{gridSearch:o,tags:l}})},87:function(t,e,i){"use strict";var n,a=i(0),o=i.n(a),s=i(1),r=i.n(s),l=i(72),c=i(106),d=i(7),u=i(2),h=i.n(u),p=l.a.DatasetListItemEdit,f=p.extend({className:"".concat(p.prototype.className," history-content"),_fetchModelDetails:function(){return this.model.inReadyState()&&!this.model.hasDetails()?this.model.fetch({silent:!0}):this.model.has("rerunnable")?o.a.when():this.model.fetch({silent:!0,data:{keys:["rerunnable","creating_job"].join(",")}})},events:r.a.extend(r.a.clone(p.prototype.events),{"click .unhide-link":function(t){return this.model.unhide(),!1}}),toString:function(){var t=this.model?"".concat(this.model):"(no model)";return"HDAListItemEdit(".concat(t,")")}});f.prototype.templates=(n=r.a.extend({},p.prototype.templates.warnings,{hidden:d.a.wrapTemplate(["<% if( !dataset.visible ){ %>",'<div class="hidden-msg warningmessagesmall">',h()("This dataset has been hidden"),'<br /><a class="unhide-link" a href="javascript:void(0);">',h()("Unhide it"),"</a>","</div>","<% } %>"],"dataset")}),r.a.extend({},p.prototype.templates,{titleBar:c.a.HDAListItemView.prototype.templates.titleBar,warnings:n})),e.a={HDAListItemEdit:f}},876:function(t,e,i){"use strict";i.r(e);var n=i(45),a=i(1),o=i.n(a),s=i(5),r=i(314),l=i.n(r),c=i(220),d=i(0),u=i.n(d),h=i(3),p=i.n(h),f=i(4),m=i(2),g=i.n(m),_=i(8),v=i(10),b=i(19),w=i(121),y=i(48),x=i(9),k={ToolRecommendationView:p.a.View.extend({el:"#tool-recommendation-view",initialize:function(t){var e=t.toolId||"",i=this;if(e.indexOf("/")>0){var n=e.split("/");e=n[n.length-2]}_.a.request({type:"POST",url:"".concat(Object(f.getAppRoot)(),"api/workflows/get_tool_predictions"),data:{tool_sequence:e},success:function(t){null!==t&&t.predicted_data.children.length>0&&(i.$el.append("<div class='infomessagelarge'>You have used "+t.predicted_data.name+" tool. For further analysis, you could try using the following tools.</div>"),i.render_tree(t.predicted_data))}})},render_tree:function(t){var e,i=20,n=30,a=20,o=200,s=900-n-o,r=300-i-a,l=0,c=750,d=x.layout.tree().size([r,s]),u=x.svg.diagonal().projection(function(t){return[t.y,t.x]}),h=x.select("#tool-recommendation-view").append("svg").attr("width",s+n+o).attr("height",r+i+a).append("g").attr("transform","translate("+o+","+i+")");function p(t){var i=d.nodes(e).reverse(),n=d.links(i);i.forEach(function(t){t.y=180*t.depth});var a=h.selectAll("g.node").data(i,function(t){return t.id||(t.id=++l)}),o=a.enter().append("g").attr("class","node").attr("transform",function(e){return"translate("+t.y0+","+t.x0+")"}).on("click",f);o.append("circle").attr("r",1e-6).style("fill",function(t){return t._children?"lightsteelblue":"#fff"}),o.append("text").attr("x",function(t){return t.children||t._children?-10:10}).attr("dy",".35em").attr("text-anchor",function(t){return t.children||t._children?"end":"start"}).text(function(t){return t.name}).style("fill-opacity",1e-6);var s=a.transition().duration(c).attr("transform",function(t){return"translate("+t.y+","+t.x+")"});s.select("circle").attr("r",4.5).style("fill",function(t){return t._children?"lightsteelblue":"#fff"}),s.select("text").style("fill-opacity",1);var r=a.exit().transition().duration(c).attr("transform",function(e){return"translate("+t.y+","+t.x+")"}).remove();r.select("circle").attr("r",1e-6),r.select("text").style("fill-opacity",1e-6);var p=h.selectAll("path.link").data(n,function(t){return t.target.id});p.enter().insert("path","g").attr("class","link").attr("d",function(e){var i={x:t.x0,y:t.y0};return u({source:i,target:i})}),p.transition().duration(c).attr("d",u),p.exit().transition().duration(c).attr("d",function(e){var i={x:t.x,y:t.y};return u({source:i,target:i})}).remove(),i.forEach(function(t){t.x0=t.x,t.y0=t.y})}function f(t){t.children?(t._children=t.children,t.children=null):(t.children=t._children,t._children=null),p(t)}x.select(self.frameElement).style("height","400px"),(e=t).x0=r/2,e.y0=0,e.children.forEach(function t(e){e.children&&(e._children=e.children,e._children.forEach(t),e.children=null)}),p(e)}})},C={View:p.a.View.extend({initialize:function(t){var e=Object(s.a)(),i=this;this.modal=e.modal||new b.a.View,this.form=new w.a(_.a.merge({listen_to_history:!0,always_refresh:!1,buildmodel:function(t,n){var a=n.model.attributes,o="",s={},r=a.job_id;r?o="".concat(Object(f.getAppRoot)(),"api/jobs/").concat(r,"/build_for_rerun"):(o="".concat(Object(f.getAppRoot)(),"api/tools/").concat(a.id,"/build"),(s=u.a.extend({},e.params)).tool_id&&delete s.tool_id),a.version&&(s.tool_version=a.version),_.a.get({url:o,data:s,success:function(a){a.display?(n.model.set(a),i._customize(n),e.emit.debug("tool-form-base::_buildModel()","Initial tool model ready.",a),t.resolve()):window.location=Object(f.getAppRoot)()},error:function(i,o){var s=i&&i.err_msg||"Uncaught error.";401==o?window.location="".concat(Object(f.getAppRoot)(),"user/login?").concat(u.a.param({redirect:"".concat(Object(f.getAppRoot)(),"?tool_id=").concat(a.id)})):n.$el.is(":empty")?n.$el.prepend(new v.a.Message({message:s,status:"danger",persistent:!0}).$el):e.modal&&e.modal.show({title:g()("Tool request failed"),body:s,buttons:{Close:function(){e.modal.hide()}}}),e.emit.debug("tool-form-base::_buildModel()","Initial tool model request failed.",i),t.reject()}})},postchange:function(t,i){var n={tool_id:i.model.get("id"),tool_version:i.model.get("version"),inputs:u.a.extend(!0,{},i.data.create())};i.wait(!0),e.emit.debug("tool-form::postchange()","Sending current state.",n),_.a.request({type:"POST",url:"".concat(Object(f.getAppRoot)(),"api/tools/").concat(i.model.get("id"),"/build"),data:n,success:function(n){i.update(n),i.wait(!1),e.emit.debug("tool-form::postchange()","Received new model.",n),t.resolve()},error:function(i){e.emit.debug("tool-form::postchange()","Refresh request failed.",i),t.reject()}})}},t)),this.deferred=this.form.deferred,this.setElement("<div/>"),this.$el.append(this.form.$el)},_customize:function(t){var e,i,n=this,a=t.model.attributes,o=new v.a.Button({icon:"fa-check",tooltip:"Execute: ".concat(a.name," (").concat(a.version,")"),title:g()("Execute"),cls:"btn btn-primary",wait_cls:"btn btn-info",onclick:function(){o.wait(),t.portlet.disable(),n.submit(a,function(){o.unwait(),t.portlet.enable()})}});(a.buttons={execute:o},a.job_id&&a.job_remap)&&("job_produced_collection_elements"===a.job_remap?(e="Replace elements in collection ?",i="The previous run of this tool failed. Use this option to replace the failed element(s) in the dataset collection that were produced during the previous tool run."):(e="Resume dependencies from this job ?",i="The previous run of this tool failed and other tools were waiting for it to finish successfully. Use this option to resume those tools using the new output(s) of this tool run."),a.inputs.push({label:e,name:"rerun_remap_job_id",type:"select",display:"radio",ignore:"__ignore__",value:"__ignore__",options:[["Yes",a.job_id],["No","__ignore__"]],help:i}));var r=Object(s.a)(),l={};r.user.attributes.preferences&&"extra_user_preferences"in r.user.attributes.preferences&&(l=JSON.parse(r.user.attributes.preferences.extra_user_preferences)),"true"===("use_cached_job|use_cached_job_checkbox"in l&&l["use_cached_job|use_cached_job_checkbox"])&&a.inputs.push({label:"BETA: Attempt to re-use jobs with identical parameters ?",help:"This may skip executing jobs that you have already run",name:"use_cached_job",type:"select",display:"radio",ignore:"__ignore__",value:"__ignore__",options:[["No",!1],["Yes",!0]]})},submit:function(t,e){var i=Object(s.a)(),n=i.currHistoryPanel&&i.currHistoryPanel.model.id,a=this,r={history_id:n,tool_id:t.id,tool_version:t.version,inputs:this.form.data.create()};if(this.form.trigger("reset"),!a.validate(r))return i.emit.debug("tool-form::submit()","Submission canceled. Validation failed."),void(e&&e());if(t.action!=="".concat(Object(f.getAppRoot)(),"tool_runner/index")){var l=u()("<form/>").attr({action:t.action,method:t.method,enctype:t.enctype});return o.a.each(r.inputs,function(t,e){l.append(u()("<input/>").attr({name:e,value:t}))}),l.hide().appendTo("body").submit().remove(),void(e&&e())}i.emit.debug("tool-form::submit()","Validation complete.",r),_.a.request({type:"POST",url:"".concat(Object(f.getAppRoot)(),"api/tools"),data:r,success:function(t){e&&e(),a.$el.children().hide(),a.$el.append(a._templateSuccess(t,r));var n=window.Galaxy.config.enable_tool_recommendation;if(!0===n||"true"===n){a.$el.append(u()("<div/>",{id:"tool-recommendation-view"}));new k.ToolRecommendationView({toolId:r.tool_id})}t.jobs&&t.jobs.length>0&&(a.$el.append(u()("<div/>",{id:"webhook-view"})),new y.a.WebhookView({type:"tool",toolId:r.tool_id})),i.currHistoryPanel&&(a.form.stopListening(i.currHistoryPanel.collection),i.currHistoryPanel.refreshContents())},error:function(t){e&&e(),i.emit.debug("tool-form::submit","Submission failed.",t);var n=!1;if(t&&t.err_data){var o=a.form.data.matchResponse(t.err_data);for(var s in o){a.form.highlight(s,o[s]),n=!0;break}}n||a.modal.show({title:g()("Job submission failed"),body:a._templateError(r,t&&t.err_msg),buttons:{Close:function(){a.modal.hide()}}})}})},validate:function(t){var e=Object(s.a)(),i=t.inputs,n=-1,a=null;for(var o in i){var r=i[o],l=this.form.data.match(o),c=this.form.field_list[l],d=this.form.input_list[l];if(l&&d&&c){if(!d.optional&&null==r)return this.form.highlight(l),!1;if(c.validate){var u=c.validate();if(u)return this.form.highlight(l,u),!1}if(r&&r.batch){var h=r.values.length,p=h>0&&r.values[0]&&r.values[0].src;if(p)if(null===a)a=p;else if(a!==p)return this.form.highlight(l,"Please select either dataset or dataset list fields for all batch mode fields."),!1;if(-1===n)n=h;else if(n!==h)return this.form.highlight(l,"Please make sure that you select the same number of inputs for all batch mode fields. This field contains <b>".concat(h,"</b> selection(s) while a previous field contains <b>").concat(n,"</b>.")),!1}}else e.emit.debug("tool-form::validate()","Retrieving input objects failed.")}return!0},_getInputs:function(t){var e=[],i={};for(var n in t.inputs){var a=t.inputs[n];if(a&&u.a.isArray(a.values)){var o=!0,s=!1,r=void 0;try{for(var l,c=a.values[Symbol.iterator]();!(o=(l=c.next()).done);o=!0){var d=l.value;d.src&&!i[d.id]&&(e.push(d),i[d.id]=!0)}}catch(t){s=!0,r=t}finally{try{o||null==c.return||c.return()}finally{if(s)throw r}}}}return e},_templateRow:function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3,n="";if(t.sort(function(t,e){return e.hid-t.hid}),t.length>0){n+="<p>".concat(e,":</p>");var a=!0,s=!1,r=void 0;try{for(var l,c=t[Symbol.iterator]();!(a=(l=c.next()).done);a=!0){var d=l.value,u=i>0?"".concat(d.hid,": ").concat(o.a.escape(d.name)):"...";if(n+='<p class="messagerow">\n                            <b>'.concat(u,"</b>\n                          </p>"),i--<=0)break}}catch(t){s=!0,r=t}finally{try{a||null==c.return||c.return()}finally{if(s)throw r}}}return n},_templateSuccess:function(t,e){var i=t&&t.jobs?t.jobs.length:0;if(i>0){var n=this._getInputs(e),a=n.length,o=t.outputs.length,s=i>1?"".concat(i," jobs"):"1 job",r=a>1?"".concat(a," inputs"):"this input",l=o>1?"".concat(o," outputs"):"this output",c=this.form.model.get("name");return'<div class="donemessagelarge">\n                        <p>\n                            Executed <b>'.concat(c,"</b> and successfully added ").concat(s," to the queue.\n                        </p>\n                        ").concat(this._templateRow(n,"The tool uses ".concat(r)),"\n                        ").concat(this._templateRow(t.outputs,"It produces ".concat(l)),"\n                        <p>\n                            You can check the status of queued jobs and view the resulting data by refreshing the History panel. When the job has been run the status will change from 'running' to 'finished' if completed successfully or 'error' if problems were encountered.\n                        </p>\n                    </div>")}return this._templateError(t,"Invalid success response. No jobs found.")},_templateError:function(t,e){return u()("<div/>").addClass("errormessagelarge").append(u()("<p/>").text("The server could not complete the request. Please contact the Galaxy Team if this error persists. ".concat(e||""))).append(u()("<pre/>").text(JSON.stringify(t,null,4)))}})},S=i(141),T=i(15),$=i.n(T),O=i(76),A=i(12),j=i(38),D=i.n(j);A.a.use(D.a);var I={props:{id:{type:String,required:!0},plural_name:{type:String,required:!0},model_class:{type:String,required:!0}},computed:{model_class_lc:function(){return this.model_class.toLowerCase()},plural_name_lc:function(){return this.plural_name.toLowerCase()},item_status:function(){return this.item.published?"accessible via link and published":"accessible via link"},item_url:function(){return"".concat(window.location.protocol,"//").concat(window.location.hostname,":").concat(window.location.port).concat(Object(f.getAppRoot)()).concat(this.item.username_and_slug)},item_url_parts:function(){var t=this.item_url,e=t.lastIndexOf("/");return[t.substring(0,e+1),t.substring(e+1)]},published_url:function(){return"".concat(Object(f.getAppRoot)()).concat(this.plural_name_lc,"/list_published")},share_url:function(){return"".concat(Object(f.getAppRoot)()).concat(this.model_class_lc,"/share/?id=").concat(this.id)},slug_url:function(){return"".concat(Object(f.getAppRoot)()).concat(this.model_class_lc,"/set_slug_async/?id=").concat(this.id)},has_possible_members:function(){return["history"].indexOf(this.model_class_lc)>-1},show_danger:function(){return null!==this.err_msg}},data:function(){return{ready:!1,has_username:Object(s.a)().user.get("username"),new_username:"",err_msg:null,pencil_url:"".concat(Object(f.getAppRoot)(),"static/images/fugue/pencil.png"),item:{title:"title",username_and_slug:"username_and_slug",importable:!1,published:!1,users_shared_with:[]},share_fields:["email",{key:"id",label:""}],make_members_public:!1}},created:function(){this.getModel()},updated:function(){this.createSlugHandler()},methods:{getModel:function(){var t=this;this.ready=!1,$.a.get("".concat(Object(f.getAppRoot)(),"api/").concat(this.plural_name_lc,"/").concat(this.id,"/sharing")).then(function(e){t.item=e.data,t.ready=!0}).catch(function(e){return t.err_msg=e.response.data.err_msg})},setUsername:function(){var t=this,e=Object(s.a)();$.a.put("".concat(Object(f.getAppRoot)(),"api/users/").concat(e.user.id,"/information/inputs"),{username:this.new_username||""}).then(function(e){t.err_msg=null,t.has_username=!0,t.getModel()}).catch(function(e){return t.err_msg=e.response.data.err_msg})},setSharing:function(t,e){var i=this,n={action:t,user_id:e};this.has_possible_members&&(n.make_members_public=this.make_members_public),$.a.post("".concat(Object(f.getAppRoot)(),"api/").concat(this.plural_name_lc,"/").concat(this.id,"/sharing"),n).then(function(t){Object.assign(i.item,t.data),t.data.skipped&&(i.err_msg="Some of the items within this object were not published due to an error.")}).catch(function(t){return i.err_msg=t.response.data.err_msg})},createSlugHandler:function(){Object(O.a)("edit-identifier","item-identifier",this.slug_url,"new_slug",null,!1,0,function(t){u()("#item-url").hide(),u()("#item-url-text").show(),t.keyup(function(){t.val(u()(this).val().replace(/\s+/g,"-").replace(/[^a-zA-Z0-9-]/g,"").toLowerCase())})},function(t){u()("#item-url-text").hide(),u()("#item-url").show();var e=u()("#item-url-text").text(),i=u()("#item-url");i.attr("href",e),i.text(e)})}}},M=i(13),R=Object(M.a)(I,function(){var t=this,e=t.$createElement,i=t._self._c||e;return t.ready?i("div",[i("h2",[t._v("Share or Publish "+t._s(t.model_class)+" `"+t._s(t.item.title)+"`")]),t._v(" "),i("b-alert",{attrs:{show:t.show_danger,variant:"danger",dismissible:""}},[t._v(" "+t._s(t.err_msg)+" ")]),t._v(" "),i("br"),t._v(" "),t.has_username?i("div",[i("br"),t._v(" "),i("h3",[t._v("Make "+t._s(t.model_class)+" Accessible via Link and Publish It")]),t._v(" "),t.item.importable?i("div",[t._v("\n            This "+t._s(t.model_class_lc)+" is currently "),i("strong",[t._v(t._s(t.item_status))]),t._v(".\n            "),i("div",[i("p",[t._v("Anyone can view and import this "+t._s(t.model_class_lc)+" by visiting the following URL:")]),t._v(" "),i("blockquote",[i("a",{attrs:{id:"item-url",href:t.item_url,target:"_top"}},[t._v(t._s(t.item_url))]),t._v(" "),i("span",{staticStyle:{display:"none"},attrs:{id:"item-url-text"}},[t._v("\n                        "+t._s(t.item_url_parts[0])),i("span",{attrs:{id:"item-identifier"}},[t._v(t._s(t.item_url_parts[1]))])]),t._v(" "),i("a",{attrs:{href:"javascript:void(0)",id:"edit-identifier"}},[i("img",{attrs:{src:t.pencil_url,alt:"Edit Share Url"}})])]),t._v(" "),t.item.published?i("div",[i("p",[t._v("\n                        This "+t._s(t.model_class_lc)+" is publicly listed and searchable in Galaxy's\n                        "),i("a",{attrs:{href:t.published_url,target:"_top"}},[t._v("Published "+t._s(t.plural_name))]),t._v(" section.\n                    ")]),t._v(" "),i("p",[t._v("You can:")])]):t._e()]),t._v(" "),t.item.published?i("div",[i("b-button",{attrs:{id:"disable_link_access_and_unpublish"},on:{click:function(e){return t.setSharing("disable_link_access_and_unpublish")}}},[t._v("Disable Access to "+t._s(t.model_class)+" via Link and Unpublish")]),t._v(" "),i("div",{staticClass:"toolParamHelp"},[t._v("\n                    Disables this "+t._s(t.model_class_lc)+"'s link so that it is not accessible and removes\n                    "+t._s(t.model_class_lc)+" from Galaxy's\n                    "),i("a",{attrs:{href:t.published_url,target:"_top"}},[t._v("Published "+t._s(t.plural_name))]),t._v(" section so that it is not\n                    publicly listed or searchable.\n                ")]),t._v(" "),i("br"),t._v(" "),i("b-button",{on:{click:function(e){return t.setSharing("unpublish")}}},[t._v("Unpublish "+t._s(t.model_class))]),t._v(" "),i("div",{staticClass:"toolParamHelp"},[t._v("\n                    Removes this "+t._s(t.model_class_lc)+" from Galaxy's\n                    "),i("a",{attrs:{href:t.published_url,target:"_top"}},[t._v("Published "+t._s(t.plural_name))]),t._v(" section so that it is not\n                    publicly listed or searchable.\n                ")])],1):i("div",[i("b-button",{on:{click:function(e){return t.setSharing("disable_link_access")}}},[t._v("Disable Access to "+t._s(t.model_class)+" Link")]),t._v(" "),i("div",{staticClass:"toolParamHelp"},[t._v("Disables "+t._s(t.model_class_lc)+"'s link so that it is not accessible.")]),t._v(" "),i("br"),t._v(" "),i("b-button",{attrs:{id:"make_accessible_and_publish"},on:{click:function(e){return t.setSharing("publish")}}},[t._v("Publish "+t._s(t.model_class))]),t._v(" "),i("div",{staticClass:"toolParamHelp"},[t._v("\n                    Publishes the "+t._s(t.model_class_lc)+" to Galaxy's\n                    "),i("a",{attrs:{href:t.published_url,target:"_top"}},[t._v("Published "+t._s(t.plural_name))]),t._v(" section, where it is\n                    publicly listed and searchable.\n                ")]),t._v(" "),i("br")],1)]):i("div",[i("p",[t._v("\n                This "+t._s(t.model_class_lc)+" is currently restricted so that only you and the users listed below can\n                access it. You can:\n            ")]),t._v(" "),i("b-button",{on:{click:function(e){return t.setSharing("make_accessible_via_link")}}},[t._v("Make "+t._s(t.model_class)+" Accessible via Link")]),t._v(" "),t.has_possible_members?i("p",{staticClass:"mt-2"},[t._v("\n                Also make all objects within the "+t._s(t.model_class)+" accessible.\n                "),i("input",{directives:[{name:"model",rawName:"v-model",value:t.make_members_public,expression:"make_members_public"}],attrs:{type:"checkbox",id:"chk_make_members_public"},domProps:{checked:Array.isArray(t.make_members_public)?t._i(t.make_members_public,null)>-1:t.make_members_public},on:{change:function(e){var i=t.make_members_public,n=e.target,a=!!n.checked;if(Array.isArray(i)){var o=t._i(i,null);n.checked?o<0&&(t.make_members_public=i.concat([null])):o>-1&&(t.make_members_public=i.slice(0,o).concat(i.slice(o+1)))}else t.make_members_public=a}}})]):t._e(),t._v(" "),i("div",{staticClass:"toolParamHelp"},[t._v("\n                Generates a web link that you can share with other people so that they can view and import the\n                "+t._s(t.model_class_lc)+".\n            ")]),t._v(" "),i("br"),t._v(" "),i("b-button",{attrs:{id:"make_accessible_and_publish"},on:{click:function(e){return t.setSharing("make_accessible_and_publish")}}},[t._v("Make "+t._s(t.model_class)+" Accessible and Publish")]),t._v(" "),t.has_possible_members?i("p",{staticClass:"mt-2"},[t._v("\n                Also make all objects within the "+t._s(t.model_class)+" accessible.\n                "),i("input",{directives:[{name:"model",rawName:"v-model",value:t.make_members_public,expression:"make_members_public"}],attrs:{type:"checkbox",id:"chk_make_members_public"},domProps:{checked:Array.isArray(t.make_members_public)?t._i(t.make_members_public,null)>-1:t.make_members_public},on:{change:function(e){var i=t.make_members_public,n=e.target,a=!!n.checked;if(Array.isArray(i)){var o=t._i(i,null);n.checked?o<0&&(t.make_members_public=i.concat([null])):o>-1&&(t.make_members_public=i.slice(0,o).concat(i.slice(o+1)))}else t.make_members_public=a}}})]):t._e(),t._v(" "),i("div",{staticClass:"toolParamHelp"},[t._v("\n                Makes the "+t._s(t.model_class_lc)+" accessible via link (see above) and publishes the\n                "+t._s(t.model_class_lc)+" to Galaxy's\n                "),i("a",{attrs:{href:t.published_url,target:"_top"}},[t._v("Published "+t._s(t.plural_name))]),t._v(" section, where it is publicly\n                listed and searchable.\n            ")])],1),t._v(" "),i("br"),i("br"),t._v(" "),i("h3",[t._v("Share "+t._s(t.model_class)+" with Individual Users")]),t._v(" "),i("div",[t.item.users_shared_with&&t.item.users_shared_with.length>0?i("div",[i("b-table",{attrs:{small:"","caption-top":"",fields:t.share_fields,items:t.item.users_shared_with},scopedSlots:t._u([{key:"id",fn:function(e){return[i("b-button",{staticClass:"unshare_user",attrs:{size:"sm"},on:{click:function(i){return i.stopPropagation(),t.setSharing("unshare_user",e.value)}}},[t._v("Remove")])]}}],null,!1,2795532641)},[i("template",{slot:"table-caption"},[t._v("\n                        The following users will see this "+t._s(t.model_class_lc)+" in their "+t._s(t.model_class_lc)+" list\n                        and will be able to view, import and run it.\n                    ")])],2)],1):i("div",[i("p",[t._v("You have not shared this "+t._s(t.model_class_lc)+" with any users.")])]),t._v(" "),i("b-button",{attrs:{href:t.share_url,id:"share_with_a_user"}},[i("span",[t._v("Share with a user")])])],1)]):i("div",[i("div",[t._v("\n            To make a "+t._s(t.model_class_lc)+" accessible via link or publish it, you must create a public username:\n        ")]),t._v(" "),i("form",{staticClass:"form-group",on:{submit:function(e){return e.preventDefault(),t.setUsername()}}},[i("label"),t._v(" "),i("input",{directives:[{name:"model",rawName:"v-model",value:t.new_username,expression:"new_username"}],staticClass:"form-control",attrs:{type:"text"},domProps:{value:t.new_username},on:{input:function(e){e.target.composing||(t.new_username=e.target.value)}}})]),t._v(" "),i("b-button",{attrs:{type:"submit",variant:"primary"},on:{click:function(e){return t.setUsername()}}},[t._v("Set Username")])],1)],1):t._e()},[],!1,null,null,null).exports,E=i(29),P=p.a.Model.extend({initialize:function(t){var e=Object(s.a)();(t=t||{}).user_id=t.user_id||e.user.id,this.set({user_id:t.user_id,information:{title:g()("Manage information"),description:"Edit your email, addresses and custom parameters or change your username.",url:"api/users/".concat(t.user_id,"/information/inputs"),icon:"fa-user",redirect:"user"},password:{title:g()("Change password"),description:g()("Allows you to change your login credentials."),icon:"fa-unlock-alt",url:"api/users/".concat(t.user_id,"/password/inputs"),submit_title:"Save password",redirect:"user"},communication:{title:g()("Change communication settings"),description:g()("Enable or disable the communication feature to chat with other users."),url:"api/users/".concat(t.user_id,"/communication/inputs"),icon:"fa-comments-o",redirect:"user"},permissions:{title:g()("Set dataset permissions for new histories"),description:"Grant others default access to newly created histories. Changes made here will only affect histories created after these settings have been stored.",url:"api/users/".concat(t.user_id,"/permissions/inputs"),icon:"fa-users",submit_title:"Save permissions",redirect:"user"},make_data_private:{title:g()("Make all data private"),description:g()("Click here to make all data private."),icon:"fa-lock",onclick:function(){confirm(g()("WARNING: This will make all datasets (excluding library datasets) for which you have 'management' permissions, in all of your histories private, and will set permissions such that all of your new data in these histories is created as private.  Any datasets within that are currently shared will need to be re-shared or published.  Are you sure you want to do this?"))&&u.a.post("".concat(e.root,"history/make_private"),{all_histories:!0},function(){e.modal.show({title:g()("Datasets are now private"),body:"All of your histories and datsets have been made private.  If you'd like to make all *future* histories private please use the <a href=\"".concat(e.root,'user/permissions">User Permissions</a> interface.'),buttons:{Close:function(){e.modal.hide()}}})})}},api_key:{title:g()("Manage API key"),description:g()("Access your current API key or create a new one."),url:"api/users/".concat(t.user_id,"/api_key/inputs"),icon:"fa-key",submit_title:"Create a new key",submit_icon:"fa-check"},toolbox_filters:{title:g()("Manage Toolbox filters"),description:g()("Customize your Toolbox by displaying or omitting sets of Tools."),url:"api/users/".concat(t.user_id,"/toolbox_filters/inputs"),icon:"fa-filter",submit_title:"Save filters",redirect:"user"},custom_builds:{title:g()("Manage custom builds"),description:g()("Add or remove custom builds using history datasets."),icon:"fa-cubes",onclick:function(){e.page.router.push("".concat(Object(f.getAppRoot)(),"custom_builds"))}},genomespace:{title:g()("Request GenomeSpace token"),description:g()("Requests token through OpenID."),icon:"fa-openid",onclick:function(){window.location.href="".concat(Object(f.getAppRoot)(),"openid/openid_auth?openid_provider=genomespace")}},logout:{title:g()("Sign out"),description:g()("Click here to sign out of all sessions."),icon:"fa-sign-out",onclick:function(){e.modal.show({title:g()("Sign out"),body:"Do you want to continue and sign out of all active sessions?",buttons:{Cancel:function(){e.modal.hide()},"Sign out":function(){window.location.href="".concat(Object(f.getAppRoot)(),"user/logout?session_csrf_token=").concat(e.session_csrf_token)}}})}}})}}),V={View:p.a.View.extend({title:g()("User Preferences"),active_tab:"user",initialize:function(){this.model=new P,this.setElement("<div/>"),this.render()},render:function(){var t=this,e=Object(s.a)(),i=e.config;u.a.getJSON("".concat(Object(f.getAppRoot)(),"api/users/").concat(e.user.id),function(n){t.$preferences=u()("<div/>").append(u()("<h2/>").append("User preferences")).append(u()("<p/>").append("You are logged in as <strong>".concat(o.a.escape(n.email),"</strong>."))).append(t.$table=u()("<table/>"));var a=E.a.get("message"),s=E.a.get("status");a&&s&&t.$preferences.prepend(new v.a.Message({message:a,status:s}).$el),i.use_remote_user||(t._addLink("information"),t._addLink("password")),i.enable_communication_server&&t._addLink("communication"),t._addLink("custom_builds"),t._addLink("permissions"),t._addLink("make_data_private"),t._addLink("api_key"),i.enable_openid&&t._addLink("genomespace"),i.has_user_tool_filters&&t._addLink("toolbox_filters"),e.session_csrf_token&&t._addLink("logout"),t.$preferences.append(t._templateFooter(n)),t.$el.empty().append(t.$preferences)})},_addLink:function(t){var e=this.model.get(t),i=u()(this._templateLink(e)),n=i.find("a");e.onclick?n.on("click",function(){e.onclick()}):n.attr("href","".concat(Object(f.getAppRoot)(),"user/").concat(t)),this.$table.append(i)},_templateLink:function(t){return'<tr>\n                    <td class="align-top">\n                        <i class="ml-3 mr-3 fa fa-lg '.concat(t.icon,'">\n                    </td>\n                    <td>\n                        <a href="javascript:void(0)"><b>').concat(t.title,'</b></a>\n                        <div class="form-text text-muted">').concat(t.description,"</div>\n                    </td>\n                </tr>")},_templateFooter:function(t){var e=Object(s.a)();return'<p class="mt-2">You are using <strong>'.concat(t.nice_total_disk_usage,"</strong> of disk space in this Galaxy instance. ").concat(e.config.enable_quotas?"Your disk quota is: <strong>".concat(t.quota,"</strong>. "):"",'Is your usage more than expected? See the <a href="https://galaxyproject.org/learn/managing-datasets/" target="_blank"><b>documentation</b></a> for tips on how to find all of the data in your account.</p>')}}),Model:P},L=i(24),z={View:p.a.View.extend({initialize:function(t){this.options=_.a.merge(t,{content:"No content available.",onchange:null,ondblclick:null,onconfirm:null,cls:"grid",selectable:!0}),this.setElement(this._template()),this.$thead=this.$("thead"),this.$tbody=this.$("tbody"),this.$tmessage=this.$("tmessage"),this.row=u()("<tr/>"),this.row_count=0},events:{click:"_onclick",dblclick:"_ondblclick"},addHeader:function(t){this.row.append(u()("<th/>").append(t))},appendHeader:function(){this.$thead.append(this.row),this.row=u()("<tr/>")},add:function(t,e,i){var n=u()("<td/>");e&&n.css("width",e),i&&n.css("text-align",i),this.row.append(n.append(t))},append:function(t,e){this._commit(t,e,!1)},prepend:function(t,e){this._commit(t,e,!0)},get:function(t){return this.$("#".concat(t))},del:function(t){var e=this.$tbody.find("#".concat(t));e.length>0&&(e.remove(),this.row_count--,this._refresh())},delAll:function(){this.$tbody.empty(),this.row_count=0,this._refresh()},value:function(t){if(this.options.selectable){this.before=this.$tbody.find(".current").attr("id"),void 0!==t&&(this.$tbody.find("tr").removeClass("current"),t&&this.$tbody.find("#".concat(t)).addClass("current"));var e=this.$tbody.find(".current").attr("id");return void 0===e?null:(e!=this.before&&this.options.onchange&&this.options.onchange(t),e)}},size:function(){return this.$tbody.find("tr").length},_commit:function(t,e,i){this.del(t),this.row.attr("id",t),i?this.$tbody.prepend(this.row):this.$tbody.append(this.row),e&&(this.row.hide(),this.row.fadeIn()),this.row=u()("<tr/>"),this.row_count++,this._refresh()},_onclick:function(t){var e=this.value(),i=u()(t.target).closest("tr").attr("id");""!=i&&i&&e!=i&&(this.options.onconfirm?this.options.onconfirm(i):this.value(i))},_ondblclick:function(t){var e=this.value();e&&this.options.ondblclick&&this.options.ondblclick(e)},_refresh:function(){0==this.row_count?this.$tmessage.show():this.$tmessage.hide()},_template:function(){return'<div><table class="'.concat(this.options.cls,'"><thead/><tbody/></table><tmessage>').concat(this.options.content,"</tmessage><div>")}})},N=p.a.Collection.extend({comparator:function(t,e){return(t=t.get("name"))>(e=e.get("name"))?1:t<e?-1:0}}),F={View:p.a.View.extend({initialize:function(t){var e=Object(s.a)(),i=this;this.active_tab="user";var n=e.currHistoryPanel&&e.currHistoryPanel.model.id;this.model=new p.a.Model,this.model.url="".concat(Object(f.getAppRoot)(),"api/histories/").concat(n,"/custom_builds_metadata"),this.collection=new N,this.collection.url="".concat(Object(f.getAppRoot)(),"api/users/").concat(e.user.id,"/custom_builds"),this.message=new v.a.Message({}),this.installed_builds=new v.a.Select.View({optional:!0,onchange:function(){i.installed_builds.value(null)},empty_text:"List of available builds:",error_text:"No system installed builds available."}),this.table=new z.View({cls:"grid",selectable:!1}),this.table.addHeader("Name"),this.table.addHeader("Key"),this.table.addHeader("Number of chroms/contigs"),this.table.addHeader(""),this.table.appendHeader(),this.setElement(u()("<div/>").append(u()("<h4/>").text("Current Custom Builds")).append(this.table.$el).append(this.$installed=u()("<div/>").append(u()("<h4/>").text("System Installed Builds").addClass("mt-1")).append(this.installed_builds.$el)).append(u()("<h4/>").text("Add a Custom Build").addClass("mt-4")).append(u()("<span/>").addClass("row").append(u()("<div/>").addClass("col").append(this.message.$el).append(this.$form=u()("<div/>").addClass("mt-1"))).append(this.$help=u()("<div/>").addClass("col m-2")))),this.listenTo(this.collection,"add remove reset",function(){i._renderTable()}),this.listenTo(this.model,"change",function(){i._renderForm()}),this.collection.fetch(),this.model.fetch()},render:function(){this._renderTable(),this._renderForm()},_renderTable:function(){var t=this;this.table.delAll(),this.collection.sort(),this.collection.each(function(e){t.table.add(e.get("name")),t.table.add(e.id),t.table.add(void 0!==e.get("count")?e.get("count"):"Processing..."),t.table.add(new v.a.Button({icon:"fa-trash-o",cls:"ui-button-icon-plain",tooltip:g()("Delete custom build."),onclick:function(){e.destroy()}}).$el),t.table.append(e.id)})},_renderForm:function(){var t=this,e=new L.a({inputs:[{type:"text",name:"name",label:"Name",help:"Specify a build name e.g. Hamster."},{type:"text",name:"id",label:"Key",help:"Specify a build key e.g. hamster_v1."},{name:"len",type:"conditional",test_param:{name:"type",label:"Definition",help:g()("Provide the data source."),type:"select",value:"fasta",data:[{value:"fasta",label:"FASTA-file from history"},{value:"file",label:"Len-file from disk"},{value:"text",label:"Len-file by copy/paste"}]},cases:[{value:"fasta",inputs:[{type:"select",name:"value",label:"FASTA-file",data:this.model.get("fasta_hdas")}]},{value:"file",inputs:[{type:"upload",name:"value",label:"Len-file",data:this.model.get("len_hdas")}]},{value:"text",inputs:[{type:"text",area:!0,name:"value",label:"Edit/Paste"}]}]}],buttons:{save:new v.a.Button({icon:"fa-save",tooltip:g()("Create new Build"),title:g()("Save"),cls:"btn btn-primary",onclick:function(){var i=e.data.create();i.id&&i.name?t.collection.create(i,{wait:!0,success:function(e){e.get("message")?t.message.update({message:e.get("message"),status:"warning"}):t.message.update({message:"Successfully added a new custom build.",status:"success"})},error:function(e,i){var n=i&&i.responseJSON&&i.responseJSON.err_msg;t.message.update({message:n||"Failed to create custom build.",status:"danger"})}}):t.message.update({message:"All inputs are required.",status:"danger"})}})},onchange:function(){var i=e.data.match("len|type");if(i){var n=e.field_list[i];t._renderHelp(n.value())}}});this.$form.empty().append(e.$el);var i=this.model.get("installed_builds");i&&i.length?(this.$installed.show(),this.installed_builds.update(this.model.get("installed_builds"))):this.$installed.hide(),this._renderHelp("fasta")},_renderHelp:function(t){this.$help.empty().addClass("alert alert-info").html("fasta"==t?this._templateFasta():this._templateLen())},_templateLen:function(){return"<h4>Length Format</h4><p>The length format is two-column, separated by whitespace, of the form:<pre>chrom/contig   length of chrom/contig</pre></p><p>For example, the first few entries of <em>mm9.len</em> are as follows:<pre>chr1    197195432\nchr2    181748087\nchr3    159599783\nchr4    155630120\nchr5    152537259</pre></p><p>Trackster uses this information to populate the select box for chrom/contig, andto set the maximum basepair of the track browser. You may either upload a .len fileof this format (Len File option), or directly enter the information into the box (Len Entry option).</p>"},_templateFasta:function(){return"<h4>FASTA format</h4><p>This is a multi-fasta file from your current history that provides the genomesequences for each chromosome/contig in your build.</p><p>Here is a snippet from an example multi-fasta file:<pre>>chr1\nATTATATATAAGACCACAGAGAGAATATTTTGCCCGG...\n\n>chr2\nGGCGGCCGCGGCGATATAGAACTACTCATTATATATA...\n\n...</pre></p>"}})},H=i(111),U=i(33),B=i(77),q={View:p.a.View.extend({initialize:function(t){var e=this,i=Object(s.a)();B.a.markViewAsLoading(this),this.model=new p.a.Model(t),this.item=this.model.get("item"),this.title=this.model.get("plural"),t&&t.active_tab&&(this.active_tab=t.active_tab),u.a.ajax({url:"".concat(Object(f.getAppRoot)()+this.item,"/").concat(this.model.get("action_id"),"?").concat(u.a.param(i.params)),success:function(t){e.model.set(t),e.render()}})},render:function(){var t=new U.a(this.model.attributes);this.$el.empty().append(t.$el),this.$el.append(this._templateShared())},_templateShared:function(){var t=this,e=u()("<div><br/><h2>".concat(this.model.get("plural")," shared with you by others</h2></div>")),i=this.model.attributes;if(i.shared_by_others&&i.shared_by_others.length>0){var n=u()('<table class="colored" border="0" cellspacing="0" cellpadding="0" width="100%"><tr class="header"><th>Title</th><th>Owner</th></tr></table>');o.a.each(i.shared_by_others,function(e,i){var a="".concat(Object(f.getAppRoot)()+t.item,"/display_by_username_and_slug?username=").concat(e.username,"&slug=").concat(e.slug);n.append('<tr><td><a href="'.concat(a,'">').concat(o.a.escape(e.title),"</a></td><td>").concat(o.a.escape(e.username),"</td></tr>"))}),e.append(n)}else e.append("No ".concat(this.model.get("plural").toLowerCase()," have been shared with you."));return e}})},G=i(6),W=i(7),J=p.a.Model.extend(W.a.LoggableMixin).extend({_logNamespace:"workflow",urlRoot:"".concat(Object(f.getAppRoot)(),"api/workflows"),toJSON:function(){return{workflow:this.attributes}}}),Y={WorkflowItem:J,WorkflowCollection:p.a.Collection.extend({model:J,url:"".concat(Object(f.getAppRoot)(),"api/workflows")})},K=i(44),Q=p.a.View.extend({tagName:"tr",initialize:function(){o.a.bindAll(this,"render","_rowTemplate","renderTagEditor","_templateActions","removeWorkflow","copyWorkflow"),G.a.options.timeOut=1500},events:{"click #show-in-tool-panel":"showInToolPanel","click #delete-workflow":"removeWorkflow","click #rename-workflow":"renameWorkflow","click #copy-workflow":"copyWorkflow"},render:function(){return u()(this.el).html(this._rowTemplate()),this},showInToolPanel:function(){this.model.save({show_in_tool_panel:!this.model.get("show_in_tool_panel")},{success:function(){window.location="".concat(Object(f.getAppRoot)(),"workflows/list")}})},removeWorkflow:function(){var t=this.model.get("name");window.confirm("Are you sure you want to delete workflow '".concat(t,"'?"))&&(this.model.destroy({success:function(){G.a.success("Successfully deleted workflow '".concat(t,"'"))}}),this.remove())},renameWorkflow:function(){var t=this.model.get("name"),e=window.prompt("Enter a new Name for workflow '".concat(t,"'"),t);e&&(this.model.save({name:e},{success:function(){G.a.success("Successfully renamed workflow '".concat(t,"' to '").concat(e,"'"))}}),this.render())},copyWorkflow:function(){var t=this,e=Object(s.a)(),i=this.model.get("name");u.a.getJSON("".concat(this.model.urlRoot,"/").concat(this.model.id,"/download"),function(n){var a="Copy of ".concat(i),o=t.model.get("owner");o!=e.user.attributes.username&&(a+=" shared by user ".concat(o)),n.name=a,t.collection.create(n,{at:0,wait:!0,success:function(){G.a.success("Successfully copied workflow '".concat(i,"' to '").concat(a,"'"))},error:function(t,e,i){G.a.error(i.errorThrown)}})}).error(function(t,e,i){G.a.error(t.responseJSON.err_msg)})},_rowTemplate:function(){var t=Object(s.a)(),e=this.model.get("show_in_tool_panel"),i=this.model.id,n='<input id="show-in-tool-panel" type="checkbox" class="show-in-tool-panel" '.concat(e?'checked="'.concat(e,'"'):"",' value="').concat(i,'">');return'\n            <td>\n                <div class="btn-group">\n                    <a href="'.concat(Object(f.getAppRoot)(),"workflow/editor?id=").concat(this.model.id,'" class="btn btn-secondary">\n                        ').concat(o.a.escape(this.model.get("name")),'\n                    </a>\n                    <button type="button" class="btn btn-secondary dropdown-toggle dropdown-toggle-split" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">\n                      <span class="sr-only">Toggle Dropdown</span>\n                    </button>\n                    ').concat(this._templateActions(),'\n                </div>\n            </td>\n            <td>\n                <div class="').concat(i,' tags-display"></div>\n            </td>\n            <td>\n                ').concat(this.model.get("owner")===t.user.attributes.username?"You":this.model.get("owner"),"\n            </td>\n            <td>").concat(this.model.get("number_of_steps"),"</td>\n            <td>").concat(this.model.get("published")?"Yes":"No","</td>\n            <td>").concat(n,"</td>")},renderTagEditor:function(){var t=u()(this.el).find(".tags-display")[0],e={model:this.model,disabled:!1,context:"workflow"};return Object(K.b)(e,t)},_templateActions:function(){var t=Object(s.a)();return this.model.get("owner")===t.user.attributes.username?'<div class="dropdown-menu">\n                        <a class="dropdown-item" href="'.concat(Object(f.getAppRoot)(),"workflow/editor?id=").concat(this.model.id,'">Edit</a>\n                        <a class="dropdown-item" href="').concat(Object(f.getAppRoot)(),"workflows/run?id=").concat(this.model.id,'">Run</a>\n                        <a class="dropdown-item" href="').concat(Object(f.getAppRoot)(),"workflow/sharing?id=").concat(this.model.id,'">Share</a>\n                        <a class="dropdown-item" href="').concat(Object(f.getAppRoot)(),"api/workflows/").concat(this.model.id,'/download?format=json-download">Download</a>\n                        <a class="dropdown-item" id="copy-workflow" style="cursor: pointer;">Copy</a>\n                        <a class="dropdown-item" id="rename-workflow" style="cursor: pointer;">Rename</a>\n                        <a class="dropdown-item" href="').concat(Object(f.getAppRoot)(),"workflow/display_by_id?id=").concat(this.model.id,'">View</a>\n                        <a class="dropdown-item" id="delete-workflow" style="cursor: pointer;">Delete</a>\n                    </div>'):'<ul class="dropdown-menu">\n                        <li><a href="'.concat(Object(f.getAppRoot)(),"workflow/display_by_username_and_slug?username=").concat(this.model.get("owner"),"&slug=").concat(this.model.get("slug"),'">View</a></li>\n                        <li><a href="').concat(Object(f.getAppRoot)(),"workflows/run?id=").concat(this.model.id,'">Run</a></li>\n                        <li><a id="copy-workflow" style="cursor: pointer;">Copy</a></li>\n                        <li><a class="link-confirm-shared-').concat(this.model.id,'" href="').concat(Object(f.getAppRoot)(),"workflow/sharing?unshare_me=True&id=").concat(this.model.id,'">Remove</a></li>\n                    </ul>')}}),X={View:p.a.View.extend({title:g()("Workflows"),active_tab:"workflow",initialize:function(){B.a.markViewAsLoading(this),o.a.bindAll(this,"adjustActiondropdown"),this.collection=new Y.WorkflowCollection,this.collection.fetch().done(this.render()),this.collection.bind("add",this.appendItem),this.collection.on("sync",this.render,this)},events:{dragover:"highlightDropZone",dragleave:"unhighlightDropZone"},highlightDropZone:function(t){u()(".hidden_description_layer").addClass("dragover"),u()(".menubutton").addClass("background-none"),t.preventDefault()},unhighlightDropZone:function(){u()(".hidden_description_layer").removeClass("dragover"),u()(".menubutton").removeClass("background-none")},drop:function(t){this.unhighlightDropZone(),t.preventDefault();for(var e,i=t.dataTransfer.files,n=0;e=i[n];n++)this.readWorkflowFiles(e)},readWorkflowFiles:function(t){var e=this,i=new FileReader;i.onload=function(n){var a;try{a=JSON.parse(i.result)}catch(e){G.a.error("Could not read file '".concat(t.name,"'. Verify it is a valid Galaxy workflow")),a=null}a&&e.collection.create(a,{at:0,wait:!0,success:function(){G.a.success("Successfully imported workflow '".concat(a.name,"'"))},error:function(t,e,i){G.a.error(i.errorThrown)}})},i.readAsText(t,"utf-8")},_showArgErrors:o.a.once(function(){var t=E.a.get("message");"error"===E.a.get("status")?G.a.error(o.a.escape(t||"Unknown Error, please report this to an administrator.")):t&&G.a.info(o.a.escape(t))}),render:function(){var t=this,e=this._templateHeader(),i=this._templateActionButtons(),n=this._templateWorkflowTable();this.$el.html(e+i+n),o.a.each(this.collection.models,function(e){t.appendItem(e),t.confirmDelete(e)});return this.searchWorkflow(this.$(".search-wf"),this.$(".workflow-search tr"),3),this.adjustActiondropdown(),this._showArgErrors(),this.$(".hidden_description_layer").get(0).addEventListener("drop",o.a.bind(this.drop,this)),this},appendItem:function(t){var e=new Q({model:t,collection:this.collection});u()(".workflow-search").append(e.render().el),e.renderTagEditor()},confirmDelete:function(t){this.$(".link-confirm-shared-".concat(t.id)).click(function(){return window.confirm("Are you sure you want to remove the shared workflow '".concat(t.attributes.name,"'?"))})},searchWorkflow:function(t,e,i){t.on("keyup",function(){var t=u()(this).val();if(t.length>=i){var n=new RegExp(t,"i");e.hide(),e.filter(function(){return n.test(u()(this).text())}).show()}else e.show()})},adjustActiondropdown:function(){u()(this.el).on("show.bs.dropdown",function(){u()(this.el).css("overflow","inherit")}),u()(this.el).on("hide.bs.dropdown",function(){u()(this.el).css("overflow","auto")})},_templateNoWorkflow:function(){return'<div class="wf-nodata"> You have no workflows. </div>'},_templateActionButtons:function(){return'<ul class="manage-table-actions"><li><input class="search-wf form-control" type="text" autocomplete="off" placeholder="search for workflow..."></li><li><a class="action-button fa fa-plus wf-action" id="new-workflow" title="Create new workflow" href="'.concat(Object(f.getAppRoot)(),'workflows/create"></a></li><li><a class="action-button fa fa-upload wf-action" id="import-workflow" title="Upload or import workflow" href="').concat(Object(f.getAppRoot)(),'workflows/import"></a></li></ul>')},_templateWorkflowTable:function(){return"".concat('<table class="table colored"><thead><tr class="header"><th>Name</th><th>Tags</th><th>Owner</th><th># of Steps</th><th>Published</th><th>Show in tools panel</th></tr></thead>','<tbody class="workflow-search "><div class="hidden_description_layer"><p>Drop workflow files here to import</p></tbody></table></div>')},_templateHeader:function(){return'<div class="page-container"><div class="user-workflows wf"><div class="response-message"></div><h2>'+g()("Your workflows")+"</h2></div></div>"}})};A.a.use(D.a);var Z={data:function(){var t=Object(s.a)();return{sourceFile:null,sourceURL:null,errorMessage:null,myexperiment_target_url:"http://".concat(t.config.myexperiment_target_url,"/galaxy?galaxy_url=").concat(window.location.protocol,"//").concat(window.location.host)}},computed:{hasErrorMessage:function(){return null!=this.errorMessage}},methods:{submit:function(t){var e=this;if(t.preventDefault(),this.sourceFile||this.sourceURL){var i=new FormData;i.append("archive_file",this.sourceFile),i.append("archive_source",this.sourceURL),$.a.post("".concat(Object(f.getAppRoot)(),"api/workflows"),i).then(function(t){window.location="".concat(Object(f.getAppRoot)(),"workflows/list?message=").concat(t.data.message,"&status=success")}).catch(function(t){var i=t.response.data&&t.response.data.err_msg;e.errorMessage=i||"Import failed for an unknown reason."})}else this.errorMessage="You must provide a workflow archive URL or file."}}},tt=Object(M.a)(Z,function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("b-form",{on:{submit:t.submit}},[i("b-card",{attrs:{title:"Import Workflow"}},[i("b-alert",{attrs:{show:t.hasErrorMessage,variant:"danger"}},[t._v(t._s(t.errorMessage))]),t._v(" "),i("p",[t._v("Please provide a Galaxy workflow export URL or a workflow file.")]),t._v(" "),i("b-form-group",{attrs:{label:"Archived Workflow URL"}},[i("b-form-input",{attrs:{id:"workflow-import-url-input",type:"url"},model:{value:t.sourceURL,callback:function(e){t.sourceURL=e},expression:"sourceURL"}}),t._v("\n            If the workflow is accessible via a URL, enter the URL above and click Import.\n        ")],1),t._v(" "),i("b-form-group",{attrs:{label:"Archived Workflow File"}},[i("b-form-file",{model:{value:t.sourceFile,callback:function(e){t.sourceFile=e},expression:"sourceFile"}}),t._v("\n            If the workflow is in a file on your computer, choose it and then click Import.\n        ")],1),t._v(" "),i("b-button",{attrs:{id:"workflow-import-button",type:"submit"}},[t._v("Import workflow")]),t._v(" "),i("div",{staticClass:"mt-4"},[i("h4",[t._v("Import a Workflow from myExperiment")]),t._v(" "),i("a",{attrs:{href:t.myexperiment_target_url}},[t._v("Visit myExperiment")]),t._v(" "),i("div",{staticClass:"form-text"},[t._v("Click the link above to visit myExperiment and search for Galaxy workflows.")])])],1)],1)},[],!1,null,null,null).exports;A.a.use(D.a);var et={data:function(){return{sourceFile:null,sourceURL:null,errorMessage:null}},computed:{hasErrorMessage:function(){return null!=this.errorMessage}},methods:{submit:function(t){var e=this;if(t.preventDefault(),this.sourceFile||this.sourceURL){var i=new FormData;i.append("archive_file",this.sourceFile),i.append("archive_source",this.sourceURL),$.a.post("".concat(Object(f.getAppRoot)(),"api/histories"),i).then(function(t){window.location="".concat(Object(f.getAppRoot)(),"histories/list?message=").concat(t.data.message,"&status=success")}).catch(function(t){var i=t.response.data&&t.response.data.err_msg;e.errorMessage=i||"Import failed for an unknown reason."})}else this.errorMessage="You must provide a history archive URL or file."}}},it=Object(M.a)(et,function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("b-form",{on:{submit:t.submit}},[i("b-card",{attrs:{title:"Import a history from an archive"}},[i("b-alert",{attrs:{show:t.hasErrorMessage,variant:"danger"}},[t._v(t._s(t.errorMessage))]),t._v(" "),i("p",[t._v("Please provide a Galaxy history export URL or a history file.")]),t._v(" "),i("b-form-group",{attrs:{label:"Archived History URL"}},[i("b-form-input",{attrs:{type:"url"},model:{value:t.sourceURL,callback:function(e){t.sourceURL=e},expression:"sourceURL"}})],1),t._v(" "),i("b-form-group",{attrs:{label:"Archived History File"}},[i("b-form-file",{model:{value:t.sourceFile,callback:function(e){t.sourceFile=e},expression:"sourceFile"}})],1),t._v(" "),i("b-button",{attrs:{type:"submit"}},[t._v("Import history")])],1)],1)},[],!1,null,null,null).exports,nt=i(47),at=i(87),ot={props:{id:{type:String,required:!1}},data:function(){return{historyTemplate:"",historyJSON:{},errorMessages:[]}},created:function(){var t=this.id,e="";e=void 0!==t&&""!==t&&null!==t?Object(f.getAppRoot)()+"history/display_structured?id="+t:Object(f.getAppRoot)()+"history/display_structured",this.ajaxCall(e)},methods:{ajaxCall:function(t){var e=this;$.a.get(t).then(function(t){e._updateHistoryData(t)}).catch(function(t){console.error(t),e.errorMessages.push("Error fetching history data -- reload the page to retry this request.  Please contact an administrator if the problem persists.")})},_updateHistoryData:function(t){var e=t.data;this.historyTemplate=e.template,this.historyJSON=e.history_json},makeHistoryView:function(t){window.hdas=t.map(function(t){var e=Object(s.a)();return new at.a.HDAListItemEdit({model:new nt.a.HistoryDatasetAssociation(t),el:u()("#hda-"+t.id),linkTarget:"galaxy_main",purgeAllowed:e.config.allow_user_dataset_purge,logger:e.logger}).render(0)}),u()(function(){u()(".workflow, .tool").each(function(t,e){var i=u()(e).children(".body");u()(e).children(".header").click(function(t){i.toggle()}).addClass("clickable")})})}},updated:function(){this.makeHistoryView(this.historyJSON)}},st=(i(806),Object(M.a)(ot,function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",[t._l(t.errorMessages,function(e){return i("div",[i("div",{staticClass:"alert alert-danger",attrs:{role:"alert"}},[t._v(t._s(e))])])}),t._v(" "),i("div",{domProps:{innerHTML:t._s(t.historyTemplate)}})],2)},[],!1,null,null,null).exports),rt=i(59),lt={props:{id:{type:String,required:!0}},data:function(){return{historyData:{},historyHistory:{},errorMessages:[]}},created:function(){var t=Object(f.getAppRoot)()+"history/view/"+this.id;this.ajaxCall(t,this.updateHistoryView)},methods:{ajaxCall:function(t,e){var i=this;$.a.get(t).then(function(t){e(t)}).catch(function(t){i.showError("Error fetching histories -- reload the page to retry this request.  Please contact an administrator if the problem persists.",t)})},updateHistoryView:function(t){this.historyData=t.data,this.historyHistory=t.data.history},showError:function(t,e){console.error(e),this.errorMessages.push(t)},makeHistoryView:function(t){u()(function(){var e={hasMasthead:t.use_panels?"true":"false",userIsOwner:t.user_is_owner?"true":"false",isCurrent:t.history_is_current?"true":"false",historyJSON:t.history,showDeletedJson:t.show_deleted,showHiddenJson:t.show_hidden,initialModeDeleted:t.show_deleted?"showing_deleted":"not_showing_deleted",initialModeHidden:t.show_hidden?"showing_hidden":"not_showing_hidden",allowUserDatasetPurge:t.allow_user_dataset_purge?"true":"false"};e.viewToUse=e.userIsOwner?{location:"mvc/history/history-view-edit",className:"HistoryViewEdit"}:{location:"mvc/history/history-view",className:"HistoryView"},rt.a.historyEntry(e)})},showStructure:function(){var t=Object(s.a)(),e=A.a.extend(st),i=document.createElement("div");t.page.center.display(i),new e({propsData:{id:E.a.get("id")}}).$mount(i)},switchHistory:function(){var t=Object(f.getAppRoot)()+"history/switch_to_history?hist_id="+this.historyHistory.id;this.ajaxCall(t,this.reloadPage)},reloadPage:function(){window.location.reload()}},updated:function(){this.makeHistoryView(this.historyData)}},ct=(i(807),Object(M.a)(lt,function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{attrs:{id:"structured-history-view"}},[i("div",{staticClass:"clear",attrs:{id:"history-view-controls"}},[i("div",{staticClass:"float-left"},[0==t.historyHistory.purged?i("span",[0==t.historyData.user_is_owner?i("span",[i("button",{staticClass:"btn btn-secondary",attrs:{id:"import"}},[t._v("Import and start using history")])]):t._e(),t._v(" "),t.historyData.user_is_owner&&0==t.historyData.history_is_current?i("span",[i("button",{staticClass:"btn btn-secondary",attrs:{id:"switch-history"},on:{click:t.switchHistory}},[t._v("\n                        Switch to this history\n                    ")])]):t._e(),t._v(" "),i("button",{staticClass:"btn btn-secondary",attrs:{id:"show-structure"},on:{click:t.showStructure}},[t._v("\n                    Show structure\n                ")])]):t._e()]),t._v(" "),t._m(0)]),t._v(" "),t._l(t.errorMessages,function(e){return i("div",[i("div",{staticClass:"alert alert-danger",attrs:{role:"alert"}},[t._v(t._s(e))])])}),t._v(" "),i("div",{staticClass:"history-panel unified-panel-body",staticStyle:{overflow:"auto"},attrs:{id:"history-"+t.historyHistory.id}})],2)},[function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"float-right"},[e("button",{staticClass:"btn btn-secondary",attrs:{id:"toggle-deleted"}},[this._v("Include deleted")]),this._v(" "),e("button",{staticClass:"btn btn-secondary",attrs:{id:"toggle-hidden"}},[this._v("Include hidden")])])}],!1,null,null,null).exports),dt=i(49),ut=i(39),ht=i(51),pt=U.a.extend({initialize:function(t){this.ajaxQueue=new dt.a.AjaxQueue,U.a.prototype.initialize.call(this,t)},init_grid_elements:function(){var t=this.ajaxQueue;t.stop(),U.a.prototype.init_grid_elements.call(this),u.a.makeArray(this.$el.find(".delayed-value-datasets_by_state").map(function(t,e){return function(){var t=u()(e).data("id"),i="".concat(Object(f.getAppRoot)(),"api/histories/").concat(t,"?keys=nice_size,contents_active,contents_states"),n={};return n.url=i,n.type="GET",n.success=function(e){for(var i=e.contents_states,n="",a=["ok","running","queued","new","error"],o=0;o<a.length;o++){var s=a[o],r=i[s];r&&(n+='<div class="count-box state-color-'.concat(s,'" title="Datasets in ').concat(s,' state">').concat(r,"</div> "))}var l=e.contents_active,c=l.deleted;c&&(n+='<div class="count-box state-color-deleted" title="Deleted datasets">'.concat(c,"</div> "));var d=l.hidden;d&&(n+='<div class="count-box state-color-hidden" title="Hidden datasets">'.concat(d,"</div> ")),u()(".delayed-value-datasets_by_state[data-id='".concat(t,"']")).html(n),u()(".delayed-value-disk_size[data-id='".concat(t,"']")).html(e.nice_size)},u.a.ajax(n)}})).forEach(function(e){return t.add(e)}),t.start()},_showCopyDialog:function(t){var e=new ut.a({id:t});e.fetch().fail(function(){alert("History could not be fetched. Please contact an administrator")}).done(function(){Object(ht.a)(e,{}).done(function(){var t=Object(s.a)();t&&t.currHistoryPanel&&t.currHistoryPanel.loadCurrentHistory(),window.location.reload(!0)})})},add_operation:function(t,e,i){var n=this;"Copy"==e.label&&(e.onclick=function(t){n._showCopyDialog(t)}),U.a.prototype.add_operation.call(this,t,e,i)}}),ft={View:p.a.View.extend({title:g()("Histories"),initialize:function(t){var e=this,i=Object(s.a)();B.a.markViewAsLoading(this),"list_published"==t.action_id?this.active_tab="shared":"list"==t.action_id&&(this.active_tab="user"),this.model=new p.a.Model,_.a.get({url:"".concat(Object(f.getAppRoot)(),"history/").concat(t.action_id,"?").concat(u.a.param(i.params)),success:function(t){e.model.set(t),e.render()}})},render:function(){var t=new pt(this.model.attributes);this.$el.empty().append(t.$el)}})},mt={data:function(){return{plugins:[],hdas:[],search:"",selected:null,name:null,error:null,fixed:!1}},created:function(){var t=this,e=Object(s.a)(),i="".concat(Object(f.getAppRoot)(),"api/plugins"),n=e.params.dataset_id;n&&(this.fixed=!0,this.selected=n,i+="?dataset_id=".concat(n)),$.a.get(i).then(function(e){t.plugins=e.data}).catch(function(e){t.error=t._errorMessage(e)})},methods:{select:function(t){var e=this;if(this.fixed)this.create(t);else{var i=Object(s.a)(),n=i.currHistoryPanel&&i.currHistoryPanel.model.id;n?$.a.get("".concat(Object(f.getAppRoot)(),"api/plugins/").concat(t.name,"?history_id=").concat(n)).then(function(i){e.name=t.name,e.hdas=i.data&&i.data.hdas,e.hdas&&e.hdas.length>0&&(e.selected=e.hdas[0].id)}).catch(function(t){e.error=e._errorMessage(t)}):this.error="This option requires an accessible history."}},create:function(t){var e="".concat(t.href,"?dataset_id=").concat(this.selected);"_top"==t.target?window.location.href=e:u()("#galaxy_main").attr("src",e)},match:function(t){return!this.search||-1!=t.name.indexOf(this.search)||t.description&&-1!=t.description.indexOf(this.search)},_errorMessage:function(t){return t&&t.response&&t.response.data&&t.response.data.err_msg||"Request failed for an unknown reason."}}},gt=Object(M.a)(mt,function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"ui-thumbnails"},[t.error?i("div",{staticClass:"alert alert-danger"},[t._v(t._s(t.error))]):i("div",[i("input",{directives:[{name:"model",rawName:"v-model",value:t.search,expression:"search"}],staticClass:"search-query parent-width",attrs:{name:"query",placeholder:"search visualizations",autocomplete:"off",type:"text"},domProps:{value:t.search},on:{input:function(e){e.target.composing||(t.search=e.target.value)}}}),t._v(" "),t._l(t.plugins,function(e){return i("div",{key:e.name},[t.match(e)?i("table",[i("tr",{staticClass:"ui-thumbnails-item",on:{click:function(i){return t.select(e)}}},[i("td",[e.logo?i("img",{staticClass:"ui-thumbnails-image",attrs:{src:e.logo}}):i("div",{staticClass:"ui-thumbnails-icon fa fa-eye"})]),t._v(" "),i("td",[i("div",{staticClass:"ui-thumbnails-title font-weight-bold text-dark"},[t._v(t._s(e.html))]),t._v(" "),i("div",{staticClass:"ui-thumbnails-text text-dark"},[t._v(t._s(e.description))])])]),t._v(" "),t.fixed?t._e():i("tr",[i("td"),t._v(" "),e.name==t.name?i("td",[t.hdas&&t.hdas.length>0?i("div",[i("div",{staticClass:"font-weight-bold text-dark"},[t._v("Select a dataset to visualize:")]),t._v(" "),i("div",{staticClass:"ui-select"},[i("select",{directives:[{name:"model",rawName:"v-model",value:t.selected,expression:"selected"}],staticClass:"select",on:{change:function(e){var i=Array.prototype.filter.call(e.target.options,function(t){return t.selected}).map(function(t){return"_value"in t?t._value:t.value});t.selected=e.target.multiple?i:i[0]}}},t._l(t.hdas,function(e){return i("option",{key:e.id,domProps:{value:e.id}},[t._v(t._s(e.name))])}),0),t._v(" "),i("div",{staticClass:"icon-dropdown fa fa-caret-down"})]),t._v(" "),i("button",{staticClass:"ui-button-default float-left mt-3 btn btn-primary",attrs:{type:"button"},on:{click:function(i){return t.create(e)}}},[i("i",{staticClass:"icon fa fa-check"}),t._v(" "),i("span",{staticClass:"title"},[t._v("Create Visualization")])])]):i("div",{staticClass:"alert alert-danger"},[t._v("\n                            There is no suitable dataset in your current history which can be visualized with this\n                            plugin.\n                        ")])]):t._e()])]):t._e()])})],2)])},[],!1,null,null,null).exports,_t=i(88),vt=i(58),bt=i(117),wt={View:p.a.View.extend({initialize:function(t){var e=Object(s.a)();this.modal=e.modal||new b.a.View,this.model=t&&t.model||new p.a.Model(t),this.deferred=new _t.a,t&&t.active_tab&&(this.active_tab=t.active_tab),this.setElement(u()("<div/>").addClass("ui-form-composite").append(this.$message=u()("<div/>").addClass("mb-4")).append(this.$header=u()("<div/>")).append(this.$steps=u()("<div/>"))),u()("body").append(this.$el),this._configure(),this.render()},_configure:function(){var t=this,e=Object(s.a)();this.forms=[],this.steps=[],this.links=[],this.parms=[],o.a.each(this.model.get("steps"),function(i,n){e.emit.debug("tool-form-composite::initialize()","".concat(n," : Preparing workflow step."));var a=bt.a[i.step_type],s="".concat(parseInt(n+1),": ").concat(i.step_label||i.step_name);i.annotation&&(s+=" - ".concat(i.annotation)),i.step_version&&(s+=" (Galaxy Version ".concat(i.step_version,")")),i=_.a.merge({index:n,fixed_title:o.a.escape(s),icon:a||"",help:null,citations:null,collapsible:!0,collapsed:n>0&&!t._isDataStep(i),sustain_version:!0,sustain_repeats:!0,sustain_conditionals:!0,narrow:!0,text_enable:"Edit",text_disable:"Undo",cls_enable:"fa fa-edit",cls_disable:"fa fa-undo",errors:i.messages,initial_errors:!0,cls:"ui-portlet-section",hide_operations:!0,needs_refresh:!1,always_refresh:"tool"!=i.step_type},i),t.steps[n]=i,t.links[n]=[],t.parms[n]={}}),o.a.each(this.steps,function(e,i){vt.a.visitInputs(e.inputs,function(e,n){t.parms[i][n]=e})}),o.a.each(this.steps,function(e,i){o.a.each(e.output_connections,function(e){o.a.each(t.steps,function(n,a){n.step_index===e.input_step_index&&t.links[i].push(n)})})}),o.a.each(this.steps,function(e,i){o.a.each(t.steps,function(n,a){var s={};o.a.each(e.output_connections,function(t){n.step_index===t.input_step_index&&(s[t.input_name]=t)}),o.a.each(t.parms[a],function(t,n){var a=s[n];a&&(t.type="hidden",t.help=t.step_linked?"".concat(t.help,", "):"",t.help+="Output dataset '".concat(a.output_name,"' from step ").concat(parseInt(i)+1),t.step_linked=t.step_linked||[],t.step_linked.push({index:e.index,step_type:e.step_type}))})})});var i=0;function n(e){return t.wp_inputs[e]=t.wp_inputs[e]||{label:e,name:e,type:"text",color:"hsl( ".concat(100*++i,", 70%, 30% )"),style:"ui-form-wp-source",links:[]}}this.wp_inputs={},o.a.each(this.steps,function(e,i){o.a.each(t.parms[i],function(t,i){!function(t,e){for(var i,a=/\$\{(.+?)\}/g;i=a.exec(String(t));)e(n(i[1]))}(t.value,function(i){i.links.push(e),t.wp_linked=!0,t.type="text",t.backdrop=!0,t.style="ui-form-wp-target"})}),o.a.each(e.replacement_parameters,function(t){n(t)})}),o.a.each(this.steps,function(e,i){if("tool"==e.step_type){var n=!0;vt.a.visitInputs(e.inputs,function(i,a,o){var s=i.value&&"RuntimeValue"==i.value.__class__,r=-1!=["data","data_collection"].indexOf(i.type),l=o[i.data_ref];i.step_linked&&!t._isDataStep(i.step_linked)&&(n=!1),i.options&&(0==i.options.length&&!n||i.wp_linked)&&(i.is_workflow=!0),l&&(i.is_workflow=l.step_linked&&!t._isDataStep(l.step_linked)||i.wp_linked),(r||i.value&&"RuntimeValue"==i.value.__class__&&!i.step_linked)&&(e.collapsed=!1),s&&(i.value=null),i.flavor="workflow",s||r||"hidden"===i.type||i.wp_linked||(i.optional||!_.a.isEmpty(i.value)&&""!==i.value)&&(i.collapsible_value=i.value,i.collapsible_preview=!0)})}})},render:function(){var t=this;this.deferred.reset(),this._renderHeader(),this._renderMessage(),this._renderParameters(),this._renderHistory(),this._renderUseCachedJob(),this._renderResourceParameters(),o.a.each(this.steps,function(e){t._renderStep(e)})},_renderHeader:function(){var t=this;this.execute_btn=new v.a.Button({id:"run-workflow",icon:"fa-check",title:g()("Run workflow"),cls:"btn btn-primary",onclick:function(){t._execute()}}),this.$header.addClass("h4").empty().append("<b>Workflow: ".concat(this.model.get("name"),"<b>")).append(this.execute_btn.$el)},_renderMessage:function(){this.$message.empty(),this.model.get("has_upgrade_messages")&&this.$message.append(new v.a.Message({message:"Some tools in this workflow may have changed since it was last saved or some errors were found. The workflow may still run, but any new options will have default values. Please review the messages below to make a decision about whether the changes will affect your analysis.",status:"warning",persistent:!0,fade:!1}).$el);var t=this.model.get("step_version_changes");t&&t.length>0&&this.$message.append(new v.a.Message({message:"Some tools are being executed with different versions compared to those available when this workflow was last saved because the other versions are not or no longer available on this Galaxy instance. To upgrade your workflow and dismiss this message simply edit the workflow and re-save it.",status:"warning",persistent:!0,fade:!1}).$el)},_renderParameters:function(){var t=this;this.wp_form=null,o.a.isEmpty(this.wp_inputs)||(this.wp_form=new L.a({title:"<b>Workflow Parameters</b>",inputs:this.wp_inputs,cls:"ui-portlet-section",onchange:function(){o.a.each(t.wp_form.input_list,function(e,i){o.a.each(e.links,function(e){t._refreshStep(e)})})}}),this._append(this.$steps.empty(),this.wp_form.$el))},_renderHistory:function(){this.history_form=new L.a({cls:"ui-portlet-section",title:"<b>History Options</b>",inputs:[{type:"conditional",name:"new_history",test_param:{name:"check",label:"Send results to a new history",type:"boolean",value:"false",help:""},cases:[{value:"true",inputs:[{name:"name",label:"History name",type:"text",value:this.model.get("name")}]}]}]}),this._append(this.$steps,this.history_form.$el)},_renderResourceParameters:function(){this.workflow_resource_parameters_form=null,o.a.isEmpty(this.model.get("workflow_resource_parameters"))||(this.workflow_resource_parameters_form=new L.a({cls:"ui-portlet-section",title:"<b>Workflow Resource Options</b>",inputs:this.model.get("workflow_resource_parameters")}),this._append(this.$steps,this.workflow_resource_parameters_form.$el))},_renderUseCachedJob:function(){var t=Object(s.a)(),e={};t.user.attributes.preferences&&"extra_user_preferences"in t.user.attributes.preferences&&(e=JSON.parse(t.user.attributes.preferences.extra_user_preferences));var i="use_cached_job|use_cached_job_checkbox"in e&&e["use_cached_job|use_cached_job_checkbox"];this.display_use_cached_job_checkbox="true"===i,this.display_use_cached_job_checkbox&&(this.job_options_form=new L.a({cls:"ui-portlet-section",title:"<b>Job re-use Options</b>",inputs:[{type:"conditional",name:"use_cached_job",test_param:{name:"check",label:"BETA: Attempt to reuse jobs with identical parameters?",type:"boolean",value:"false",help:"This may skip executing jobs that you have already run."}}]}),this._append(this.$steps,this.job_options_form.$el))},_renderStep:function(t){var e=Object(s.a)(),i=this,n=null;this.deferred.execute(function(a){if(i.$steps.addClass("ui-steps"),"tool"==t.step_type)t.postchange=function(i,n){var a={tool_id:t.id,tool_version:t.version,inputs:u.a.extend(!0,{},n.data.create())};n.wait(!0),e.emit.debug("tool-form-composite::postchange()","Sending current state.",a),_.a.request({type:"POST",url:"".concat(Object(f.getAppRoot)(),"api/tools/").concat(t.id,"/build"),data:a,success:function(t){n.update(t),n.wait(!1),e.emit.debug("tool-form-composite::postchange()","Received new model.",t),i.resolve()},error:function(t){e.emit.debug("tool-form-composite::postchange()","Refresh request failed.",t),i.reject()}})},n=new w.a(t),t.post_job_actions&&t.post_job_actions.length&&n.portlet.append(u()("<div/>").addClass("ui-form-element-disabled").append(u()("<div/>").addClass("ui-form-title").html("<b>Job Post Actions</b>")).append(u()("<div/>").addClass("ui-form-preview").html(o.a.reduce(t.post_job_actions,function(t,e){return"".concat(t," ").concat(e.short_str)},""))));else{var s=-1!=["data_input","data_collection_input"].indexOf(t.step_type);o.a.each(t.inputs,function(t){t.flavor="module",t.hide_label=s}),n=new L.a(_.a.merge({title:t.fixed_title,onchange:function(){o.a.each(i.links[t.index],function(t){i._refreshStep(t)})},inputs:t.inputs&&t.inputs.length>0?t.inputs:[{type:"hidden",name:"No options available.",ignore:null}]},t)),t.step_label&&n.$el.attr("step-label",t.step_label)}i.forms[t.index]=n,i._append(i.$steps,n.$el),t.needs_refresh&&i._refreshStep(t),n.portlet[i.show_progress?"disable":"enable"](),i.show_progress&&i.execute_btn.model.set({wait:!0,wait_text:"Preparing...",percentage:100*(t.index+1)/i.steps.length}),e.emit.debug("tool-form-composite::initialize()","".concat(t.index," : Workflow step state ready."),t),window.setTimeout(function(){a.resolve()},0)})},_refreshStep:function(t){var e=this,i=this.forms[t.index];i?(o.a.each(e.parms[t.index],function(t,n){if(t.step_linked||t.wp_linked){var a=i.field_list[i.data.match(n)];if(a){var s;if(t.step_linked)s={values:[]},o.a.each(t.step_linked,function(t){if(e._isDataStep(t)){var i=e.forms[t.index].data.create().input;i&&o.a.each(i.values,function(t){s.values.push(t)})}}),!t.multiple&&s.values.length>0&&(s={values:[s.values[0]]});else if(t.wp_linked){s=t.value;for(var r,l=/\$\{(.+?)\}/g;r=l.exec(t.value);){var c=e.wp_form.field_list[e.wp_form.data.match(r[1])],d=c&&c.value();d&&(s=s.split(r[0]).join(d))}}void 0!==s&&a.value(s)}}}),i.trigger("change")):t.needs_refresh=!0},_refreshHistory:function(){var t=Object(s.a)(),e=this,i=t&&t.currHistoryPanel&&t.currHistoryPanel.model;this._refresh_history&&window.clearTimeout(this._refresh_history),i&&i.refresh().success(function(){0===i.numOfUnfinishedShownContents()&&(e._refresh_history=window.setTimeout(function(){e._refreshHistory()},i.UPDATE_DELAY))})},_execute:function(){var t=this;this.show_progress=!0,this._enabled(!1),this.deferred.execute(function(e){window.setTimeout(function(){e.resolve(),t._submit()},0)})},_submit:function(){var t=Object(s.a)(),e=this,i=this.history_form.data.create(),n={new_history_name:i["new_history|name"]?i["new_history|name"]:null,history_id:i["new_history|name"]?null:this.model.get("history_id"),resource_params:this.workflow_resource_parameters_form?this.workflow_resource_parameters_form.data.create():{},replacement_params:this.wp_form?this.wp_form.data.create():{},parameters:{},parameters_normalized:!0,batch:!0};this.display_use_cached_job_checkbox&&(n.use_cached_job="true"===this.job_options_form.data.create()["use_cached_job|check"]);var a=!0;for(var o in this.forms){var r=this.forms[o],l=r.data.create(),c=e.steps[o],d=c.step_index;for(var h in r.trigger("reset"),l){var p=l[h],m=r.data.match(h),v=r.input_list[m];if(!v.step_linked){if(!(a=this._isDataStep(c)?p&&p.values&&p.values.length>0:v.optional||v.is_workflow&&""!==p||!v.is_workflow&&null!==p)){r.highlight(m);break}n.parameters[d]=n.parameters[d]||{},n.parameters[d][h]=l[h]}}if(!a)break}a?(t.emit.debug("tool-form-composite::submit()","Validation complete.",n),_.a.request({type:"POST",url:"".concat(Object(f.getAppRoot)(),"api/workflows/").concat(this.model.id,"/invocations"),data:n,success:function(i){t.emit.debug("tool-form-composite::submit","Submission successful.",i),e.$el.children().hide(),e.$el.append(e._templateSuccess(i)),u.a.isArray(i)&&i.length>0&&(e.$el.append(u()("<div/>",{id:"webhook-view"})),new y.a.WebhookView({type:"workflow",toolId:n.tool_id,toolVersion:n.tool_version})),e._refreshHistory()},error:function(i){t.emit.debug("tool-form-composite::submit","Submission failed.",i);var a=!1;if(i&&i.err_data)for(var o in e.forms){var s=e.forms[o],r=i.err_data[s.model.get("step_index")];if(r){var l=s.data.matchResponse(r);for(var c in l){s.highlight(c,l[c]),a=!0;break}}}a||e.modal.show({title:g()("Workflow submission failed"),body:e._templateError(n,i&&i.err_msg),buttons:{Close:function(){e.modal.hide()}}})},complete:function(){e._enabled(!0)}})):(e._enabled(!0),t.emit.debug("tool-form-composite::submit()","Validation failed.",n))},_append:function(t,e){t.append("<p/>").append(e)},_enabled:function(t){this.execute_btn.model.set({wait:!t,wait_text:"Sending...",percentage:-1}),this.wp_form&&this.wp_form.portlet[t?"enable":"disable"](),this.history_form&&this.history_form.portlet[t?"enable":"disable"](),o.a.each(this.forms,function(e){e&&e.portlet[t?"enable":"disable"]()})},_isDataStep:function(t){for(var e=u.a.isArray(t)?t:[t],i=0;i<e.length;i++){var n=e[i];if(!n||!n.step_type||!n.step_type.startsWith("data"))return!1}return!0},_templateSuccess:function(t){var e=Object(s.a)();if(u.a.isArray(t)&&t.length>0){var i="",n="You can check the status of queued jobs and view the resulting data by refreshing the History pane, if this has not already happened automatically.",a=t[0].history_id&&e.currHistoryPanel&&e.currHistoryPanel.model.id!=t[0].history_id||!1;return t.length>1?(i="<em> - ".concat(t.length," times</em>"),a&&(n='This workflow will generate results in multiple histories.  You can observe progress in the <a href="'.concat(Object(f.getAppRoot)(),'history/view_multiple">history multi-view</a>.'))):a&&(n='This workflow will generate results in a new history. <a href="'.concat(Object(f.getAppRoot)(),"history/switch_to_history?hist_id=").concat(t[0].history_id,'">Switch to that history now</a>.')),u()('\n                <div class="donemessagelarge">\n                    <p>\n                        Successfully invoked workflow <b>'.concat(_.a.sanitize(this.model.get("name")),"</b>").concat(i,".\n                    </p>\n                    <p>\n                        ").concat(n,"\n                    </p>\n                </div>"))}return this._templateError(t,"Invalid success response. No invocations found.")},_templateError:function(t,e){return u()("<div/>").addClass("errormessagelarge").append(u()("<p/>").text("The server could not complete the request. Please contact the Galaxy Team if this error persists. ".concat(JSON.stringify(e)||""))).append(u()("<pre/>").text(JSON.stringify(t,null,4)))}})},yt={View:p.a.View.extend({initialize:function(){var t=Object(s.a)();this.setElement("<div/>"),this.model=new p.a.Model({dataset_id:t.params.dataset_id}),this.active_tab="user",this.render()},render:function(){var t=this,e="".concat(Object(f.getAppRoot)(),"api/datasets/").concat(this.model.get("dataset_id"));_.a.get({url:e,success:function(e){var i="".concat(Object(f.getAppRoot)(),"api/jobs/").concat(e.creating_job,"?full=True");_.a.get({url:i,success:function(i){t.render_error_page(e,i),t.find_common_problems(i)},error:function(e){t.display_message({status:"error",message:"Error occurred while loading the job.",persistent:!0,cls:"errormessage"},t.$(".response-message"))}})},error:function(e){t.display_message({status:"error",message:"Error occurred while loading the dataset.",persistent:!0,cls:"errormessage"},t.$(".response-message"))}})},find_common_problems:function(t){var e=this,i="".concat(Object(f.getAppRoot)(),"api/jobs/").concat(t.id,"/common_problems");_.a.get({url:i,success:function(i){e.render_common_problems(t,i)},error:function(t){console.log("error"),console.log(t)}})},render_common_problems:function(t,e){var i=e.has_duplicate_inputs,n=e.has_empty_inputs;if(i||n){var a=this.$el.find(".common_problems");a.text("Detected Common Potential Problems"),n&&a.after("\n                    <p>\n                        The tool was executed with one or more empty input datasets. This frequently\n                        results in tool errors due to problematic input choices.\n                    <p>"),i&&a.after("\n                    <p>\n                        The tool was executed with one or more duplicate input datasets. This frequently\n                        results in tool errors due to problematic input choices.\n                    <p>")}},render_error_page:function(t,e){this.$el.empty().append("\n            ".concat(this._templateHeader(),"\n            <h2>Dataset Error</h2>\n            <p>An error occurred while running the tool <b>").concat(e.tool_id,"</b>.</p>\n            ").concat(this.job_summary(e),'\n            <h3>Troubleshoot This Error</h3>\n            <p>\n                There are a number of help resources to self diagnose and\n                correct problems.\n                Start here: <a\n                href="https://galaxyproject.org/support/tool-error/"\n                target="_blank"> My job ended with an error. What can I do?</a>\n            </p>\n\n            <h3>Report This Error</h3>\n            <p>\n                Usually the local Galaxy administrators regularly review errors\n                that occur on the server However, if you would like to provide\n                additional information (such as what you were trying to do when\n                the error occurred) and a contact e-mail address, we will be\n                better able to investigate your problem and get back to you.\n            </p>')),this.$el.append(this._getBugFormTemplate(t,e))},job_summary:function(t){var e=t.tool_stderr,i=t.job_stderr,n=t.job_messages;if(!e&&!i&&!n)return'<h3 class="common_problems"></h3>';var a="<h3>Error Details</h3>";if(n){a+="<p>Execution resulted in the following messages:</p>";var s=!0,r=!1,l=void 0;try{for(var c,d=n[Symbol.iterator]();!(s=(c=d.next()).done);s=!0){var u=c.value;a+="<p><pre>".concat(o.a.escape(u.desc),"</pre></p>")}}catch(t){r=!0,l=t}finally{try{s||null==d.return||d.return()}finally{if(r)throw l}}}return e&&(a+="<p>Tool generated the following standard error:</p>",a+='<pre class="code">'.concat(o.a.escape(e),"</pre>")),i&&(a+="<p>Galaxy job runner generated the following standard error:</p>",a+='<pre class="code">'.concat(o.a.escape(i),"</pre>")),a+='<h3 class="common_problems"></h3>'},display_message:function(t,e,i,n){n?i?e.append(new v.a.UnescapedMessage(t).$el):e.empty().html(new v.a.UnescapedMessage(t).$el):i?e.append(new v.a.Message(t).$el):e.empty().html(new v.a.Message(t).$el)},_templateHeader:function(){return'<div class="page-container edit-attr"><div class="response-message"></div></div>'},_getBugFormTemplate:function(t,e){var i=this,n=Object(s.a)(),a=[{help:g()("Your email address"),options:[],type:"text",name:"email",label:"Your email",value:n.user.get("email")},{help:g()("Any additional comments you can provide regarding what you were doing at the time of the bug."),options:[],type:"text",area:!0,name:"message",label:"Message"}],o=new L.a({title:g()("Error Report"),inputs:a,buttons:{save:new v.a.Button({icon:"fa-bug",title:g()("Report"),cls:"ui-button btn btn-primary",floating:"clear",onclick:function(){var n=o.data.create(),a="".concat(Object(f.getAppRoot)(),"api/jobs/").concat(e.id,"/error");n.dataset_id=t.id,i.submit(n,a)}})}});return o.$el},submit:function(t,e){var i=this;u.a.ajax({type:"POST",url:e,data:t,success:function(t){i.$el.empty().append(i._templateHeader()),t.messages.forEach(function(t){i.display_message({status:t[1],message:t[0],persistent:!0},i.$(".response-message"),!0,!0)})},error:function(t){i.display_message({status:"error",message:"Error occurred while saving. Please fill all the required fields and try again.",persistent:!0,cls:"errormessage"},i.$(".response-message"))}})}})},xt=i(81),kt={View:p.a.View.extend({initialize:function(){var t=Object(s.a)();this.setElement("<div/>"),this.model=new p.a.Model({dataset_id:t.params.dataset_id}),this.message=new v.a.Message({persistent:!0}),this.tabs=this._createTabs(),this.active_tab="user",this.$el.append(u()("<h4/>").append("Edit dataset attributes")).append(this.message.$el).append("<p/>").append(this.tabs.$el).hide(),this.render()},render:function(){var t=this;u.a.ajax({url:"".concat(Object(f.getAppRoot)(),"dataset/get_edit?dataset_id=").concat(t.model.get("dataset_id")),success:function(e){!t.initial_message&&t.message.update(e),t.initial_message=!0,o.a.each(t.forms,function(t,i){t.model.set("inputs",e["".concat(i,"_inputs")]),t.model.set("hide_operations",e["".concat(i,"_disable")]),t.render()}),t.$el.show()},error:function(e){var i=e.responseJSON&&e.responseJSON.err_msg;t.message.update({status:"danger",message:i||"Error occurred while loading the dataset."})}})},_submit:function(t,e){var i=this,n=e.data.create();n.dataset_id=this.model.get("dataset_id"),n.operation=t,u.a.ajax({type:"PUT",url:"".concat(Object(f.getAppRoot)(),"dataset/set_edit"),data:n,success:function(t){i.message.update(t),i.render(),i._reloadHistory()},error:function(t){var e=t.responseJSON&&t.responseJSON.err_msg;i.message.update({status:"danger",message:e||"Error occurred while editing the dataset attributes."})}})},_createTabs:function(){this.forms={attribute:this._getAttribute(),conversion:this._getConversion(),datatype:this._getDatatype(),permission:this._getPermission()};var t=new xt.a.View;return t.add({id:"attribute",title:g()("Attributes"),icon:"fa fa-bars",tooltip:g()("Edit dataset attributes"),$el:this.forms.attribute.$el}),t.add({id:"convert",title:g()("Convert"),icon:"fa-gear",tooltip:g()("Convert to new format"),$el:this.forms.conversion.$el}),t.add({id:"datatype",title:g()("Datatypes"),icon:"fa-database",tooltip:g()("Change data type"),$el:this.forms.datatype.$el}),t.add({id:"permissions",title:g()("Permissions"),icon:"fa-user",tooltip:g()("Permissions"),$el:this.forms.permission.$el}),t},_getAttribute:function(){var t=this,e=new L.a({title:g()("Edit attributes"),operations:{submit_attributes:new v.a.Button({tooltip:g()("Save attributes of the dataset."),icon:"fa-floppy-o",title:g()("Save"),onclick:function(){t._submit("attributes",e)}}),submit_autodetect:new v.a.Button({tooltip:"This will inspect the dataset and attempt to correct the values of fields if they are not accurate.",icon:"fa-undo",title:"Auto-detect",onclick:function(){t._submit("autodetect",e)}})}});return e},_getConversion:function(){var t=this,e=new L.a({title:g()("Convert to new format"),operations:{submit_conversion:new v.a.Button({tooltip:g()("Convert the datatype to a new format."),title:g()("Convert datatype"),icon:"fa-exchange",onclick:function(){t._submit("conversion",e)}})}});return e},_getDatatype:function(){var t=this,e=new L.a({title:g()("Change datatype"),operations:{submit_datatype:new v.a.Button({tooltip:g()("Change the datatype to a new type."),title:g()("Change datatype"),icon:"fa-exchange",onclick:function(){t._submit("datatype",e)}}),submit_datatype_detect:new v.a.Button({tooltip:g()("Detect the datatype and change it."),title:g()("Detect datatype"),icon:"fa-undo",onclick:function(){t._submit("datatype_detect",e)}})}});return e},_getPermission:function(){var t=this,e=new L.a({title:g()("Manage dataset permissions"),operations:{submit_permission:new v.a.Button({tooltip:g()("Save permissions."),title:g()("Save permissions"),icon:"fa-floppy-o ",onclick:function(){t._submit("permission",e)}})}});return e},_reloadHistory:function(){var t=Object(s.a)();t&&t.currHistoryPanel.loadCurrentHistory()}})},Ct=i(130),St=i(41),Tt=i(152),$t={View:p.a.View.extend({initialize:function(t){var e=this;this.model=t&&t.model||new p.a.Model({tooltip:g()("Download from URL or upload files from disk"),label:"Load Data",percentage:0,status:"",onunload:function(){},onclick:function(){}}).set(t),this.setElement(this._template()),this.$progress=this.$(".progress-bar"),this.listenTo(this.model,"change",this.render,this),this.render(),u()(window).on("beforeunload",function(){return e.model.get("onunload")()})},render:function(){var t=this.model.attributes;this.$el.off("click").on("click",function(e){t.onclick(e)}).tooltip({title:this.model.get("tooltip"),placement:"bottom",trigger:"hover"}),this.$progress.removeClass().addClass("progress-bar").addClass("progress-bar-notransition").addClass(""!=t.status&&"progress-bar-".concat(t.status)).css({width:"".concat(t.percentage,"%")})},_template:function(){return'<div class="upload-button">\n                <div class="progress">\n                    <div class="progress-bar"/>\n                        <a class="upload-button-link" href="javascript:void(0)" id="tool-panel-upload-button">\n                            <span class="fa fa-upload"/>\n                        </a>\n                    </div>\n            </div>'}})},Ot=p.a.Model.extend({defaults:{extension:"auto",genome:"?",url_paste:"",status:"init",optional:!1,info:null,file_name:"",file_mode:"",file_size:0,file_type:null,file_path:"",file_data:null,percentage:0,space_to_tab:!1,to_posix_lines:!0,enabled:!0},reset:function(t){this.clear().set(this.defaults).set(t)}}),At={Model:Ot,Collection:p.a.Collection.extend({model:Ot})},jt=p.a.View.extend({options:{class_check:"fa-check-square-o",class_uncheck:"fa-square-o",parameters:[{id:"space_to_tab",title:"Convert spaces to tabs"},{id:"to_posix_lines",title:"Use POSIX standard"}]},initialize:function(t){this.model=t.model,this.setElement(u()("<div/>").addClass("upload-settings")),this.$el.append(u()("<div/>").addClass("upload-settings-cover")),this.$el.append(u()("<table/>").addClass("upload-settings-table grid").append("<tbody/>")),this.$cover=this.$(".upload-settings-cover"),this.$table=this.$(".upload-settings-table > tbody"),this.listenTo(this.model,"change",this.render,this),this.model.trigger("change")},render:function(){var t=this;this.$table.empty(),o.a.each(this.options.parameters,function(e){var i=u()("<div/>").addClass("upload-".concat(e.id," fa")).addClass(t.model.get(e.id)&&t.options.class_check||t.options.class_uncheck),n=u()("<tr/>").append(u()("<td/>").append(i)).append(u()("<td/>").append(e.title)).on("click",function(){t.model.get("enabled")&&t.model.set(e.id,!t.model.get(e.id))});t.$table.append(n)}),this.$cover[this.model.get("enabled")?"hide":"show"]()}}),Dt=p.a.View.extend({initialize:function(t){this.options=o.a.defaults(t||{},{title:null,placement:"top",container:"body"}),this.uid=_.a.uid(),this.$target=this.options.container},show:function(t){var e=this;u()(this.$target).popover({title:"".concat(this.options.title," ").concat("<i class='fa fa-times-circle'/>"),placement:this.options.placement,content:t,html:!0,trigger:"manual"}),u()(this.$target).popover("show");var i=this,n=u()(this.$target.data("bs.popover").tip);n.find(".popover-header > i").on("click",function(){return e.hide()}),u()("body").on("mousedown.".concat(this.uid),function(t){u()(n).is(t.target)||0!==u()(n).has(t.target).length||i.hide()})},hide:function(){u()(this.$target).popover("dispose"),u()("body").off("mousedown.".concat(this.uid))}}),It=p.a.View.extend({initialize:function(t){this.model=new p.a.Model(t),this.setElement("<div/>"),this.render()},render:function(){var t=this.model.attributes,e=o.a.findWhere(t.list,{id:t.extension});this.extension_popup&&this.extension_popup.remove(),this.extension_popup=new Dt({title:t.title,placement:t.placement||"bottom",container:t.$el}),this.extension_popup.show(this._templateDescription(e))},_templateDescription:function(t){if(t.description){var e=t.description;return t.description_url&&(e+='&nbsp;(<a href="'.concat(t.description_url,'" target="_blank">read more</a>)')),e}return"There is no description available for this file extension."}}),Mt=i(17),Rt=p.a.View.extend({status_classes:{init:"upload-icon-button fa fa-trash-o",queued:"upload-icon fa fa-spinner fa-spin",running:"upload-icon fa fa-spinner fa-spin",warning:"upload-icon fa fa-spinner fa-spin",success:"upload-icon-button fa fa-check",error:"upload-icon-button fa fa-exclamation-triangle"},initialize:function(t,e){var i=this,n=this;this.app=t,this.list_extensions=t.list_extensions,this.model=e.model,this.setElement(this._template(e.model)),this.$mode=this.$(".upload-mode"),this.$title=this.$(".upload-title"),this.$text=this.$(".upload-text"),this.$size=this.$(".upload-size"),this.$info_text=this.$(".upload-info-text"),this.$info_progress=this.$(".upload-info-progress"),this.$text_content=this.$(".upload-text-content"),this.$settings=this.$(".upload-settings"),this.$symbol=this.$(".upload-symbol"),this.$progress_bar=this.$(".upload-progress-bar"),this.$percentage=this.$(".upload-percentage"),this.settings=new Dt({title:g()("Upload configuration"),container:this.$(".upload-settings"),placement:"bottom"});var a=this.app.select_genome.value(),s=this.app.select_extension.value();this.select_genome=new Mt.a.View({css:"upload-genome",data:n.app.list_genomes,container:this.$(".upload-genome"),value:a,onchange:function(t){n.model.set("genome",t)}}),this.select_extension=new Mt.a.View({css:"upload-extension",data:o.a.filter(this.list_extensions,function(t){return!t.composite_files}),container:this.$(".upload-extension"),value:s,onchange:function(t){n.model.set("extension",t)}}),this.model.set({genome:a,extension:s}),this.$symbol.on("click",function(){n._removeRow()}),this.$(".upload-extension-info").on("click",function(t){var e=i.upload_extension;e?e.extension_popup.visible?e.extension_popup.hide():(e.extension_popup.remove(),i._makeUploadExtensionsPopover(t)):i._makeUploadExtensionsPopover(t)}).on("mousedown",function(t){t.preventDefault()}),this.$settings.on("click",function(t){n._showSettings()}).on("mousedown",function(t){t.preventDefault()}),this.$text_content.on("change input",function(t){n.model.set({url_paste:u()(t.target).val(),file_size:u()(t.target).val().length})}),this.$title.on("change input",function(t){n.model.set({file_name:u()(t.target).val()})}),this.listenTo(this.model,"change:percentage",function(){n._refreshPercentage()}),this.listenTo(this.model,"change:status",function(){n._refreshStatus()}),this.listenTo(this.model,"change:info",function(){n._refreshInfo()}),this.listenTo(this.model,"change:genome",function(){n._refreshGenome()}),this.listenTo(this.model,"change:extension",function(){n._refreshExtension()}),this.listenTo(this.model,"change:file_size",function(){n._refreshFileSize()})},render:function(){this._refreshType(),this._refreshPercentage(),this._refreshStatus(),this._refreshInfo(),this._refreshGenome(),this._refreshExtension(),this._refreshFileSize()},remove:function(){this.select_genome.remove(),this.select_extension.remove(),p.a.View.prototype.remove.apply(this)},_refreshType:function(){var t=this.model.attributes;this.$title.val(o.a.escape(t.file_name)),this.$size.html(_.a.bytesToString(t.file_size)),this.$mode.removeClass().addClass("upload-mode").addClass("text-primary"),"new"==t.file_mode?(this.$text.css({width:"".concat(this.$el.width()-16,"px"),top:"".concat(this.$el.height()-8,"px")}).show(),this.$el.height(this.$el.height()-8+this.$text.height()+16),this.$mode.addClass("fa fa-edit")):"local"==t.file_mode?this.$mode.addClass("fa fa-laptop"):"ftp"==t.file_mode&&this.$mode.addClass("fa fa-folder-open-o")},_refreshExtension:function(){this.select_extension.value(this.model.get("extension"))},_refreshGenome:function(){this.select_genome.value(this.model.get("genome"))},_refreshInfo:function(){var t=this.model.get("info");t?this.$info_text.html("<strong>Warning: </strong>".concat(t)).show():this.$info_text.hide()},_refreshPercentage:function(){var t=parseInt(this.model.get("percentage"));this.$progress_bar.css({width:"".concat(t,"%")}),this.$percentage.html(100!=t?"".concat(t,"%"):"Adding to history...")},_refreshStatus:function(){var t=this.model.get("status");this.$symbol.removeClass().addClass("upload-symbol").addClass(this.status_classes[t]),this.model.set("enabled","init"==t);var e=this.model.get("enabled");this.$text_content.attr("disabled",!e),this.$title.attr("disabled",!e),e?(this.select_genome.enable(),this.select_extension.enable()):(this.select_genome.disable(),this.select_extension.disable()),this.$info_progress.show(),this.$el.removeClass().addClass("upload-row"),"success"==t?(this.$el.addClass("table-success"),this.$percentage.html("100%")):"error"==t?(this.$el.addClass("table-danger"),this.$info_progress.hide()):"warning"==t&&(this.$el.addClass("table-warning"),this.$info_progress.hide())},_refreshFileSize:function(){this.$size.html(_.a.bytesToString(this.model.get("file_size")))},_removeRow:function(){-1!==["init","success","error"].indexOf(this.model.get("status"))&&this.app.collection.remove(this.model)},_showSettings:function(){this.settings.show(new jt(this).$el)},_makeUploadExtensionsPopover:function(t){this.upload_extension=new It({$el:u()(t.target),title:this.select_extension.text(),extension:this.select_extension.value(),list:this.list_extensions})},_template:function(t){return'<tr id="upload-row-'.concat(t.id,'" class="upload-row">\n                    <td>\n                        <div class="upload-text-column">\n                            <div class="upload-mode"/>\n                            <input class="upload-title ml-2 border rounded"/>\n                            <div class="upload-text">\n                                <div class="upload-text-info">\n                                    Download data from the web by entering URLs (one per line) or directly paste content.\n                                </div>\n                                <textarea class="upload-text-content form-control"/>\n                            </div>\n                        </div>\n                    </td>\n                    <td>\n                        <div class="upload-size"/>\n                    </td>\n                    <td>\n                        <div class="upload-extension float-left mr-1"/>\n                        <div class="upload-extension-info upload-icon-button fa fa-search"/>\n                    </td>\n                    <td>\n                        <div class="upload-genome"/>\n                    </td>\n                    <td>\n                        <div class="upload-settings upload-icon-button fa fa-gear"/>\n                    </td>\n                    <td>\n                        <div class="upload-info">\n                            <div class="upload-info-text"/>\n                            <div class="upload-info-progress progress">\n                                <div class="upload-progress-bar progress-bar progress-bar-success"/>\n                                <div class="upload-percentage">0%</div>\n                            </div>\n                        </div>\n                    </td>\n                    <td>\n                        <div class="upload-symbol ').concat(this.status_classes.init,'"/>\n                    </td>\n                </tr>')}}),Et=p.a.View.extend({initialize:function(t){this.model=new p.a.Model({cls:"upload-ftp",class_add:"upload-icon-button fa fa-square-o",class_remove:"upload-icon-button fa fa-check-square-o",class_partial:"upload-icon-button fa fa-minus-square-o",help_enabled:!0,oidc_text:"<br/>If you are signed-in to Galaxy using a third-party identity and you <strong>don't have a Galaxy password</strong> please go to <a href=\"".concat(Object(f.getAppRoot)(),'user/reset_password" target="_blank">this</a> page and request a password for your Galaxy account.'),help_text:"This Galaxy server allows you to upload files via FTP. To upload some files, log in to the FTP server at <strong>".concat(t.ftp_upload_site,'</strong> using your Galaxy credentials.\n            For help visit the <a href="https://ftp.usegalaxy.eu" target="_blank">documentation</a>.'),collection:null,onchange:function(){},onadd:function(){},onremove:function(){}}).set(t),this.collection=this.model.get("collection"),Object(s.a)().config.enable_oidc&&this.model.set("help_text",this.model.get("help_text")+this.model.get("oidc_text")),this.setElement(this._template()),this.$content=this.$(".upload-ftp-content"),this.$wait=this.$(".upload-ftp-wait"),this.$help=this.$(".upload-ftp-help"),this.$number=this.$(".upload-ftp-number"),this.$disk=this.$(".upload-ftp-disk"),this.$body=this.$(".upload-ftp-body"),this.$warning=this.$(".upload-ftp-warning"),this.$select=this.$(".upload-ftp-select-all"),this.render()},render:function(){var t=this;this.$wait.show(),this.$content.hide(),this.$warning.hide(),this.$help.hide(),Tt.a.getRemoteFiles(function(e){t.model.set("ftp_files",e),t._index(),t._renderTable()},function(){t._renderTable()})},_renderTable:function(){var t=this,e=this.model.get("ftp_files");if(this.rows=[],e&&e.length>0){this.$body.empty();var i=0;o.a.each(e,function(e){t.rows.push(t._renderRow(e)),i+=e.size}),this.$number.html("".concat(e.length," files")),this.$disk.html(_.a.bytesToString(i,!0)),this.collection&&(this.$("._has_collection").show(),this.$select.addClass(this.model.get("class_add")).off().on("click",function(){t._all()}),this._refresh()),this.$content.show()}else this.$warning.show();this.model.get("help_enabled")&&this.$help.show(),this.$wait.hide()},_renderRow:function(t){var e=this,i=this.model.attributes,n=u()(this._templateRow(t)),a=n.find(".icon");if(this.$body.append(n),this.collection){var o=this.ftp_index[t.path];a.addClass(void 0===o?i.class_add:i.class_remove),n.on("click",function(){e._switch(a,t),e._refresh()})}else n.on("click",function(){i.onchange(t)});return a},_index:function(){var t=this;this.ftp_index={},this.collection&&this.collection.each(function(e){"ftp"==e.get("file_mode")&&(t.ftp_index[e.get("file_path")]=e.id)})},_all:function(){var t=this.model.attributes,e=this.model.get("ftp_files"),i=this.$select.hasClass(t.class_add);for(var n in e){var a=e[n],o=this.ftp_index[a.path];(void 0===o&&i||void 0!==o&&!i)&&this._switch(this.rows[n],a)}this._refresh()},_switch:function(t,e){t.removeClass();var i=this.model.attributes,n=this.ftp_index[e.path];if(void 0===n){var a=i.onadd(e);t.addClass(i.class_remove),this.ftp_index[e.path]=a}else i.onremove(n),t.addClass(i.class_add),this.ftp_index[e.path]=void 0},_refresh:function(){var t=o.a.reduce(this.ftp_index,function(t,e){return void 0!==e&&t++,t},0);this.$select.removeClass(),0==t?this.$select.addClass(this.model.get("class_add")):this.$select.addClass(t==this.rows.length?this.model.get("class_remove"):this.model.get("class_partial"))},_templateRow:function(t){return'<tr class="upload-ftp-row">\n                    <td class="_has_collection" style="display: none;">\n                        <div class="icon"/>\n                    </td>\n                    <td class="ftp-name">'.concat(o.a.escape(t.path),'</td>\n                    <td class="ftp-size">').concat(_.a.bytesToString(t.size),'</td>\n                    <td class="ftp-time">').concat(t.ctime,"</td>\n                </tr>")},_template:function(){return'<div class="'.concat(this.model.get("cls"),'">\n                    <div class="upload-ftp-wait fa fa-spinner fa-spin"/>\n                    <div class="upload-ftp-help">').concat(this.model.get("help_text"),'</div>\n                    <div class="upload-ftp-content">\n                        <span style="whitespace: nowrap; float: left;">Available files: </span>\n                        <span style="whitespace: nowrap; float: right;">\n                            <span class="upload-icon fa fa-file-text-o"/>\n                            <span class="upload-ftp-number"/>\n                            <span class="upload-icon fa fa-hdd-o"/>\n                            <span class="upload-ftp-disk"/>\n                        </span>\n                        <table class="grid" style="float: left;">\n                            <thead>\n                                <tr>\n                                    <th class="_has_collection" style="display: none;">\n                                        <div class="upload-ftp-select-all">\n                                    </th>\n                                    <th>Name</th>\n                                    <th>Size</th>\n                                    <th>Created</th>\n                                </tr>\n                            </thead>\n                            <tbody class="upload-ftp-body"/>\n                        </table>\n                    </div>\n                    <div class="upload-ftp-warning warningmessage">Your FTP directory does not contain any files.</div>\n                </div>')}}),Pt=p.a.View.extend({initialize:function(t){this.$container=t.$container,this.collection=t.collection,this.new_content=t.new_content,this.max=t.max||50,this.content_list={},this.$message=u()("<div/>").addClass("ui-limitloader").append("...only the first ".concat(this.max," entries are visible.")).hide(),this.$container.append(this.$message),this.listenTo(this.collection,"reset",this._reset,this),this.listenTo(this.collection,"add",this._refresh,this),this.listenTo(this.collection,"remove",this._remove,this)},_done:function(){var t=o.a.size(this.content_list)>this.max;return this.$message[t?"show":"hide"](),t},_reset:function(){o.a.each(this.content_list,function(t){t.remove()}),this.content_list={},this.$message.hide()},_remove:function(t){var e=t.id,i=this.content_list[e];i&&(i.remove(),delete this.content_list[e]),this._refresh()},_refresh:function(){if(!this._done())for(var t in this.collection.models){var e=this.collection.models[t];if(!this.content_list[e.id]){var i=this.new_content(e);if(this.content_list[e.id]=i,this._done())break}}}});!function(t){u.a.event.props.push("dataTransfer");var e=function(e){var i=t.extend({error_default:"Please make sure the file is available.",error_server:"Upload request failed.",error_login:"Uploads require you to log in.",error_retry:"Waiting for server to resume..."},e);console.debug(i);var n=new XMLHttpRequest;n.open("POST",i.url,!0),n.setRequestHeader("Cache-Control","no-cache"),n.setRequestHeader("X-Requested-With","XMLHttpRequest"),n.setRequestHeader("Accept","application/json"),n.onreadystatechange=function(){if(n.readyState==n.DONE)if(-1!==[502,0].indexOf(n.status)&&i.warning)i.warning(i.error_retry);else if(n.status<200||n.status>299){var t=n.statusText;403==n.status?t=i.error_login:0==n.status?t=i.error_server:t||(t=i.error_default),i.error("".concat(t," (").concat(n.status,")"))}else{var e=null;if(n.responseText)try{e=u.a.parseJSON(n.responseText)}catch(t){e=n.responseText}i.success(e)}},n.upload.addEventListener("progress",i.progress,!1),n.send(i.data)};t.uploadchunk=function(i){var n=t.extend({},{data:{},success:function(){},error:function(){},warning:function(){},progress:function(){},attempts:7e4,timeout:5e3,url:null,error_file:"File not provided.",error_attempt:"Maximum number of attempts reached.",error_tool:"Tool submission failed."},i),a=n.data;if(a.error_message)n.error(a.error_message);else{var o=a.files&&a.files[0];if(o){var s=o.file,r=n.attempts,l="".concat(n.session.id,"-").concat((new Date).valueOf(),"-").concat(s.size),c=n.session.chunk_upload_size;console.debug("Starting chunked uploads [size=".concat(c,"].")),function i(o){o=o||0;var d=s.mozSlice||s.webkitSlice||s.slice;if(d){var u=Math.min(o+c,s.size),h=s.size;console.debug("Submitting chunk at ".concat(o," bytes..."));var p=new FormData;p.append("session_id",l),p.append("session_start",o),p.append("session_chunk",d.bind(s)(o,u)),e({url:"".concat(Object(f.getAppRoot)(),"api/uploads"),data:p,success:function(e){var d=o+c;d<h?(r=n.attempts,i(d)):(console.debug("Upload completed."),a.payload.inputs=JSON.parse(a.payload.inputs),a.payload.inputs["files_0|file_data"]={session_id:l,name:s.name},a.payload.inputs=JSON.stringify(a.payload.inputs),t.ajax({url:"".concat(Object(f.getAppRoot)(),"api/tools"),method:"POST",data:a.payload,success:function(t){n.success(t)},error:function(t){var e=t&&t.responseJSON&&t.responseJSON.err_msg;n.error(e||n.error_tool)}}))},warning:function(t){--r>0?(console.debug("Retrying last chunk..."),n.warning(t),setTimeout(function(){return i(o)},n.timeout)):(console.debug(n.error_attempt),n.error(n.error_attempt))},error:function(t){console.debug(t),n.error(t)},progress:function(t){t.lengthComputable&&n.progress(Math.min(Math.round(100*(o+t.loaded)/s.size),100))}})}else n.error("Browser does not support chunked uploads.")}()}else n.error(n.error_file)}},t.uploadpost=function(i){var n=t.extend({},{data:{},success:function(){},error:function(){},progress:function(){},url:null,maxfilesize:2147483648,error_filesize:"File exceeds 2GB. Please use a FTP client."},i),a=n.data;if(a.error_message)n.error(a.error_message);else{var o=new FormData;for(var s in a.payload)o.append(s,a.payload[s]);var r=0;for(var l in a.files){var c=a.files[l];o.append(c.name,c.file,c.file.name),r+=c.file.size}r>n.maxfilesize?n.error(n.error_filesize):e({url:n.url,data:o,success:n.success,error:n.error,progress:function(t){t.lengthComputable&&n.progress(Math.round(100*t.loaded/t.total))}})}},t.fn.uploadinput=function(e){var i=t.extend({},{ondragover:function(){},ondragleave:function(){},onchange:function(){},multiple:!1},e),n=t('<input type="file" style="display: none" '.concat(i.multiple?"multiple":"","/>"));this.append(n.change(function(t){i.onchange(t.target.files),t.target.value=null}));var a=this.get(0);return a.addEventListener("drop",function(t){i.ondragleave(t),t.dataTransfer&&(i.onchange(t.dataTransfer.files),t.preventDefault())}),a.addEventListener("dragover",function(t){t.preventDefault(),i.ondragover(t)}),a.addEventListener("dragleave",function(t){t.stopPropagation(),i.ondragleave(t)}),{dialog:function(){n.trigger("click")}}},t.fn.uploadbox=function(e){var i=t.extend({},{dragover:function(){},dragleave:function(){},announce:function(t){},initialize:function(t){},progress:function(t,e){},success:function(t,e){},warning:function(t,e){},error:function(t,e){alert(e)},complete:function(){}},e),n={},a=null,s=0,r=0,l=!1,c=!1,d=t(this).uploadinput({multiple:!0,onchange:function(t){o.a.each(t,function(t){t.chunk_mode=!0}),u(t)},ondragover:e.ondragover,ondragleave:e.ondragleave});function u(t){if(t&&t.length&&!l){var e=void 0;return o.a.each(t,function(t,e){"new"!==t.mode&&o.a.filter(n,function(e){return e.name===t.name&&e.size===t.size}).length&&(t.duplicate=!0)}),o.a.each(t,function(t){t.duplicate||(e=String(s++),n[e]=t,i.announce(e,n[e]),r++)}),e}}function h(t){n[t]&&(delete n[t],r--)}return{select:function(){d.dialog()},add:u,remove:h,start:function(e){a=e,l||(l=!0,function e(){if(0==r||c)return c=!1,l=!1,void i.complete();l=!0;var o=-1;for(var s in n){o=s;break}var d=n[o];h(o);var u=t.uploadpost;d.chunk_mode&&a&&a.id&&a.chunk_upload_size&&a.chunk_upload_size>0&&(u=t.uploadchunk),u({url:i.url,data:i.initialize(o),session:a,success:function(t){i.success(o,t),e()},warning:function(t){i.warning(o,t)},error:function(t){i.error(o,t),e()},progress:function(t){i.progress(o,t)}})}())},stop:function(){c=!0},reset:function(t){for(t in n)h(t)},configure:function(e){return i=t.extend({},i,e)},compatible:function(){return window.File&&window.FormData&&window.XMLHttpRequest&&window.FileList}}}}(u.a);var Vt=p.a.View.extend({upload_size:0,collection:new At.Collection,counter:{announce:0,success:0,error:0,running:0,reset:function(){this.announce=this.success=this.error=this.running=0}},initialize:function(t){var e=this;this.app=t,this.options=t.options,this.list_extensions=t.list_extensions,this.list_genomes=t.list_genomes,this.ui_button=t.ui_button,this.ftp_upload_site=t.currentFtp(),this.setElement(this._template()),this.$uploadbox=this.$(".upload-box"),this.$uploadtable=this.$(".upload-table"),this.btnLocal=new v.a.Button({id:"btn-local",title:g()("Choose local file"),onclick:function(){e.uploadbox.select()},icon:"fa fa-laptop"}),this.btnFtp=new v.a.Button({id:"btn-ftp",title:g()("Choose FTP file"),onclick:function(){e._eventFtp()},icon:"fa fa-folder-open-o"}),this.btnCreate=new v.a.Button({id:"btn-new",title:"Paste/Fetch data",onclick:function(){e._eventCreate()},icon:"fa fa-edit"}),this.btnStart=new v.a.Button({id:"btn-start",title:g()("Start"),onclick:function(){e._eventStart()}}),this.btnStop=new v.a.Button({id:"btn-stop",title:g()("Pause"),onclick:function(){e._eventStop()}}),this.btnReset=new v.a.Button({id:"btn-reset",title:g()("Reset"),onclick:function(){e._eventReset()}}),this.btnClose=new v.a.Button({id:"btn-close",title:g()("Close"),onclick:function(){e.app.modal.hide()}}),o.a.each([this.btnLocal,this.btnFtp,this.btnCreate,this.btnStop,this.btnReset,this.btnStart,this.btnClose],function(t){e.$(".upload-buttons").prepend(t.$el)}),this.uploadbox=this.$uploadbox.uploadbox({url:this.app.options.upload_path,announce:function(t,i){e._eventAnnounce(t,i)},initialize:function(t){return e.app.toData([e.collection.get(t)],e.history_id)},progress:function(t,i){e._eventProgress(t,i)},success:function(t,i){e._eventSuccess(t,i)},error:function(t,i){e._eventError(t,i)},warning:function(t,i){e._eventWarning(t,i)},complete:function(){e._eventComplete()},ondragover:function(){e.$uploadbox.addClass("highlight")},ondragleave:function(){e.$uploadbox.removeClass("highlight")}}),this.ftp=new Dt({title:g()("FTP files"),container:this.btnFtp.$el}),this.select_extension=new Mt.a.View({css:"upload-footer-selection",container:this.$(".upload-footer-extension"),data:o.a.filter(this.list_extensions,function(t){return!t.composite_files}),value:this.options.default_extension,onchange:function(t){e._changeExtension(t)}}),this.$(".upload-footer-extension-info").on("click",function(t){new It({$el:u()(t.target),title:e.select_extension.text(),extension:e.select_extension.value(),list:e.list_extensions,placement:"top"})}).on("mousedown",function(t){t.preventDefault()}),this.select_genome=new Mt.a.View({css:"upload-footer-selection",container:this.$(".upload-footer-genome"),data:this.list_genomes,value:this.options.default_genome,onchange:function(t){e._changeGenome(t)}}),this.loader=new Pt({$container:this.$uploadbox,collection:this.collection,new_content:function(t){var i=new Rt(e,{model:t});return e.$uploadtable.find("> tbody:first").append(i.$el),i.render(),i}}),this.collection.on("remove",function(t){e._eventRemove(t)}),this.render()},render:function(){var t="";t=0===this.counter.announce?this.uploadbox.compatible()?"&nbsp;":"Browser does not support Drag & Drop. Try Firefox 4+, Chrome 7+, IE 10+, Opera 12+ or Safari 6+.":0===this.counter.running?"You added ".concat(this.counter.announce," file(s) to the queue. Add more files or click 'Start' to proceed."):"Please wait...".concat(this.counter.announce," out of ").concat(this.counter.running," remaining."),this.$(".upload-top-info").html(t);var e=0===this.counter.running&&this.counter.announce+this.counter.success+this.counter.error>0,i=0===this.counter.running&&this.counter.announce>0,n=0===this.counter.running,a=this.counter.announce+this.counter.success+this.counter.error>0;this.btnReset[e?"enable":"disable"](),this.btnStart[i?"enable":"disable"](),this.btnStart.$el[i?"addClass":"removeClass"]("btn-primary"),this.btnStop[this.counter.running>0?"enable":"disable"](),this.btnLocal[n?"enable":"disable"](),this.btnFtp[n?"enable":"disable"](),this.btnCreate[n?"enable":"disable"](),this.btnFtp.$el[this.ftp_upload_site?"show":"hide"](),this.$(".upload-table")[a?"show":"hide"](),this.$(".upload-helper")[a?"hide":"show"]()},_eventAnnounce:function(t,e){this.counter.announce++;var i=new At.Model({id:t,file_name:e.name,file_size:e.size,file_mode:e.mode||"local",file_path:e.path,file_data:e});this.render(),this.collection.add(i)},_eventProgress:function(t,e){var i=this.collection.get(t);i.set({percentage:e,status:"running",info:""}),this.ui_button.model.set("percentage",this._uploadPercentage(e,i.get("file_size")))},_eventSuccess:function(t,e){var i=Object(s.a)(),n=this.collection.get(t);n.set({percentage:100,status:"success"}),this.ui_button.model.set("percentage",this._uploadPercentage(100,n.get("file_size"))),this.upload_completed+=100*n.get("file_size"),this.counter.announce--,this.counter.success++,this.render(),i.currHistoryPanel.refreshContents()},_eventWarning:function(t,e){this.collection.get(t).set({status:"warning",info:e})},_eventError:function(t,e){var i=this.collection.get(t);i.set({percentage:100,status:"error",info:e}),this.ui_button.model.set({percentage:this._uploadPercentage(100,i.get("file_size")),status:"danger"}),this.upload_completed+=100*i.get("file_size"),this.counter.announce--,this.counter.error++,this.render()},_eventComplete:function(){this.collection.each(function(t){"queued"==t.get("status")&&t.set("status","init")}),this.counter.running=0,this.render()},_eventRemove:function(t){var e=t.get("status");"success"==e?this.counter.success--:"error"==e?this.counter.error--:this.counter.announce--,this.uploadbox.remove(t.id),this.render()},_eventFtp:function(){var t=this;this.ftp.show(new Et({collection:this.collection,ftp_upload_site:this.ftp_upload_site,onadd:function(e){return t.uploadbox.add([{mode:"ftp",name:e.path,size:e.size,path:e.path}])},onremove:function(e){t.collection.remove(e)}}).$el)},_eventCreate:function(){this.uploadbox.add([{name:"New File",size:0,mode:"new"}])},_eventStart:function(){if(0!==this.counter.announce&&0===this.counter.running){var t=this;this.upload_size=0,this.upload_completed=0,this.collection.each(function(e){"init"==e.get("status")&&(e.set("status","queued"),t.upload_size+=e.get("file_size"))}),this.ui_button.model.set({percentage:0,status:"success"}),this.counter.running=this.counter.announce,this.history_id=this.app.currentHistory(),this._uploadFtp();var e=Object(s.a)();this.uploadbox.start({id:e.user.id,chunk_upload_size:this.app.options.chunk_upload_size}),this.render()}},_eventStop:function(){this.counter.running>0&&(this.ui_button.model.set("status","info"),u()(".upload-top-info").html("Queue will pause after completing the current file..."),this.uploadbox.stop())},_eventReset:function(){0===this.counter.running&&(this.collection.reset(),this.counter.reset(),this.uploadbox.reset(),this.select_extension.value(this.options.default_extension),this.select_genome.value(this.options.default_genome),this.ui_button.model.set("percentage",0),this.render())},_changeExtension:function(t,e){var i=this;this.collection.each(function(n){"init"!=n.get("status")||n.get("extension")!=i.options.default_extension&&e||n.set("extension",t)})},_changeGenome:function(t,e){var i=this;this.collection.each(function(n){"init"!=n.get("status")||n.get("genome")!=i.options.default_genome&&e||n.set("genome",t)})},_uploadFtp:function(){var t=this,e=[];this.collection.each(function(i){"queued"==i.get("status")&&"ftp"==i.get("file_mode")&&(t.uploadbox.remove(i.id),e.push(i))}),e.length>0&&u.a.uploadpost({data:this.app.toData(e),url:this.app.options.upload_path,success:function(i){o.a.each(e,function(e){t._eventSuccess(e.id)})},error:function(i){o.a.each(e,function(e){t._eventError(e.id,i)})}})},_uploadPercentage:function(t,e){return(this.upload_completed+t*e)/this.upload_size},_template:function(){return'<div class="upload-view-default">\n                    <div class="upload-top">\n                        <div class="upload-top-info"/>\n                    </div>\n                    <div class="upload-box">\n                        <div class="upload-helper">\n                            <i class="fa fa-files-o"/>Drop files here\n                        </div>\n                        <table class="upload-table ui-table-striped" style="display: none;">\n                            <thead>\n                                <tr>\n                                    <th>Name</th>\n                                    <th>Size</th>\n                                    <th>Type</th>\n                                    <th>Genome</th>\n                                    <th>Settings</th>\n                                    <th>Status</th>\n                                    <th/>\n                                </tr>\n                            </thead>\n                            <tbody/>\n                        </table>\n                    </div>\n                    <div class="upload-footer">\n                        <span class="upload-footer-title">Type (set all):</span>\n                        <span class="upload-footer-extension"/>\n                        <span class="upload-footer-extension-info upload-icon-button fa fa-search"/>\n                        <span class="upload-footer-title">Genome (set all):</span>\n                        <span class="upload-footer-genome"/>\n                    </div>\n                    <div class="upload-buttons"/>\n                </div>'}}),Lt=p.a.View.extend({status_classes:{init:"upload-mode fa fa-exclamation text-primary",ready:"upload-mode fa fa-check text-success",running:"upload-mode fa fa-spinner fa-spin",success:"upload-mode fa fa-check",error:"upload-mode fa fa-exclamation-triangle"},initialize:function(t,e){var i=this;this.app=t,this.model=e.model,this.setElement(this._template()),this.$source=this.$(".upload-source"),this.$settings=this.$(".upload-settings"),this.$status=this.$(".upload-status"),this.$text=this.$(".upload-text"),this.$text_content=this.$(".upload-text-content"),this.$info_text=this.$(".upload-info-text"),this.$info_progress=this.$(".upload-info-progress"),this.$file_name=this.$(".upload-file-name"),this.$file_desc=this.$(".upload-file-desc"),this.$file_size=this.$(".upload-file-size"),this.$progress_bar=this.$(".upload-progress-bar"),this.$percentage=this.$(".upload-percentage"),this.uploadinput=this.$el.uploadinput({ondragover:function(){i.model.get("enabled")&&i.$el.addClass("alert-success")},ondragleave:function(){i.$el.removeClass("alert-success")},onchange:function(t){"running"!=i.model.get("status")&&t&&t.length>0&&(i.model.reset({file_data:t[0],file_name:t[0].name,file_size:t[0].size,file_mode:t[0].mode||"local"}),i._refreshReady())}}),this.button_menu=new v.a.ButtonMenu({icon:"fa-caret-down",title:g()("Select"),pull:"left"}),this.$source.append(this.button_menu.$el),this.button_menu.addMenu({icon:"fa-laptop",title:g()("Choose local file"),onclick:function(){i.uploadinput.dialog()}}),this.app.ftp_upload_site&&this.button_menu.addMenu({icon:"fa-folder-open-o",title:g()("Choose FTP file"),onclick:function(){i._showFtp()}}),this.button_menu.addMenu({icon:"fa-edit",title:"Paste/Fetch data",onclick:function(){i.model.reset({file_mode:"new",file_name:"New File"})}}),this.ftp=new Dt({title:"Select a file",container:this.$source.find(".dropdown"),placement:"right"}),this.settings=new Dt({title:g()("Upload configuration"),container:this.$settings,placement:"bottom"}),this.$text_content.on("change input",function(t){i.model.set({url_paste:u()(t.target).val(),file_size:u()(t.target).val().length}),i._refreshReady()}),this.$settings.on("click",function(t){i._showSettings()}).on("mousedown",function(t){t.preventDefault()}),this.listenTo(this.model,"change:percentage",function(){i._refreshPercentage()}),this.listenTo(this.model,"change:status",function(){i._refreshStatus()}),this.listenTo(this.model,"change:info",function(){i._refreshInfo()}),this.listenTo(this.model,"change:file_name",function(){i._refreshFileName()}),this.listenTo(this.model,"change:file_mode",function(){i._refreshMode()}),this.listenTo(this.model,"change:file_size",function(){i._refreshFileSize()}),this.listenTo(this.model,"remove",function(){i.remove()}),this.app.collection.on("reset",function(){i.remove()})},render:function(){this.$el.attr("id","upload-row-".concat(this.model.id)),this.$file_name.html(o.a.escape(this.model.get("file_name")||"-")),this.$file_desc.html(this.model.get("file_desc")||"Unavailable"),this.$file_size.html(_.a.bytesToString(this.model.get("file_size"))),this.$status.removeClass().addClass(this.status_classes.init)},remove:function(){p.a.View.prototype.remove.apply(this)},_refreshReady:function(){this.app.collection.each(function(t){t.set("status",t.get("file_size")>0?"ready":"init")})},_refreshMode:function(){"new"==this.model.get("file_mode")?(this.height=this.$el.height(),this.$text.css({width:"".concat(this.$el.width()-16,"px"),top:"".concat(this.$el.height()-8,"px")}).show(),this.$el.height(this.$el.height()-8+this.$text.height()+16),this.$text_content.val("").trigger("keyup")):(this.$el.height(this.height),this.$text.hide())},_refreshInfo:function(){var t=this.model.get("info");t?this.$info_text.html("<strong>Failed: </strong>".concat(t)).show():this.$info_text.hide()},_refreshPercentage:function(){var t=parseInt(this.model.get("percentage"));0!=t?this.$progress_bar.css({width:"".concat(t,"%")}):(this.$progress_bar.addClass("no-transition"),this.$progress_bar.css({width:"0%"}),this.$progress_bar[0].offsetHeight,this.$progress_bar.removeClass("no-transition")),this.$percentage.html(100!=t?"".concat(t,"%"):"Adding to history...")},_refreshStatus:function(){var t=this.model.get("status");this.$status.removeClass().addClass(this.status_classes[t]),this.model.set("enabled","running"!=t),this.$text_content.attr("disabled",!this.model.get("enabled")),this.$el.removeClass("table-success table-danger table-warning"),"running"!=t&&"ready"!=t||this.model.set("percentage",0),this.$source.find(".button")["running"==t?"addClass":"removeClass"]("disabled"),"success"==t&&(this.$el.addClass("table-success"),this.model.set("percentage",100),this.$percentage.html("100%")),"error"==t?(this.$el.addClass("table-danger"),this.model.set("percentage",0),this.$info_progress.hide(),this.$info_text.show()):(this.$info_progress.show(),this.$info_text.hide())},_refreshFileName:function(){this.$file_name.html(this.model.get("file_name")||"-")},_refreshFileSize:function(){this.$file_size.html(_.a.bytesToString(this.model.get("file_size")))},_showFtp:function(){var t=this;this.ftp.show(new Et({ftp_upload_site:this.app.ftp_upload_site,onchange:function(e){t.ftp.hide(),"running"!=t.model.get("status")&&e&&(t.model.reset({file_mode:"ftp",file_name:e.path,file_size:e.size,file_path:e.path}),t._refreshReady())}}).$el)},_showSettings:function(){this.settings.show(new jt(this).$el)},_template:function(){return'<tr class="upload-row">\n                <td>\n                    <div class="upload-source"/>\n                    <div class="upload-text-column">\n                        <div class="upload-text">\n                            <div class="upload-text-info">Download data from the web by entering a URL (one per line) or directly paste content.</div>\n                            <textarea class="upload-text-content form-control"/>\n                        </div>\n                    </div>\n                </td>\n                <td>\n                    <div class="upload-status"/>\n                </td>\n                <td>\n                    <div class="upload-file-desc upload-title"/>\n                </td>\n                <td>\n                    <div class="upload-file-name upload-title"/>\n                </td>\n                <td>\n                    <div class="upload-file-size upload-size"/>\n                </td>\n                <td>\n                    <div class="upload-settings upload-icon-button fa fa-gear"/>\n                </td>\n                <td>\n                    <div class="upload-info">\n                        <div class="upload-info-text"/>\n                        <div class="upload-info-progress progress">\n                            <div class="upload-progress-bar progress-bar progress-bar-success"/>\n                            <div class="upload-percentage">0%</div>\n                        </div>\n                    </div>\n                </td>\n            </tr>'}}),zt=p.a.View.extend({collection:new At.Collection,initialize:function(t){var e=this;this.app=t,this.options=t.options,this.list_extensions=t.list_extensions,this.list_genomes=t.list_genomes,this.ftp_upload_site=t.currentFtp(),this.setElement(this._template()),this.btnReset=new v.a.Button({id:"btn-reset",title:g()("Reset"),onclick:function(){e._eventReset()}}),this.btnStart=new v.a.Button({title:g()("Start"),onclick:function(){e._eventStart()}}),this.btnClose=new v.a.Button({title:g()("Close"),onclick:function(){e.app.modal.hide()}}),o.a.each([this.btnReset,this.btnStart,this.btnClose],function(t){e.$(".upload-buttons").prepend(t.$el)}),this.select_extension=new Mt.a.View({css:"upload-footer-selection",container:this.$(".upload-footer-extension"),data:o.a.filter(this.list_extensions,function(t){return t.composite_files}),onchange:function(t){e.collection.reset();var i=o.a.findWhere(e.list_extensions,{id:t});i&&i.composite_files&&o.a.each(i.composite_files,function(t){e.collection.add({id:e.collection.size(),file_desc:t.description||t.name,optional:t.optional})})}}),this.$(".upload-footer-extension-info").on("click",function(t){new It({$el:u()(t.target),title:e.select_extension.text(),extension:e.select_extension.value(),list:e.list_extensions,placement:"top"})}).on("mousedown",function(t){t.preventDefault()}),this.select_genome=new Mt.a.View({css:"upload-footer-selection",container:this.$(".upload-footer-genome"),data:this.list_genomes,value:this.options.default_genome}),this.listenTo(this.collection,"add",function(t){e._eventAnnounce(t)}),this.listenTo(this.collection,"change add",function(){e.render()}),this.select_extension.options.onchange(this.select_extension.value()),this.render()},render:function(){var t=this.collection.first();t&&"running"==t.get("status")?(this.select_genome.disable(),this.select_extension.disable()):(this.select_genome.enable(),this.select_extension.enable()),this.collection.where({status:"ready"}).length+this.collection.where({optional:!0}).length==this.collection.length&&this.collection.length>0?(this.btnStart.enable(),this.btnStart.$el.addClass("btn-primary")):(this.btnStart.disable(),this.btnStart.$el.removeClass("btn-primary")),this.$(".upload-table")[this.collection.length>0?"show":"hide"]()},_eventAnnounce:function(t){var e=new Lt(this,{model:t});this.$(".upload-table > tbody:first").append(e.$el),this.$(".upload-table")[this.collection.length>0?"show":"hide"](),e.render()},_eventStart:function(){var t=this;this.collection.each(function(e){e.set({genome:t.select_genome.value(),extension:t.select_extension.value()})}),u.a.uploadpost({url:this.app.options.upload_path,data:this.app.toData(this.collection.filter()),success:function(e){t._eventSuccess(e)},error:function(e){t._eventError(e)},progress:function(e){t._eventProgress(e)}})},_eventReset:function(){0==this.collection.where({status:"running"}).length&&(this.collection.reset(),this.select_extension.value(this.options.default_extension),this.select_genome.value(this.options.default_genome),this.render())},_eventProgress:function(t){this.collection.each(function(e){e.set("percentage",t)})},_eventSuccess:function(t){var e=Object(s.a)();this.collection.each(function(t){t.set("status","success")}),e.currHistoryPanel.refreshContents()},_eventError:function(t){this.collection.each(function(e){e.set({status:"error",info:t})})},_template:function(){return'<div class="upload-view-composite">\n                <div class="upload-top">\n                    <div class="upload-top-info">&nbsp;</div>\n                </div>\n                <div class="upload-box">\n                    <table class="upload-table ui-table-striped" style="display: none;">\n                        <thead>\n                            <tr>\n                                <th/>\n                                <th/>\n                                <th>Description</th>\n                                <th>Name</th>\n                                <th>Size</th>\n                                <th>Settings</th>\n                                <th>Status</th>\n                            </tr>\n                        </thead>\n                        <tbody/>\n                    </table>\n                </div>\n                <div class="upload-footer">\n                    <span class="upload-footer-title">Composite Type:</span>\n                    <span class="upload-footer-extension"/>\n                    <span class="upload-footer-extension-info upload-icon-button fa fa-search"/>\n                    <span class="upload-footer-title">Genome/Build:</span>\n                    <span class="upload-footer-genome"/>\n                </div>\n                <div class="upload-buttons"/>\n            </div>'}}),Nt=p.a.View.extend({status_classes:{init:"upload-icon-button fa fa-trash-o",queued:"upload-icon fa fa-spinner fa-spin",running:"upload-icon fa fa-spinner fa-spin",success:"upload-icon-button fa fa-check",error:"upload-icon-button fa fa-exclamation-triangle"},initialize:function(t,e){var i=this;this.app=t,this.model=e.model,this.setElement(this._template(e.model)),this.$mode=this.$(".upload-mode"),this.$title=this.$(".upload-title-extended"),this.$text=this.$(".upload-text"),this.$size=this.$(".upload-size"),this.$info_text=this.$(".upload-info-text"),this.$info_progress=this.$(".upload-info-progress"),this.$text_content=this.$(".upload-text-content"),this.$symbol=this.$(".upload-symbol"),this.$progress_bar=this.$(".upload-progress-bar"),this.$percentage=this.$(".upload-percentage"),this.settings=new Dt({title:g()("Upload configuration"),container:this.$(".upload-settings"),placement:"bottom"}),this.$symbol.on("click",function(){i._removeRow()}),this.$text_content.on("change input",function(t){i.model.set({url_paste:u()(t.target).val(),file_size:u()(t.target).val().length})}),this.listenTo(this.model,"change:percentage",function(){i._refreshPercentage()}),this.listenTo(this.model,"change:status",function(){i._refreshStatus()}),this.listenTo(this.model,"change:info",function(){i._refreshInfo()}),this.listenTo(this.model,"change:file_size",function(){i._refreshFileSize()}),this.listenTo(this.model,"remove",function(){i.remove()}),this.app.collection.on("reset",function(){i.remove()})},render:function(){var t=this.model.attributes;this.$title.html(o.a.escape(t.file_name)),this.$size.html(_.a.bytesToString(t.file_size)),this.$mode.removeClass().addClass("upload-mode").addClass("text-primary"),"new"==t.file_mode?(this.$text.css({width:"".concat(this.$el.width()-16,"px"),top:"".concat(this.$el.height()-8,"px")}).show(),this.$el.height(this.$el.height()-8+this.$text.height()+16),this.$mode.addClass("fa fa-edit")):"local"==t.file_mode?this.$mode.addClass("fa fa-laptop"):"ftp"==t.file_mode&&this.$mode.addClass("fa fa-folder-open-o")},_refreshInfo:function(){var t=this.model.get("info");t?this.$info_text.html("<strong>Failed: </strong>".concat(t)).show():this.$info_text.hide()},_refreshPercentage:function(){var t=parseInt(this.model.get("percentage"));this.$progress_bar.css({width:"".concat(t,"%")}),this.$percentage.html(100!=t?"".concat(t,"%"):"Adding to history...")},_refreshStatus:function(){var t=this.model.get("status");this.$symbol.removeClass().addClass("upload-symbol").addClass(this.status_classes[t]),this.model.set("enabled","init"==t);var e=this.model.get("enabled");this.$text_content.attr("disabled",!e),"success"==t&&(this.$el.addClass("table-success"),this.$percentage.html("100%")),"error"==t&&(this.$el.addClass("table-danger"),this.$info_progress.hide())},_refreshFileSize:function(){this.$size.html(_.a.bytesToString(this.model.get("file_size")))},_removeRow:function(){-1!==["init","success","error"].indexOf(this.model.get("status"))&&this.app.collection.remove(this.model)},_showSettings:function(){this.settings.show(new jt(this).$el)},_template:function(t){return'<tr id="upload-row-'.concat(t.id,'" class="upload-row"><td><div class="upload-text-column"><div class="upload-mode"/><div class="upload-title-extended"/><div class="upload-text"><div class="upload-text-info">Download data from the web by entering URLs (one per line) or directly paste content.</div><textarea class="upload-text-content form-control"/></div></div></td><td><div class="upload-size"/></td><td><div class="upload-info"><div class="upload-info-text"/><div class="upload-info-progress progress"><div class="upload-progress-bar progress-bar progress-bar-success"/><div class="upload-percentage">0%</div></div></div></td><td><div class="upload-symbol ').concat(this.status_classes.init,'"/></td></tr>')}}),Ft=p.a.View.extend({upload_size:0,collection:new At.Collection,counter:{announce:0,success:0,error:0,running:0,reset:function(){this.announce=this.success=this.error=this.running=0}},initialize:function(t){var e=this;this.app=t,this.options=t.options,this.list_extensions=t.list_extensions,this.list_genomes=t.list_genomes,this.ui_button=t.ui_button,this.ftp_upload_site=t.currentFtp(),this.setElement(this._template()),this.btnLocal=new v.a.Button({id:"btn-local",title:g()("Choose local files"),onclick:function(){e.uploadbox.select()},icon:"fa fa-laptop"}),this.btnFtp=new v.a.Button({id:"btn-ftp",title:g()("Choose FTP files"),onclick:function(){e._eventFtp()},icon:"fa fa-folder-open-o"}),this.btnCreate=new v.a.Button({id:"btn-new",title:"Paste/Fetch data",onclick:function(){e._eventCreate()},icon:"fa fa-edit"}),this.btnStart=new v.a.Button({id:"btn-start",title:g()("Start"),onclick:function(){e._eventStart()}}),this.btnBuild=new v.a.Button({id:"btn-build",title:g()("Build"),onclick:function(){e._eventBuild()}}),this.btnStop=new v.a.Button({id:"btn-stop",title:g()("Pause"),onclick:function(){e._eventStop()}}),this.btnReset=new v.a.Button({id:"btn-reset",title:g()("Reset"),onclick:function(){e._eventReset()}}),this.btnClose=new v.a.Button({id:"btn-close",title:g()("Close"),onclick:function(){e.app.modal.hide()}}),o.a.each([this.btnLocal,this.btnFtp,this.btnCreate,this.btnStop,this.btnReset,this.btnStart,this.btnBuild,this.btnClose],function(t){e.$(".upload-buttons").prepend(t.$el)}),this.uploadbox=this.$(".upload-box").uploadbox({url:this.app.options.upload_path,announce:function(t,i){e._eventAnnounce(t,i)},initialize:function(t){return e.app.toData([e.collection.get(t)],e.history_id)},progress:function(t,i){e._eventProgress(t,i)},success:function(t,i){e._eventSuccess(t,i)},error:function(t,i){e._eventError(t,i)},complete:function(){e._eventComplete()},ondragover:function(){e.$(".upload-box").addClass("highlight")},ondragleave:function(){e.$(".upload-box").removeClass("highlight")}}),this.ftp=new Dt({title:g()("FTP files"),container:this.btnFtp.$el}),this.select_extension=new Mt.a.View({container:this.$(".upload-footer-extension"),data:o.a.filter(this.list_extensions,function(t){return!t.composite_files}),value:this.options.default_extension,onchange:function(t){e.updateExtension(t)}}),this.collectionType="list",this.select_collection=new Mt.a.View({container:this.$(".upload-footer-collection-type"),data:[{id:"list",text:"List"},{id:"paired",text:"Paired"},{id:"list:paired",text:"List of Pairs"}],value:"list",onchange:function(t){e.updateCollectionType(t)}}),this.$(".upload-footer-extension-info").on("click",function(t){new It({$el:u()(t.target),title:e.select_extension.text(),extension:e.select_extension.value(),list:e.list_extensions,placement:"top"})}).on("mousedown",function(t){t.preventDefault()}),this.select_genome=new Mt.a.View({css:"upload-footer-selection",container:this.$(".upload-footer-genome"),data:this.list_genomes,value:this.options.default_genome,onchange:function(t){e.updateGenome(t)}}),this.collection.on("remove",function(t){e._eventRemove(t)}),this._updateScreen()},_eventAnnounce:function(t,e){this.counter.announce++;var i=new At.Model({id:t,file_name:e.name,file_size:e.size,file_mode:e.mode||"local",file_path:e.path,file_data:e,extension:this.select_extension.value(),genome:this.select_genome.value()});this.collection.add(i);var n=new Nt(this,{model:i});this.$(".upload-table > tbody:first").append(n.$el),this._updateScreen(),n.render()},_eventProgress:function(t,e){var i=this.collection.get(t);i.set("percentage",e),this.ui_button.model.set("percentage",this._uploadPercentage(e,i.get("file_size")))},_eventSuccess:function(t,e){var i=o.a.pluck(e.outputs,"hid"),n=this.collection.get(t);n.set({percentage:100,status:"success",hids:i}),this.ui_button.model.set("percentage",this._uploadPercentage(100,n.get("file_size"))),this.upload_completed+=100*n.get("file_size"),this.counter.announce--,this.counter.success++,this._updateScreen(),Object(s.a)().currHistoryPanel.refreshContents()},_eventError:function(t,e){var i=this.collection.get(t);i.set({percentage:100,status:"error",info:e}),this.ui_button.model.set({percentage:this._uploadPercentage(100,i.get("file_size")),status:"danger"}),this.upload_completed+=100*i.get("file_size"),this.counter.announce--,this.counter.error++,this._updateScreen()},_eventComplete:function(){this.collection.each(function(t){"queued"==t.get("status")&&t.set("status","init")}),this.counter.running=0,this._updateScreen()},_eventBuild:function(){var t=Object(s.a)(),e=[];o.a.forEach(this.collection.models,function(t){e.push.apply(e,t.get("hids"))});var i=o.a.map(e,function(e){return t.currHistoryPanel.collection.getByHid(e)}),n=new t.currHistoryPanel.collection.constructor(i);n.historyId=t.currHistoryPanel.collection.historyId,t.currHistoryPanel.buildCollection(this.collectionType,n,!0),this.counter.running=0,this._updateScreen(),this._eventReset(),this.app.modal.hide()},_eventRemove:function(t){var e=t.get("status");"success"==e?this.counter.success--:"error"==e?this.counter.error--:this.counter.announce--,this.uploadbox.remove(t.id),this._updateScreen()},_eventFtp:function(){var t=this;this.ftp.show(new Et({collection:this.collection,ftp_upload_site:this.ftp_upload_site,onadd:function(e){return t.uploadbox.add([{mode:"ftp",name:e.path,size:e.size,path:e.path}])},onremove:function(e){t.collection.remove(e)}}).$el)},_eventCreate:function(){this.uploadbox.add([{name:"New File",size:0,mode:"new"}])},_eventStart:function(){if(!(0==this.counter.announce||this.counter.running>0)){var t=this;this.upload_size=0,this.upload_completed=0,this.collection.each(function(e){"init"==e.get("status")&&(e.set("status","queued"),t.upload_size+=e.get("file_size"))}),this.ui_button.model.set({percentage:0,status:"success"}),this.counter.running=this.counter.announce,this.history_id=this.app.currentHistory(),this.uploadbox.start(),this._updateScreen()}},_eventStop:function(){this.counter.running>0&&(this.ui_button.model.set("status","info"),u()(".upload-top-info").html("Queue will pause after completing the current file..."),this.uploadbox.stop())},_eventReset:function(){0==this.counter.running&&(this.collection.reset(),this.counter.reset(),this.uploadbox.reset(),this.select_extension.value(this.options.default_extension),this.select_genome.value(this.options.default_genome),this.ui_button.model.set("percentage",0),this._updateScreen())},updateExtension:function(t,e){var i=this;this.collection.each(function(n){"init"!=n.get("status")||n.get("extension")!=i.options.default_extension&&e||n.set("extension",t)})},updateCollectionType:function(t){this.collectionType=t},updateGenome:function(t,e){var i=this;this.collection.each(function(n){"init"!=n.get("status")||n.get("genome")!=i.options.default_genome&&e||n.set("genome",t)})},_updateScreen:function(){var t="";t=0==this.counter.announce?this.uploadbox.compatible()?"&nbsp;":"Browser does not support Drag & Drop. Try Firefox 4+, Chrome 7+, IE 10+, Opera 12+ or Safari 6+.":0==this.counter.running?"You added ".concat(this.counter.announce," file(s) to the queue. Add more files or click 'Start' to proceed."):"Please wait...".concat(this.counter.announce," out of ").concat(this.counter.running," remaining."),this.$(".upload-top-info").html(t);var e=0==this.counter.running&&this.counter.announce+this.counter.success+this.counter.error>0,i=0==this.counter.running&&this.counter.announce>0,n=0==this.counter.running&&0==this.counter.announce&&this.counter.success>0&&0==this.counter.error,a=0==this.counter.running,o=this.counter.announce+this.counter.success+this.counter.error>0;this.btnReset[e?"enable":"disable"](),this.btnStart[i?"enable":"disable"](),this.btnStart.$el[i?"addClass":"removeClass"]("btn-primary"),this.btnBuild[n?"enable":"disable"](),this.btnBuild.$el[n?"addClass":"removeClass"]("btn-primary"),this.btnStop[this.counter.running>0?"enable":"disable"](),this.btnLocal[a?"enable":"disable"](),this.btnFtp[a?"enable":"disable"](),this.btnCreate[a?"enable":"disable"](),this.btnFtp.$el[this.ftp_upload_site?"show":"hide"](),this.$(".upload-table")[o?"show":"hide"](),this.$(".upload-helper")[o?"hide":"show"]()},_uploadPercentage:function(t,e){return(this.upload_completed+t*e)/this.upload_size},_template:function(){return'<div class="upload-view-default">\n                <div class="upload-top">\n                    <div class="upload-top-info"/>\n                </div>\n                <div class="upload-box">\n                    <div class="upload-helper">\n                        <i class="fa fa-files-o"/>Drop files here\n                    </div>\n                    <table class="upload-table ui-table-striped" style="display: none;">\n                        <thead>\n                            <tr>\n                                <th>Name</th>\n                                <th>Size</th>\n                                <th>Status</th>\n                                <th/>\n                            </tr>\n                        </thead>\n                        <tbody/>\n                    </table>\n                </div>\n                <div class="upload-footer">\n                    <span class="upload-footer-title">Collection Type:</span>\n                    <span class="upload-footer-collection-type"/>\n                    <span class="upload-footer-title">File Type:</span>\n                    <span class="upload-footer-extension"/>\n                    <span class="upload-footer-extension-info upload-icon-button fa fa-search"/>\n                    <span class="upload-footer-title">Genome (set all):</span>\n                    <span class="upload-footer-genome"/>\n                </div>\n                <div class="upload-buttons"/>\n            </div>'}}),Ht=p.a.View.extend({initialize:function(t){var e=this;this.app=t,this.options=t.options,this.ftpFiles=[],this.ftpUploadSite=t.currentFtp(),this.setElement(this._template()),this.btnBuild=new v.a.Button({id:"btn-build",title:g()("Build"),onclick:function(){e._eventBuild()}}),this.btnBuild.$el.addClass("btn-primary"),this.btnReset=new v.a.Button({id:"btn-reset",title:g()("Reset"),onclick:function(){return e._eventReset()}}),this.btnClose=new v.a.Button({id:"btn-close",title:g()("Close"),onclick:function(){return e.app.modal.hide()}}),o.a.each([this.btnReset,this.btnBuild,this.btnClose],function(t){e.$(".upload-buttons").prepend(t.$el)});this.dataType="datasets",this.dataTypeView=new Mt.a.View({css:"upload-footer-selection",container:this.$(".rule-data-type"),data:[{id:"datasets",text:"Datasets"},{id:"collections",text:"Collection(s)"}],value:this.dataType,onchange:function(t){e.dataType=t}});var i=[{id:"paste",text:"Pasted Table"},{id:"dataset",text:"History Dataset"}];this.ftpUploadSite&&i.push({id:"ftp",text:"FTP Directory"}),this.selectionType="paste",this.selectionTypeView=new Mt.a.View({css:"upload-footer-selection",container:this.$(".rule-select-type"),data:i,value:this.selectionType,onchange:function(t){e.selectionType=t,e._renderSelectedType()}}),this.selectedDatasetId=null,this.$sourceContent=this.$(".upload-rule-source-content"),this.$sourceContent.on("change keyup paste",function(){e._updateBuildState()}),this._renderSelectedType()},_renderSelectedType:function(){var t=this,e=this.selectionType,i=Object(s.a)();if("dataset"==e)if(this.datasetSelectorView)this.datasetSelectorView.value(null);else{this.selectedDatasetId=null;var n=(i&&i.currHistoryPanel&&i.currHistoryPanel.model).contents.models,a=[],r=!0,l=!1,c=void 0;try{for(var d,u=n[Symbol.iterator]();!(r=(d=u.next()).done);r=!0){var h=d.value.attributes;"dataset"===h.history_content_type&&a.push({id:h.id,text:"".concat(h.hid,": ").concat(o.a.escape(h.name))})}}catch(t){l=!0,c=t}finally{try{r||null==u.return||u.return()}finally{if(l)throw c}}this.datasetSelectorView=new Mt.a.View({container:this.$(".dataset-selector"),data:a,placeholder:g()("Select a dataset"),onchange:function(e){t._onDataset(e)}})}else"ftp"==e&&Tt.a.getRemoteFiles(function(e){t._setPreview(e.map(function(t){return t.path}).join("\n")),t.ftpFiles=e});this._updateScreen()},_onDataset:function(t){var e=this,i=Object(s.a)();this.selectedDatasetId=t,t?$.a.get("".concat(Object(f.getAppRoot)(),"api/histories/").concat(i.currHistoryPanel.model.id,"/contents/").concat(t,"/display")).then(function(t){e._setPreview(t.data)}).catch(function(t){return console.log(t)}):this._setPreview("")},_eventReset:function(){this.datasetSelectorView&&this.datasetSelectorView.value(null),this.$sourceContent.val(""),this._updateScreen()},_eventBuild:function(){var t=this.$sourceContent.val();this._buildSelection(t)},_buildSelection:function(t){var e=this.selectionType,i={},n=Object(s.a)();"dataset"==e||"paste"==e?(i.selectionType="raw",i.content=t):"ftp"==e&&(i.selectionType="ftp",i.elements=this.ftpFiles,i.ftpUploadSite=this.ftpUploadSite),i.dataType=this.dataType,n.currHistoryPanel.buildCollection("rules",i,!0),this.app.modal.hide()},_setPreview:function(t){this.$sourceContent.val(t),this._updateScreen()},_updateScreen:function(){this._updateBuildState();var t=this.selectionType;this.$("#upload-rule-dataset-option")["dataset"==t?"show":"hide"](),this.$sourceContent.attr("disabled","paste"!==t)},_updateBuildState:function(){var t=this.$sourceContent.val();this.btnBuild[t?"enable":"disable"](),this.btnBuild.$el[t?"addClass":"removeClass"]("btn-primary")},_template:function(){return'\n            <div class="upload-view-default">\n                <div class="upload-top">\n                    <div class="upload-top-info">\n                        Tabular source data to extract collection files and metadata from\n                    </div>\n                </div>\n                <div class="upload-box" style="height: 335px;">\n                    <span style="width: 25%; display: inline; height: 100%" class="float-left">\n                        <div class="upload-rule-option">\n                            <div class="upload-rule-option-title">'.concat(g()("Upload data as"),':</div>\n                            <div class="rule-data-type" />\n                        </div>\n                        <div class="upload-rule-option">\n                            <div class="upload-rule-option-title">').concat(g()("Load tabular data from"),':</div>\n                            <div class="rule-select-type" />\n                        </div>\n                        <div id="upload-rule-dataset-option" class="upload-rule-option">\n                            <div class="upload-rule-option-title">').concat(g()("Select dataset to load"),':</div>\n                            <div class="dataset-selector" />\n                        </div>\n                    </span>\n                    <span style="display: inline; float: right; width: 75%; height: 300px">\n                    <textarea class="upload-rule-source-content form-control" style="height: 100%"></textarea>\n                    </span>\n                </div>\n                <div class="clear" />\n                \x3c!--\n                <div class="upload-footer">\n                </div>\n                --\x3e\n                <div class="upload-buttons"/>\n                </div>\n        ')}}),Ut=p.a.View.extend({options:{ftp_upload_site:"n/a",default_genome:Tt.a.DEFAULT_GENOME,default_extension:Tt.a.DEFAULT_EXTENSION,height:500,width:900,auto:Tt.a.AUTO_EXTENSION},list_extensions:[],list_genomes:[],initialize:function(t){var e=this;this.options=_.a.merge(t,this.options),this.ui_button=new $t.View({onclick:function(t){t.preventDefault(),e.show()},onunload:function(){var t=e.ui_button.model.get("percentage",0);if(t>0&&t<100)return"Several uploads are queued."}}),this.setElement(this.ui_button.$el),Tt.a.getUploadDatatypes(function(t){e.list_extensions=t},this.options.datatypes_disable_auto,this.options.auto),Tt.a.getUploadGenomes(function(t){e.list_genomes=t},this.default_genome)},show:function(){var t=Object(s.a)(),e=this;t.currHistoryPanel&&t.currHistoryPanel.model?(this.current_user=t.user.id,this.modal||(this.tabs=new xt.a.View,this.default_view=new Vt(this),this.tabs.add({id:"regular",title:g()("Regular"),$el:this.default_view.$el}),this.composite_view=new zt(this),this.tabs.add({id:"composite",title:g()("Composite"),$el:this.composite_view.$el}),this.collection_view=new Ft(this),this.tabs.add({id:"collection",title:g()("Collection"),$el:this.collection_view.$el}),this.rule_based_view=new Ht(this),this.tabs.add({id:"rule-based",title:g()("Rule-based"),$el:this.rule_based_view.$el}),this.modal=new b.a.View({title:g()("Download from web or upload from disk"),body:this.tabs.$el,height:this.options.height,width:this.options.width,closing_events:!0,title_separator:!1})),this.modal.show()):window.setTimeout(function(){e.show()},500)},currentHistory:function(){var t=Object(s.a)();return this.current_user&&t.currHistoryPanel.model.get("id")},currentFtp:function(){return this.current_user&&this.options.ftp_upload_site},toData:function(t,e){var i={payload:{tool_id:"upload1",history_id:e||this.currentHistory(),inputs:{}},files:[],error_message:null};if(t&&t.length>0){var n={file_count:t.length,dbkey:t[0].get("genome","?"),file_type:t[0].get("extension")||"auto"};for(var a in t){var o=t[a];if(o.set("status","running"),!(o.get("file_size")>0)){if(o.get("optional"))continue;i.error_message="Upload content incomplete.",o.set("status","error"),o.set("info",i.error_message);break}var s="files_".concat(a,"|");switch(n["".concat(s,"type")]="upload_dataset","New File"!=o.get("file_name")&&(n["".concat(s,"NAME")]=o.get("file_name")),n["".concat(s,"space_to_tab")]=o.get("space_to_tab")?"Yes":null,n["".concat(s,"to_posix_lines")]=o.get("to_posix_lines")?"Yes":null,n["".concat(s,"dbkey")]=o.get("genome",null),n["".concat(s,"file_type")]=o.get("extension",null),o.get("file_mode")){case"new":n["".concat(s,"url_paste")]=o.get("url_paste");break;case"ftp":n["".concat(s,"ftp_files")]=o.get("file_path");break;case"local":i.files.push({name:"".concat(s,"file_data"),file:o.get("file_data")})}}i.payload.inputs=JSON.stringify(n)}return i}}),Bt=i(18),qt=i.n(Bt),Gt=i(27),Wt=p.a.View.extend({initialize:function(t,e){var i=Object(s.a)(),a=Object(n.b)(),o=e.config;this.root=e.root,this.stored_workflow_menu_entries=o.stored_workflow_menu_entries||[];var r=new St.a.ToolSearch({hidden:!1}),l=new St.a.ToolCollection(o.toolbox);this.tool_panel=new St.a.ToolPanel({tool_search:r,tools:l,layout:o.toolbox_in_panel}),this.tool_panel_view=new St.a.ToolPanelView({model:this.tool_panel}),this.upload_button=new Ut({upload_path:o.nginx_upload_path||"".concat(a,"api/tools"),chunk_upload_size:o.chunk_upload_size,ftp_upload_site:o.ftp_upload_site,default_genome:o.default_genome,default_extension:o.default_extension});var c=[this.upload_button];i.user&&i.user.id&&(this.favorite_button=new Gt.a.ButtonLink({cls:"panel-header-button",title:g()("Show favorites"),icon:"fa fa-star-o",onclick:function(t){u()("#tool-search-query").val("#favorites").trigger("change")}}),c.push(this.favorite_button)),i.upload=this.upload_button,this.model=new p.a.Model({title:g()("Tools"),buttons:c}),this.setElement(this._template())},render:function(){var t=this;this.tool_panel.get("layout").size()>0&&(this.$el.find(".toolMenu").replaceWith(this.tool_panel_view.$el),this.tool_panel_view.render()),t.$("#internal-workflows").append(t._templateAllWorkflow({title:g()("All workflows"),href:"workflows/list"})),qt.a.each(this.stored_workflow_menu_entries,function(e){t.$("#internal-workflows").append(t._templateWorkflowLink({title:e.stored_workflow.name,href:"workflows/run?id=".concat(e.encoded_stored_workflow_id)}))})},_templateTool:function(t){var e=Object(n.b)();return'<div class="toolTitle">\n                    <a href="'.concat(e).concat(t.href,'" target="galaxy_main">\n                        ').concat(t.title,"\n                    </a>\n                </div>")},_templateAllWorkflow:function(t){var e=Object(n.b)();return'<div class="toolTitle">\n                    <a href="'.concat(e).concat(t.href,'">\n                        ').concat(t.title,"\n                    </a>\n                </div>")},_templateWorkflowLink:function(t){var e=Object(n.b)();return'<div class="toolTitle">\n                    <a class="'.concat(t.cls,'" href="').concat(e).concat(t.href,'">\n                        ').concat(qt.a.escape(t.title),"\n                    </a>\n                </div>")},_template:function(){return'<div class="toolMenuContainer">\n                    <div class="toolMenu" style="display: none">\n                        <div id="search-no-results" style="display: none; padding-top: 5px">\n                            <em>\n                                <strong>\n                                    '.concat(g()("Search did not match any tools."),'\n                                </strong>\n                            </em>\n                        </div>\n                    </div>\n                    <div class="toolSectionPad"/>\n                    <div class="toolSectionPad"/>\n                    <div class="toolSectionTitle" id="title_XXinternalXXworkflow">\n                        <span>\n                            ').concat(g()("Workflows"),'\n                        </span>\n                    </div>\n                        <div id="internal-workflows" class="toolSectionBody">\n                            <div class="toolSectionBg"/>\n                        </div>\n                </div>')},toString:function(){return"toolPanel"}}),Jt=i(89),Yt=[{html:g()("History Lists"),header:!0},{html:g()("Saved Histories"),href:"histories/list",target:"_top"},{html:g()("Histories Shared with Me"),href:"histories/list_shared",target:"_top"},{html:g()("Current History"),header:!0,anon:!0},{html:g()("Copy History"),func:function(){var t=Object(s.a)();Object(ht.a)(t.currHistoryPanel.model).done(function(){t.currHistoryPanel.loadCurrentHistory()})}},{html:g()("Share or Publish"),func:function(){var t=Object(s.a)();t&&t.currHistoryPanel&&t.router&&t.router.push("/histories/sharing?id=".concat(t.currHistoryPanel.model.id))}},{html:g()("Show Structure"),anon:!0,func:function(){var t=Object(s.a)();t&&t.currHistoryPanel&&t.router&&t.router.push("/histories/show_structure")}},{html:g()("Extract Workflow"),href:"workflow/build_from_current_history"},{html:g()("Delete"),anon:!0,func:function(){var t=Object(s.a)();t&&t.currHistoryPanel&&confirm(g()("Really delete the current history?"))&&t.currHistoryPanel.model._delete().done(function(){t.currHistoryPanel.loadCurrentHistory()})}},{html:g()("Delete Permanently"),purge:!0,anon:!0,func:function(){var t=Object(s.a)();t&&t.currHistoryPanel&&confirm(g()("Really delete the current history permanently? This cannot be undone."))&&t.currHistoryPanel.model.purge().done(function(){t.currHistoryPanel.loadCurrentHistory()})}},{html:g()("Make Data Private"),anon:!0,func:function(){var t=Object(s.a)();t&&t.currHistoryPanel&&confirm(g()("This will make all the data in this history private (excluding library datasets), and will set permissions such that all new data is created as private.  Any datasets within that are currently shared will need to be re-shared or published.  Are you sure you want to do this?"))&&u.a.post("".concat(t.root,"history/make_private"),{history_id:t.currHistoryPanel.model.id},function(){t.currHistoryPanel.loadCurrentHistory()})}},{html:g()("Dataset Actions"),header:!0,anon:!0},{html:g()("Copy Datasets"),href:"dataset/copy_datasets"},{html:g()("Dataset Security"),func:function(){var t=Object(s.a)();t&&t.currHistoryPanel&&t.router&&t.router.push("/histories/permissions?id=".concat(t.currHistoryPanel.model.id))}},{html:g()("Resume Paused Jobs"),href:"history/resume_paused_jobs?current=True",anon:!0},{html:g()("Collapse Expanded Datasets"),func:function(){var t=Object(s.a)();t&&t.currHistoryPanel&&t.currHistoryPanel.collapseAll()}},{html:g()("Unhide Hidden Datasets"),anon:!0,func:function(){var t=Object(s.a)();t&&t.currHistoryPanel&&confirm(g()("Really unhide all hidden datasets?"))&&u.a.post("".concat(Object(f.getAppRoot)(),"history/adjust_hidden"),{user_action:"unhide"},function(){t.currHistoryPanel.loadCurrentHistory()})}},{html:g()("Delete Hidden Datasets"),anon:!0,func:function(){var t=Object(s.a)();t&&t.currHistoryPanel&&confirm(g()("Really delete all hidden datasets?"))&&u.a.post("".concat(Object(f.getAppRoot)(),"history/adjust_hidden"),{user_action:"delete"},function(){t.currHistoryPanel.loadCurrentHistory()})}},{html:g()("Purge Deleted Datasets"),confirm:g()("Really delete all deleted datasets permanently? This cannot be undone."),href:"history/purge_deleted_datasets",purge:!0,anon:!0},{html:g()("Downloads"),header:!0},{html:g()("Export Tool Citations"),anon:!0,func:function(){var t=Object(s.a)();t&&t.currHistoryPanel&&t.router&&t.router.push("/histories/citations?id=".concat(t.currHistoryPanel.model.id))}},{html:g()("Export History to File"),href:"history/export_archive?preview=True",anon:!0}];y.a.load({type:"history-menu",async:!1,callback:function(t){var e=[];t.each(function(t){var i=t.toJSON();i.activate&&e.push({html:g()(i.config.title),anon:!0})}),e.length>0&&(e.unshift({html:g()("Webhooks"),header:!0}),u.a.merge(Yt,e))}});var Kt=function(t,e){var i=function(t,e,i){return o.a.clone(Yt).filter(function(n){return!(t&&!n.anon||!e&&n.purge||(n.href&&(n.href=i+n.href,n.target=n.target||"galaxy_main"),n.confirm&&(n.func=function(){var t=window.parent.document.getElementById("galaxy_main");confirm(n.confirm)&&t&&(t.src=n.href)}),0))})}(void 0===(e=e||{}).anonymous||e.anonymous,e.purgeAllowed||!1,Object(f.getAppRoot)());return new Jt.a(t,i)},Qt=i(78),Xt=W.a.SessionStorageModel.extend({defaults:{tagsEditorShown:!1,annotationEditorShown:!1,scrollPosition:0},toString:function(){return"HistoryViewPrefs(".concat(JSON.stringify(this.toJSON()),")")}});Xt.storageKey=function(){return"history-panel"};var Zt,te=Qt.a.HistoryViewEdit,ee=te.extend({className:"".concat(te.prototype.className," current-history-panel"),HDCAViewClass:te.prototype.HDCAViewClass.extend({foldoutStyle:"drilldown"}),emptyMsg:[g()("This history is empty"),". ",g()("You can "),'<a class="uploader-link" href="javascript:void(0)">',g()("load your own data"),"</a>",g()(" or "),'<a class="get-data-link" href="javascript:void(0)">',g()("get data from an external source"),"</a>"].join(""),initialize:function(t){t=t||{},this.preferences=new Xt(o.a.extend({id:Xt.storageKey()},o.a.pick(t,o.a.keys(Xt.prototype.defaults)))),te.prototype.initialize.call(this,t),this.panelStack=[],this.currentContentId=t.currentContentId||null},_setUpListeners:function(){te.prototype._setUpListeners.call(this);var t=this;this.on("new-model",function(){t.preferences.set("scrollPosition",0)})},loadCurrentHistory:function(){return this.loadHistory(null,{url:"".concat(Object(f.getAppRoot)(),"history/current_history_json")})},switchToHistory:function(t,e){return Object(s.a)().user.isAnonymous()?(this.trigger("error",g()("You must be logged in to switch histories"),g()("Anonymous user")),u.a.when()):this.loadHistory(t,{url:"".concat(Object(f.getAppRoot)(),"history/set_as_current?id=").concat(t)})},createNewHistory:function(t){return Object(s.a)().user.isAnonymous()?(this.trigger("error",g()("You must be logged in to create histories"),g()("Anonymous user")),u.a.when()):this.loadHistory(null,{url:"".concat(Object(f.getAppRoot)(),"history/create_new_current")})},setModel:function(t,e,i){return te.prototype.setModel.call(this,t,e,i),this.model&&this.model.id&&(this.log("checking for updates"),this.model.checkForUpdates()),this},_setUpModelListeners:function(){return te.prototype._setUpModelListeners.call(this),this.listenTo(this.model,{"change:nice_size change:size":function(){this.trigger("history-size-change",this,this.model,arguments)},"change:id":function(){this.once("loading-done",function(){this.model.checkForUpdates()})}})},_setUpCollectionListeners:function(){te.prototype._setUpCollectionListeners.call(this),this.listenTo(this.collection,"state:ready",function(t,e,i){t.get("visible")||this.collection.storage.includeHidden()||this.removeItemView(t)})},_setUpBehaviors:function(t){t=t||this.$el;var e=this;return te.prototype._setUpBehaviors.call(e,t),this._debouncedScrollCaptureHandler||(this._debouncedScrollCaptureHandler=o.a.debounce(function(){e.$el.is(":visible")&&e.preferences.set("scrollPosition",u()(this).scrollTop())},40)),e.$scrollContainer(t).off("scroll",this._debouncedScrollCaptureHandler).on("scroll",this._debouncedScrollCaptureHandler),e},_buildNewRender:function(){if(!this.model)return u()();var t=te.prototype._buildNewRender.call(this);return t.find(".search").prependTo(t.find("> .controls")),this._renderQuotaMessage(t),t},_renderQuotaMessage:function(t){return t=t||this.$el,u()(this.templates.quotaMsg({},this)).prependTo(t.find(".messages"))},_renderTags:function(t){return te.prototype._renderTags.call(this,t)},_renderAnnotation:function(t){var e=this;te.prototype._renderAnnotation.call(e,t),e.preferences.get("annotationEditorShown")&&e.annotationEditor.toggle(!0),e.listenTo(e.annotationEditor,"hiddenUntilActivated:shown hiddenUntilActivated:hidden",function(t){e.preferences.set("annotationEditorShown",t.hidden)})},_swapNewRender:function(t){te.prototype._swapNewRender.call(this,t);var e=this;return o.a.delay(function(){var t=e.preferences.get("scrollPosition");t&&e.scrollTo(t,0)},10),this},_attachItems:function(t){te.prototype._attachItems.call(this,t);return this.currentContentId&&this._setCurrentContentById(this.currentContentId),this},addItemView:function(t,e,i){var n=te.prototype.addItemView.call(this,t,e,i);return n&&this.panelStack.length?this._collapseDrilldownPanel():n},_setUpItemViewListeners:function(t){return te.prototype._setUpItemViewListeners.call(this,t),this.listenTo(t,{"expanded:drilldown":function(t,e){this._expandDrilldownPanel(e)},"collapsed:drilldown":function(t,e){this._collapseDrilldownPanel(e)}})},setCurrentContent:function(t){this.$(".history-content.current-content").removeClass("current-content"),t?(t.$el.addClass("current-content"),this.currentContentId=t.model.id):this.currentContentId=null},_setCurrentContentById:function(t){var e=this.viewFromModelId(t)||null;this.setCurrentContent(e)},_expandDrilldownPanel:function(t){this.panelStack.push(t),this.$controls().add(this.$list()).hide(),t.parentName=this.model.get("name"),t.delegateEvents().render().$el.appendTo(this.$el)},_collapseDrilldownPanel:function(t){this.panelStack.pop(),this.$controls().add(this.$list()).show()},events:o.a.extend(o.a.clone(te.prototype.events),{"click .uploader-link":function(t){Object(s.a)().upload.show(t)},"click .get-data-link":function(t){var e=u()(".toolMenuContainer");e.parent().scrollTop(0),e.find('span:contains("Get Data")').click()}}),listenToGalaxy:function(t){this.listenTo(t,{"center-frame:load":function(t){var e=t.fullpath,i=null;o.a.find({display:/datasets\/([a-f0-9]+)\/display/,edit:/datasets\/([a-f0-9]+)\/edit/,report_error:/dataset\/errors\?id=([a-f0-9]+)/,rerun:/tool_runner\/rerun\?id=([a-f0-9]+)/,show_params:/datasets\/([a-f0-9]+)\/show_params/},function(t,n){return i=o.a.result(e.match(t),1)}),this._setCurrentContentById(i?"dataset-".concat(i):null)},"center-panel:load":function(t){try{var e=t.model.attributes.dataset_id||null;if(null===e)throw"Invalid id";this._setCurrentContentById("dataset-".concat(e))}catch(t){this._setCurrentContentById()}},"activate-hda":function(t){this._setCurrentContentById("dataset-".concat(t))}})},connectToQuotaMeter:function(t){return t?(this.listenTo(t,"quota:over",this.showQuotaMessage),this.listenTo(t,"quota:under",this.hideQuotaMessage),this.on("rendered rendered:initial",function(){t&&t.isOverQuota()&&this.showQuotaMessage()}),this):this},clearMessages:function(t){var e=o.a.isUndefined(t)?this.$messages().children('[class$="message"]'):u()(t.currentTarget);return(e=e.not(".quota-message")).fadeOut(this.fxSpeed,function(){u()(this).remove()}),this},showQuotaMessage:function(){var t=this.$(".quota-message");t.is(":hidden")&&t.slideDown(this.fxSpeed)},hideQuotaMessage:function(){var t=this.$(".quota-message");t.is(":hidden")||t.slideUp(this.fxSpeed)},unhideHidden:function(){var t=this;return window.confirm(g()("Really unhide all hidden datasets?"))?t.model.contents._filterAndUpdate({visible:!1,deleted:"",purged:""},{visible:!0}).done(function(){t.model.contents.includeHidden||t.renderItems()}):u.a.when()},deleteHidden:function(){return window.confirm(g()("Really delete all hidden datasets?"))?this.model.contents._filterAndUpdate({visible:!1,deleted:"",purged:""},{deleted:!0,visible:!0}):u.a.when()},toString:function(){return"CurrentHistoryView(".concat(this.model?this.model.get("name"):"",")")}});ee.prototype.templates=(Zt=W.a.wrapTemplate(['<div class="quota-message errormessage">',g()("You are over your disk quota"),". ",g()("Tool execution is on hold until your disk usage drops below your allocated quota"),".","</div>"],"history"),o.a.extend(o.a.clone(te.prototype.templates),{quotaMsg:Zt}));var ie={CurrentHistoryView:ee},ne=p.a.View.extend({initialize:function(t,e){var i=this,n=Object(s.a)(),a=[];this.userIsAnonymous=n.user.isAnonymous(),this.allow_user_dataset_purge=e.config.allow_user_dataset_purge,this.root=e.root,this.historyView=new ie.CurrentHistoryView({className:"".concat(ie.CurrentHistoryView.prototype.className," middle"),purgeAllowed:this.allow_user_dataset_purge,linkTarget:"galaxy_main"}),n.currHistoryPanel=this.historyView,n.currHistoryPanel.listenToGalaxy(n),this.buttonRefresh=new v.a.ButtonLink({id:"history-refresh-button",title:g()("Refresh history"),cls:"panel-header-button",icon:"fa fa-refresh",onclick:function(){i.historyView.loadCurrentHistory()}}),a.push(this.buttonRefresh),this.userIsAnonymous||(this.buttonNew=new v.a.ButtonLink({id:"history-new-button",title:g()("Create new history"),cls:"panel-header-button",icon:"fa fa-plus",onclick:function(){n.currHistoryPanel.createNewHistory()}}),a.push(this.buttonNew)),this.buttonViewMulti=new v.a.ButtonLink({id:"history-view-multi-button",title:g()("View all histories"),cls:"panel-header-button",icon:"fa fa-columns",href:"".concat(this.root,"history/view_multiple")}),a.push(this.buttonViewMulti),this.buttonOptions=new v.a.ButtonLink({id:"history-options-button",title:g()("History options"),cls:"panel-header-button",target:"galaxy_main",icon:"fa fa-cog",href:"".concat(this.root,"root/history_options")}),a.push(this.buttonOptions),this.model=new p.a.Model({cls:"history-right-panel",title:g()("History"),buttons:a}),this.setElement(this._template()),this.historyView.setElement(this.$el),this.historyView.connectToQuotaMeter(n.quotaMeter),this.historyView.loadCurrentHistory(),n.listenTo(this.historyView,"history-size-change",function(){n.user.fetch({url:"".concat(n.user.urlRoot(),"/").concat(n.user.id||"current")})})},render:function(){this.optionsMenu=Kt(this.buttonOptions.$el,{anonymous:this.userIsAnonymous,purgeAllowed:this.allow_user_dataset_purge,root:this.root}),this.buttonViewMulti.$el[this.userIsAnonymous?"hide":"show"]()},_template:function(t){return['<div id="current-history-panel" class="history-panel middle"/>'].join("")},toString:function(){return"historyPanel"}}),ae=i(167);Object(n.a)(function(t,e){var i=e.options,a=void 0===i?{}:i;console.log("Analysis custom page setup");var r=Object.assign({},a,{config:Object.assign({},a.config,{hide_panels:t.params.hide_panels,hide_masthead:t.params.hide_masthead}),Left:Wt,Right:ne,Router:c.a.extend({routes:{"(/)(#)(_=_)":"home","(/)root*":"home","(/)tours(/)(:tour_id)":"show_tours","(/)user(/)":"show_user","(/)user(/)(:form_id)":"show_user_form","(/)pages(/)create(/)":"show_pages_create","(/)pages(/)edit(/)":"show_pages_edit","(/)pages(/)sharing(/)":"show_pages_sharing","(/)pages(/)(:action_id)":"show_pages","(/)visualizations(/)":"show_plugins","(/)visualizations(/)edit(/)":"show_visualizations_edit","(/)visualizations(/)sharing(/)":"show_visualizations_sharing","(/)visualizations/(:action_id)":"show_visualizations","(/)workflows/import":"show_workflows_import","(/)workflows/run(/)":"show_workflows_run","(/)workflows(/)list":"show_workflows","(/)workflows/list_published(/)":"show_workflows_published","(/)workflows/create(/)":"show_workflows_create","(/)histories(/)citations(/)":"show_history_citations","(/)histories(/)rename(/)":"show_histories_rename","(/)histories(/)sharing(/)":"show_histories_sharing","(/)histories(/)import(/)":"show_histories_import","(/)histories(/)permissions(/)":"show_histories_permissions","(/)histories/view":"show_history_view","(/)histories/show_structure":"show_history_structure","(/)histories(/)(:action_id)":"show_histories","(/)datasets(/)list(/)":"show_datasets","(/)custom_builds":"show_custom_builds","(/)datasets/edit":"show_dataset_edit_attributes","(/)datasets/error":"show_dataset_error"},require_login:["show_user","show_user_form","show_workflows"],authenticate:function(t,e){var i=Object(s.a)();return i.user&&i.user.id||-1==this.require_login.indexOf(e)},_display_vue_helper:function(t,e){var i=A.a.extend(t),n=document.createElement("div");this.page.display(n),new i(e).$mount(n)},show_tours:function(t){t?H.a.giveTourById(t):this.page.display(new H.a.ToursView)},show_user:function(){this.page.display(new V.View)},show_user_form:function(t){var e=Object(s.a)(),i=new V.Model({user_id:e.params.id});this.page.display(new S.a.View(o.a.extend(i.get(t),{active_tab:"user"})))},show_visualizations:function(t){var e="list_published"==t?"shared":"user";this.page.display(new q.View({action_id:t,plural:"Visualizations",item:"visualization",active_tab:e}))},show_visualizations_edit:function(){this.page.display(new S.a.View({url:"visualization/edit?id=".concat(E.a.get("id")),redirect:"visualizations/list",active_tab:"visualization"}))},show_visualizations_sharing:function(){var t=A.a.extend(R),e=document.createElement("div");this.page.display(e),new t({propsData:{id:E.a.get("id"),plural_name:"Visualizations",model_class:"Visualization"}}).$mount(e)},show_workflows_published:function(){var t=E.a.get("f-username");this.page.display(new U.a({url_base:"".concat(Object(n.b)(),"workflow/list_published"),active_tab:"shared",url_data:{"f-username":null==t?"":t}}))},show_history_view:function(){var t=A.a.extend(ct),e=document.createElement("div");this.page.display(e),new t({propsData:{id:E.a.get("id")}}).$mount(e)},show_history_structure:function(){var t=A.a.extend(st),e=document.createElement("div");this.page.display(e),new t({propsData:{id:E.a.get(" id: ")}}).$mount(e)},show_histories:function(t){var e=new ft.View({action_id:t});this.page.display(e)},show_history_citations:function(){var t=A.a.extend(Ct.a),e=document.createElement("div");this.page.display(e),new t({propsData:{id:E.a.get("id"),source:"histories"}}).$mount(e)},show_histories_rename:function(){this.page.display(new S.a.View({url:"history/rename?id=".concat(E.a.get("id")),redirect:"histories/list"}))},show_histories_sharing:function(){var t=A.a.extend(R),e=document.createElement("div");this.page.display(e),new t({propsData:{id:E.a.get("id"),plural_name:"Histories",model_class:"History"}}).$mount(e)},show_histories_import:function(){this._display_vue_helper(it)},show_histories_permissions:function(){this.page.display(new S.a.View({url:"history/permissions?id=".concat(E.a.get("id")),redirect:"histories/list"}))},show_datasets:function(){this.page.display(new U.a({url_base:"".concat(Object(n.b)(),"dataset/list"),active_tab:"user"}))},show_pages:function(t){var e="list_published"==t?"shared":"user";this.page.display(new q.View({action_id:t,plural:"Pages",item:"page",active_tab:e}))},show_pages_create:function(){this.page.display(new S.a.View({url:"page/create",redirect:"pages/list",active_tab:"user"}))},show_pages_edit:function(){this.page.display(new S.a.View({url:"page/edit?id=".concat(E.a.get("id")),redirect:"pages/list",active_tab:"user"}))},show_pages_sharing:function(){var t=A.a.extend(R),e=document.createElement("div");this.page.display(e),new t({propsData:{id:E.a.get("id"),plural_name:"Pages",model_class:"Page"}}).$mount(e)},show_plugins:function(){var t=A.a.extend(gt),e=document.createElement("div");this.page.display(e),(new t).$mount(e)},show_workflows:function(){this.page.display(new X.View)},show_workflows_create:function(){this.page.display(new S.a.View({url:"workflow/create",redirect:"workflow/editor",active_tab:"workflow"}))},show_workflows_run:function(){this._loadWorkflow()},show_workflows_import:function(){var t=A.a.extend(tt),e=document.createElement("div");this.page.display(e),(new t).$mount(e)},show_custom_builds:function(){var t=this,e=this.page.historyPanel.historyView;e&&e.model&&e.model.id?this.page.display(new F.View):window.setTimeout(function(){t.show_custom_builds()},500)},show_dataset_edit_attributes:function(){this.page.display(new kt.View)},show_dataset_error:function(){this.page.display(new yt.View)},home:function(t){t.tool_id||t.job_id?"upload1"===t.tool_id?(this.page.toolPanel.upload.show(),this._loadCenterIframe("welcome")):this._loadToolForm(t):t.workflow_id?this._loadWorkflow():t.m_c?this._loadCenterIframe("".concat(t.m_c,"/").concat(t.m_a)):this._loadCenterIframe("welcome")},_loadToolForm:function(t){t.tool_id&&(t.id=l()(t.tool_id)),t.version&&(t.version=l()(t.version)),this.page.display(new C.View(t))},_loadCenterIframe:function(t,e){t=(e=e||Object(n.b)())+t,this.page.$("#galaxy_main").prop("src",t)},_loadWorkflow:function(){var t=this;_.a.get({url:"".concat(Object(n.b)(),"api/workflows/").concat(_.a.getQueryString("id"),"/download?style=run"),success:function(e){t.page.display(new wt.View(o.a.extend(e,{active_tab:"workflow"})))},error:function(e){var i={message:e.err_msg||"Error occurred while loading the resource.",status:"danger",persistent:!0,active_tab:"workflow"};t.page.display(new v.a.Message(i))}})}})});t.page=new ae.a.View(r)}),window.addEventListener("load",function(){return Object(n.c)("analysis")})},88:function(t,e,i){"use strict";var n=i(0),a=i.n(n),o=i(3),s=i.n(o),r=i(8),l=i(5);e.a=s.a.Model.extend({initialize:function(){this.active={},this.last=null},execute:function(t){var e=this,i=r.a.uid(),n=t.length>0,o=Object(l.a)();this.active[i]=!0;var s=a.a.Deferred();s.promise().always(function(){delete e.active[i],n&&o.emit.debug("deferred::execute()","".concat(this.state().charAt(0).toUpperCase()+this.state().slice(1)," ").concat(i))}),a.a.when(this.last).always(function(){e.active[i]?(n&&o.emit.debug("deferred::execute()","Running ".concat(i)),t(s),!n&&s.resolve()):s.reject()}),this.last=s.promise()},reset:function(){var t=Object(l.a)();for(var e in t.emit.debug("deferred::execute()","Reset"),this.active)this.active[e]=!1},ready:function(){return a.a.isEmptyObject(this.active)}})},89:function(t,e,i){"use strict";var n=i(0),a=i.n(n),o=i(1),s=i.n(o),r=i(3),l=i.n(r).a.View.extend({initialize:function(t,e){this.$button=t,this.$button.length||(this.$button=a()("<div/>")),this.options=e||[],this.$button.data("popupmenu",this);var i=this;this.$button.click(function(t){return a()(".popmenu-wrapper").remove(),i._renderAndShow(t),!1})},_renderAndShow:function(t){this.render(),this.$el.appendTo("body").css(this._getShownPosition(t)).show(),this._setUpCloseBehavior()},render:function(){if(this.$el.addClass("popmenu-wrapper").hide().css({position:"absolute"}).html(this.template(this.$button.attr("id"),this.options)),this.options.length){var t=this;this.$el.find("li").each(function(e,i){var n=t.options[e];n.func&&a()(this).children("a.popupmenu-option").click(function(e){n.func.call(t,e,n),e.preventDefault()})})}return this},template:function(t,e){return['<ul id="',t,'-menu" class="dropdown-menu">',this._templateOptions(e),"</ul>"].join("")},_templateOptions:function(t){return t.length?s.a.map(t,function(t){return t.divider?'<li class="divider"></li>':t.header?['<li class="head"><a href="javascript:void(0);">',t.html,"</a></li>"].join(""):['<li><a class="popupmenu-option" href="',t.href||"javascript:void(0);",'"',t.target?' target="'.concat(t.target,'"'):"",">",t.checked?'<span class="fa fa-check"></span>':"",t.html,"</a></li>"].join("")}).join(""):"<li>(no options)</li>"},_getShownPosition:function(t){var e=this.$el.width(),i=t.pageX-e/2;return i=Math.min(i,a()(document).scrollLeft()+a()(window).width()-e-5),i=Math.max(i,a()(document).scrollLeft()+5),{top:t.pageY,left:i}},_setUpCloseBehavior:function(){var t=this;function e(e){a()(document).off("click.close_popup");try{window&&window.parent!==window?a()(window.parent.document).off("click.close_popup"):a()("iframe#galaxy_main").contents().off("click.close_popup")}catch(t){t instanceof DOMException?console.debug("Error clearing parent popups, likely cross-origin frame access from the toolshed and not problematic."):console.debug(t)}t.remove()}a()("html").one("click.close_popup",e);try{window&&window.parent!==window?a()(window.parent.document).find("html").one("click.close_popup",e):a()("iframe#galaxy_main").contents().one("click.close_popup",e)}catch(t){t instanceof DOMException?console.debug("Error clearing parent popups, likely cross-origin frame access from the toolshed and not problematic."):console.debug(t)}},addItem:function(t,e){return e=e>=0?e:this.options.length,this.options.splice(e,0,t),this},removeItem:function(t){return t>=0&&this.options.splice(t,1),this},findIndexByHtml:function(t){for(var e=0;e<this.options.length;e++)if(s.a.has(this.options[e],"html")&&this.options[e].html===t)return e;return null},findItemByHtml:function(t){return this.options[this.findIndexByHtml(t)]},toString:function(){return"PopupMenu"}});l.create=function(t,e){return new l(t,e)},l.make_popupmenu=function(t,e){var i=[];return s.a.each(e,function(t,e){var n={html:e};null===t?n.header=!0:"function"===a.a.type(t)&&(n.func=t),i.push(n)}),new l(a()(t),i)},l.convertLinksToOptions=function(t,e){t=a()(t),e=e||"a";var i=[];return t.find(e).each(function(t,e){var n={},o=a()(t);if(n.html=o.text(),o.attr("href")){var s=o.attr("href"),r=o.attr("target"),l=o.attr("confirm");n.func=function(){if(!l||confirm(l))switch(r){case"_parent":window.parent.location=s;break;case"_top":window.top.location=s;break;default:window.location=s}}}i.push(n)}),i},l.fromExistingDom=function(t,e,i){t=a()(t),e=a()(e);var n=l.convertLinksToOptions(e,i);return e.remove(),new l(t,n)},l.make_popup_menus=function(t,e,i){t=t||document,e=e||"div[popupmenu]",i=i||function(t,e){return"#".concat(t.attr("popupmenu"))};var n=[];return a()(t).find(e).each(function(){var e=a()(this),o=a()(t).find(i(e,t));n.push(l.fromDom(o,e)),o.addClass("popup")}),n},e.a=l},93:function(t,e,i){"use strict";var n=i(0),a=i.n(n),o=i(1),s=i.n(o),r=i(3),l=i.n(r),c=i(5),d=160,u=800,h=l.a.View.extend({initialize:function(t){this.view=t.view,this.hidden=!1,this.saved_size=null,this.hiddenByTool=!1},$center:function(){return this.$el.siblings("#center")},$toggleButton:function(){return this.$(".unified-panel-footer > .panel-collapse")},render:function(){var t=this,e=this.view,i=this.view.model.attributes||{};this.$el.html(this._templatePanel(this.id)),s.a.each(i.buttons,function(e){t.$(".panel-header-buttons").append(e.$el)}),this.$el.addClass(i.cls),this.$(".panel-header-text").html(s.a.escape(i.title)),this.$(".unified-panel-body").append(e.$el),e.render()},_templatePanel:function(){return[this._templateHeader(),this._templateBody(),this._templateFooter()].join("")},_templateHeader:function(t){return'<div class="unified-panel-header" unselectable="on">\n                    <div class="unified-panel-header-inner">\n                        <div class="panel-header-buttons"/>\n                        <div class="panel-header-text"/>\n                    </div>\n                </div>\n                <div class="unified-panel-controls"/>'},_templateBody:function(t){return'<div class="unified-panel-body"/>'},_templateFooter:function(t){return['<div class="unified-panel-footer">','<div class="panel-collapse ',s.a.escape(this.id),'"/>','<div class="drag"/>',"</div>"].join("")},events:{"mousedown .unified-panel-footer > .drag":"_mousedownDragHandler","click .unified-panel-footer > .panel-collapse":"toggle"},_mousedownDragHandler:function(t){var e=this,i="left"===this.id,n=t.pageX,o=e.$el.width();function s(t){var a=t.pageX-n,s=i?o+a:o-a;s=Math.min(u,Math.max(d,s)),e.resize(s)}a()("#dd-helper").show().on("mousemove",s).one("mouseup",function(t){a()(this).hide().off("mousemove",s)})},resize:function(t){return this.$el.css("width",t),this.$center().css(this.id,t),this},show:function(){if(this.hidden){var t=this,e={},i=this.id;return e[i]=0,t.$el.css(i,-this.saved_size).show().animate(e,"fast",function(){t.resize(t.saved_size)}),t.hidden=!1,t.$toggleButton().removeClass("hidden"),this}},hide:function(){if(!this.hidden){var t={},e=this.id;return this.saved_size=this.$el.width(),t[e]=-this.saved_size,this.$el.animate(t,"fast"),this.$center().css(e,0),this.hidden=!0,this.$toggleButton().addClass("hidden"),this}},toggle:function(t){return this.hidden?this.show():this.hide(),this.hiddenByTool=!1,this},handle_minwidth_hint:function(t){return this.$center().width()-(this.hidden?this.saved_size:0)<t?this.hidden||(this.toggle(),this.hiddenByTool=!0):this.hiddenByTool&&(this.toggle(),this.hiddenByTool=!1),self},force_panel:function(t){return"show"==t?this.show():"hide"==t?this.hide():self},toString:function(){return"SidePanel(".concat(this.id,")")}}),p=h.extend({id:"left"}),f=h.extend({id:"right"}),m=l.a.View.extend({initialize:function(t){this.setElement(a()(this.template())),this.$frame=this.$(".center-frame"),this.$panel=this.$(".center-panel"),this.$frame.on("load",this._iframeChangeHandler.bind(this))},_iframeChangeHandler:function(t){var e=t.currentTarget,i=e.contentWindow&&e.contentWindow.location,n=Object(c.a)();try{i&&i.host&&(a()(e).show(),this.$panel.empty().hide(),n.trigger("center-frame:load",{fullpath:i.pathname+i.search+i.hash,pathname:i.pathname,search:i.search,hash:i.hash}))}catch(e){console.warn("_iframeChangeHandler error",t,i,n)}},display:function(t){var e,i=Object(c.a)(),n=this.$frame[0].contentWindow||{};try{e=n.onbeforeunload&&n.onbeforeunload()}catch(t){n={},console.warn("Iframe unload exception.  This can happen when external content is displayed in the page iframe and causes a CORS violation -- likely harmless.")}e&&!confirm(e)||(n.onbeforeunload=void 0,this.$frame.attr("src","about:blank").hide(),this.$panel.empty().scrollTop(0).append(t.$el||t).show(),i.trigger("center-panel:load",t))},template:function(){return'<div class="center-container"><iframe id="galaxy_main" name="galaxy_main" frameborder="0" class="center-frame" /><div class="center-panel" /></div>'},toString:function(){return"CenterPanel"}});e.a={SidePanel:h,LeftPanel:p,RightPanel:f,CenterPanel:m}},95:function(t,e,i){},96:function(t,e,i){},97:function(t,e,i){},98:function(t,e,i){},99:function(t,e,i){}});